!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).augLoop=e()}}((function(){return function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,(function(e){return r(t[s][1][e]||e)}),l,l.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(2),n)},{2:2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isStopWorkflowMessage=n.setStopAndFilterWorkflowMessage=n.setMessageException=n.getMessageExceptionType=n.getMessageExceptionDescription=n.filterWorkflowSchema=n.exceptionSchema=void 0;var o=e(88);n.exceptionSchema={category:o.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},n.filterWorkflowSchema={category:o.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}};n.getMessageExceptionDescription=function(e,t){if(void 0===t&&(t=!1),null==e)return"Invalid message passed";if(null==e.payload)return o.ExceptionType[o.ExceptionType.NoOutput]+": Payload is null";if(null==e.payload.exceptionType)return"Payload is not an exception";var n=o.ExceptionType[e.payload.exceptionType];return n+=e.payload.message?": "+e.payload.message:": No description",n+=t&&e.payload.data?"\n"+e.payload.data.toString():""};n.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?o.ExceptionType.Unknown:e.payload.exceptionType};n.setMessageException=function(e,t){if(null==e)throw new Error("Cannot set exception on null message");e.payload=t,e.payloadSchema=n.exceptionSchema,e.messageType=o.MessageType.Exception};n.setStopAndFilterWorkflowMessage=function(e,t){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:t};e.payload=r,e.payloadSchema=n.filterWorkflowSchema,e.messageType=o.MessageType.StopAndFilterWorkflow};n.isStopWorkflowMessage=function(e){return(e||{}).messageType==o.MessageType.StopAndFilterWorkflow}},{88:88}],3:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(8),n),o(e(9),n)},{8:8,9:9}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ReduceTimerCache=void 0;var o=function(){function e(){this.cache=new Map}return e.prototype.setReduceTimer=function(e,t,n,o,r,i){var s=this;void 0===o&&(o=500),void 0===r&&(r=function(){return!1}),void 0===i&&(i=5e3),this.cache.has(e)||this.cache.set(e,new Map);var a=this.cache.get(e);a.has(t)&&clearTimeout(a.get(t).timer);var c=function(){var c=a.get(t),u=Date.now()-c.start;r()&&u<i?c.timer=setTimeout(c.timerCallback,Math.min(o,i-u)):(a.size>1?a.delete(t):s.cache.delete(e),n())};a.set(t,{start:Date.now(),timerCallback:c,timer:setTimeout(c,o)})},e.prototype.clear=function(e,t){this.cache.forEach((function(n,o){e&&e!==o||n.forEach((function(e,n){t&&t!==n||clearTimeout(e.timer)}))})),this.cache.clear()},e}();n.ReduceTimerCache=o},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.executeRemoteLambda=n.clearTokenCache=void 0;var o,r=e(30),i=e(62),s=e(88);n.clearTokenCache=function(){o=new i.TokenCache},(0,n.clearTokenCache)();var a=function(e,t,n,c,u,l,p,f,d,h){var g={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":u},body:JSON.stringify({payload:t.payload,payloadSchema:n,requestedSchema:c,clientMetadata:l,tokens:o.getAuthTokenEntries(p,d.docId)})};(0,i.internalFetch)(e,g,(function(i,g){i?h(new Error("Fetch error in remote lambda request to "+e+": "+i)):401===g.status?f>0?(r.Log.info(572838109,r.LogCategory.CoreDefault,"Auth token required for remote lambda request"),g.json().then((function(e){return o.updateAuthToken(p,{Tickets:[e],DocId:d.docId})})).then((function(){a(e,t,n,c,u,l,p,f-1,d,h)})).catch((function(e){h({exceptionType:s.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:s.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):g.ok?g.json().then((function(e){if(Array.isArray(e))if(e.length>0)for(var n=0,o=0,r=e;o<r.length;o++){var i=r[o];t.moreResults=++n<e.length,h(null,i)}else h(new Error("No output"));else h(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){h({exceptionType:s.ExceptionType.LambdaThrow,message:e.message})})):h(new Error("Remote lambda request failed with status "+g.status))}))};n.executeRemoteLambda=function(e,t,n,r,i,c,u,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(u,{Tickets:l.authTickets,DocId:l.docId}).then((function(){a(e,t,n,r,i.id,c,u,1,l,p)})).catch((function(e){p({exceptionType:s.ExceptionType.Authentication,message:e.message})})):a(e,t,n,r,i.id,c,u,1,l,p)}},{30:30,62:62,88:88}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.testWebSocketConnection=n.executeRemoteLambda=n.clearTokenCache=void 0;var o,r=e(30),i=e(62),s=e(88),a=e(11);n.clearTokenCache=function(){o=new i.TokenCache},(0,n.clearTokenCache)();var c=new a.WebSocketRequestManager(3e4,(function(){return new i.WebSocketWorker}),50),u=function(e,t,n,i,a,l,p,f,d,h){var g={payload:t.payload,payloadSchema:n,requestedSchema:i,clientMetadata:l,tokens:o.getAuthTokenEntries(p,d.docId)},y="";i&&i.schema&&(y=i.schema.name);var m=!1;c.addRequest(e,g,a,y,(function(c,g,y){if(!m)if(m=!0,null!=g)if(g.exceptionType===s.ExceptionType.Authentication)try{var v=JSON.parse(g.data);f>0?(r.Log.info(572838108,r.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),o.updateAuthToken(p,{Tickets:[v],DocId:d.docId}).then((function(){u(e,t,n,i,a,l,p,f-1,d,h)})).catch((function(e){h({exceptionType:s.ExceptionType.Authentication,message:e.message})}))):h({exceptionType:s.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){h({exceptionType:s.ExceptionType.Authentication,message:e.message})}else h(new Error("Error in remote lambda WebSocket request to "+e+": "+g));else t.moreResults=!1,h(null,c)}))};n.executeRemoteLambda=function(e,t,n,r,i,a,c,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(c,{Tickets:l.authTickets,DocId:l.docId}).then((function(){u(e,t,n,r,i.id,a,c,1,l,p)})).catch((function(e){p({exceptionType:s.ExceptionType.Authentication,message:e.message})})):u(e,t,n,r,i.id,a,c,1,l,p)};n.testWebSocketConnection=function(e,t){return c.testConnection(e,t)}},{11:11,30:30,62:62,88:88}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ResultCache=void 0;var o=function(){function e(){this.cache=new Map,this.bucketSizes=new Map}return e.prototype.setBucketSize=function(e,t){this.bucketSizes.set(e,t)},e.prototype.setResult=function(e,t,n){if(t.primary){var o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));var r=o.get(t.primary);if(r||(r=t.secondary?new Map:[],o.set(t.primary,r)),t.secondary){r.set(t.secondary,n)}else{var i=r;i.length==this.getBucketSize(e)&&i.shift(),i.push(n)}}},e.prototype.getResults=function(e,t){var n=this.cache.get(e);if(n){var o=n.get(t.primary);if(o){if(!t.secondary)return o;var r=Array.from(o.values());if(r.length>0)return r}}return[]},e.prototype.clear=function(e,t){t?this.cache.forEach((function(n,o){if(!e||e===o)if(t.secondary){var r=n.get(t.primary);r&&r.delete(t.secondary)}else n.delete(t.primary)})):e?this.cache.delete(e):this.cache.clear()},e.prototype.getBucketSize=function(e){return this.bucketSizes.get(e)||10},e}();n.ResultCache=o},{}],8:[function(e,t,n){"use strict";var o=e("assignHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.runtimeALv1=n.ClientRuntimeALv1=n.getTypeFromSchema=n.Workflow=void 0;var r,i=e(1),s=e(30),a=e(62),c=e(88),u=e(4),l=e(5),p=e(6),f=e(7),d=e(9),h=e(10);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(r||(r={}));var g=function(){function e(){this.canaryTextTileEventSubmittedByDocSessionId=new Set,this.stateByDocSessionId=new Map,this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map}return e.prototype.getOutputSchema=function(){return this.lambdas[this.lambdas.length-1].outputSchema},e.prototype.scheduleExecution=function(e,t){var n=this.docSessionIdExtractor?this.docSessionIdExtractor(e):void 0,o=this.getStateForDocSessionId(n);if(o===r.Restricted){var i=this.getExecutionQueueForDocSessionId(n);i.push(t),1===i.length&&t()}else o===r.Unrestricted?t():r.Suppressed},e.prototype.onStart=function(e){this.incrementExecutionCountForDocSessionId(e)},e.prototype.onFinish=function(e,t){if(this.decrementExecutionCountForDocSessionId(e),t===c.ExceptionType.Authentication)this.stateByDocSessionId.set(e,r.Suppressed),this.executionQueueByDocSessionId.delete(e);else if(this.stateByDocSessionId.get(e)===r.Restricted){var n=this.getExecutionQueueForDocSessionId(e);if(n.shift(),void 0===t){this.stateByDocSessionId.set(e,r.Unrestricted),this.executionQueueByDocSessionId.delete(e);for(var o=0,i=n;o<i.length;o++){(0,i[o])()}}else if(n.length>0){(0,n[0])()}}},e.prototype.onRefresh=function(e){this.stateByDocSessionId=new Map,this.triggerOnRefresh&&(e?(this.executionQueueByDocSessionId.delete(e),this.executionCountByDocSessionId.delete(e)):(this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map)),this.canaryTextTileEventSubmittedByDocSessionId.delete(e)},e.prototype.getStateForDocSessionId=function(t){var n=this.stateByDocSessionId.get(t);return void 0===n&&(n=e.executionQueuesEnabled?r.Restricted:r.Unrestricted,this.stateByDocSessionId.set(t,n)),n},e.prototype.getExecutionQueueForDocSessionId=function(e){var t=this.executionQueueByDocSessionId.get(e);return void 0===t&&(t=[],this.executionQueueByDocSessionId.set(e,t)),t},e.prototype.incrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;this.executionCountByDocSessionId.set(e,t+1)},e.prototype.decrementExecutionCountForDocSessionId=function(e){var t=this.executionCountByDocSessionId.get(e)||0;t<=1?this.executionCountByDocSessionId.delete(e):this.executionCountByDocSessionId.set(e,t-1)},e.executionQueuesEnabled=!0,e}();n.Workflow=g;n.getTypeFromSchema=function(e){return{category:c.TypeCategory.Schema,schema:{name:e}}};var y="Tiling.TextTileEvent",m=function(e,t){return e===y&&t&&t.type==c.Tiling.TextTileEventType.Refresh},v=function(e,t){return"ClpSlideTile"===e&&t&&t.eventType==c.Ppt.SlideTileEventType.Refresh},T=function(e,t){return m(e,t)||v(e,t)},S=function(e,t){var n,o;return e===y?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.docSessionId:"ClpSlideTile"===e?t.docId:void 0},w=function(){function e(){this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new f.ResultCache,this.reduceTimerCache=new u.ReduceTimerCache,this.lookupTableCache=new Map,this.throttling=new h.ExecutionWithThrottling,this.lastTileRefreshSeq=-1,this.lastTileRefreshSeqByDocSessionId=new Map,this.tileRefreshByDocSessionIdEnabled=!0}return e.prototype.init=function(e,t,n){var o=this,r=new s.Operation({operationName:"InitRuntimeALv1",resourceId:e});r.start(),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,a.getVersion)()),this.hostCallbacks=n;var i=[];return i.push(this.isFeatureEnabled("DisableWebSocket").then((function(n){if(!!n)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf(t.appName+" "+t.appPlatform)>=0)||p.testWebSocketConnection(a.Utils.convertServiceUrlToWebSocket(e),o.clientMetadata)})).then((function(t){e&&(o.serviceUrl=t?a.Utils.convertServiceUrlToWebSocket(e):e,o.executeRemoteLambda=t?p.executeRemoteLambda:l.executeRemoteLambda,o.clearRemoteLambdaTokenCache=t?p.clearTokenCache:l.clearTokenCache,o.serviceProtocol=o.serviceUrl.split(":")[0].toLowerCase())}))),i.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){g.executionQueuesEnabled=!e}))),i.push(this.isFeatureEnabled("TileRefreshByDocSessionIdDisabled").then((function(e){o.tileRefreshByDocSessionIdEnabled=!e}))),Promise.all(i).then((function(){o.logOperation(r,!0)})).catch((function(e){o.logOperation(r,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerSchemas=function(e,t){return Promise.resolve()},e.prototype.registerSimpleLocalWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),t.source=t.source||d.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,n)},e.prototype.registerSimpleRemoteWorkflow=function(e,t,n,o,r){void 0===r&&(r=this.defaultWorkflowOptions);var i=[];return t&&(t.source=d.LambdaSource.Custom,i.push(t)),n.source=n.func?d.LambdaSource.Custom:d.LambdaSource.Remote,i.push(n),o&&(o.source=d.LambdaSource.Custom,i.push(o)),this.registerHardcodedWorkflow(e,i,this.inputSchemasToWorkflows,r)},e.prototype.registerMultipleLambdasWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,n)},e.prototype.registerReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,n),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||d.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)},e.prototype.registerMultipleLambdasReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,n),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)},e.prototype.submit=function(e,t,n){this.submitToWorkflows(e,t,n,this.inputSchemasToWorkflows)},e.prototype.getGroupingKey=function(e,t,n){var o=this.reduceWorkflowsGroupingKeyExtractors.get(n);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)},e.prototype.submitToWorkflows=function(e,t,n,o){if(void 0===o&&(o=this.inputSchemasToWorkflows),this.hostCallbacks){var r;r=n?s.CorrelationVector.fromString(n):new s.CorrelationVector,this.handleTileRefresh(e,t,r);for(var i,a=0,c=o.get(e)||[];a<c.length;a++){var u=c[a];T(e,t)&&!u.triggerOnRefresh||(u.useCanaryTextTile&&e===y&&!u.canaryTextTileEventSubmittedByDocSessionId.has(S(e,t))&&(this.submitToWorkflow(y,{type:(i=t).type,tile:{metadata:{docSessionId:i.tile.metadata.docSessionId,docId:i.tile.metadata.docId,seqnoCLPRefresh:i.tile.metadata.seqnoCLPRefresh,tileId:"A56B3127DBDFD0D6"},elements:[{text:"B91153AE828B4E48"}]}},r,u,o),u.canaryTextTileEventSubmittedByDocSessionId.add(S(e,t))),this.submitToWorkflow(e,t,r,u,o))}}},e.prototype.submitToWorkflow=function(e,t,o,r,i){var a=this,u={messageType:c.MessageType.Input,correlationVector:o.newChild(),payload:t,payloadSchema:(0,n.getTypeFromSchema)(r.lambdas[0].inputSchema),clientMetadata:this.clientMetadata},l=new s.Operation({cv:u.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:r.name});l.start(),r.scheduleExecution(t,(function(){try{if(u.payload&&u.payload.tile&&u.payload.tile.metadata&&u.payload.tile.metadata.tileId){var n=u.payload.tile.metadata.tileId;a.throttling.execute(n,r,(function(){return a.executeWorkflow(l,u,t,r,e,i)}))}else a.executeWorkflow(l,u,t,r,e,i)}catch(e){l.success=!1,l.resultSignature="ExecuteException",l.resultDescription=e?e.message:"(no error)",s.Log.error(559290447,s.LogCategory.CoreDefault,l.stop())}}))},e.prototype.handleTileRefresh=function(e,t,n){var o=this;if(T(e,t)){var r=this.tileRefreshByDocSessionIdEnabled?S(e,t):void 0,i=function(e,t){var n,o;return m(e,t)?null===(o=null===(n=t.tile)||void 0===n?void 0:n.metadata)||void 0===o?void 0:o.seqnoCLPRefresh:(v(e,t),-1)}(e,t);if(this.tileRefreshByDocSessionIdEnabled){var a=this.lastTileRefreshSeqByDocSessionId.get(r);if(a>=0&&i<=a)return}else if(i<=this.lastTileRefreshSeq)return;var c=new s.Operation({cv:n.toString(),operationName:"TileRefresh",resultDescription:"",success:!0});if(c.start(),this.tileRefreshByDocSessionIdEnabled&&!r)return c.success=!1,c.resultDescription="NoDocSessionId",void s.Log.info(559290448,s.LogCategory.CoreDefault,c.stop());this.inputSchemasToReduceWorkflows.forEach((function(e,t){e.some((function(e){return e.triggerOnRefresh}))&&(o.tileRefreshByDocSessionIdEnabled?(o.resultCache.clear(t,{primary:r}),o.resultCache.clear(o.getForcedDocLevelSchema(t),{primary:r}),o.reduceTimerCache.clear(t,r)):(o.resultCache.clear(t),o.resultCache.clear(o.getForcedDocLevelSchema(t)),o.reduceTimerCache.clear(t)),e.some((function(e){return!e.triggerOnRefresh}))&&(c.resultDescription+="X_"),c.resultDescription+=t+" ")})),this.clearRemoteLambdaTokenCache();var u=[];this.inputSchemasToWorkflows.forEach((function(e){return u.push.apply(u,e)})),this.inputSchemasToReduceWorkflows.forEach((function(e){return u.push.apply(u,e)}));for(var l=0,p=u;l<p.length;l++){var f=p[l];this.tileRefreshByDocSessionIdEnabled?f.onRefresh(r):f.onRefresh()}this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.set(r,i):this.lastTileRefreshSeq=i,s.Log.info(559290449,s.LogCategory.CoreDefault,c.stop())}},e.prototype.executeWorkflow=function(e,t,n,o,r,a){var u=this,l=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,p=o.docSessionIdExtractor(n),f=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(p):this.lastTileRefreshSeq;o.onStart(p);var d=function(t){var l=u.tileRefreshByDocSessionIdEnabled?u.lastTileRefreshSeqByDocSessionId.get(p):u.lastTileRefreshSeq;if(o.triggerOnRefresh&&l!==f)return e.success=!0,e.resultSignature="TileRefreshIgnore",void s.Log.info(559290450,s.LogCategory.CoreDefault,e.stop());var d=t.messageType==c.MessageType.Exception&&t.payload.exceptionType==c.ExceptionType.NoOutput,h=d&&o.canProduceNullResult,g=h?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,y=h?null:t.payload;t.messageType===c.MessageType.Input||h?(o.shouldSendResultsToHost&&(a===u.inputSchemasToReduceWorkflows?u.hostCallbacks.onResult("Reduce.Input",n,g,y):u.hostCallbacks.onResult(r,n,g,y)),e.success=!0,e.resultSignature=d?"NoOutput":"ValidOutput"):d?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=(0,i.getMessageExceptionDescription)(t)),a!==u.inputSchemasToReduceWorkflows&&u.updateResultCacheForReduceWorkflows(r,n,g,y,t.correlationVector.toString()),t.moreResults||(e.stop(),s.Log.info(559290451,s.LogCategory.CoreDefault,e),o.onFinish(p,t.payload&&t.payload.exceptionType?(0,i.getMessageExceptionType)(t):void 0))};o.preExecutionPromise.then((function(){for(var e={lookupTable:u.lookupTableCache.get(o.name),docId:l,docSessionId:p},n=d,r=o.lambdas.length-1;r>=0;r--)n=u.createLambdaExecutionStep(o.name,o.lambdas[r],e,n,d);n(t)}))},e.prototype.getForcedDocLevelSchema=function(e){return"~"+e},e.prototype.updateResultCacheForReduceWorkflows=function(e,t,n,o,r){var i=this,a=this.inputSchemasToReduceWorkflows.get(n);if(a){var u;"docSessionId"===e?(u=this.getGroupingKey(e,t,n),this.resultCache.setResult(this.getForcedDocLevelSchema(n),u,o),u.secondary="*"):(u=this.getGroupingKey(e,t,n),!function(e,t){return e===y&&t&&t.type==c.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==c.Ppt.SlideTileEventType.Delete}(e,t)||null==u.primary||null==u.secondary?this.resultCache.setResult(n,u,o):this.resultCache.clear(void 0,u));var l=a.some((function(e){return e.deferReduceUntilIdle})),p=[];this.inputSchemasToWorkflows.forEach((function(e){return p.push.apply(p,e.filter((function(e){return e.getOutputSchema()===n})))}));var f=a.map((function(e){return e.deferReduceUntilIdleMaxDelayMs||0})).reduce((function(e,t){return Math.max(e,t)}));this.reduceTimerCache.setReduceTimer(n,u.primary,(function(){var e=i.resultCache.getResults(n,u);if(e.push.apply(e,i.resultCache.getResults(i.getForcedDocLevelSchema(n),{primary:u.primary})),Array.isArray(e)){var t={id:u.primary,values:e,isReduceInput:!0};i.submitToWorkflows(n,t,r,i.inputSchemasToReduceWorkflows)}else s.Log.error(559290452,s.LogCategory.CoreDefault,'Cached results have unexpected type "'+typeof e+'"')}),500,(function(){return l&&p.some((function(e){return e.executionCountByDocSessionId.get(u.primary)>0}))}),f)}},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)},e.prototype.areLicenseFeaturesEnabled=function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)},e.prototype.isWorkflowEnabled=function(e,t,n,o,r){var i=this;if(t.some((function(e){return e.source===d.LambdaSource.Remote||e.source===d.LambdaSource.BatchedRemote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return(e.source===d.LambdaSource.Remote||e.source===d.LambdaSource.BatchedRemote)&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,r.resultDescription="Enabled by default due to platform name"),(o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e)).then((function(t){return t?i.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!n||i.areLicenseFeaturesEnabled(n).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))},e.prototype.registerHardcodedWorkflow=function(e,t,o,r){var i=this;if(void 0===o&&(o=this.inputSchemasToWorkflows),!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");o.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var a=new s.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return a.setClientMetadata(this.clientMetadata),a.start(),this.isWorkflowEnabled(e,t,r.licenseFeatures,r.enabledByDefault,a).then((function(u){if(a.resultSignature=u?"Enabled":"Disabled",a.stop(),s.Log.info(559290453,s.LogCategory.CoreDefault,a),u){var l=t[0].inputSchema,p=o.get(l);p||(p=[],o.set(l,p));var f=Promise.resolve();r.lookupTableLambda&&(f=new Promise((function(t,o){var a=new s.CorrelationVector,u={messageType:c.MessageType.Input,correlationVector:a,payloadSchema:(0,n.getTypeFromSchema)(r.lookupTableLambda.inputSchema),clientMetadata:i.clientMetadata,payload:{}},l=function(n){n.messageType===c.MessageType.Input&&n.payload&&i.lookupTableCache.set(e,n.payload),t()};i.createLambdaExecutionStep("",r.lookupTableLambda,{},l,l)(u)})));var d=new g;d.name=e,d.lambdas=t,d.canProduceNullResult=r.canProduceNullResult,d.shouldSendResultsToHost=r.shouldSendResultsToHost,d.triggerOnRefresh=r.triggerOnRefresh,d.throttleSettings=r.throttleSettings||i.defaultWorkflowOptions.throttleSettings,d.docIdExtractor=r.docIdExtractor,d.docSessionIdExtractor=function(e){return e.isReduceInput?e.id:S(l,e)},d.deferReduceUntilIdle=r.deferReduceUntilIdle,d.deferReduceUntilIdleMaxDelayMs=r.deferReduceUntilIdleMaxDelayMs,d.useCanaryTextTile=r.useCanaryTextTile,d.preExecutionPromise=f,p.push(d)}}))},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,s.Log.info(559290454,s.LogCategory.CoreDefault,e)},e.prototype.handleLambdaError=function(e,t,n,o,r){null!=e.exceptionType?(0,i.setMessageException)(t,e):e instanceof Error?(0,i.setMessageException)(t,{exceptionType:o,message:e.message}):(0,i.setMessageException)(t,{exceptionType:c.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(n,!1,"Exception",(0,i.getMessageExceptionDescription)(t)),r(t)},e.prototype.handleLambdaOutput=function(e,t,o,r,s,a){e&&e.exceptionType!==c.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,t,o,e.exceptionType,a):e instanceof Error?this.handleLambdaError(e,t,o,c.ExceptionType.LambdaErrorCallback,a):(t.payload=e,t.payloadSchema=(0,n.getTypeFromSchema)(r),this.logOperation(o,!0),s(t)):((0,i.setMessageException)(t,{exceptionType:c.ExceptionType.NoOutput}),this.logOperation(o,!0,"NoOutput"),a(t))},e.prototype.executeCustomLambdaStep=function(e,t,n,o,r,s){var a=this;if(null==n.func)(0,i.setMessageException)(e,{exceptionType:c.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",(0,i.getMessageExceptionDescription)(e)),s(e);else{try{n.func(e.payload,n.config,o,(function(o){a.handleLambdaOutput(o,e,t,n.outputSchema,r,s)}),(function(n,o){a.handleLambdaOutput(n,e,t,o,s,s)}))}catch(n){this.handleLambdaError(n,e,t,c.ExceptionType.LambdaThrow,s)}}},e.prototype.executeLocalLambdaStep=function(e,t,n,o,r){var s=this;null==this.hostCallbacks.executeLocalLambda?((0,i.setMessageException)(e,{exceptionType:c.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",(0,i.getMessageExceptionDescription)(e)),r(e)):this.hostCallbacks.executeLocalLambda(n.inputSchema,e.payload,n.outputSchema).then((function(i){s.handleLambdaOutput(i,e,t,n.outputSchema,o,r)})).catch((function(n){s.handleLambdaError(n,e,t,c.ExceptionType.LambdaThrow,r)}))},e.prototype.executeRemoteLambdaStep=function(e,t,o,r,s,u){var l=this;if(this.serviceUrl){t.resourceId+="."+this.serviceProtocol;var p=function(n,r){n?l.handleLambdaError(n,e,t,n.exceptionType||c.ExceptionType.LambdaErrorCallback,u):l.handleLambdaOutput(r,e,t,o.outputSchema,s,u)};if(r.authTickets=o.authTickets,o.source===d.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,(0,n.getTypeFromSchema)(o.inputSchema),(0,n.getTypeFromSchema)(o.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,p);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new a.BatchManager((function(e,t,o){var r=t.context,i=r.remoteLambda,s=r.lambdaContext;l.executeRemoteLambda(l.serviceUrl,{messageType:c.MessageType.Input,correlationVector:{id:t.cv},payload:e,payloadSchema:(0,n.getTypeFromSchema)(i.inputSchema),clientMetadata:l.clientMetadata},(0,n.getTypeFromSchema)(i.remoteInputSchema),(0,n.getTypeFromSchema)(i.remoteOutputSchema),{id:t.cv},l.clientMetadata,l.hostCallbacks,s,o)}),(function(e,t,n){var o,r=n.lambdaContext;l.updateResultCacheForReduceWorkflows("docSessionId",null!==(o=r.docSessionId)&&void 0!==o?o:r.docId,e,t)})));var f=o.batchOptions,h=this.normalizeBatchOptions(f),g=h.groupingKeyExtractor;h.groupingKeyExtractor=function(e){return o.name+"-"+g(e)};var y={name:o.name,remoteLambda:o,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,h,y,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,void 0,p)}}else(0,i.setMessageException)(e,{exceptionType:c.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(t,!1,"Error",(0,i.getMessageExceptionDescription)(e)),u(e)},e.prototype.createLambdaExecutionStep=function(e,t,n,o,r){var a=this;return function(u){var l=new s.Operation({cv:u.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});l.start(),t.source===d.LambdaSource.Custom?a.executeCustomLambdaStep(u,l,t,n,o,r):t.source===d.LambdaSource.Local?a.executeLocalLambdaStep(u,l,t,o,r):t.source===d.LambdaSource.Remote||t.source===d.LambdaSource.BatchedRemote?a.executeRemoteLambdaStep(u,l,t,n,o,r):((0,i.setMessageException)(u,{exceptionType:c.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),a.logOperation(l,!1,"Error",(0,i.getMessageExceptionDescription)(u)),r(u))}},e.prototype.normalizeBatchOptions=function(e){if(!e)throw new Error("Expected batchConfig");var t=o({},e);return e.estimateSize||(t.estimateSize=a.estimateSize),t},e}();n.ClientRuntimeALv1=w,n.runtimeALv1=new w},{1:1,10:10,30:30,4:4,5:5,6:6,62:62,7:7,88:88,9:9}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(n.LambdaSource||(n.LambdaSource={}))},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExecutionWithThrottling=void 0;var o=e(62),r=function(){function e(){this.throttleInfoMap=new Map}return e.prototype.execute=function(e,t,n){var r=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var i=this.getWorkflowThrottleInfo(t.name);if(null==i.currentTileId)i.currentTileId=e,i.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n();else if(i.currentTileId===e){var s=o.Utils.getCurrentTimeMs(),a=this.delayTime(i,s,t.throttleSettings.throttlingInterval);a>0?(i.latestCallback=n,null==i.lastTimeout&&(i.lastTimeout=setTimeout((function(){var e=r.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),e.latestCallback()}),a))):(i.timeOfPreviousStartedEvent=s,n())}else null!=i.lastTimeout&&(clearTimeout(i.lastTimeout),i.latestCallback(),i.lastTimeout=void 0),i.currentTileId=e,i.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n()}else n()},e.prototype.delayTime=function(e,t,n){var o=t-e.timeOfPreviousStartedEvent;return Math.max(n-o,0)},e.prototype.getWorkflowThrottleInfo=function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t},e}();n.ExecutionWithThrottling=r},{62:62}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketRequestManager=void 0;var o=e(30),r=e(62),i=function(){function e(e,t,n,o,r,i){this.requestId=e,this.correlationId=t,this.schemaName=n,this.data=o,this.callback=r,this.requestTimeoutInMs=i,this.ended=!1,this.startTime=0}return e.prototype.startRequest=function(){this.startTime=r.Utils.getCurrentTimeMs()},e.prototype.getMsUntilTimeout=function(){var e=r.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e},e.prototype.endRequest=function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)},e.prototype.addResponseData=function(e){this.invokeCallback(e,null,!1)},e.prototype.invokeCallback=function(e,t,n){var o=this;new Promise((function(){return o.callback(e,t,n)})).catch((function(e){}))},e}(),s=function(){function e(e,t,n){this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=e,this.workerFactory=t,this.maxActiveRequests=n}return e.prototype.testConnection=function(e,t){var n=this,i=!1,s=new o.Operation({cv:(new o.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:e,success:!0}).start();return new Promise((function(a){var c=r.Utils.createHealthCheckRequest(t);e?n.addRequest(e,c,s.cv,"HealthCheckRequest",(function(e,t,n){t&&(s.success=!1,s.resultSignature="Error",s.resultDescription=t.message||t),e&&"OK"===e.status&&(i=!0),n&&(s.success&&!i&&(s.success=!1,s.resultSignature="NoResponseData"),o.Log.info(556617949,o.LogCategory.CoreDefault,s.stop()),a(s.success))})):(s.success=!1,s.resultSignature="EmptyUrl",o.Log.info(557641870,o.LogCategory.CoreDefault,s.stop()),a(s.success))}))},e.prototype.addRequest=function(e,t,n,o,r){var s=(this.requestCounter++).toString(),a=new i(s,n,o,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(a),this.egressPendingRequests()},e.prototype.egressPendingRequests=function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress(this.createRequestMessage(e.data,e.requestId,e.correlationId))}},e.prototype.createRequestMessage=function(e,t,n){return JSON.stringify({correlationId:n,requestId:t,body:e})},e.prototype.onTimeout=function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var n=new Error("Request timed out");e.endRequest(n),this.activeRequests.shift(),this.egressPendingRequests()}},e.prototype.onMessage=function(e){try{for(var t=JSON.parse(e),n=0;n<this.activeRequests.length;n++){var r=this.activeRequests[n];if(r.requestId===t.requestId){t.end?(this.activeRequests.splice(n,1),r.endRequest(t.error),this.egressPendingRequests()):t.body&&r.addResponseData(t.body);break}}}catch(e){o.Log.error(557641871,o.LogCategory.CoreDefault,e)}},e.prototype.onClose=function(e){for(var t=new Error("Connection closed: "+e),n=0,o=this.activeRequests;n<o.length;n++){o[n].endRequest(t)}this.activeRequests=[];for(var r=0,i=this.pendingRequests;r<i.length;r++){i[r].endRequest(t)}this.pendingRequests=[],this.worker=void 0},e.prototype.getWorker=function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),(function(){}),this.onClose.bind(this))),this.worker},e}();n.WebSocketRequestManager=s},{30:30,62:62}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BufferingSequencer=void 0;var o=e(30),r=function(){function e(e,t){void 0===e&&(e=500),void 0===t&&(t=!1),this.prevSeq=-1,this.bufferingTimeMs=e,this.rejectOutdatedSequenceNumbers=t}return e.prototype.sequence=function(t){var n=this;return new Promise((function(r,i){if(t<n.prevSeq){if(n.rejectOutdatedSequenceNumbers){var s=new Error("BufferingSequencer: Item out of order. Expecting seqId > "+n.prevSeq+". Actual seqId "+t);return s.name=e.Rejected,void i(s)}n.prevSeq=-1}t!=n.prevSeq+1&&o.Log.warn(542712385,o.LogCategory.WorkflowDefault,"BufferingSequencer: got out of order sequence number. Got "+t+", expected "+(n.prevSeq+1));var a={seq:t,resolve:r};n.insertItem(a),n.runInOrder(a,!0,!1)}))},e.prototype.insertItem=function(e){if(!this.firstQueueItem)return this.firstQueueItem=e,void(this.lastQueueItem=e);var t=this.lastQueueItem,n=null;do{if(e.seq>t.seq)return e.prev=t,t.next=e,void(n?n.prev=e:this.lastQueueItem=e);n=t,t=t.prev}while(t);n&&(n.prev=e),e.next=n,this.firstQueueItem=e},e.prototype.runInOrder=function(e,t,n){for(var o=this,r=this.prevSeq,i=!1,s=[];this.firstQueueItem;){var a=this.firstQueueItem;if(r+1!=a.seq&&(!n||a.seq>e.seq))break;r=a.seq,a.timeout&&clearTimeout(a.timeout),s.push(a),e==a&&(i=!0),this.firstQueueItem=this.firstQueueItem.next,this.firstQueueItem&&(this.firstQueueItem.prev=null)}s.length>0&&setTimeout((function(){for(var e=0,t=s;e<t.length;e++){var n=t[e];n.resolve(n.seq)}}),0),this.prevSeq=r,!i&&t&&(e.timeout=setTimeout((function(){o.runInOrder(e,!1,!0)}),this.bufferingTimeMs))},e.Rejected="SequenceItemRejected",e}();n.BufferingSequencer=r},{30:30}],13:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(12),n)},{12:12}],14:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(15),n)},{15:15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ObserverStatusAnnotation=n.ExcelSessionCloseReason=n.ExcelKeepAlive=n.ExcelAccessTokenRefreshed=n.ExcelWorkbookUpdated=n.ExcelServerSessionExtensionConfig=n.ExcelServerSessionInitMessage=void 0;var o=e(112),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelServerSessionInitMessage=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionExtensionConfig"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelServerSessionExtensionConfig=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelWorkbookUpdated"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelWorkbookUpdated=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelAccessTokenRefreshed"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelAccessTokenRefreshed=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelKeepAlive"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelKeepAlive=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ExcelSessionCloseReason"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ExcelSessionCloseReason=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Excel_Session_Protocol_ObserverStatusAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ObserverStatusAnnotation=l},{112:112}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserType=n.AuthTokenType=void 0,function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacUserInfo=8]="WacUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege",e[e.AugLoopApp=18]="AugLoopApp",e[e.MeetingIntelligenceApp=19]="MeetingIntelligenceApp",e[e.GraphApp=20]="GraphApp",e[e.IceServicesApp=21]="IceServicesApp",e[e.AzureMapsApp=22]="AzureMapsApp"}(n.AuthTokenType||(n.AuthTokenType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(n.UserType||(n.UserType={}))},{}],17:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(16),n),o(e(18),n),o(e(19),n),o(e(20),n),o(e(21),n),o(e(22),n),o(e(23),n),o(e(24),n),o(e(25),n)},{16:16,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug"}(n.LoggingLevel||(n.LoggingLevel={}))},{}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isExceptionMessage=void 0;var o=e(88);n.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==o.MessageType.Exception}},{88:88}],21:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.ExpectedError=n.WorkflowKind=void 0,function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid",e[e.DynamicText=3]="DynamicText",e[e.Join=4]="Join",e[e.Generic=5]="Generic"}(n.WorkflowKind||(n.WorkflowKind={}));var r=function(e){function t(n){void 0===n&&(n="ExpectedError");var o=e.call(this,n)||this;return o.__proto__=t.prototype,o}return o(t,e),t}(Error);n.ExpectedError=r},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.gatewayType=void 0,n.gatewayType="Gateway"},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],25:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.CoherencyError=n.GridRangeFilterCondition=void 0,function(e){e[e.None=0]="None",e[e.NotPartOfTables=1]="NotPartOfTables"}(n.GridRangeFilterCondition||(n.GridRangeFilterCondition={}));var r=function(e){function t(n){void 0===n&&(n="CoherencyError");var o=e.call(this,n)||this;return o.__proto__=t.prototype,o}return o(t,e),t}(Error);n.CoherencyError=r},{}],26:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.AugLoopTextDecoder=n.AugLoopTextEncoder=void 0;n.AugLoopTextEncoder=(o=function(){if("undefined"==typeof TextEncoder){e(145);var t={AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder};return TextEncoder=void 0,TextDecoder=void 0,t}return{AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder}}()).AugLoopTextEncoder,n.AugLoopTextDecoder=o.AugLoopTextDecoder},{145:145}],27:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(28),n)},{28:28}],28:[function(e,t,n){"use strict";var o=e("valuesHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.JSOND=void 0;var r=e(26),i=function(){function e(){}return e.deserialize=function(t,n){if(void 0===n&&(n=function(e){return e}),t[0]!==e.IDENTIFIERBYTE)throw"Invalid Binary: Incorrect Identifier";for(var o=1,r=[],i=new DataView(t.buffer,t.byteOffset,t.byteLength);o<t.byteLength;){if(o+4>t.byteLength)throw"Invalid Binary: Error reading fragment length";var s=i.getUint32(o);if(o+s+4>t.byteLength)throw"Invalid Binary: Fragment out of range";"undefined"!=typeof Buffer&&Buffer.from?r.push(Buffer.from(t.buffer,t.byteOffset+o+4,s)):r.push(new Uint8Array(t.buffer,t.byteOffset+o+4,s)),o+=4+s}if(r.length<1)throw"Invalid Binary: No fragments found";var a=e.textDecoder.decode(r[0]);return JSON.parse(a,(function(t,o){if("string"==typeof o){if(o.substring(0,e.BINARYKEYWORD.length)===e.BINARYKEYWORD){var i=parseInt(o.substring(e.BINARYKEYWORD.length),10);if("number"!=typeof i||i>=r.length-1)throw"Invalid Binary: Binary index out of range";return n(r[i+1])}if(o.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD)return o.substring(e.ESCAPEKEYWORD.length)}return o}))},e.serialize=function(t){var n,r,i=[void 0],s=JSON.stringify(t,(function(t,n){return ArrayBuffer.isView(n)?(i.push(n),""+e.BINARYKEYWORD+(i.length-2)):n&&"Buffer"===n.type&&Array.isArray(n.data)?(i.push(new Uint8Array(n.data)),""+e.BINARYKEYWORD+(i.length-2)):"string"==typeof n&&n.substring(0,e.ESCAPEKEYWORD.length)===e.ESCAPEKEYWORD?e.ESCAPEKEYWORD+n:n}));i[0]=e.textEncoder.encode(s);var a=i.reduce((function(e,t){return e+4+t.byteLength}),0),c=new Uint8Array(a+1);c[0]=e.IDENTIFIERBYTE;var u=1,l=new DataView(c.buffer,c.byteOffset,c.byteLength);try{for(var p=o(i),f=p.next();!f.done;f=p.next()){var d=f.value;l.setUint32(u,d.byteLength),c.set(d,u+4),u+=4+d.byteLength}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}return c},e.IDENTIFIERBYTE=3,e.BINARYKEYWORD=":b",e.ESCAPEKEYWORD=":",e.textDecoder=new r.AugLoopTextDecoder,e.textEncoder=new r.AugLoopTextEncoder,e}();n.JSOND=i},{26:26}],29:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationMetaDataChange=void 0;var r=function(e){function t(t){var n=e.call(this,t)||this;return n.eventName="AnnotationMetaDataChange",n}return o(t,e),t}(e(107).AnnotationMetaDataChangeEvent);n.AnnotationMetaDataChange=r},{107:107}],30:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.SessionHealthSource=n.SessionHealthReason=n.SessionHealthImpact=n.SessionHealthEvent=void 0,o(e(29),n),o(e(31),n),o(e(33),n),o(e(32),n),o(e(35),n);var r=e(36);Object.defineProperty(n,"SessionHealthEvent",{enumerable:!0,get:function(){return r.SessionHealth}}),Object.defineProperty(n,"SessionHealthImpact",{enumerable:!0,get:function(){return r.SessionHealthImpact}}),Object.defineProperty(n,"SessionHealthReason",{enumerable:!0,get:function(){return r.SessionHealthReason}}),Object.defineProperty(n,"SessionHealthSource",{enumerable:!0,get:function(){return r.SessionHealthSource}})},{29:29,31:31,32:32,33:33,35:35,36:36}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CorrelationVector=void 0;var o=function(){function e(e){this.childCount=0,this.id=e||function(){for(var e=0;e<22;e++)i[e]=r[Math.floor(Math.random()*r.length)];return i.join("")}()}return e.fromString=function(t,n){if(!t)throw new Error("Received invalid correlation vector string");var o;return o=t.endsWith(".0")?new e(t.substring(0,t.length-2)):new e(t),n&&(o.childCount=n),o},e.prototype.newChild=function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())},e.prototype.toString=function(){return this.id.length>127?this.id.substring(0,127)+"!":this.id},e}();n.CorrelationVector=o;var r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i=new Array(22)},{}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LoggingAggregator=void 0;var o=/\|\~/g,r=function(){this.count=0,this.measureSums=new Map},i=function(e,t,n,i,s){var a=this;this.buckets=new Map,this.init=function(e){a.log=e},this.add=function(e){if(a.condition&&a.condition(e)){for(var t=[],n=0,i=a.dimensions;n<i.length;n++){var s=i[n];if(void 0===e[s])t.push(null);else{var c="";"boolean"==typeof e[s]?c="b~":"number"==typeof e[s]&&(c="n~"),t.push(""+c+e[s].toString().replace(o,"_"))}}var u=t.join("|"),l=a.buckets.get(u);if(!l){(l=new r).traceLevel=e.traceLevel;for(var p=0,f=a.avgMeasures;p<f.length;p++){var d=f[p];l.measureSums.set(d,0)}a.buckets.set(u,l)}l.count++;for(var h=0,g=a.avgMeasures;h<g.length;h++)e[d=g[h]]&&l.measureSums.set(d,l.measureSums.get(d)+e[d])}else a.log(e,!1)},this.flush=function(e){void 0===e&&(e=!1),a.buckets.forEach((function(e,t){for(var n={traceLevel:e.traceLevel,eventName:a.eventName,count:e.count},o=t.split("|"),r=0;r<a.dimensions.length;r++){var i=a.dimensions[r],s=o[r];0===s.indexOf("b~")?n[i]="b~true"===s:0===s.indexOf("n~")?n[i]=parseInt(s.slice("n~".length),10):n[i]=s}for(var c=0,u=a.avgMeasures;c<u.length;c++){var l=u[c];n[l]=Math.round(e.measureSums.get(l)/e.count)}a.log(n,!0)})),a.buckets.clear(),e&&(a.condition=null,clearInterval(a.interval))},this.eventName=e,this.condition=t,this.dimensions=n,this.avgMeasures=i,s>0&&(this.interval=setInterval(this.flush,1e3*s))};n.LoggingAggregator=i},{}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=n.tagIdToString=n.argsToString=n.Log=void 0;var o,r,i=e(17),s="undefined"!=typeof process&&process.env?process.env.SERVICE_NAME:"client",a="abcdefghijklmnopqrstuvwxyz0123456789",c={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},u=[],l=[],p=new Map,f=new Map,d=new Map,h=new Map;!function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){u=[],l=[],f.clear(),d.clear()},e.addLogger=function(e){-1===u.indexOf(e)&&(u.push(e),g(f,e))},e.addDecidingLogger=function(e){-1===l.indexOf(e)&&(l.push(e),g(d,e))},e.setCorrelationContextCallback=function(e){o=e},e.addAggregator=function(e){e.init((function(e,t){T(e,t)})),p.set(e.eventName,e)},e.flushAggregators=function(e){p.forEach((function(t){t.flush(e)}))},e.setTagLevelOverride=function(e,t){var n=S(e);h.set(n,t)},e.resetTagLevelOverrides=function(){h.clear()},e.error=function(e,t,n,o,r,s,a,c,u,l){v(e,t,i.LoggingLevel.error,n,o,r,s,a,c,u,l)},e.warn=function(e,t,n,o,r,s,a,c,u,l){v(e,t,i.LoggingLevel.warn,n,o,r,s,a,c,u,l)},e.info=function(e,t,n,o,r,s,a,c,u,l){v(e,t,i.LoggingLevel.info,n,o,r,s,a,c,u,l)},e.verbose=function(e,t,n,o,r,s,a,c,u,l){v(e,t,i.LoggingLevel.verbose,n,o,r,s,a,c,u,l)},e.debug=function(e,t,n,o,r,s,a,c,u,l){v(e,t,i.LoggingLevel.debug,n,o,r,s,a,c,u,l)},e.metric=function(e,t,n,o,r,s,a,c,u,l){v(e,t,i.LoggingLevel.metric,n,o,r,s,a,c,u,l)},e.dynamic=function(e){T(e)}}(r=n.Log||(n.Log={}));var g=function(e,t){var n=t.level;Object.keys(i.LoggingLevel).map((function(e){return i.LoggingLevel[e]})).filter((function(e){return"string"!=typeof e})).filter((function(e){return e<=n})).forEach((function(n){e.has(n)?e.get(n).push(t):e.set(n,[t])}))};n.argsToString=function(e){return"string"==typeof e?e:e.map((function(e){return e instanceof Error?JSON.stringify({message:e.message,name:e.name,stack:e.stack}):"object"==typeof e?JSON.stringify(e):e})).join(" ")};var y=function(e){return void 0!==e?f.get(e)||[]:u},m=function(e,t){return(void 0!==e?d.get(e)||[]:l).filter((function(e){return e.shouldLog(t)}))},v=function(e,t,r,i,s,a,c,u,l,f,d){r=h.get(e)||r;var g=y(r),v=m(r,i);if(0!=g.length||0!=v.length){var S=(0,n.tagIdToString)(e),w=function(e,t,n,o,r,i,s,a){if(void 0===t&&("string"==typeof e||"object"==typeof e))return e;if(void 0===t&&"function"==typeof e)return e();for(var c=[],u=0,l=[e,t,n,o,r,i,s,a];u<l.length;u++){var p=l[u];void 0!==p&&c.push("function"==typeof p?p():p)}return c}(i,s,a,c,u,l,f,d);if(Array.isArray(w)||"object"!=typeof w){var b={};"Core"===t.root?b.TraceEventV2={dimensionNames:function(){return["Level","Tag"]},dimensionValues:function(){return[String(r),S]},value:function(){return 1}}:b.WorkflowTraceEvent={dimensionNames:function(){return["Level","Tag","Workflow"]},dimensionValues:function(){var e;return[String(r),S,o?null===(e=o())||void 0===e?void 0:e.workflow:""]},value:function(){return 1}},T({eventName:"Log",tagId:S,category:t.root+"."+t.name,traceLevel:r,message:(0,n.argsToString)(w),metrics:b},!1,g,v)}else{var _=w;_.tagId=S,"Operation"===_.eventName&&"Workflow"===t.root&&(_.eventName="WorkflowOperation",o&&(_.joinContextId=o().joinContextId)),_.traceLevel=r;var C=p.get(_.eventName);C?C.add(_):T(_,!1,g,v)}}},T=function(e,t,n,r){var i,a,c;if(void 0===t&&(t=!1),null==n&&(n=y(e.traceLevel)),r=r||[],n.length>0||r.length>0){if(e.serviceName=s,!t&&o){var u=o();if(u){e.cv=e.cv?e.cv:u.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:u.sessionKey,e.workflow=e.workflow?e.workflow:u.workflow;var l=null===(i=u.clientMetadata)||void 0===i?void 0:i.appName;e.clientAppName=e.clientAppName?e.clientAppName:l;var p=null===(a=u.clientMetadata)||void 0===a?void 0:a.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:p;var f=null===(c=u.clientMetadata)||void 0===c?void 0:c.releaseAudienceGroup;e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:f}}for(var d=0,h=n;d<h.length;d++){h[d].log(e)}for(var g=0,m=r;g<m.length;g++){m[g].log(e)}}};n.tagIdToString=function(e){return a[e>>24&63]+a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[e>>0&63]};var S=function(e){return e&&5===e.length?c[e.charCodeAt(0)]<<24|c[e.charCodeAt(1)]<<18|c[e.charCodeAt(2)]<<12|c[e.charCodeAt(3)]<<6|c[e.charCodeAt(4)]:-1},w=function(){function e(){}return e.CoreDefault=r.defineCoreLogCategory("Default"),e.WorkflowDefault=r.defineWorkflowLogCategory("Default"),e}();n.LogCategory=w},{17:17}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.now=void 0;n.now="undefined"!=typeof process&&process.hrtime?function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}},{}],35:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.Operation=void 0;var r=e(107),i=e(34),s=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.eventName="Operation",r.metrics={},t&&null!=t.count||(r.count=1),r.setClientMetadata(n),r.setUserContext(o),(null==t?void 0:t.operationName)&&r.setMetricsForOpName(t.operationName),r}return o(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDeviceId=e.deviceId,this.clientUserAgent=e.userAgent),this},t.prototype.setUserContext=function(e){return e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString()),this},t.prototype.start=function(){return this.startTime=(0,i.now)(),this},t.prototype.stop=function(){var e=(0,i.now)();return this.durationMs=Math.round(e-this.startTime),this},t.prototype.setMetricsForOpName=function(e){var t=this;switch(e){case"SessionHealthOrphanedEventsWithoutProperSessionKey":case"SessionHealthOrphanedSessions":case"WorkflowActivationState":this.metrics[e+".CountV2"]={dimensionNames:this.getOrphanedSessionHealthDimensionNames.bind(this),dimensionValues:this.getOrphanedSessionHealthDimensionValues.bind(this),value:function(){return t.count}};break;case"MarkUnhealthySession":case"MarkHealthWarningSession":this.metrics[e+".Reason"]={dimensionNames:this.getSessionHealthDimensionNames.bind(this),dimensionValues:this.getSessionHealthDimensionValues.bind(this),value:function(){return 1}};break;default:"matchmaker_timer"===e&&(this.metrics["Workflow.DurationMs"]={dimensionNames:this.getWorkflowDimensionNames.bind(this),dimensionValues:this.getWorkflowDimensionValues.bind(this),value:function(){return t.durationMs}},this.metrics["Workflow.Count"]={dimensionNames:this.getWorkflowDimensionNames.bind(this),dimensionValues:this.getWorkflowDimensionValues.bind(this),value:function(){return 1}}),this.metrics[e+".DurationMsV2"]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues.bind(this),value:function(){return t.durationMs}},this.metrics[e+".CountV2"]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues.bind(this),value:function(){return t.count}}}},t.prototype.getDimensionNames=function(){return["Success","ClientAppName","ClientAppPlatform","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"]},t.prototype.getDimensionValues=function(){return[this.success,this.clientAppName,this.clientAppPlatform,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t.prototype.getOrphanedSessionHealthDimensionNames=function(){return["Success","ClientAppName","ClientAppPlatform","ClientReleaseAudienceGroup","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"]},t.prototype.getOrphanedSessionHealthDimensionValues=function(){return[this.success,this.clientAppName,this.clientAppPlatform,this.clientReleaseAudienceGroup,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t.prototype.getSessionHealthDimensionNames=function(){return["Reason","ClientAppName","ClientAppPlatform","ClientAppVersion","Dimension0","Dimension1","Dimension2","Dimension3"]},t.prototype.getSessionHealthDimensionValues=function(){return[this.resultSignature,this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t.prototype.getWorkflowDimensionNames=function(){return["ResultSignature","WorkflowId","ResourceId","Success"]},t.prototype.getWorkflowDimensionValues=function(){return[this.resultSignature,this.resourceId,this.resourceId,this.success]},t}(r.OperationEvent);n.Operation=s},{107:107,34:34}],36:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.SessionHealth=n.SessionHealthImpact=n.SessionHealthReason=n.SessionHealthSource=void 0;var r,i,s,a=e(107),c=e(34);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(r=n.SessionHealthSource||(n.SessionHealthSource={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(i=n.SessionHealthReason||(n.SessionHealthReason={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(s=n.SessionHealthImpact||(n.SessionHealthImpact={}));var u=function(e){function t(t,n){var o,a,c=e.call(this,{source:r[t.source],reason:i[t.reason],reasonDependency:t.reasonDependency,subReason:t.subReason,sessionHealthEventName:t.sessionHealthEventName,impact:s[t.impact],success:t.success,durationMs:null!==(o=t.durationMs)&&void 0!==o?o:0,count:"number"==typeof t.count?t.count:1,message:t.message,affectedWorkflows:(null!==(a=t.affectedWorkflows)&&void 0!==a?a:[]).join(","),resourceId:t.resourceId,dimension0:t.dimension0,dimension1:t.dimension1,dimension2:t.dimension2,dimension3:t.dimension3,cv:t.cv,resultSignature:t.resultSignature,resultDescription:t.resultDescription})||this;return c.eventName="SessionHealth",c.metrics={},c.dimensionNames=["ClientAppName","ClientAppPlatform","ClientAppVersion","Success","Reason","Impact","FirstAffectedWorkflow","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],n&&c.setClientMetadata(n),c.metrics[t.sessionHealthEventName+".CountV2"]={dimensionNames:function(){return c.dimensionNames},dimensionValues:c.getDimensionValues.bind(c),value:function(){return c.count}},c.metrics[t.sessionHealthEventName+".DurationMsV2"]={dimensionNames:function(){return c.dimensionNames},dimensionValues:c.getDimensionValues.bind(c),value:function(){return c.durationMs}},c}return o(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientUserAgent=e.userAgent,this.clientDeviceId=e.deviceId),this},t.prototype.setReason=function(e){return this.reason=i[e],this},t.prototype.setSource=function(e){return this.source=r[e],this},t.prototype.setImpact=function(e){return this.impact=s[e],this},t.prototype.setAffectedWorkflows=function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this},t.prototype.getAffectedWorkflows=function(){return this.affectedWorkflows.split(",")},t.prototype.start=function(){return this.startTime=(0,c.now)(),this},t.prototype.stop=function(){var e=(0,c.now)();return this.durationMs=Math.round(e-this.startTime),this},t.prototype.getDimensionValues=function(){var e;return[this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.success?"1":"0",this.reason+"_"+this.reasonDependency,this.impact,null!==(e=this.getAffectedWorkflows()[0])&&void 0!==e?e:"",this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]},t}(a.SessionHealthEvent);n.SessionHealth=u},{107:107,34:34}],37:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(38),n),o(e(39),n),o(e(40),n),o(e(41),n),o(e(43),n)},{38:38,39:39,40:40,41:41,43:43}],38:[function(e,t,n){"use strict";var o=e("assignHelper"),r=e("valuesHelper"),i=e("readHelper"),s=e("spreadArrayHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.ContextIdManager=void 0;var a=e(112),c=e(30),u=new Set([a.AddOperation.getTypeName(),a.UpdateOperation.getTypeName(),a.SignalOperation.getTypeName(),a.DeltaUpdateOperation.getTypeName()]),l=function(){function e(){this.collectionScopeTypesOnJoinWorkflows=new Set,this.updatesByScopeItemPath=new Map}return e.prototype.setActiveScopeType=function(e){this.collectionScopeTypesOnJoinWorkflows.add(e)},e.prototype.applyContextIdOnOperations=function(e){var t,n,i,s,u,l;try{for(var p=r(e),f=p.next();!f.done;f=p.next()){var d=f.value,h=a.SchemaObject.getTypeNameFor(d);if(this.isSupportedOperation(h))try{for(var g=(i=void 0,r(d.items)),y=g.next();!y.done;y=g.next()){var m=y.value,v=void 0;if(100*Math.random()<=.5&&(v=new c.Operation({operationName:"ApplyContextIdOnOperations",success:!0}).start()),m.contextId)this.tryLogMessage(v,"Item of id: "+m.id+" already has a contextId "+m.contextId);else{var T=o({parentPath:d.parentPath},m);if(h===a.DeltaUpdateOperation.getTypeName()){var S=o(o({},m),{parentPath:d.parentPath.slice(0,-1)});this.updatesByScopeItemPath.has(this.makeItemPathStr(S))?(m.contextId=this.getNewContextId(S),this.tryLogMessage(v,"DeltaUpdateOperation "+m.id+" already has a related TextTile, its new contextId is "+m.contextId)):this.tryLogMessage(v,"DeltaUpdateOperation "+m.id+" don't have a related TextTile with contextId");continue}if(this.isScopeTypeOfAnyJoinWorkflow(m.body))m.contextId=this.getNewContextId(T),this.tryLogMessage(v,"Item of id: "+m.id+" is scope item of a join and its contextId is "+m.contextId);else{var w=this.makeItemPathStr(T);try{for(var b=(u=void 0,r(this.updatesByScopeItemPath.keys())),_=b.next();!_.done;_=b.next()){var C=_.value;w.indexOf(C)>=0&&(m.contextId=this.getContextId(C),this.tryLogMessage(v,"Item of id: "+m.id+" is not scope item of a join and its contextId is "+m.contextId))}}catch(e){u={error:e}}finally{try{_&&!_.done&&(l=b.return)&&l.call(b)}finally{if(u)throw u.error}}m.contextId||this.tryLogMessage(v,"Item of id: "+m.id+" does not belong to any join workflow execution")}}}}catch(e){i={error:e}}finally{try{y&&!y.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}},e.prototype.getNewContextId=function(e){var t=this.makeItemPathStr(e),n=this.updatesByScopeItemPath.get(t)||0;return this.updatesByScopeItemPath.set(t,n+1),this.getContextId(t)},e.prototype.isSupportedOperation=function(e){return u.has(e)},e.prototype.isScopeTypeOfAnyJoinWorkflow=function(e){var t=s([],i(this.collectionScopeTypesOnJoinWorkflows),!1);return 0!==t.length&&a.SchemaObject.matchesTypesFor(e,t)},e.prototype.makeItemPathStr=function(e){return s(s([],i(e.parentPath),!1),[e.id],!1).join("/")},e.prototype.getContextId=function(e){return e+"@"+this.updatesByScopeItemPath.get(e)},e.prototype.tryLogMessage=function(e,t){e&&(e.resultDescription=t,c.Log.verbose(527308633,c.LogCategory.CoreDefault,e.stop()))},e}();n.ContextIdManager=l},{112:112,30:30}],39:[function(e,t,n){"use strict";var o=e("assignHelper"),r=e("readHelper"),i=e("spreadArrayHelper"),s=e("valuesHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.findRangeForDeltaType=n.applyFormattedTextTileDelta=n.applyTextTileDelta=void 0;var a=e(112),c=e(30),u=e(123);function l(e,t,n){var o=new c.Operation({operationName:"FindRangeForDelta",success:!0});if(o.start(),!e)return o.resultDescription="No formatted ranges found within the tile, skipping.",void c.Log.info(538798212,c.LogCategory.CoreDefault,o.stop());if(t===u.TextTileDeltaType.Add){var r=e.find((function(e){return e.start===n&&0===e.length}));if(r)return o.resultDescription="Found a zero-length formatted range for add operation with start "+r.start+".",c.Log.info(538798213,c.LogCategory.CoreDefault,o.stop()),r;n=Math.max(n-1,0)}var i=e.find((function(e){return 0===e.length?e.start===n:e.start<=n&&n<e.start+e.length}));return i?(o.resultDescription="Updating formatted range for operation with start: "+i.start+" and length: "+i.length,c.Log.info(538798214,c.LogCategory.CoreDefault,o.stop())):(o.resultDescription="Unable to find formatted range for operation at position "+n+", skipping.",c.Log.info(538798215,c.LogCategory.CoreDefault,o.stop())),i}n.applyTextTileDelta=function(e,t){var n=new c.Operation({operationName:"ApplyTextTileDeltaForLocalWorkflows",success:!0});n.start();try{if(!t)return n.success=!1,n.resultDescription="Unable to apply text tile delta, parent tile is undefined",void c.Log.info(538798173,c.LogCategory.CoreDefault,n.stop());if(a.SchemaObject.getTypeNameFor(t)!==u.TextTile.getTypeName())return n.success=!1,n.resultDescription="Unable to apply text tile delta, parent tile is not proper type: expected "+u.TextTileDelta.getTypeName()+", received "+a.SchemaObject.getTypeNameFor(t),void c.Log.info(538798174,c.LogCategory.CoreDefault,n.stop());var o=e,r=t.content,i="";if(void 0===o.position||o.position<0)return n.success=!1,n.resultDescription="Unable to apply text tile delta, invalid text tile position",void c.Log.info(538798175,c.LogCategory.CoreDefault,n.stop());switch(o.deltaType){case u.TextTileDeltaType.Add:i=o.position<r.length?""+r.slice(0,o.position)+o.content+r.slice(o.position,r.length):r+o.content;break;case u.TextTileDeltaType.Update:i=""+r.slice(0,o.position)+o.content+r.slice(o.position+(o.length||0),r.length);break;case u.TextTileDeltaType.Delete:i=""+r.slice(0,o.position)+r.slice(o.position+(o.length||0),r.length)}return c.Log.info(538837071,c.LogCategory.CoreDefault,n.stop()),new u.TextTile({content:i})}catch(e){return n.success=!1,n.resultDescription="Error applying text tile delta: "+e,void c.Log.info(538798176,c.LogCategory.CoreDefault,n.stop())}},n.applyFormattedTextTileDelta=function(e,t){var n,p,f,d,h,g,y=new c.Operation({operationName:"ApplyFormattedTextTileDeltaForLocalWorkflows",success:!0});y.start();try{if(!t)return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, parent tile is undefined",void c.Log.info(538798177,c.LogCategory.CoreDefault,y.stop());if(a.SchemaObject.getTypeNameFor(t)!==u.FormattedTextTile.getTypeName())return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, parent tile is not proper type: expected "+u.FormattedTextTile.getTypeName()+", received "+a.SchemaObject.getTypeNameFor(t),void c.Log.info(538798178,c.LogCategory.CoreDefault,y.stop());var m=t,v=e,T=m.content,S="";if(void 0===v.position||v.position<0)return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, invalid text tile position",void c.Log.info(538798179,c.LogCategory.CoreDefault,y.stop());if(void 0===v.content&&v.deltaType!==u.TextTileDeltaType.Delete)return y.success=!1,y.resultDescription="Unable to apply formatted text tile delta, non-delete operation without content defined",void c.Log.info(538798208,c.LogCategory.CoreDefault,y.stop());v.deltaType===u.TextTileDeltaType.Add&&0!==v.length?c.Log.info(538798209,c.LogCategory.CoreDefault,new c.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta add operation with delta length, expected length 0",success:!0})):v.deltaType===u.TextTileDeltaType.Delete&&void 0!==v.content&&c.Log.info(538798210,c.LogCategory.CoreDefault,new c.Operation({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta delete operation with content defined, expected undefined",success:!0}));var w=l(m.formattedRanges,v.deltaType,v.position),b=m.formattedRanges?i([],r(m.formattedRanges),!1):[],_=w?b.indexOf(w):-1;switch(-1!==_&&(v.position+(v.length||0)>w.start+w.length?w.length=v.position+(null!==(f=v.content)&&void 0!==f?f:"").length-w.start:w.length+=(null!==(d=v.content)&&void 0!==d?d:"").length-(v.length||0),b[_]=w),v.deltaType){case u.TextTileDeltaType.Add:S=v.position<T.length?""+T.slice(0,v.position)+v.content+T.slice(v.position,T.length):T+v.content;break;case u.TextTileDeltaType.Update:S=""+T.slice(0,v.position)+v.content+T.slice(v.position+(v.length||0),T.length);break;case u.TextTileDeltaType.Delete:S=""+T.slice(0,v.position)+T.slice(v.position+(v.length||0),T.length)}try{for(var C=s(b.slice(_+1)),k=C.next();!k.done;k=C.next()){var x=k.value;x.start<v.position||(v.position+(v.length||0)>x.start?(x.length=x.start+x.length-(v.position+(v.length||0)),x.start=v.position+(null!==(h=v.content)&&void 0!==h?h:"").length):x.start+=(null!==(g=v.content)&&void 0!==g?g:"").length-(v.length||0))}}catch(e){n={error:e}}finally{try{k&&!k.done&&(p=C.return)&&p.call(C)}finally{if(n)throw n.error}}b=b.filter((function(e){return e.length>0}));var O=new u.FormattedTextTile(o(o({},m),{content:S,formattedRanges:b,queryRange:v.queryRange}));return c.Log.info(538837073,c.LogCategory.CoreDefault,y.stop()),O}catch(e){return y.success=!1,y.resultDescription="Error applying formatted text tile delta: "+e,void c.Log.info(538798211,c.LogCategory.CoreDefault,y.stop())}},n.findRangeForDeltaType=l},{112:112,123:123,30:30}],40:[function(e,t,n){"use strict";var o=e("assignHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.DynamicWorkflowDefinitionManager=void 0;var r=e(42),i=function(){function e(){this.workflowDefByWorkflowAndContextId=new Map,this.workflowDefByWorkflow=new Map}return e.mergeDefinitions=function(e,t,n){return o(o(o({},e),t),n)},e.prototype.mergeWorkflowDefinition=function(t,n,o){if(o){var i=(0,r.getOrSetDefaultValue)(this.workflowDefByWorkflowAndContextId,t.id,(function(){return new Map}));i.set(o,e.mergeDefinitions(t,i.get(o),n))}else this.workflowDefByWorkflow.set(t.id,e.mergeDefinitions(t,this.workflowDefByWorkflow.get(t.id),n))},e.prototype.getWorkflowDefinition=function(e,t){var n,o;return t&&(o=null===(n=this.workflowDefByWorkflowAndContextId.get(e.id))||void 0===n?void 0:n.get(t)),o||(o=this.workflowDefByWorkflow.get(e.id)),o||(o=e),o},e.prototype.deleteWorkflowDefinition=function(e,t){var n=this.workflowDefByWorkflowAndContextId.get(e.id);n&&(n.delete(t),0===n.size&&this.workflowDefByWorkflowAndContextId.delete(e.id))},e}();n.DynamicWorkflowDefinitionManager=i},{42:42}],41:[function(e,t,n){"use strict";var o=e("assignHelper"),r=e("valuesHelper"),i=e("readHelper"),s=e("spreadArrayHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.JoinAnnotationsManager=void 0;var a=e(112),c=e(30),u=new Set([a.AddOperation.getTypeName(),a.UpdateOperation.getTypeName(),a.SignalOperation.getTypeName(),a.DeltaUpdateOperation.getTypeName()]),l=function(){function e(e){this.collectionScopeTypesOnJoinWorkflows=new Set,this.updatesByScopeItemPath=new Map,this.scopeItemsByContextId=new Map,this.annotationsByWorkflowAndScopeItem=new Map,this.workflowDefinitionManager=e}return e.prototype.setActiveCollectionScopeType=function(e){this.collectionScopeTypesOnJoinWorkflows.add(e)},e.prototype.applyContextIdOnOperations=function(e){var t,n,i,s,u,l;try{for(var p=r(e),f=p.next();!f.done;f=p.next()){var d=f.value,h=a.SchemaObject.getTypeNameFor(d);if(this.isSupportedOperation(h))try{for(var g=(i=void 0,r(d.items)),y=g.next();!y.done;y=g.next()){var m=y.value,v=new c.Operation({operationName:"ApplyContextIdOnOperations",success:!1}).start();if(m.contextId)c.Log.verbose(539854490,c.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+m.id+" already has a contextId "+m.contextId).stop());else{var T=o({parentPath:d.parentPath},m);if(h===a.DeltaUpdateOperation.getTypeName()){var S=o(o({},m),{parentPath:d.parentPath.slice(0,-1)});this.updatesByScopeItemPath.has(this.makeItemPathStr(S))?(m.contextId=this.getNewContextId(S),c.Log.verbose(539776014,c.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: DeltaUpdateOperation "+m.id+" already has a related TextTile, its new contextId is "+m.contextId).stop())):c.Log.verbose(539776015,c.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: DeltaUpdateOperation "+m.id+" don't have a related TextTile with contextId").stop());continue}if(this.isScopeTypeOfAnyJoinWorkflow(m.body))m.contextId=this.getNewContextId(T),c.Log.verbose(539854488,c.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+m.id+" is scope item of a join and its contextId is "+m.contextId).stop());else{var w=this.makeItemPathStr(T);try{for(var b=(u=void 0,r(this.updatesByScopeItemPath.keys())),_=b.next();!_.done;_=b.next()){var C=_.value;w.indexOf(C)>=0&&(m.contextId=this.getContextId(C),c.Log.verbose(539854489,c.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+m.id+" is not scope item of a join and its contextId is "+m.contextId).stop()))}}catch(e){u={error:e}}finally{try{_&&!_.done&&(l=b.return)&&l.call(b)}finally{if(u)throw u.error}}m.contextId||c.Log.verbose(539109088,c.LogCategory.CoreDefault,this.successLogMessage(v,"JAM :: Item of id: "+m.id+" does not belong to any join workflow execution").stop())}}}}catch(e){i={error:e}}finally{try{y&&!y.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}},e.prototype.getNewContextId=function(e){var t=this.makeItemPathStr(e),n=this.updatesByScopeItemPath.get(t)||0;return this.updatesByScopeItemPath.set(t,n+1),this.getContextId(t)},e.prototype.setScopeItem=function(e,t){var n=e.contextId;if(this.scopeItemsByContextId.has(n)){var o=new c.Operation({resultDescription:"JAM.setScopeItem :: Trying to set new scope item: "+e.id+" with already existing contextId "+n,operationName:"JoinSetScopeItem",success:!0}).start();c.Log.verbose(539854491,c.LogCategory.CoreDefault,o.stop())}else this.scopeItemsByContextId.set(n,e);this.annotationsByWorkflowAndScopeItem.has(t.id)||this.annotationsByWorkflowAndScopeItem.set(t.id,new Map),this.annotationsByWorkflowAndScopeItem.get(t.id).set(n,[])},e.prototype.getScopeItem=function(e,t){var n;if(null===(n=this.annotationsByWorkflowAndScopeItem.get(t.id))||void 0===n?void 0:n.has(e))return this.scopeItemsByContextId.get(e)},e.prototype.addItemOnContextIdList=function(e,t){var n,o,r=e.contextId,i=this.annotationsByWorkflowAndScopeItem.get(t.id);if(i){null===(n=i.get(r))||void 0===n||n.push(e);var s=new c.Operation({resultDescription:"JAM.addItemOnContextIdList :: Items for contextId "+r+": ["+(null===(o=i.get(r))||void 0===o?void 0:o.map((function(e){return e.id})).join(","))+"]",operationName:"JoinAddInputItem",success:!0}).start();c.Log.verbose(539854492,c.LogCategory.CoreDefault,s.stop())}},e.prototype.isJoinReady=function(e,t){var n=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.getGeneratedItems(e,t).length>=n},e.prototype.getItemsToExecute=function(e,t){var n=this.getGeneratedItems(e,t);return this.annotationsByWorkflowAndScopeItem.get(t.id).delete(e),n},e.prototype.registerWorkflowExecution=function(e,t){var n=e.contextId,o=this.annotationsByWorkflowAndScopeItem.get(t.id);o&&(o.delete(n),0===o.size&&this.annotationsByWorkflowAndScopeItem.delete(t.id)),this.hasWorkflowsAwaitingExecution(n)||this.scopeItemsByContextId.delete(n)},e.prototype.getGeneratedItems=function(e,t){var n;if(!(null===(n=this.annotationsByWorkflowAndScopeItem.get(t.id))||void 0===n?void 0:n.get(e)))return[];var o=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.annotationsByWorkflowAndScopeItem.get(t.id).get(e).slice(0,o)},e.prototype.isSupportedOperation=function(e){return u.has(e)},e.prototype.isScopeTypeOfAnyJoinWorkflow=function(e){var t=s([],i(this.collectionScopeTypesOnJoinWorkflows),!1);return 0!==t.length&&a.SchemaObject.matchesTypesFor(e,t)},e.prototype.hasWorkflowsAwaitingExecution=function(e){var t,n,o,i;try{for(var s=r(this.annotationsByWorkflowAndScopeItem.values()),a=s.next();!a.done;a=s.next()){var c=a.value;try{for(var u=(o=void 0,r(c.keys())),l=u.next();!l.done;l=u.next()){if(l.value===e)return!0}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return!1},e.prototype.makeItemPathStr=function(e){return s(s([],i(e.parentPath),!1),[e.id],!1).join("/")},e.prototype.getContextId=function(e){return e+"@"+this.updatesByScopeItemPath.get(e)},e.prototype.successLogMessage=function(e,t){return e.success=!0,e.resultDescription=t,e},e}();n.JoinAnnotationsManager=l},{112:112,30:30}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getOrSetDefaultValue=void 0;n.getOrSetDefaultValue=function(e,t,n){var o=e.get(t);return o||(o=n(),e.set(t,o)),o}},{}],43:[function(e,t,n){"use strict";var o=e("valuesHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowItemStorage=void 0;var r=e(30),i=function(){function e(e){this.scopeItemsByContextIdAndType=new Map,this.itemsByWorkflowAndContextId=new Map,this.workflowDefinitionManager=e}return e.prototype.setScopeItem=function(e,t){var n=e.contextId;if(n){this.scopeItemsByContextIdAndType.has(n)||this.scopeItemsByContextIdAndType.set(n,new Map);var o=this.scopeItemsByContextIdAndType.get(n);if(o.has(t.collectionScopeType)){var i=new r.Operation({resultDescription:"Trying to set new scope item: "+e.id+" with already existing contextId "+n+" for workflow "+t.id,operationName:"WIS.setScopeItem",success:!0}).start();r.Log.verbose(527291288,r.LogCategory.CoreDefault,i.stop())}else o.set(t.collectionScopeType,e);this.itemsByWorkflowAndContextId.has(t.id)||this.itemsByWorkflowAndContextId.set(t.id,new Map),this.itemsByWorkflowAndContextId.get(t.id).set(n,[])}},e.prototype.getScopeItem=function(e,t){var n;if(null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.has(e))return this.scopeItemsByContextIdAndType.get(e).get(t.collectionScopeType)},e.prototype.addItemToWorkflowList=function(e,t){var n,o,i=e.contextId,s=this.itemsByWorkflowAndContextId.get(t.id);if(s){null===(n=s.get(i))||void 0===n||n.push(e);var a=new r.Operation({resultDescription:"Items for contextId "+i+": ["+(null===(o=s.get(i))||void 0===o?void 0:o.map((function(e){return e.id})).join(","))+"]",operationName:"WIS.addItemOnContextIdList",success:!0}).start();r.Log.verbose(527291289,r.LogCategory.CoreDefault,a.stop())}},e.prototype.isWorkflowReady=function(e,t){var n=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.getGeneratedItems(e,t).length>=n},e.prototype.getItemsToExecute=function(e,t){var n=this.getGeneratedItems(e,t);return this.itemsByWorkflowAndContextId.get(t.id).delete(e),n},e.prototype.onWorkflowExecuted=function(e,t){var n=e.contextId,o=this.itemsByWorkflowAndContextId.get(t.id);o&&(o.delete(n),0===o.size&&this.itemsByWorkflowAndContextId.delete(t.id)),this.hasWorkflowsAwaitingExecution(n)||this.scopeItemsByContextIdAndType.delete(n)},e.prototype.getGeneratedItems=function(e,t){var n;if(!(null===(n=this.itemsByWorkflowAndContextId.get(t.id))||void 0===n?void 0:n.get(e)))return[];var o=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.itemsByWorkflowAndContextId.get(t.id).get(e).slice(0,o)},e.prototype.hasWorkflowsAwaitingExecution=function(e){var t,n,r,i;try{for(var s=o(this.itemsByWorkflowAndContextId.values()),a=s.next();!a.done;a=s.next()){var c=a.value;try{for(var u=(r=void 0,o(c.keys())),l=u.next();!l.done;l=u.next()){if(l.value===e)return!0}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return!1},e}();n.WorkflowItemStorage=i},{30:30}],44:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(45),n)},{45:45}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ModelDownloader=void 0;var o,r=e(30),i=e(146),s=e(142),a="undefined"!=typeof fetch?fetch:s;!function(e){e.URL="URL",e.ArrayBuffer="ArrayBuffer"}(o||(o={}));var c=function(){function e(e,t,n){var o=this;this.dbName="ALModels_db",this.osName="ALModels_os",this.baseURL="https://"+t+"/web/"+e,this.checkIdbByFeatures=null==n?void 0:n.checkIdbByFeatures;var i=new r.Operation({operationName:"CreateModelDownloader",success:!0,resultDescription:""});i.start(),this.isBrowserIdbCompatible().then((function(e){if(e){var t,n=0,s=0,a=0,c=new Promise((function(e,n){t=setTimeout((function(){n(new Error("Took longer than 10000 ms"))}),1e4)})),u=o.accessDB().then((function(e){var t=e.transaction(o.osName,"readwrite");return t.objectStore(o.osName).openCursor().then((function e(o){if(a++,o){var r=o.value;r.timesSinceUsage||(r.timesSinceUsage=0),r.timesSinceUsage++;var i=void 0;return r.timesSinceUsage>5?(s++,i=o.delete()):(n++,i=o.update(r)),i.then((function(){return o.continue()})).then(e)}return t.done}))}));o.initPromise=Promise.race([c,u]).catch((function(e){i.success=!1,i.resultDescription+=e.message+" "})).then((function(){i.dimension0=""+a,i.dimension1=""+n,i.dimension2=""+s,clearTimeout(t),o.closeDBAndEndLog(i,"initializing idb storage")}))}else i.resultDescription="Incompatible browser for IDB",r.Log.info(538706242,r.LogCategory.CoreDefault,i.stop())})).catch((function(){i.resultDescription="Issue determining idb compatibility",r.Log.info(536966936,r.LogCategory.CoreDefault,i.stop())}))}return e.prototype.getResourceAsArrayBuffer=function(e,t){var n=new r.Operation({operationName:"GetResource",success:!0,resultDescription:"",dimension0:o.ArrayBuffer,dimension1:e,dimension2:t});n.start();var i={};return this.getResource(e,t,o.ArrayBuffer,n,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){var n=e.get(t);return n.arrayBuffer?n.arrayBuffer().then((function(e){i[t]=e})):new Promise((function(e,o){var r=new FileReader;r.readAsArrayBuffer(n),r.onload=function(n){var r=n.target.result;r instanceof ArrayBuffer?(i[t]=r,e()):o(new Error("Unable to obtain ArrayBuffer"))}}))})))})).then((function(){return i}))},e.prototype.getResourceAsURL=function(e,t){var n=new r.Operation({operationName:"GetResource",success:!0,resultDescription:"",dimension0:o.URL,dimension1:e,dimension2:t});n.start();var i={};return this.getResource(e,t,o.URL,n,(function(e){return Promise.all(Array.from(e.keys()).map((function(t){i[t]=URL.createObjectURL(e.get(t))})))})).then((function(){return i}))},e.prototype.getResource=function(e,t,n,o,r){var i=this;return this.getIndexedDBFiles(e,t,o).then((function(e){return r(e)})).then((function(){i.closeDBAndEndLog(o,"retrieving "+e)})).catch((function(t){throw o.resultDescription!==t.message+" "&&(o.success=!1,o.resultDescription+=t.message+" "),o.resultSignature="Issue retrieving from CDN or translating to "+n,i.closeDBAndEndLog(o,"retrieving "+e),t}))},e.prototype.isBrowserIdbCompatible=function(){var e,t;return"undefined"==typeof Array||void 0===Array.from||"undefined"==typeof Proxy||"undefined"==typeof URL||void 0===URL.createObjectURL?Promise.resolve(!1):"undefined"!=typeof window&&(null===(e=window.navigator)||void 0===e?void 0:e.userAgent)&&window.navigator.userAgent.toLowerCase().indexOf("safari")>-1&&window.navigator.userAgent.toLowerCase().indexOf("chrome")<=-1?this.checkIdbByFeatures&&(null===(t=window.document)||void 0===t?void 0:t.hasStorageAccess)?window.document.hasStorageAccess().then((function(){return!0})).catch((function(){return!1})):Promise.resolve(!1):Promise.resolve(!0)},e.prototype.accessDB=function(){var e=this;return this.accessDBPromise?this.accessDBPromise.then((function(e){return e.transaction("ALModels_os").done})).then((function(){return e.accessDBPromise})).catch((function(){return e.callOpenDB()})):this.callOpenDB()},e.prototype.callOpenDB=function(){var e=this;return this.accessDBPromise=(0,i.openDB)(this.dbName,1,{upgrade:function(t){t&&!t.objectStoreNames.contains(e.osName)&&t.createObjectStore(e.osName,{keyPath:"modelId"})}})},e.prototype.endLog=function(e,t){e.success?(e.resultDescription="Success "+t,r.Log.info(573329487,r.LogCategory.CoreDefault,e.stop())):(e.resultDescription+="error "+t,r.Log.error(573329488,r.LogCategory.CoreDefault,e.stop()))},e.prototype.closeDBAndEndLog=function(e,t){var n=this;this.accessDBPromise?this.accessDBPromise.then((function(e){e.close()})).catch((function(t){e.resultDescription!==t.message+" "&&(e.success=!1,e.resultDescription+=(t.message?t.message:"Error closing db")+" ",e.resultSignature="Issue closing db")})).then((function(){n.accessDBPromise=void 0,n.endLog(e,t)})):this.endLog(e,t)},e.prototype.getIndexedDBFiles=function(e,t,n){var o=this;return this.isBrowserIdbCompatible().catch((function(e){return n.success=!1,n.resultDescription+=e.message+" ",n.resultSignature="Issue determining idb compatibility",!1})).then((function(r){return r?o.initPromise.catch((function(e){n.success=!1,n.resultDescription+=e.message+" ",n.resultSignature="Issue initializing"})).then((function(){return o.getModel(e)})).then((function(e){return e&&e.model&&e.version==t?Promise.resolve(e.model):Promise.reject()})).catch((function(r){return r&&(n.resultDescription!==r.message+" "&&(n.success=!1,n.resultDescription+=r.message+" "),n.resultSignature="Issue retrieving from DB"),o.downloadFiles(e,t)})).then((function(r){return o.putModel(e,r,t).then((function(){return r})).catch((function(e){return n.resultDescription!==e.message+" "&&(n.success=!1,n.resultDescription+=e.message+" "),n.resultSignature="Issue adding to DB",r}))})):o.downloadFiles(e,t)}))},e.prototype.downloadFiles=function(e,t){var n=this;return a(this.baseURL+"/catalog_"+e+"_"+t+".json").then((function(e){if(e.ok)return e.text();throw new Error("CDN download response status: "+e.status)})).then((function(o){var r=JSON.parse(o),i=r.MajorVersion+"."+r.MinorVersion+"/ModelResources",s=e+"/"+t+"/";return Promise.all(r.Resources.map((function(e){return e.Name.length>s.length&&e.Name.substring(0,s.length)===s&&(e.Name=e.Name.substring(s.length)),a(n.baseURL+"/"+i+"/"+s+e.Name+"."+e.Type).then((function(e){if(e.ok)return e.blob();throw new Error("CDN download response status: "+e.status)})).then((function(t){return[e.Name+"."+e.Type,t]}))})))})).then((function(e){return new Map(e)}))},e.prototype.getModel=function(e){var t=this;return this.accessDB().then((function(n){return n.get(t.osName,e)}))},e.prototype.putModel=function(e,t,n){var o=this;return this.accessDB().then((function(r){return r.put(o.osName,{modelId:e,model:t,version:n,timesSinceUsage:0})}))},e}();n.ModelDownloader=c},{142:142,146:146,30:30}],46:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ALFactoryGlobal=n.AugLoopFactory=void 0;var o=e(47),r=e(62),i=function(){function e(){this._augLoopRuntimeManager=new o.AugLoopRuntimeManager}return e.prototype.getAugLoopRuntimeManager=function(){return this._augLoopRuntimeManager},e.prototype.createSingleItemWorkflow=function(e){return r.SingleItemWorkflow.create(e)},e}();n.AugLoopFactory=i,n.ALFactoryGlobal=new i},{47:47,62:62}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AugLoopRuntimeManager=n.IdentityProvider=void 0;var o=e(62),r=e(3),i=e(88);Object.defineProperty(n,"IdentityProvider",{enumerable:!0,get:function(){return i.IdentityProvider}});var s=e(44),a=e(49),c=e(134),u=e(135),l=e(136),p=e(14),f=e(53),d=function(e,t){for(var n,o=[],r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];if(void 0!==e[s]&&null!==e[s]){var a={name:t?t+"."+s:s,dataType:(n=e[s],"string"==typeof n?0:"boolean"==typeof n?1:"number"==typeof n?2:void l.ULS.sendTraceTag(572838285,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Warning,"Unsupported data field type")),value:e[s],classification:4};o.push(a)}}return o},h=function(e){return Promise.resolve(!1)},g=function(){var e=this;this._telemetryAggregationIntervalSec=30,this._eventHandlerDictionary={},this.initialize=function(t){if(e._runtimeInitPromise)l.ULS.sendTraceTag(572838286,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Info,"Runtime already initialized");else{l.ULS.sendTraceTag(572838287,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Info,"Start and initialize augloop runtime ..."),e.checkParametersAndThrow("initialize",t);var n=e.isFeatureEnabled("ModelDownloaderEbrake","None").then((function(n){n?l.ULS.sendTraceTag(556376070,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Info,"Resource downloader not created due to feature gate"):e.modelDownloaderFromCDN=t.appName&&t.downloadBaseUrl?new s.ModelDownloader(t.appName,t.downloadBaseUrl):void 0}));e.inferenceServiceFactory=t.appName&&t.inferenceServiceVersion?a.OnnxInferenceService.createFactory(t.appName,t.inferenceServiceVersion):void 0,e.excelServerParameters=t.excelServer,e.powerpointParameters=t.powerpoint;var i={appName:t.appName,appPlatform:"Web",appVersion:t.appVersion,uiLanguage:t.uiLanguage,releaseAudienceGroup:t.releaseAudienceGroup,releaseChannel:t.releaseChannel,releaseFork:t.releaseFork,sessionId:t.sessionId,flights:t.flights,privateMode:t.privateMode,disabledServiceGroups:t.disabledServiceGroups},p={onResult:e.onResult.bind(e),onAnnotationResult:e.onAnnotationResult.bind(e),sendTelemetryEvent:e.sendTelemetryEvent.bind(e),requestAuthToken:e.requestAuthToken.bind(e),isFeatureEnabled:e.isFeatureEnabled.bind(e),setSessionData:e.setSessionData.bind(e),areLicenseFeaturesEnabled:h,onInitSession:e.onInitSession.bind(e),overrideSessionInitMessage:e.overrideSessionInitMessage.bind(e)},f=n.then((function(){return o.runtime.init(t.serviceUrl,i,p,{telemetryAggregationIntervalSec:e._telemetryAggregationIntervalSec,modelDownloader:e.modelDownloaderFromCDN,inferenceServiceFactory:e.inferenceServiceFactory})})).then((function(){return r.runtimeALv1.init(t.serviceUrl,i,p)}));e.createSession=function(){e._runtimeInitPromise=f.then((function(){return o.runtime.createSession(t.sessionCreationOptions)}))},e.createSession()}},this.getSession=function(){return e._runtimeInitPromise},this.setULSLogger=function(t){e.checkParametersAndThrow("setULSLogger",t&&t.ulsLogger),l.ULS.setLogger(t.ulsLogger)},this.setSendOTelEventCallback=function(t){e.checkParametersAndPropertyAndThrow("setSendOTelEventCallback",t&&t.sendOTelEvent,e._sendOTelEventCallback),e._sendOTelEventCallback=t.sendOTelEvent},this.setRequestAuthTokenCallback=function(t){e.checkParametersAndPropertyAndThrow("setRequestAuthTokenCallback",t&&t.requestAuthTokenCallback,e._requestAuthTokenCallback),e._requestAuthTokenCallback=t.requestAuthTokenCallback},this.setIsFeatureEnabledCallback=function(t){e.checkParametersAndPropertyAndThrow("setIsFeatureEnabledCallback",t&&t.featureEnabledCallback,e._featureEnabledCallback),e._featureEnabledCallback=t.featureEnabledCallback},this.registerLocalWorkflow=function(t){e.checkParametersAndThrow("registerLocalWorkflow",t&&t.workflow),e.checkRuntimeInitAndThrow("registerLocalWorkflow"),e._runtimeInitPromise.then((function(e){e.registerLocalWorkflow(t.workflow)}))},this.activateAnnotation=function(t){var n=e.checkParameters("activateAnnotation",t&&t.annotationType)||e.checkRuntimeInit("activateAnnotation");return n?Promise.reject(n):e._runtimeInitPromise.then((function(e){var n;return(t.handler||t.stateUpdateHandler)&&(n={callback:t.handler,stateUpdateCallback:t.stateUpdateHandler}),e.activateAnnotation(t.annotationType,n)}))},this.updateAnnotationConfig=function(t){var n=e.checkParameters("updateAnnotationConfig",t&&t.token&&t.config)||e.checkRuntimeInit("updateAnnotationConfig");return n?Promise.reject(n):e._runtimeInitPromise.then((function(e){e.updateAnnotationConfig(t.token,t.config)}))},this.releaseAnnotation=function(t){var n=e.checkParameters("releaseAnnotation",t&&t.token)||e.checkRuntimeInit("releaseAnnotation");return n?Promise.reject(n):e._runtimeInitPromise.then((function(e){return e.releaseAnnotation(t.token)}))},this.submitOperation=function(t){e.checkParametersAndThrow("submitOperation",t&&t.operation),e.checkRuntimeInit("submitOperation"),e._runtimeInitPromise.then((function(e){e.submitOperation(t.operation)}))},this.setSessionDataCallback=function(t){e.checkParametersAndPropertyAndThrow("setSessionDataCallback",t&&(t.sessionDataCallback||t.handler),e._setSessionDataCallback),t.sessionDataCallback?e._setSessionDataCallback=t.sessionDataCallback:t.handler&&(e._setSessionDataCallback=function(e,n,o){return t.handler(e,n)})},this.setAnnotationResultCallback=function(t){e.checkParametersAndThrow("setAnnotationResultCallback",t&&t.handler),e._annotationResultCallback&&l.ULS.sendTraceTag(537401028,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Error,"setAnnotationResultCallback already called"),e._annotationResultCallback=t.handler},this.setAnnotationState=function(t){e.checkParametersAndThrow("setAnnotationState",t&&t.parentPath&&t.id&&t.value),e.checkRuntimeInitAndThrow("setAnnotationState"),e._runtimeInitPromise.then((function(e){e.setAnnotationState(t.parentPath,t.id,t.value)}))},this.setAnnotationMetadata=function(t){e.checkParametersAndThrow("setAnnotationMetadata",t&&t.parentPath&&t.id&&t.value),e.checkRuntimeInitAndThrow("setAnnotationMetadata"),e._runtimeInitPromise.then((function(e){e.setAnnotationMetadata(t.parentPath,t.id,t.value)}))},this.setInitSessionCallback=function(t){e.checkParametersAndPropertyAndThrow("setInitSessionCallback",t&&t.initSessionCallback,e._initSessionCallback),e._initSessionCallback=t.initSessionCallback},this.setSessionInitOverrideCallback=function(t){e.checkParametersAndPropertyAndThrow("setSessionInitOverrideCallback",t&&t.handler,e._sessionInitOverrideCallback),e._sessionInitOverrideCallback=t.handler},this.forceReconnectSession=function(t){var n=e.checkParameters("forceReconnectSession",t)||e.checkRuntimeInit("forceReconnectSession");return n?Promise.reject(n):e._runtimeInitPromise.then((function(n){return t.excelServerParameters&&(e.excelServerParameters=t.excelServerParameters),n.forceReconnect()}))},this.setSessionCloseCallback=function(t){var n=e.checkParameters("setSessionCloseCallback",t&&t.callback)||e.checkRuntimeInit("setSessionCloseCallback");return n?Promise.reject(n):e._runtimeInitPromise.then((function(e){e.setSessionCloseCallback(t.callback)}))},this.submitCustomMessage=function(t){var n=e.checkParameters("submitCustomMessage",t&&t.message)||e.checkRuntimeInit("submitCustomMessage");return n?Promise.reject(n):e._runtimeInitPromise.then((function(e){return e.submitCustomMessage(t.message)}))},this.closeSession=function(){var t=e.checkRuntimeInit("closeSession");return t?Promise.reject(t):e._runtimeInitPromise.then((function(e){e.close()}))},this.startNewSession=function(){if(!e.createSession){var t="startNewSession called before runtime init";throw l.ULS.sendTraceTag(537408074,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Error,t),new Error(t)}e.createSession()},this.submit=function(t){e.checkParametersAndThrow("submit",t&&t.inputSchema&&t.input),e.checkRuntimeInitAndThrow("submit"),e._runtimeInitPromise.then((function(){r.runtimeALv1.submit(t.inputSchema,t.input,t.correlationVector)}))},this.addEventHandler=function(t){e.checkParametersAndThrow("addEventHandler",t&&t.schemaName&&t.handler);var n=e._eventHandlerDictionary[t.schemaName]||[];n.push(t.handler),e._eventHandlerDictionary[t.schemaName]=n},this.removeEventHandler=function(t){e.checkParametersAndThrow("removeEventHandler",t&&t.schemaName&&t.handler);var n=e._eventHandlerDictionary[t.schemaName];if(Array.isArray(n)){var o=n.indexOf(t.handler);o>=0&&n.splice(o,1)}},this.registerSimpleRemoteWorkflow=function(t){var n=e.checkParameters("registerSimpleRemoteWorkflow",t&&t.name&&t.lambdaRemote)||e.checkRuntimeInit("registerSimpleRemoteWorkflow");return n?Promise.reject(n):e._runtimeInitPromise.then((function(){return r.runtimeALv1.registerSimpleRemoteWorkflow(t.name,t.lambdaBefore,t.lambdaRemote,t.lambdaAfter)}))},this.registerSimpleLocalWorkflow=function(t){var n=e.checkParameters("registerSimpleLocalWorkflow",t&&t.name&&t.lambda)||e.checkRuntimeInit("registerSimpleLocalWorkflow");return n?Promise.reject(n):e._runtimeInitPromise.then((function(){return r.runtimeALv1.registerSimpleLocalWorkflow(t.name,t.lambda)}))},this.registerReduceWorkflow=function(e){return Promise.resolve()},this.registerSchemas=function(e){return Promise.resolve()},this.onResult=function(t,n,o,r){var i=e._eventHandlerDictionary[o];if(i)for(var s=0,a=i;s<a.length;s++){var c=a[s];c&&c({inputSchema:t,input:n,outputSchema:o,output:r})}},this.onAnnotationResult=function(t){e._annotationResultCallback&&e._annotationResultCallback(t)},this.requestAuthToken=function(t){return e._requestAuthTokenCallback?(e._requestAuthTokenCallback(t)||Promise.resolve("")).then((function(e){var t=e||"";return Promise.resolve({Token:t})})):Promise.resolve({Token:""})},this.sendTelemetryEvent=function(t,n,o,r,i,s,a,c){e._sendOTelEventCallback&&e._sendOTelEventCallback(function(e,t,n,o,r,i,s){var a={telemetryProperties:{ariaTenantToken:e,nexusTenantToken:-1},eventName:t.split("_").join("."),dataFields:d(n),eventFlags:{dataCategories:i,diagnosticLevel:s,samplingPolicy:1}};return o&&(a.eventContract={name:o,dataFields:d(r,o.split(".").slice(-1)[0])}),a}(t,n,o,r,i,a,c))},this.isFeatureEnabled=function(t,n){if(!t)return Promise.resolve(!1);var o="Microsoft.Office.AugLoop.";if(0===t.indexOf(o)&&e._featureEnabledCallback){var r=t.slice(o.length);return Promise.resolve(e._featureEnabledCallback(r))}return Promise.resolve(!1)},this.setSessionData=function(t,n,o){e._setSessionDataCallback&&e._setSessionDataCallback(t,n,o)},this.overrideSessionInitMessage=function(t){return e._sessionInitOverrideCallback?e._sessionInitOverrideCallback(t):0===t.clientMetadata.appName.indexOf("Excel")&&e.excelServerParameters?e.overrideExcelSessionInitMessage(t):0===t.clientMetadata.appName.indexOf("PowerPoint")&&e.powerpointParameters?e.overridePowerPointSessionInitMessage(t):t},this.overrideExcelSessionInitMessage=function(t){for(var n={cluster:e.excelServerParameters.wacCluster,restUrl:e.excelServerParameters.ecsRestUrl,ecsId:e.excelServerParameters.ecsSessionId,ecsOperationUrl:e.excelServerParameters.ecsOperationUrl,workbookMetadataVersion:e.excelServerParameters.metadataVersion,serverEventVersion:e.excelServerParameters.serverEventVersion,permissionFlags:e.excelServerParameters.permissionFlags,configurations:e.excelServerParameters.configurations,collabUserListVersion:e.excelServerParameters.userListVersion,collabStateId:e.excelServerParameters.collabStateId,accessToken:e.excelServerParameters.accessToken,accessTokenTTL:e.excelServerParameters.accessTokenTTL,supportCustomMessages:e.excelServerParameters.supportCustomMessages},o=0,r=Object.keys(t);o<r.length;o++){var i=r[o];n[i]=t[i]}return new p.ExcelServerSessionInitMessage(n)},this.overridePowerPointSessionInitMessage=function(t){for(var n={downloadUrl:e.powerpointParameters.downloadUrl,getItemsEndPoint:e.powerpointParameters.getItemsEndPoint,documentOpenType:e.powerpointParameters.documentOpenType},o=0,r=Object.keys(t);o<r.length;o++){var i=r[o];n[i]=t[i]}return new f.PowerPointSessionInitMessage(n)},this.onInitSession=function(){return e._initSessionCallback?e._initSessionCallback():Promise.resolve()},this.checkParameters=function(e,t){if(!t){var n=e+" called with invalid parameters";return l.ULS.sendTraceTag(537408075,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Error,n),new Error(n)}},this.checkParametersAndThrow=function(t,n){var o=e.checkParameters(t,n);if(o)throw o},this.checkParametersAndPropertyAndThrow=function(t,n,o){if(e.checkParametersAndThrow(t,n),o){var r=t+" already called";throw l.ULS.sendTraceTag(537408076,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Error,r),new Error(r)}},this.checkRuntimeInit=function(t){if(!e._runtimeInitPromise){var n=t+" called before runtime init";return l.ULS.sendTraceTag(537408077,c.LogCategory.msoulscat_Wac_BrowserGeneral,u.TraceLevel.Error,n),new Error(n)}},this.checkRuntimeInitAndThrow=function(t){var n=e.checkRuntimeInit(t);if(n)throw n}};n.AugLoopRuntimeManager=g},{134:134,135:135,136:136,14:14,3:3,44:44,49:49,53:53,62:62,88:88}],48:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ALFactoryGlobal=void 0;var o=e(46);Object.defineProperty(n,"ALFactoryGlobal",{enumerable:!0,get:function(){return o.ALFactoryGlobal}})},{46:46}],49:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(51),n)},{51:51}],50:[function(e,t,n){"use strict";var o=e("awaiterHelper"),r=e("generatorHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.Inputs=n.Model=n.lackingPromiseOrWasmSupport=void 0;var i=e(30);n.lackingPromiseOrWasmSupport=function(e){var t="";if("undefined"!=typeof window&&window.navigator&&window.navigator.userAgent){var n=window.navigator.userAgent;!n.indexOf||n.indexOf("MSIE ")>0||n.indexOf("Trident/")>0?t="Error: IE lacks necessary support":"undefined"==typeof Promise?t="Error: Promise is not supported":"undefined"==typeof WebAssembly&&(t="Error: WASM is not supported")}else t="Error: No window userAgent";return""!=t&&(e.resultDescription=t,i.Log.info(540406806,i.LogCategory.CoreDefault,e.stop()),!0)};var s=function(){function e(e,t,n){this.session=e,this.onnxObject=n,this.modelName=t}return e.create=function(t,n,s){return o(this,void 0,void 0,(function(){var o;return r(this,(function(r){return(o=new i.Operation({operationName:"CreateModelForInferencing",success:!0,resourceId:n})).start(),[2,this.getInferenceSession(s).create(t).then((function(t){return i.Log.info(540406807,i.LogCategory.CoreDefault,o.stop()),new e(t,n,s)})).catch((function(e){throw o.resultDescription="Error: "+e,i.Log.info(540406808,i.LogCategory.CoreDefault,o.stop()),e}))]}))}))},e.getInferenceSession=function(e){if(null==e?void 0:e.InferenceSession)return e.InferenceSession;throw new Error("InferenceSession is not defined")},e.prototype.run=function(e){var t;return o(this,void 0,void 0,(function(){var n,o,s,a=this;return r(this,(function(r){if((n=new i.Operation({operationName:"RunModelForInferencing",success:!0,resourceId:this.modelName})).start(),null===(t=this.onnxObject)||void 0===t?void 0:t.Tensor)return o=e.getInputs(),s={},Object.keys(o).forEach((function(e){var t=o[e];if(Array.isArray(t.values)&&t.values.length>0&&"boolean"==typeof t.values[0]){var n=new Uint8Array(t.values);s[e]=new a.onnxObject.Tensor(n,t.dimensions)}else s[e]=new a.onnxObject.Tensor(t.values,t.dimensions)})),[2,this.session.run(s).then((function(e){return i.Log.info(540406809,i.LogCategory.CoreDefault,n.stop()),new c(e)})).catch((function(e){n.resultDescription="Problem running model. "+e.message,i.Log.info(540406810,i.LogCategory.CoreDefault,n.stop())}))];throw n.resultDescription="Unable to run model. Tensor not defined",i.Log.info(540406811,i.LogCategory.CoreDefault,n.stop()),new Error("Tensor is not defined")}))}))},e}();n.Model=s;var a=function(){function e(){this.map={}}return e.create=function(){return new e},e.prototype.getInputs=function(){return this.map},e.prototype.add=function(e,t,n){return this.map[e]={dimensions:t,values:n},this},e}();n.Inputs=a;var c=function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var o=n[t];this[o]=new u(o,e[o])}},u=function(){function e(e,t){this.resultName=e,this.result=t}return e.prototype.name=function(){return this.resultName},e.prototype.outputType=function(){switch(this.result.type){case"string":return 7;case"int8":return 4;case"int16":return 5;case"int32":return 6;case"bool":return 1;case"uint8":return 8;case"uint16":return 9;case"uint32":return 10;case"float32":return 2;case"float64":return 3;default:throw new Error("The output type "+this.result.type+" is not supported.")}},e.prototype.dimensions=function(){return this.result.dims},e.prototype.asBooleans=function(){if(1===this.outputType())return this.result.data.map((function(e){return!!e}));throw new Error("asBooleans() was called; however, outputType() is "+this.outputType()+", not Type.Booleans.")},e.prototype.asFloat32s=function(){if(2===this.outputType())return this.result.data;throw new Error("asFloat32s() was called; however, outputType() is "+this.outputType()+", not Type.Float32s.")},e.prototype.asFloat64s=function(){if(3===this.outputType())return this.result.data;throw new Error("asFloat64s() was called; however, outputType() is "+this.outputType()+", not Type.Float64s.")},e.prototype.asInt8s=function(){if(4===this.outputType())return this.result.data;throw new Error("asInt8s() was called; however, outputType() is "+this.outputType()+", not Type.Int8s.")},e.prototype.asInt16s=function(){if(5===this.outputType())return this.result.data;throw new Error("asInt16s() was called; however, outputType() is "+this.outputType()+", not Type.Int16s.")},e.prototype.asInt32s=function(){if(6===this.outputType())return this.result.data;throw new Error("asInt32s() was called; however, outputType() is "+this.outputType()+", not Type.Int32s.")},e.prototype.asStrings=function(){if(7===this.outputType())return this.result.data;throw new Error("asStrings() was called; however, outputType() is "+this.outputType()+", not Type.Strings.")},e.prototype.asUnsignedInt8s=function(){if(8===this.outputType())return this.result.data;throw new Error("asUnsignedInt8s() was called; however, outputType() is "+this.outputType()+", not Type.UnsignedInt8s.")},e.prototype.asUnsignedInt16s=function(){if(9===this.outputType())return this.result.data;throw new Error("asUnsignedInt16s() was called; however, outputType() is "+this.outputType()+", not Type.UnsignedInt16s.")},e.prototype.asUnsignedInt32s=function(){if(10===this.outputType())return this.result.data;throw new Error("asUnsignedInt32s() was called; however, outputType() is "+this.outputType()+", not Type.UnsignedInt32s.")},e}()},{30:30}],51:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OnnxInferenceService=void 0;var o=e(52),r=function(){function e(){}return e.createFactory=function(t,n){var r=this;return function(){if(e.onnxRetrievalPromise)return e.onnxRetrievalPromise;return(0,o.createFactory)((function(){return t&&n?new Promise((function(o,i){var s=document.createElement("script");s.src=r.createCdnUrl(t,n),s.onload=function(){var t;(null===(t=null===window||void 0===window?void 0:window.top)||void 0===t?void 0:t.ort)&&window.top.ort.InferenceSession&&window.top.ort.Tensor?(e.onnxRetrievalPromise=Promise.resolve(new e),o("Success creating inference service")):(s.remove(),i(new Error("ort.Tensor and/or ort.InferenceSession are undefined")))},s.onerror=i,document.body.appendChild(s)})):Promise.reject(new Error("Error: appName and/or version not provided"))})).catch((function(t){e.onnxRetrievalPromise=Promise.reject(t)})).then((function(){return e.onnxRetrievalPromise}))}},e.createCdnUrl=function(e,t){return"https://"+e+t},e.prototype.createModel=function(e,t){var n;return(0,o.createModel)(e,t||"",null===(n=null===window||void 0===window?void 0:window.top)||void 0===n?void 0:n.ort)},e.prototype.createInputs=function(){return(0,o.createInputs)()},e}();n.OnnxInferenceService=r},{52:52}],52:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.createInputs=n.createModel=n.createFactory=void 0;var o=e(30),r=e(50);n.createFactory=function(e){var t=new o.Operation({operationName:"CreateOnnxInferenceService",success:!0,resultDescription:""});if(t.start(),(0,r.lackingPromiseOrWasmSupport)(t)){var n="Browser lacks necessary support for inference service";return t.success=!1,t.resultDescription=n,o.Log.info(540406803,o.LogCategory.CoreDefault,t.stop()),Promise.reject(new Error(n))}return e().then((function(e){t.resultDescription=e,o.Log.info(540406804,o.LogCategory.CoreDefault,t.stop())})).catch((function(e){throw t.success=!1,t.resultDescription=e.message,o.Log.info(540406805,o.LogCategory.CoreDefault,t.stop()),e}))},n.createModel=function(e,t,n){return r.Model.create(e,t,n)},n.createInputs=function(){return r.Inputs.create()}},{30:30,50:50}],53:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(54),n)},{54:54}],54:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PowerPointSessionExtensionConfig=n.PowerPointSessionInitMessage=void 0;var o=e(112),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.PowerPointSessionInitMessage=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionExtensionConfig"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.PowerPointSessionExtensionConfig=i},{112:112}],55:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationActivationTracker=void 0;var o=e(100),r=function(){function e(t,n,o){var r=this;this.sessionManager=t,this.annotationType=n,this.options=o,this.token=n+"-"+e.nextActivationResultBatchId++,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return e.prototype.asPromise=function(){return this.promise},e.prototype.activate=function(e){var t=this;this.sessionManager().sendMessage(new o.AnnotationActivationMessage({annotationType:this.annotationType,token:this.token,config:this.options?this.options.config:void 0,ignoreExistingAnnotations:e,sendStateUpdates:this.options?!!this.options.stateUpdateCallback:void 0}),(function(e,n){t.complete(e?new Error(e.error):void 0)}))},e.prototype.release=function(){var e=this;return new Promise((function(t,n){e.sessionManager().sendMessage(new o.AnnotationReleaseMessage({token:e.token}),(function(e,o){e?n(new Error(e.error)):t(o.lastRelease)}))}))},e.prototype.complete=function(e){this.isComplete||(this.isComplete=!0,e?this.reject(e):this.resolve({token:this.token}))},e.nextActivationResultBatchId=1,e}();n.AnnotationActivationTracker=r},{100:100}],56:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OrderedAnnotationResultsProcessor=void 0;var o=e(57),r=function(){function e(e){this.annotationSequencer=null!=e?e:new o.AnnotationSequencer}return e.prototype.process=function(e,t,n,o){for(var r=[],i=function(e){var o=[];if(null==e?void 0:e.items)for(var i=function(n){var r=s.annotationSequencer.sequence(n.body).then((function(){t(e,n)}));o.push(r)},a=0,c=e.items;a<c.length;a++){i(c[a])}r.push(Promise.all(o).then((function(){n(e)})))},s=this,a=0,c=e.ops;a<c.length;a++){i(c[a])}Promise.all(r).then((function(){return o(e)}))},e}();n.OrderedAnnotationResultsProcessor=r},{57:57}],57:[function(e,t,n){"use strict";var o=e("awaiterHelper"),r=e("generatorHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationSequencer=void 0;var i=e(58),s=function(){function e(e,t){void 0===e&&(e=500),this.sequencerFactory=null!=t?t:new i.BufferingSequencerFactory(e)}return e.prototype.sequence=function(e){var t;return o(this,void 0,void 0,(function(){var n;return r(this,(function(o){switch(o.label){case 0:return(null===(t=null==e?void 0:e.metadata)||void 0===t?void 0:t.seq)&&(n=this.sequencerFactory.create(e))?[4,n.sequence(e.metadata.seq)]:[2];case 1:return o.sent(),[2]}}))}))},e}();n.AnnotationSequencer=s},{58:58}],58:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BufferingSequencerFactory=void 0;var o=e(13),r=function(){function e(e){void 0===e&&(e=500),this.bufferingTimeMs=500,this.workflowIdToSequencersMap=new Map,this.bufferingTimeMs=e}return e.prototype.create=function(e){if(!e.ownerId)return null;var t=this.workflowIdToSequencersMap.get(e.ownerId);return t||(t=new o.BufferingSequencer(this.bufferingTimeMs),this.workflowIdToSequencersMap.set(e.ownerId,t)),t},e}();n.BufferingSequencerFactory=r},{13:13}],59:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RoutingAnnotationResultsProcessor=void 0;var o=e(56),r=e(60),i=function(){function e(e,t,n){this.isOrderingEnabled=e,this.orderedAnnotationResultsProcessor=null!=t?t:new o.OrderedAnnotationResultsProcessor,this.unorderedAnnotationResultsProcessor=null!=n?n:new r.UnorderedAnnotationResultsProcessor}return e.prototype.process=function(e,t,n,o){this.isOrderingEnabled()?this.orderedAnnotationResultsProcessor.process(e,t,n,o):this.unorderedAnnotationResultsProcessor.process(e,t,n,o)},e}();n.RoutingAnnotationResultsProcessor=i},{56:56,60:60}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UnorderedAnnotationResultsProcessor=void 0;var o=function(){function e(){}return e.prototype.process=function(e,t,n,o){for(var r=0,i=e.ops;r<i.length;r++){var s=i[r];if(null==s?void 0:s.items)for(var a=0,c=s.items;a<c.length;a++){t(s,c[a])}n(s)}o(e)},e}();n.UnorderedAnnotationResultsProcessor=o},{}],61:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BatchManager=void 0;var o=e(30),r=e(88),i=function(){function e(e,t){this.batchesByGroupingKey=new Map,this.submit=e,this.onSummary=t}return e.prototype.addBatchItem=function(e,t,n,r,i,s){var a=this,c=t.delayMs,u=t.maxInputSize,l=t.estimateSize,p=t.groupingKeyExtractor,f=l(e),d=p(e);if(t.split&&f>u){var h;try{h=t.split(e)}catch(e){var g=new Error("Split error: "+e.message);return void(s?s(g):o.Log.error(573366352,o.LogCategory.CoreDefault,g))}if(h&&Array.isArray(h.inputs)&&h.inputs.length>1){for(var y,m=[],v=s?function(e,t){if(y=y||e,m.push(t),m.length===h.inputs.length){var n;try{n=h.join(m)}catch(e){return void s(new Error("Join error: "+e.message))}s(y,n)}}:void 0,T=0;T<h.inputs.length;T++){var S=h.inputs[T];this.addBatchItem(S,t,n,r,i&&T===h.inputs.length-1,v)}return}}var w=this.batchesByGroupingKey.get(d);w&&w.size+f>u&&(clearTimeout(w.timeout),this.executeBatch(d,w,t),w=void 0),w||(w={items:[],size:0,hasItemsWithCallbacks:!1,context:n},this.batchesByGroupingKey.set(d,w)),w.items.push({input:e,size:f,callback:s}),w.size+=f,w.hasItemsWithCallbacks=w.hasItemsWithCallbacks||!!s,w.cv=r,w.groupComplete=i,clearTimeout(w.timeout),w.groupComplete?this.executeBatch(d,w,t):w.timeout=setTimeout((function(){a.executeBatch(d,w,t)}),c)},e.prototype.removeAllBatchedItems=function(){this.batchesByGroupingKey.forEach((function(e){e.timeout&&clearTimeout(e.timeout)})),this.batchesByGroupingKey.clear()},e.prototype.executeBatch=function(e,t,n){var i=this;this.batchesByGroupingKey.delete(e);var s,a=t.items,c=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude "+e.toString().length},u=new o.Operation({operationName:"ExecuteBatch",cv:t.cv,resourceId:t.context.name,dimension0:"Count "+c(a.length),dimension1:"Size "+c(t.size)}).start(),l=function(e,n,i){var s;if(n&&n.exceptionType===r.ExceptionType.NoOutput)u.success=!0,o.Log.info(573366353,o.LogCategory.CoreDefault,u.stop());else{var c=e+" error: "+(n?n.message||n:"Unknown error");s=n||new Error(c),u.success=!1,u.resultDescription="Batch of "+a.length+" items of size "+t.size+" with "+c,u.resultSignature=e+" Error",o.Log.error(573366354,o.LogCategory.CoreDefault,u.stop())}if(t.hasItemsWithCallbacks)for(var l=0,p=a;l<p.length;l++){var f=p[l];f.callback&&f.callback(s,i)}};try{s=n.multiplex(a.map((function(e){return e.input})))}catch(e){return void l("Multiplex",e)}this.submit(s.input,t,(function(e,r){var c;if(e||r&&("exceptionType"in r||r instanceof Error))l("Submit",e||r,r);else if(t.hasItemsWithCallbacks||n.summaryExtractor){var p=void 0;if(t.hasItemsWithCallbacks)try{if((p=s.demultiplex(r)).length!==a.length)throw new Error("Mismatched output length")}catch(e){return void l("Demultiplex",e)}var f=void 0,d=void 0;if(n.summaryExtractor)try{d=(c=n.summaryExtractor(r))[0],f=c[1]}catch(e){return void l("SummaryExtractor",e)}if(u.success=!0,o.Log.info(573366342,o.LogCategory.CoreDefault,u.stop()),t.hasItemsWithCallbacks)for(var h=0;h<a.length;h++)a[h].callback&&a[h].callback(void 0,p[h]);f&&i.onSummary(d,f,t.context)}else u.success=!0,o.Log.info(573366343,o.LogCategory.CoreDefault,u.stop())}))},e}();n.BatchManager=i},{30:30,88:88}],62:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(61),n),o(e(63),n),o(e(64),n),o(e(65),n),o(e(66),n),o(e(68),n),o(e(69),n),o(e(73),n),o(e(74),n),o(e(84),n),o(e(85),n)},{61:61,63:63,64:64,65:65,66:66,68:68,69:69,73:73,74:74,84:84,85:85}],63:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.isLargerThan=n.estimateSize=void 0;n.estimateSize=function(e){return o(e,Number.POSITIVE_INFINITY)};n.isLargerThan=function(e,t){return o(e,t)>t};var o=function(e,t){for(var n=0,o=[],r=[e];r.length>0;){var i=r.pop(),s=typeof i;if("boolean"===s)n+=4;else if("string"===s)n+=2*i.length;else if("number"===s)n+=8;else if("object"===s&&i&&-1===o.indexOf(i))if(i instanceof Uint8Array)n+=i.length;else for(var a in o.push(i),i)r.push(i[a]);if(n>t)return n}return n}},{}],64:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.internalFetch=void 0;var o=e(70),r=e(142);n.internalFetch=function(e,t,n){var o=new r.Request(e,t);return i.add(o,n)};var i=new o.SequentialFetchQueue(r,2e4,12e4)},{142:142,70:70}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],66:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],67:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.LocalWorkflowContext=void 0;var o=e(128),r=function(){function e(e){this.model=e.model,this.clientMetadata=e.clientMetadata,this.site=e.site,this.getToken=e.getTokenCallback}return Object.defineProperty(e.prototype,"flights",{get:function(){var e;return null!==(e=this._flights)&&void 0!==e||(this._flights=(0,o.parseFlights)(this.clientMetadata.flights)),this._flights},enumerable:!1,configurable:!0}),e.prototype.getToken=function(e,t){return this.getToken(e,t)},e}();n.LocalWorkflowContext=r},{128:128}],68:[function(e,t,n){"use strict";var o=e("assignHelper"),r=e("spreadArrayHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.LocalWorkflowExecutionManager=void 0;var i=e(112),s=e(17),a=e(30),c=e(100),u=e(97),l=e(86),p=e(74),f=e(37),d=e(67),h=e(130),g=e(123),y=e(95),m=function(){function e(e,t,n){var o=this;this.workflowsWithSessionAffinity=new Map,this.workflowDefinitionsWithSessionAffinity=[],this.workflowsWithoutSessionAffinity=[],this.pendingScopeExecutionNotificationsByWorkflow=new Map,this.sweepIntervalMs=200,this.sweepTimers=new Map,this.getResourceAsArrayBuffer=function(e,t){return o.modelDownloader?o.modelDownloader.getResourceAsArrayBuffer(e,t):Promise.reject(new Error("Resource Downloader never created"))},this.getResourceAsURL=function(e,t){return o.modelDownloader?o.modelDownloader.getResourceAsURL(e,t):Promise.reject(new Error("Resource Downloader never created"))},this.createModel=function(e){return!o.inferenceService&&o.inferenceServiceFactory&&(o.inferenceService=o.inferenceServiceFactory()),o.inferenceService?o.inferenceService.then((function(t){return t.createModel(e)})):Promise.reject(new Error("Inference Service never created"))},this.createModelInputs=function(){if(!o.inferenceService&&o.inferenceServiceFactory&&(o.inferenceService=o.inferenceServiceFactory()),o.inferenceService)return o.inferenceService.then((function(e){return e.createInputs()}));throw new Error("Inference Service never created")},this.nextAnnotationId=1,this.nextSignalId=1,this.modelDownloader=e,this.inferenceServiceFactory=t,n.enableDeltas&&(this.deltaHandlers=(new Map).set(i.SchemaObject.getTypeNameFor(g.TextTileDelta),f.applyTextTileDelta).set(i.SchemaObject.getTypeNameFor(g.FormattedTextTileDelta),f.applyFormattedTextTileDelta),this.deltaItems=new Map),this.site={getResourceAsArrayBuffer:this.getResourceAsArrayBuffer,getResourceAsURL:this.getResourceAsURL,createModel:this.createModel,createModelInputs:this.createModelInputs}}return e.prototype.getNextClientAnnotationId=function(){return"#AC"+this.nextAnnotationId++},e.prototype.getNextClientSignalId=function(){return"#SC"+this.nextSignalId++},e.prototype.registerLocalWorkflow=function(e,t){var n=this,o=new a.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");t?(this.workflowsWithSessionAffinity.get(t).push(this.createWorkflowImplementation(e,t)),t.registerContextTypes((0,h.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=e[0];e[1];return t})))):(e.isStateful?(this.workflowDefinitionsWithSessionAffinity.push(e),this.workflowsWithSessionAffinity.forEach((function(o){o.push(n.createWorkflowImplementation(e,t))}))):this.workflowsWithoutSessionAffinity.push(this.createWorkflowImplementation(e)),this.workflowsWithSessionAffinity.forEach((function(t,n){return n.registerContextTypes((0,h.getContextTypes)(e.requestedContextTypesRules).map((function(e){var t=e[0];e[1];return t})))}))),o.success=!0,a.Log.info(572838110,a.LogCategory.CoreDefault,o.stop())},e.prototype.getWorkflowDefinitionsByName=function(e){var t,n=new Map;return null===(t=this.workflowsWithSessionAffinity.get(e))||void 0===t||t.forEach((function(e){return n.set(e.workflow.id,e.workflow)})),n},e.prototype.getWorkflowDefinitionsWithSessionAffinity=function(){return this.workflowDefinitionsWithSessionAffinity},e.prototype.addSession=function(e){for(var t=[],n=0,o=this.workflowDefinitionsWithSessionAffinity;n<o.length;n++){var r=o[n];t.push(this.createWorkflowImplementation(r)),r.kind===s.WorkflowKind.Join&&e.getContextIdManager().setActiveScopeType(r.collectionScopeType)}this.workflowsWithSessionAffinity.set(e,t)},e.prototype.closeSession=function(e){this.cancelSweepTimer(e);for(var t=0,n=this.workflowsWithSessionAffinity.get(e)||[];t<n.length;t++){n[t].workflowLambda.dispose()}this.workflowsWithSessionAffinity.delete(e)},e.prototype.setTokenCallback=function(e){this.getAuthTokenCallback=e},e.prototype.runLocalWorkflows=function(e,t,n){var o,c,u,l=this;void 0===n&&(n=!1);var p=function(e,n,o){var c,u=t.getWorkflowItemStorage(),p=e.workflow,f=p.inputTypes.concat(p.kind===s.WorkflowKind.Join?p.collectionScopeType:[]);if(i.SchemaObject.matchesTypesFor(n.body,f)){var d=(0,y.shallowCloneItemWithPath)(o.parentPath,n);if(p.kind===s.WorkflowKind.Join)if(i.SchemaObject.matchesTypesFor(d.body,[p.collectionScopeType]))u.setScopeItem(d,p),l.setScopeExecutionNotification(t,e,d,0);else{if(!u.getScopeItem(d.contextId,p)){var h=new a.Operation({resultDescription:"Filtered out join invalidation: out of scope type ("+p.collectionScopeType+"), itemd id: "+d.id+", contextId: "+d.contextId,operationName:"RunLocalWorkflows",success:!1}).start();return void a.Log.info(541173894,a.LogCategory.CoreDefault,h.stop())}u.addItemToWorkflowList(d,p)}if(i.SchemaObject.getBaseTypesFor(d.body).indexOf(i.ContextHolder.getTypeName())>=0){for(var g=r(r([],d.parentPath,!0),[d.id],!1),m=!0,v=0,T=null!==(c=p.outputTypes)&&void 0!==c?c:[];v<T.length;v++){var S=T[v];if(!t.getContextAnnotations(S,0,g,p.id)){m=!1;break}}if(m)return}var w=function(){var o,r=t.resolveRequestedContexts(p),i=r[0],c=r[1];if(!i)return a.Log.info(545837259,a.LogCategory.WorkflowDefault,"Required contexts are not ready for "+p.id+". Retrying execution in 500 milliseconds..."),void setTimeout(w,500);if(p.kind===s.WorkflowKind.SingleItem)l.executeLocalWorkflow(e,d,[d],t,c,0).catch((function(e){return a.Log.error(572838111,a.LogCategory.CoreDefault,e)}));else if(p.kind===s.WorkflowKind.Join){var f=n.contextId,h=u.getScopeItem(f,e.workflow);if(!h){var g=new a.Operation({resultDescription:"No scope item for "+p.id+" workflow from contextId "+f}).start();return void a.Log.info(526758475,a.LogCategory.CoreDefault,g.stop())}if(u.isWorkflowReady(f,p)){var y=u.getItemsToExecute(f,p);if(l.executeLocalWorkflow(e,h,y,t,c,0).catch((function(e){return a.Log.error(541173895,a.LogCategory.CoreDefault,e)})).finally((function(){return u.onWorkflowExecuted(h,p)})),null===(o=l.pendingScopeExecutionNotificationsByWorkflow.get(p.id))||void 0===o?void 0:o.get(f))l.pendingScopeExecutionNotificationsByWorkflow.get(p.id).delete(f),0===l.pendingScopeExecutionNotificationsByWorkflow.get(p.id).size&&l.pendingScopeExecutionNotificationsByWorkflow.delete(p.id);else{g=new a.Operation({resultDescription:"Workflow "+p.id+", contextId "+f+", already queued, skipping new scope execution"}).start();a.Log.info(528048977,a.LogCategory.CoreDefault,g.stop())}}}};w()}},f=e;n&&(f=[new i.AddOperation({parentPath:["session"],items:[{id:"#userContext#",body:new i.UserContextHolder}]}),new i.AddOperation({parentPath:["session"],items:[{id:"#tenantContext#",body:new i.TenantContextHolder}]})],t.getContextIdManager().applyContextIdOnOperations(f),f=f.concat(e));for(var d=0,h=f;d<h.length;d++)for(var g=h[d],m=i.SchemaObject.getTypeNameFor(g),v=0,T=g.items;v<T.length;v++){var S=T[v];if(t.applyOperationForContext(g,S,2),m!==i.DeleteOperation.getTypeName()){if(S.body)if(m===i.DeltaUpdateOperation.getTypeName()&&this.deltaHandlers&&this.deltaItems){var w=new a.Operation({operationName:"LocalDeltaUpdate",dimension0:i.SchemaObject.getTypeNameFor(S.body),success:!0});w.start();try{var b=this.deltaHandlers.get(i.SchemaObject.getTypeNameFor(S.body)),_=this.deltaItems.get(S.id);if(b&&_){var C=b(S.body,_);if(C){var k={id:S.id,revId:S.revId,body:C,parentPath:g.parentPath,delta:S.body,contextId:S.contextId},x=new i.Operation({parentPath:k.parentPath,items:[k]});a.Log.info(539637591,a.LogCategory.CoreDefault,w.stop()),this.runLocalWorkflows([x],t)}else w.success=!1,w.resultDescription="Failed because the handler did not produce valid updated item",a.Log.info(539637592,a.LogCategory.CoreDefault,w.stop())}else w.success=!1,w.resultDescription="Failed due to lack of handler or parent item",a.Log.info(539637593,a.LogCategory.CoreDefault,w.stop())}catch(e){w.success=!1,w.resultDescription="Failed to apply delta, error: "+e,a.Log.info(539637594,a.LogCategory.CoreDefault,w.stop())}}else{null===(c=this.deltaItems)||void 0===c||c.set(S.id,S.body);for(var O=0,M=this.workflowsWithoutSessionAffinity;O<M.length;O++){p(M[O],S,g)}for(var I=0,A=null!==(u=this.workflowsWithSessionAffinity.get(t))&&void 0!==u?u:[];I<A.length;I++){p(A[I],S,g)}}}else null===(o=this.deltaItems)||void 0===o||o.delete(S.id)}},e.prototype.onWorkflowExecutionRequest=function(e,t,n,o){var r,i=null===(r=this.workflowsWithSessionAffinity.get(e))||void 0===r?void 0:r.find((function(e){return e.workflow.id===t}));this.executeLocalWorkflow(i,n.scopeItem,n.inputItems,e,n.requestedContexts,1).then((function(e){o(void 0,e)})).catch((function(e){o(new Error(e))}))},e.prototype.createWorkflowImplementation=function(e,t){var n=e.factory();return{workflow:e,workflowLambda:n,initPromise:this.initWorkflow(e.kind,n,t)}},e.prototype.initWorkflow=function(e,t,n){var o=new d.LocalWorkflowContext({model:void 0,clientMetadata:n?n.getClientMetadata():void 0,site:this.site,getTokenCallback:this.getAuthTokenCallback.bind(this)});return e===s.WorkflowKind.SingleItem||e===s.WorkflowKind.Join?t.init(this.site,o):Promise.resolve()},e.prototype.executeLocalWorkflow=function(e,t,n,r,p,f){var h=this;return new Promise((function(g,y){var m,v={annotations:[]},T=e.workflow,S=new a.Operation({operationName:"ExecuteWorkflow",resourceId:T.id});S.start();var w=null===(m=null==n?void 0:n[0])||void 0===m?void 0:m.contextId;S.dimension3=null!=w?w:"";var b=function(e){return e?(S.resultDescription=e,S.resultSignature="Exception",a.Log.error(572838112,a.LogCategory.CoreDefault,S.stop())):(S.success=!0,a.Log.info(572838113,a.LogCategory.CoreDefault,S.stop())),e},_=new d.LocalWorkflowContext({model:new l.WorkflowModel(n[0],p),clientMetadata:r.getClientMetadata(),site:h.site,getTokenCallback:h.getAuthTokenCallback.bind(h)}),C=function(e){b(e?e.message:null),e?y(e):g(v)},k={setAnnotations:function(u,l,p,d){for(var g,m=function(t){a.Log.info(555866112,a.LogCategory.CoreDefault,new a.AnnotationMetaDataChange({annotationType:l,annotationState:t,workflowId:e.workflow.id}))},S=0,_=p;S<_.length;S++){(A=_[S]).metadata=o(o({},A.metadata),{state:i.AnnotationState.Created}),m(i.AnnotationState.Created)}if(T.kind!==s.WorkflowKind.SingleItem||n[0].body===u)if(T.kind!==s.WorkflowKind.Join||(null==t?void 0:t.body)===u){var C,k,x=t||n[0],O=i.SchemaObject.getTypeNameFor(x.body);if(Array.isArray(p))if(!T.outputTypes||T.outputTypes.indexOf(l)<0)C="Workflow said it would output one of ["+T.outputTypes+"] but instead output "+l;else if(x)for(var M=0,I=p;M<I.length;M++){var A=I[M];i.SchemaObject.matchesTypesFor(A,[i.Annotation.getTypeName()])?i.SchemaObject.getTypeNameFor(A)!==l&&(C="Workflow produced inconsistent annotation types in setAnnotations call ("+i.SchemaObject.getTypeNameFor(A)+" did not match expected "+l+")"):C="Workflow produced an output that is not an annotation "+i.SchemaObject.getTypeNameFor(A)}else C="No item provided";else C="Workflow produced an invalid annotation array";if(C)y(b(C));else if(k=d&&d.isSessionAnnotation?["session"]:d&&d.ancestorType?x.parentPath:x.parentPath.concat(x.id),v.annotations.push({path:k,annotationType:l,annotations:p}),1!==f){for(var L=[],P=[],D=function(e){e.metadata=o(o({},e.metadata),{state:i.AnnotationState.Sent}),m(i.AnnotationState.Sent);var t=e.id,n=t?null===(g=r.getContextAnnotations(l,0,k,T.id))||void 0===g?void 0:g.filter((function(e){var n;return(null===(n=e.body)||void 0===n?void 0:n.id)==t})):void 0;1==(null==n?void 0:n.length)?1==n.length?P.push({id:n[0].id,source:T.id,body:e,contextId:w}):a.Log.error(545837260,a.LogCategory.CoreDefault,"Assert: Multiple existing context annotations with body id "+t+" found for "+l+" and local workflow "+T.id+")."):L.push({id:h.getNextClientAnnotationId(),source:T.id,body:e,contextId:w})},E=0,R=p;E<R.length;E++){D(A=R[E])}var N=[];L.length>0&&N.push(new i.AddOperation({parentPath:k,items:L})),P.length>0&&N.push(new i.UpdateOperation({parentPath:k,items:P})),r.onAnnotationResults(new c.AnnotationResultsMessage({annotationType:l,ops:N}),0,(function(){})),(O==i.UserContextHolder.getTypeName()||O==i.TenantContextHolder.getTypeName()||i.SchemaObject.matchesTypesFor(x.body,[i.Document.getTypeName(),i.SubDocument.getTypeName()]))&&r.submitOperationsToServer(N)}}else y(b("Expected obj to be "+(null==t?void 0:t.body)+" but instead it was "+u));else y(b("Expected obj to be "+n[0].body+" but instead it was "+u))},submitSignals:function(e){if(1!==f){var t=e.map((function(e){return{id:h.getNextClientSignalId(),source:T.id,body:e,contextId:w}})),n=new i.SignalOperation({parentPath:["session"],items:t});r.submitOperations([n])}else y(b("NYI"))},done:C,overrideWorkflowDefinition:function(e,n,o){var i;switch(o){case 0:if(!t.contextId){var s="ContextId is not defined for this scope item.";throw a.Log.error(527472289,a.LogCategory.CoreDefault,s),new Error(s)}i=t.contextId;break;case 1:i=void 0;break;default:s="Defined scope is not supported. "+o;throw a.Log.error(527472290,a.LogCategory.CoreDefault,s),new Error(s)}var c=new u.WorkflowDefinitionOverrideMessage({definition:n,contextId:i,sourceWorkflowId:T.id,targetWorkflowId:e});r.onWorkflowDefinitionOverrideMessage(c)}},x=e.workflowLambda;if(T.kind===s.WorkflowKind.SingleItem){1!==n.length&&C(new Error("Single item workflows expect a single input")),_.delta=n[0].delta;try{var O=x;e.initPromise||(e.initPromise=O.init(h.site,_)),e.initPromise.then((function(){O.execute(n[0].body,_,k)})).catch((function(e){b(e)}))}catch(e){b(e)}}else if(T.kind===s.WorkflowKind.Join){0===n.length&&C(new Error("Join workflows expect an inputs array")),_.delta=t.delta;try{var M=x;e.initPromise||(e.initPromise=M.init(h.site,_)),e.initPromise.then((function(){M.execute(t.body,n.map((function(e){return e.body})),_,k)})).catch((function(e){b(e)}))}catch(e){b(e)}}else b("Workflow kind "+T.kind+" not supported")}))},e.prototype.ensureSweepTimer=function(e){if(!this.sweepTimers.get(e)){var t=setInterval(this.onSweep.bind(this),this.sweepIntervalMs);this.sweepTimers.set(e,t)}},e.prototype.cancelSweepTimer=function(e){var t=this.sweepTimers.get(e);this.sweepTimers.get(e)&&(clearInterval(t),this.sweepTimers.delete(e))},e.prototype.onSweep=function(){this.sweepScopeExecutionNotifications()},e.prototype.setScopeExecutionNotification=function(e,t,n,o){var r=Date.now(),i={session:e,workflowImplementation:t,scopeItem:n,startTime:r,minTime:r+(0,p.getSafeNumber)(t.workflow.minDelayMs,1e3),maxTime:r+(0,p.getSafeNumber)(t.workflow.maxDelayMs,5e3),orchestrationMode:o},c=t.workflow.kind===s.WorkflowKind.Join?n.contextId:i.scopeItem.parentPath.concat(n.id).join("\\");if(this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id)||this.pendingScopeExecutionNotificationsByWorkflow.set(t.workflow.id,new Map),!this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).get(c)){var u=new a.Operation({resultDescription:"New pending scope execution for "+t.workflow.id+" at "+c,operationName:"LocalScopeExecutionNotification",success:!0}).start();a.Log.info(539883075,a.LogCategory.CoreDefault,u.stop()),this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).set(c,i)}this.ensureSweepTimer(e)},e.prototype.sweepScopeExecutionNotifications=function(){for(var e=this,t=new Set(Array.from(this.sweepTimers.keys())),n=0,o=Array.from(this.pendingScopeExecutionNotificationsByWorkflow.entries());n<o.length;n++)for(var r=o[n],i=r[0],c=r[1],u=function(n,o){var r=o.session,c=o.workflowImplementation.workflow,u=o.orchestrationMode,p=r.getWorkflowItemStorage();!function(){if(!function(){if(c.kind===s.WorkflowKind.Join){var e=Date.now(),t=o.workflowImplementation.workflow,n=o.scopeItem.contextId,i=r.getWorkflowDefinition(t,n).maxDelayMs;if(p.isWorkflowReady(n,t)){var u=new a.Operation({resultDescription:"Join Workflow: "+t.id+" queuing by maxAnnotation, contextId: "+n}).start();return a.Log.info(528048978,a.LogCategory.CoreDefault,u.stop()),!0}if(o.startTime+i<e){u=new a.Operation({resultDescription:"Join Workflow: "+t.id+" queuing by maxTimeout, contextId: "+n}).start();return a.Log.info(528048979,a.LogCategory.CoreDefault,u.stop()),!0}return!1}return!0}())return!1;var t=r.resolveRequestedContexts(c),n=t[0],i=t[1];if(!n)return!1;var l=new a.Operation({operationName:"LocalScopeExecutionNotification"}).start();try{if(c.kind===s.WorkflowKind.Join){var f=o.scopeItem.contextId,d=p.getScopeItem(f,c);if(d){var h=p.getItemsToExecute(f,c);if(0===h.length)return a.Log.info(527472291,a.LogCategory.CoreDefault,"Failed to retrieve items for workflow: "+c.id+", contextId: "+f+", skipping execution"),p.onWorkflowExecuted(d,c),!0;e.executeLocalWorkflow(o.workflowImplementation,d,h,r,i,u).finally((function(){return p.onWorkflowExecuted(d,c)}))}else l.resultDescription="ContextId no longer exists, skipping workflow execution",a.Log.debug(539883076,a.LogCategory.CoreDefault,l.stop())}else l.resultDescription="Workflow in type "+c.kind+" is not supported",a.Log.error(539883077,a.LogCategory.CoreDefault,l.stop())}catch(e){l.resultDescription="Trying to execute "+c.id+" caused an exception: "+e,a.Log.warn(539883078,a.LogCategory.CoreDefault,l.stop())}return!0}()?t.delete(r):(l.pendingScopeExecutionNotificationsByWorkflow.get(i).delete(n),0===l.pendingScopeExecutionNotificationsByWorkflow.get(i).size&&l.pendingScopeExecutionNotificationsByWorkflow.delete(i))},l=this,p=0,f=Array.from(c.entries());p<f.length;p++){var d=f[p];u(d[0],d[1])}if(0!==t.size)for(var h=0,g=Array.from(t);h<g.length;h++){var y=g[h],m=new a.Operation({resultDescription:"No pending scope notifications left, cancelling sweep timer",operationName:"LocalScopeExecutionNotification",success:!0}).start();a.Log.debug(539883079,a.LogCategory.CoreDefault,m.stop()),this.cancelSweepTimer(y)}},e}();n.LocalWorkflowExecutionManager=m},{100:100,112:112,123:123,130:130,17:17,30:30,37:37,67:67,74:74,86:86,95:95,97:97}],69:[function(e,t,n){"use strict";var o=e("assignHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.createRuntime=n.runtime=n.ClientRuntime=n.getVersion=void 0;var r=e(30),i=e(72),s=e(84),a=e(82),c=e(71),u=e(74),l=e(77),p=e(79),f=e(81),d=e(68),h=e(59);n.getVersion=function(){return e(75).version};var g=function(){function e(e,t,n){var o=this;this.sessionsByDocSessionId=new Map,this.settings={dropOnlySequencedSyncsOnReseedEnabled:!0,closeWSBlockedSessionEnabled:!0,sessionOfflineModeEnabled:!0,annotationsOrderingEnabled:!1,deltaOperationsEnabled:!1,checkIdbByFeatures:!1},this.isDownloaderCompatible=function(){if(o.settings.checkIdbByFeatures)return"undefined"!=typeof Array&&void 0!==Array.from&&"undefined"!=typeof URL&&void 0!==URL.createObjectURL;if("undefined"!=typeof window&&window.navigator&&window.navigator.userAgent){var e=window.navigator.userAgent;return!(!e.indexOf||e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0)}return!1},this.workerFactory=e||function(){return new s.WebSocketWorker};var r=this.createDefaultSessionManagerFactory();this.sessionManagerFactory=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(null==t?void 0:t.apply(void 0,e))||r.apply(void 0,e)},this.sessionFactory=n||function(e){return new c.SessionProxy(e)}}return e.prototype.init=function(e,t,o,s){var a=this,c=new r.Operation({operationName:"InitRuntime",resourceId:e});c.start(),this.annotationResultsProcessor=new h.RoutingAnnotationResultsProcessor((function(){return a.settings.annotationsOrderingEnabled})),this.inferenceServiceFactory=s.inferenceServiceFactory,this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=(0,n.getVersion)()),this.hostCallbacks=o,r.Log.addLogger(new i.TelemetryLogger(this.hostCallbacks));var l=s.telemetryAggregationIntervalSec;if(void 0===l&&(l=30),l>0){var p=function(e,t,n){return new r.LoggingAggregator(e,(function(e){return e.success&&n.indexOf(e[t])>=0}),[t,"resourceId","success","resultSignature","dimension0","dimension1","dimension2","dimension3"],["durationMs"],l)};r.Log.addAggregator(p("Operation","operationName",["ExecuteLambda","ExecuteWorkflow","ExecuteBatch","ProcessResponse","LocalDeltaUpdate","ApplyFormattedTextTileDeltaForLocalWorkflows","ApplyTextTileDeltaForLocalWorkflows","FindRangeForDelta","RunModelForInferencing","GetResource"])),r.Log.addAggregator(p("SessionHealth","sessionHealthEventName",["ProcessMessage","SendMessage"]))}this.batchOptions=s.batchOptions,e&&(this.defaultServiceUrl=u.Utils.convertServiceUrlToWebSocket(e),this.serviceProtocol=this.defaultServiceUrl.split(":")[0].toLowerCase());var f=[];return f.push(this.isFeatureEnabled("CheckIdbByFeatures",!1).then((function(e){a.settings.checkIdbByFeatures=e}))),f.push(this.isFeatureEnabled("DropOnlySequencedSyncsOnReseedDisabled").then((function(e){a.settings.dropOnlySequencedSyncsOnReseedEnabled=!e}))),f.push(this.isFeatureEnabled("CloseWSBlockedSessionDisabled").then((function(e){a.settings.closeWSBlockedSessionEnabled=!e}))),f.push(this.isFeatureEnabled("SessionOfflineModeDisabled").then((function(e){a.settings.sessionOfflineModeEnabled=!e}))),f.push(this.isFeatureEnabled("AnnotationsOrderingEnabled",!1).then((function(e){a.settings.annotationsOrderingEnabled=e}))),f.push(this.isFeatureEnabled("DeltaOperationsEnabled").then((function(e){a.localWorkflowManager=new d.LocalWorkflowExecutionManager(s.modelDownloader&&a.isDownloaderCompatible()?s.modelDownloader:void 0,a.inferenceServiceFactory,{enableDeltas:e})})).catch((function(){a.localWorkflowManager=new d.LocalWorkflowExecutionManager(s.modelDownloader&&a.isDownloaderCompatible()?s.modelDownloader:void 0,a.inferenceServiceFactory,{enableDeltas:!1})}))),Promise.all(f).then((function(){a.logOperation(c,!0)})).catch((function(e){a.logOperation(c,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerLocalWorkflow=function(e){this.localWorkflowManager.registerLocalWorkflow(e)},e.prototype.flushTelemetry=function(e){r.Log.flushAggregators(e)},e.prototype.createSession=function(e){var t,n=e?e.docSessionId:void 0,r=this.sessionsByDocSessionId.get(n);if(r&&!1===r.isClosed)throw new Error("docSessionId already exists");var i=e&&null!==(t=e.serviceUrl)&&void 0!==t?t:this.defaultServiceUrl;if(!(i=u.Utils.convertServiceUrlToWebSocket(i)))return Promise.reject(new Error("EmptyUrl"));var s=o({},this.clientMetadata);s.docSessionId=n,e&&e.flights&&(s.flights=s.flights?s.flights+";"+e.flights:e.flights);var a=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(s,i,null==e?void 0:e.enableComplexLocalWorkflows),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:s,localWorkflowManager:this.localWorkflowManager,annotationResultsProcessor:this.annotationResultsProcessor});return this.sessionsByDocSessionId.set(n,a),e&&e.onSessionConnect&&a.setConnectCallback(e.onSessionConnect),e&&e.onSessionDisconnect&&a.setDisconnectCallback(e.onSessionDisconnect),e&&e.onSessionReconnect&&a.setReconnectCallback(e.onSessionReconnect),e&&e.onSessionClose&&a.setSessionCloseCallback(e.onSessionClose),a.initialize?a.initialize():Promise.resolve(a)},e.prototype.getSessionManagerFactory=function(){return this.sessionManagerFactory},e.prototype.createDefaultSessionManagerFactory=function(){var e=this;return function(t,n,o){if(o)throw new Error("NYI");var i=new f.TokenRefreshManager,s=new l.SessionStats,c=function(){r.Log.error(573321615,r.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},d=new p.SessionInitializer((function(){return s}),t,i,(function(e,t){c(e,t)}),{getAuthToken:e.getAuthToken.bind(e,t.docSessionId),overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage}),h=new a.WebSocketSessionManager(u.Utils.convertServiceUrlToWebSocket(n),s,e.workerFactory,d,t,i,e.settings);return c=h.sendMessage.bind(h),h.on("disconnect",(function(){return i.clearRefreshTimeouts()})),h.on("connect",(function(t,n,o,r){t&&e.hostCallbacks.setSessionData&&e.hostCallbacks.setSessionData(n,o,r)})),h}},e.prototype.getAuthToken=function(e){var t={Tickets:[]};return e&&(t.DocSessionId=e),this.hostCallbacks.requestAuthToken(t).then((function(e){if(e)return e.Token})).catch((function(){}))},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),u.Utils.isFeatureEnabled(this.hostCallbacks,e,t,n)},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,r.Log.info(573321622,r.LogCategory.CoreDefault,e)},e}();n.ClientRuntime=g,n.runtime=new g;n.createRuntime=function(){return new g}},{30:30,59:59,68:68,71:71,72:72,74:74,75:75,77:77,79:79,81:81,82:82,84:84}],70:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SequentialFetchQueue=void 0;var o=function(){function e(e,t,n){if(this.requestInProgress=!1,this.queuedRequests=[],null==e)throw new Error("No request.");this.fetch=e,this.fetchTimeout=t,this.queueTimeout=n}return e.prototype.tryProcessNextRequest=function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=e[0],n=e[1],o=e[2];clearTimeout(o),this.add(t,n)}},e.prototype.add=function(e,t){var n=this;if(this.requestInProgress){var o=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),n.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,o])}else{this.requestInProgress=!0,new Promise((function(t,o){var r=!1,i=setTimeout((function(){r=!0,o(new Error("Fetch timed out"))}),n.fetchTimeout);n.fetch(e).then((function(e){r||(clearTimeout(i),t(e))})).catch((function(e){r||(clearTimeout(i),o(e))}))})).then((function(e){t(null,e),n.tryProcessNextRequest()})).catch((function(e){t(e,null),n.tryProcessNextRequest()}))}},e}();n.SequentialFetchQueue=o},{}],71:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SessionProxy=void 0;var o=e(100),r=e(97),i=e(112),s=e(88),a=e(55),c=e(61),u=e(63),l=e(76),p=e(17),f=e(74),d=e(30),h=e(130),g=e(95),y=e(37),m=function(){function e(e){this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.registeredContextTypes=new Set,this.availableContexts=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.isSessionConnected=!1,this.workflowDefinitionManager=new y.DynamicWorkflowDefinitionManager,this.contextIdManager=new y.ContextIdManager,this.workflowItemStorage=new y.WorkflowItemStorage(this.workflowDefinitionManager),this.hostCallbacks=e.hostCallbacks,this.sessionManager=e.sessionManager,this.operationBatchConfig=e.batchOptions?this.getOperationBatchConfig(e.batchOptions):void 0,this.extensionConfigs=e.extensionConfigs,this.clientMetadata=e.clientMetadata,this.localWorkflowManager=e.localWorkflowManager,this.annotationResultsProcessor=e.annotationResultsProcessor,this.localWorkflowOrchestrationMode=e.localWorkflowOrchestrationMode||0,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.onMessage(o.AnnotationResultsMessage.getTypeName(),this.onAnnotationResultsFromServer.bind(this)),this.sessionManager.onMessage(o.AnnotationResultStateMessage.getTypeName(),this.onAnnotationResultStateMessage.bind(this)),1===this.localWorkflowOrchestrationMode&&this.sessionManager.onMessage(r.WorkflowExecutionRequest.getTypeName(),this.onWorkflowExecutionRequest.bind(this))}return e.prototype.initialize=function(){var e=this;return this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0).then((function(){return e.localWorkflowManager.addSession(e),e.localWorkflowManager.setTokenCallback(e.getAuthToken.bind(e)),e}))},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.isSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasConnected",{get:function(){return this.hasSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.isSessionClosed},enumerable:!1,configurable:!0}),e.prototype.getContextIdManager=function(){return this.contextIdManager},e.prototype.getWorkflowItemStorage=function(){return this.workflowItemStorage},e.prototype.getWorkflowDefinition=function(e,t){return this.workflowDefinitionManager.getWorkflowDefinition(e,t)},e.prototype.registerLocalWorkflow=function(e){if(e.kind===p.WorkflowKind.Join){this.contextIdManager.setActiveScopeType(e.collectionScopeType);for(var t=0,n=this.localWorkflowManager.getWorkflowDefinitionsWithSessionAffinity();t<n.length;t++){var o=n[t];this.contextIdManager.setActiveScopeType(o.collectionScopeType)}}this.localWorkflowManager.registerLocalWorkflow(e,this),1===this.localWorkflowOrchestrationMode&&this.sessionManager.sendMessage(new r.WorkflowRegistrationMessage({workflowDefinition:e}))},e.prototype.activateAnnotation=function(e,t){var n,o=new a.AnnotationActivationTracker(this.getSessionManager.bind(this),e,t);if(t&&t.callback){var r=this.annotationCallbacks.get(e);r||(r=new Map,this.annotationCallbacks.set(e,r)),r.set(o.token,t.callback)}var i=null!==(n=this.tokensByAnnotationType.get(e))&&void 0!==n?n:[];return-1===i.indexOf(o.token)&&i.push(o.token),this.tokensByAnnotationType.set(e,i),this.annotationActivationTrackers.set(o.token,o),o.activate(!1),o.asPromise()},e.prototype.updateAnnotationConfig=function(e,t){var n=new o.AnnotationConfigUpdateMessage({token:e,config:t});this.getSessionManager().sendMessage(n);var r=this.annotationActivationTrackers.get(e);r&&r.options&&(r.options.config=t)},e.prototype.releaseAnnotation=function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var n=this.annotationCallbacks.get(t.annotationType);return n&&(n.delete(e),0==n.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)},e.prototype.setAnnotationState=function(e,t,n){var o={state:n};this.submitOperation(new i.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:o}))},e.prototype.setAnnotationMetadata=function(e,t,n){this.submitOperation(new i.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:n}))},e.prototype.submitOperation=function(e,t){this.submitOperations([e],t)},e.prototype.submitOperations=function(e,t){var n=this;this.contextIdManager.applyContextIdOnOperations(e);var o=e.filter((function(e){return(0,f.isServerOp)(e,n.serverInputTypes)}));this.submitOperationsToServer(o,t),0===this.localWorkflowOrchestrationMode&&this.localWorkflowManager.runLocalWorkflows(e,this,!0)},e.prototype.submitSeedOperations=function(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");this.allowSeed=!1,this.allowGroupSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!0,t):this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:0,ops:e}))},e.prototype.submitSeedGroupOperations=function(e,t,n){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");t&&(this.allowGroupSeed=!1),this.allowSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!!t,n):(this.seedGroupSize++,this.getSessionManager().sendMessage(new o.SyncMessage({cv:n,seq:0,ops:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))},e.prototype.submitCustomMessage=function(e){var t=this;return new Promise((function(n,o){t.getSessionManager().sendMessage(e,(function(e,t){e?o(e.error?new Error(e.error):e):n(t)}))}))},e.prototype.requestCacheDump=function(e){var t=this;if(e)throw new Error("NYI");return new Promise((function(e,n){t.getSessionManager().sendMessage(new o.CacheDumpRequestMessage,(function(t,o){t?n(t):e(o)}))}))},e.prototype.forceReconnect=function(e){return this.extensionConfigs=e,this.getSessionManager().forceReconnect(e)},e.prototype.close=function(){this.isSessionClosed=!0,this.getSessionManager().closeSession(),this.localWorkflowManager.closeSession(this)},e.prototype.getClientMetadata=function(){return this.clientMetadata},e.prototype.setSessionCloseCallback=function(e){this.sessionCloseCallback=e},e.prototype.setConnectCallback=function(e){this.connectCallback=e},e.prototype.setDisconnectCallback=function(e){this.disconnectCallback=e},e.prototype.setReconnectCallback=function(e){this.reconnectCallback=e},e.prototype.onAnnotationResults=function(e,t,n){var r=this;n(void 0,new o.Response),this.annotationResultsProcessor.process(e,(function(e,n){r.applyOperationForContext(e,n,t)}),(function(t){if(r.callAnnotationCallbacks(t,e.annotationType),r.hostCallbacks.onAnnotationResult)try{r.hostCallbacks.onAnnotationResult(t)}catch(e){d.Log.error(540301151,d.LogCategory.WorkflowDefault,"onAnnotationResult error: "+e)}}),(function(e){if(r.contextIdManager.applyContextIdOnOperations(e.ops),1!==t){var n=e.ops.filter((function(e){return(0,f.isServerOp)(e,r.serverInputTypes)}));r.submitOperationsToServer(n,e.cv)}0===r.localWorkflowOrchestrationMode&&r.localWorkflowManager.runLocalWorkflows(e.ops,r)}))},e.prototype.onAnnotationResultStateMessage=function(e,t){var n;t(void 0,new o.Response);for(var r=0,i=e.updates;r<i.length;r++){var s=i[r],a=s.annotationType,c=s.state;if(this.tokensByAnnotationType.has(a)){var u=void 0;u=this.annotationResultStates.has(a)?this.annotationResultStates.get(a):0===c?1:0;for(var l=0,p=this.tokensByAnnotationType.get(a);l<p.length;l++){var f=p[l],d=this.annotationActivationTrackers.get(f);(null===(n=d.options)||void 0===n?void 0:n.stateUpdateCallback)&&d.options.stateUpdateCallback(u,c)}}}},e.prototype.onWorkflowExecutionRequest=function(e,t){this.localWorkflowManager.onWorkflowExecutionRequest(this,e.workflowId,e.batchExecutionInputs[0],(function(e,n){t(void 0,e?new r.WorkflowExecutionResponse({error:e.message}):new r.WorkflowExecutionResponse({batchExecutionResults:[n]}))}))},e.prototype.submitOperationsToServer=function(e,t){var n=this,r=function(e){return i.SchemaObject.getTypeNameFor(e)===i.SignalOperation.getTypeName()},s=e.filter((function(e){return r(e)})),a=e.filter((function(e){return!r(e)}));if(s.length>0&&this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,ops:s})),a.length>0)if(this.operationBatchConfig){if(!this.batchedOperationsManager){this.batchedOperationsManager=new c.BatchManager((function(e,t,r){n.getSessionManager().sendMessage(new o.SyncMessage({cv:t.cv,seq:n.nextSyncSequenceId++,ops:e}),(function(e){r(e?new Error(e.error):void 0)}))}))}this.batchedOperationsManager.addBatchItem(a,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:a}))},e.prototype.registerContextTypes=function(e){for(var t=0,n=e;t<n.length;t++){var o=n[t];this.activateAnnotation(o),this.registeredContextTypes.add(o)}},e.prototype.applyOperationForContext=function(e,t,n){var o=this,r=i.SchemaObject.getTypeNameFor(e);if(r==i.AddOperation.getTypeName()||r==i.Operation.getTypeName()||r==i.UpdateOperation.getTypeName()||r==i.DeleteOperation.getTypeName()){r==i.Operation.getTypeName()&&(r=i.AddOperation.getTypeName());var s=(0,g.shallowCloneItemWithPath)(this.resolvePlaceholdersInOperationParentPath(e.parentPath),t),a=(0,g.makeItemPathKey)(s.parentPath);if(r==i.AddOperation.getTypeName()||r==i.UpdateOperation.getTypeName()){if(!s.body)return;var c=i.SchemaObject.getTypeNameFor(s.body);if(!this.registeredContextTypes.has(c))return;var u=this.availableContexts.get(c);u||(u=new Map,this.availableContexts.set(c,u));var l=u.get(n);if(l||(l=[],u.set(n,l)),s.id||(s.id=this.localWorkflowManager.getNextClientAnnotationId()),r==i.AddOperation.getTypeName())0==l.filter((function(e){return(0,g.makeItemPathKey)(e.parentPath)==a&&e.id==s.id})).length?l.push(s):d.Log.info(540848911,d.LogCategory.WorkflowDefault,"AddOperation for ("+n+", "+s.id+", "+s.source+") can't be applied as the context item with matching path and ID already exists. Use UpdateOperation instead.");else for(var p=0;p<l.length;p++)if(l[p].id==s.id&&(0,g.makeItemPathKey)(l[p].parentPath)==a){if(l[p].source==s.source){l[p]=s;break}d.Log.warn(540848912,d.LogCategory.WorkflowDefault,"UpdateOperation for ("+n+", "+s.id+", "+s.source+") can't be applied as the context item with provided path and ID has different source: "+l[p].source)}else d.Log.warn(540848913,d.LogCategory.WorkflowDefault,"UpdateOperation for ("+n+", "+s.id+", "+s.source+") can't be applied as the context item with matching path and ID was not found. AddOperation should be used instead")}else if(r==i.DeleteOperation.getTypeName()){if(!s.id)return;this.availableContexts.forEach((function(e,t){var r=e.get(n);r&&(0==(r=r.filter((function(e){return!((0,g.makeItemPathKey)(e.parentPath)==a&&e.id==s.id)}))).length?e.delete(n):e.set(n,r),0==e.size?o.availableContexts.delete(t):o.availableContexts.set(t,e))}))}}},e.prototype.resolveRequestedContexts=function(e){for(var t=[],n=0,o=(0,h.getContextTypes)(e.requestedContextTypesRules);n<o.length;n++){var r=o[n],i=r[0],s=r[1];if(this.availableContexts.has(i)){var a=Array.from(this.availableContexts.get(i).values()).reduce((function(e,t){return e.concat(t)}),[]);if(0==a.length)throw new Error("Assert: availableContexts have the entry for "+i+" which does not contain any context annotation.");t.push.apply(t,a)}else if(-3==s)return[!1,[]]}return[!0,t]},e.prototype.getContextAnnotations=function(e,t,n,o){var r,i,s=n?(0,g.makeItemPathKey)(n):void 0;return null===(i=null===(r=this.availableContexts.get(e))||void 0===r?void 0:r.get(t))||void 0===i?void 0:i.filter((function(e){return!(s&&(0,g.makeItemPathKey)(e.parentPath)!=s||o&&e.source!=o)}))},e.prototype.onWorkflowDefinitionOverrideMessage=function(e){var t=new d.Operation({operationName:"WorkflowDefinitionOverride",success:!0}),n=function(e){throw t.resultDescription=e,t.success=!1,d.Log.error(527472287,d.LogCategory.CoreDefault,t.stop()),Error("WorkflowDefinitionOverride: "+e)},o=this.localWorkflowManager.getWorkflowDefinitionsByName(this),r=o.get(e.sourceWorkflowId);if(r){var i=o.get(e.targetWorkflowId);i?i.allowDefinitionOverride?-1!==r.definitionOverrideTargetWorkflows.indexOf(i.id)?(this.workflowDefinitionManager.mergeWorkflowDefinition(i,e.definition,e.contextId),t.success=!0,t.resourceId=r.id,t.resultDescription="Updated config for workflow: "+e.targetWorkflowId+", context id: "+e.contextId,d.Log.info(527472288,d.LogCategory.CoreDefault,t.stop())):n("Workflow '"+r.id+"' does not allow workflow definition for workflow '"+i.id+"'."):n("Workflow '"+i.id+"' does not allow workflow definition override."):n("Workflow registration for target workflow '"+e.targetWorkflowId+"' was not found.")}else n("Workflow registration for source workflow '"+e.targetWorkflowId+"' was not found.")},e.prototype.applyContextIdOnOperations=function(e){this.contextIdManager.applyContextIdOnOperations(e)},e.prototype.getAuthToken=function(e,t){var n={Tickets:[]};this.clientMetadata.docSessionId&&(n.DocSessionId=this.clientMetadata.docSessionId);var o=function(e){if(e===p.AuthTokenType.Substrate)return s.AuthTokenType.Substrate}(e);o&&(n.TokenType=o),this.hostCallbacks.requestAuthToken(n).then((function(e){e?t(void 0,e.Token):t(new Error("Missing AuthTokenResponse from requestAutToken"))})).catch((function(e){return t(e)}))},e.prototype.resetNextSyncSequenceId=function(){this.nextSyncSequenceId=1},e.prototype.onReconnect=function(){this.isSessionConnected=!0,this.annotationActivationTrackers.forEach((function(e){e.activate(!0)})),this.reconnectCallback&&this.reconnectCallback()},e.prototype.onSessionClose=function(e){this.isSessionClosed=!0,this.isSessionConnected=!1,this.sessionCloseCallback&&this.sessionCloseCallback(e)},e.prototype.onConnect=function(e,t,n,o,r){this.hasSessionConnected&&e&&(this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.seedBatchedOperationsManager&&(this.seedBatchedOperationsManager.removeAllBatchedItems(),this.seedBatchedOperationsManager=void 0),this.batchedOperationsManager&&(this.batchedOperationsManager.removeAllBatchedItems(),this.batchedOperationsManager=void 0)),this.isSessionConnected=!0,this.hasSessionConnected=!0,this.connectCallback&&this.connectCallback(e,t,n,o),this.serverInputTypes=r},e.prototype.onDisconnect=function(e){this.isSessionConnected=!1,this.disconnectCallback&&this.disconnectCallback(e)},e.prototype.getSessionManager=function(){return this.sessionManager||(this.sessionManager=new l.EmptySessionManager),this.sessionManager},e.prototype.callAnnotationCallbacks=function(e,t){if(0!==this.annotationCallbacks.size){var n=this.annotationCallbacks.get(t);n&&n.forEach((function(t){t(e)}))}},e.prototype.getOperationBatchConfig=function(e){return{delayMs:e.delayMs,maxInputSize:e.maxInputSize,estimateSize:u.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}},split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}},e.prototype.sendSeedMessagesViaBatchManager=function(e,t,n){var r=this;if(!this.seedBatchedOperationsManager){this.seedBatchedOperationsManager=new c.BatchManager((function(e,t,n){r.seedGroupSize++,r.getSessionManager().sendMessage(new o.SyncMessage({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:t.groupComplete?r.seedGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}),(function(e){n(e?new Error(e.error):void 0)}))}))}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},n,t)},e.prototype.onAnnotationResultsFromServer=function(e,t){this.onAnnotationResults(e,1,t)},e.prototype.resolvePlaceholdersInOperationParentPath=function(e){var t=e;return 3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("user_")&&(d.Log.info(540848914,d.LogCategory.WorkflowDefault,"Replacing user context placeholder for: "+(0,g.makeItemPathKey)(e)+"."),t=["session","#userContext#"]),3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("tenant_")&&(d.Log.info(540848915,d.LogCategory.WorkflowDefault,"Replacing tenant context placeholder for: "+(0,g.makeItemPathKey)(e)+"."),t=["session","#tenantContext#"]),t},e}();n.SessionProxy=m},{100:100,112:112,130:130,17:17,30:30,37:37,55:55,61:61,63:63,74:74,76:76,88:88,95:95,97:97}],72:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TelemetryLogger=void 0;var o=e(17),r=function(){function e(e){this.level=o.LoggingLevel.info,this.hostCallbacks=e}return e.prototype.log=function(t){var n=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var o=function(t,o,r,i){var s=o.charAt(0).toUpperCase()+o.slice(1);n.hostCallbacks.sendTelemetryEvent(r||e.augLoopAriaTenantToken,(i||e.augLoopAriaNamespace)+"_"+s,{ResourceId:t.resourceId,ResultDescription:t.resultDescription,ResultSignature:t.resultSignature,Dimension0:t.dimension0,Dimension1:t.dimension1,Dimension2:t.dimension2,Dimension3:t.dimension3},"Office.System.Activity",{CV:t.cv,Duration:1e3*t.durationMs,Count:t.count,AggMode:2,Success:t.success},!1,6,110)};if("Operation"===t.eventName){o(t,t.operationName)}else if("SessionHealth"===t.eventName){o(t,t.sessionHealthEventName)}else if("WorkflowOperation"===t.eventName){var r=t;o(r,r.operationName,r.ariaTenant,r.ariaNamespace)}}},e.augLoopAriaTenantToken="3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",e.augLoopAriaNamespace="Office_AugLoop_Client",e}();n.TelemetryLogger=r},{17:17}],73:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TokenCache=void 0;var o=e(74),r=function(){function e(e){void 0===e&&(e=33e5),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=e}return e.prototype.updateAuthToken=function(e,t){var n=this,r=JSON.stringify(t),i=this.requestRecordMap.get(r);return(void 0===i||this.isTokenExpired(i))&&(i={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request "+r);n.tokenCache.set(r,e.Token)})),requestTime:o.Utils.getCurrentTimeMs()},this.requestRecordMap.set(r,i)),i.requestPromise},e.prototype.getAuthTokenEntries=function(e,t){var n=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=n.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),n.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var n=e.request;return!t||n.DocId===t})).map((function(t){var o=t.requestKey,r=t.request;return n.isTokenExpired(n.requestRecordMap.get(o))&&n.updateAuthToken(e,r),{ticket:r.Tickets[0],token:n.tokenCache.get(o)}}))},e.prototype.isTokenExpired=function(e){return o.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs},e}();n.TokenCache=r},{74:74}],74:[function(e,t,n){"use strict";var o=e("spreadArrayHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.isServerOp=n.getSafeNumber=n.buildArrayOfTypes=n.LogCountLimiter=n.Utils=void 0;var r=e(30),i=e(88),s=e(112),a=function(){function e(){}return e.createHealthCheckRequest=function(e){return{payload:{},payloadSchema:{category:i.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:i.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:e}},e.isFeatureEnabled=function(e,t,n,o){return void 0===n&&(n=!1),void 0===o&&(o="None"),e&&e.isFeatureEnabled?e.isFeatureEnabled("Microsoft.Office.AugLoop."+t,o).catch((function(){return Promise.resolve(n)})):Promise.resolve(n)},e.convertWebSocketUrlToHttp=function(e){return this.convertUrl(e,!1)},e.convertServiceUrlToWebSocket=function(e){return this.convertUrl(e,!0)},e.convertUrl=function(e,t){if(!e)return e;var n=e.split(":"),o=n[0].toLowerCase();return 0==o.indexOf(t?"http":"ws")?(o=t?o.replace("http","ws"):o.replace("ws","http"),n[0]=o,n.join(":")):e},e.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()},e}();n.Utils=a;var c=function(){function e(e){this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=e}return e.prototype.log=function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new r.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: "+this.id+" reached - all next logs will be dropped"});r.Log.warn(572838107,r.LogCategory.CoreDefault,t)}},e}();n.LogCountLimiter=c;var u=[s.SchemaObject.getTypeName(),s.Annotation.getTypeName(),s.Signal.getTypeName()];n.buildArrayOfTypes=function(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];if("string"==typeof i)-1===u.indexOf(i)&&t.add(i);else for(var s=0,a=o([i.getTypeName()],i.getBaseTypes(),!0);s<a.length;s++){var c=a[s];-1===u.indexOf(c)&&t.add(c)}}return Array.from(t)};n.getSafeNumber=function(e,t){return void 0===t&&(t=0),Number.isFinite(e)?e:t};n.isServerOp=function(e,t){if(!Array.isArray(t)||0===t.length)return!0;if(s.DeltaUpdateOperation.typeGuard(e)||s.UpdateAnnotationMetaDataOperation.typeGuard(e))return!0;for(var n=0,o=e.items;n<o.length;n++){var r=o[n];if(!r.body||s.SchemaObject.matchesTypesFor(r.body,t))return!0}return!1}},{112:112,30:30,88:88}],75:[function(e,t,n){t.exports={version:"2.27.41"}},{}],76:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.EmptySessionManager=void 0;var r=e(30),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.init=function(){return Promise.resolve()},t.prototype.sendMessage=function(e,t){},t.prototype.onMessage=function(e,t){},t.prototype.forceReconnect=function(){return Promise.resolve()},t.prototype.closeSession=function(){},t.prototype.sendBytes=function(e){},t.prototype.getCorrelationVector=function(){return new r.CorrelationVector},t.prototype.setState=function(e){},t}(e(144).EventEmitter);n.EmptySessionManager=i},{144:144,30:30}],77:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SessionStats=void 0;var o=function(){};n.SessionStats=o},{}],78:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MessageQueue=n.ClientSendMessageErrorReason=void 0;var o,r=e(100),i=e(112),s=e(143),a=e(74),c=e(30);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue"}(o=n.ClientSendMessageErrorReason||(n.ClientSendMessageErrorReason={}));var u=function(){function e(e){this.logOp=new c.Operation({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new a.LogCountLimiter("MessageQueue"),this.queue=new s(1e3),this.callbacks=e}return e.prototype.push=function(e,t,n){var i=this,s=this.queue;if(1e3===s.length){this.messageQueueLogCountLimiter.log((function(){i.logOp.resourceId="QueueFull",i.logOp.durationMs=0,c.Log.warn(573187741,c.LogCategory.CoreDefault,i.logOp)}));var u=s.shift();u.onResponse&&u.onResponse(new r.ErrorResponse({error:o.DroppedAsOldestInQueue}))}s.push({message:e,onResponse:t,timeQueued:a.Utils.getCurrentTimeMs(),attemptNumber:n})},e.prototype.sendOnSessionInitialized=function(e){var t=this,n=this.queue.length,s=0;if(n>0){for(var u=a.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var l=this.queue.shift();e&&l.message instanceof r.SyncMessage&&i.SchemaObject.matchesTypesFor(l.message,[r.SyncMessage.getTypeName()])&&(!this.callbacks.dropOnlySequencedSyncsOnReseed||l.message.seq>=0)?(s++,l.onResponse&&l.onResponse(new r.ErrorResponse({error:o.ArrivedBeforeReseeding}))):l.message instanceof Uint8Array?this.callbacks.sendBytes(l.message):this.callbacks.sendMessage(l.message,l.onResponse,l.attemptNumber)}this.messageQueueLogCountLimiter.log((function(){t.logOp.resourceId="SendOnSessionInitialized",t.logOp.resultDescription="Queue size before: "+n+", after: "+t.queue.length+". droppedSyncMessages: "+s,t.logOp.durationMs=u,c.Log.warn(573187742,c.LogCategory.CoreDefault,t.logOp)}))}},e}();n.MessageQueue=u},{100:100,112:112,143:143,30:30,74:74}],79:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.SessionInitializer=void 0;var r=e(30),i=e(100),s=e(74),a=function(e){function t(t,n,o,r,i){var s=e.call(this)||this;return s.getSessionStats=t,s.clientMetadata=n,s.tokenRefreshManager=o,s.sendMessage=r,s.options=i||{},s.options.overrideSessionInitMessage=s.options.overrideSessionInitMessage||function(e){return e},s}return o(t,e),t.prototype.initSession=function(e){var t=this;e.onResponse=e.onResponse||function(){};var n=s.Utils.getCurrentTimeMs(),o=this.getSessionStats().lastConnectionClose&&n-this.getSessionStats().lastConnectionClose,a=this.getSessionStats().lastSyncMessage&&n-this.getSessionStats().lastSyncMessage,c=new r.Operation({operationName:"SessionInit"}),u={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:o,timeSinceLastSyncMessage:a,isTokenRefresh:e.isTokenRefresh,error:void 0},l=this.options.overrideSessionInitMessage(new i.SessionInitMessage({protocolVersion:i.currentProtocolVersion,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs,returnWorkflowInputTypes:!0}));this.sendMessage(l,(function(n,o){c.success=!n,c.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",c.resourceId=null==o?void 0:o.sliceUrl,(null==o?void 0:o.sessionKey)&&u.sessionKey!==o.sessionKey&&(u.sessionKey=o.sessionKey),n&&(u.error=n.error),c.resultDescription=JSON.stringify(u),r.Log.info(572838103,r.LogCategory.CoreDefault,c),e.onResponse(n,o),n||e.isReconnectOnSameSlice&&o.forceReconnect||(o.anonymousToken&&o.tokenExpirationSeconds?(t.anonymousToken=o.anonymousToken,t.onSuccessfulSessionInitOnServerSide(o)):r.Log.error(572838104,r.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session"))}))},t.prototype.onSuccessfulSessionInitOnServerSide=function(e){var t=this;this.tokenRefreshManager.scheduleRefresh(0,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0}),(function(){t.anonymousToken=void 0})),this.initHostAuthToken();var n=!!this.sessionKey,o=this.sessionKey!==e.sessionKey;this.sessionKey=e.sessionKey,this.origin=e.origin,this.emit("connect",o,n,e.sessionUrlBase+"/"+e.sessionKey,e.origin,this.anonymousToken,e.workflowInputTypes),n&&this.emit("reconnect")},t.prototype.initHostAuthToken=function(){var e=this;this.options.getAuthToken&&this.options.getAuthToken().then((function(t){t?e.sendTokenProvisionMessage(t):r.Log.info(572838105,r.LogCategory.CoreDefault,"Host auth token provision failed")})).catch((function(e){r.Log.error(572838106,r.LogCategory.CoreDefault,"Error happened while attempting to fetch host token: "+e)}))},t.prototype.sendTokenProvisionMessage=function(e){var t=new i.TokenProvisionMessage({authToken:e});this.sendMessage(t,this.onTokenProvisionResponse.bind(this))},t.prototype.onTokenProvisionResponse=function(e,t){!e&&t&&t.tokenExpirationSeconds&&this.tokenRefreshManager.scheduleRefresh(1,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))},t}(e(144).EventEmitter);n.SessionInitializer=a},{100:100,144:144,30:30,74:74}],80:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.ClosedState=n.DisconnectedState=n.RunningState=n.InitingState=n.BaseState=n.queueBytes=n.queueMessage=n.sendMessageNow=n.SessionState=void 0;var r,i=e(100),s=e(112);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(r=n.SessionState||(n.SessionState={}));n.sendMessageNow=function(e,t,n,o){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,o){t||s.SchemaObject.getTypeNameFor(o)!==i.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),n&&n(t,o)}),void 0,o))};n.queueMessage=function(e,t,n,o){t&&(e.messageQueue.push(t,n,o),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};n.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};var a=function(){function e(e){this.context=e}return e.prototype.onEnter=function(e){},e.prototype.sendMessage=function(e,t,n){},e.prototype.sendBytes=function(e){},e.prototype.canSendMessage=function(){return!1},e.prototype.onConnectionClose=function(){},e}();n.BaseState=a;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=r.Initing,t.possibleNextStates=[r.Running,r.Disconnected,r.Closed],t}return o(t,e),t.prototype.sendMessage=function(e,t,o){s.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?(0,n.sendMessageNow)(this.context,e,t,o):(0,n.queueMessage)(this.context,e,t)},t.prototype.sendBytes=function(e){(0,n.queueBytes)(this.context,e)},t.prototype.onConnectionClose=function(){this.context.setState(r.Disconnected)},t}(a);n.InitingState=c;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=r.Running,t.possibleNextStates=[r.Disconnected,r.Closed],t}return o(t,e),t.prototype.onEnter=function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)},t.prototype.sendMessage=function(e,t,o){(0,n.sendMessageNow)(this.context,e,t,o)},t.prototype.sendBytes=function(e){e&&this.context.webSocketWorkerManager.egressBytes(e)},t.prototype.canSendMessage=function(){return!0},t.prototype.onConnectionClose=function(){this.context.setState(r.Disconnected)},t}(a);n.RunningState=u;var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=r.Disconnected,t.possibleNextStates=[r.Initing,r.Closed],t}return o(t,e),t.prototype.onEnter=function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()},t.prototype.sendMessage=function(e,t,o){s.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?(this.context.setState(r.Initing),(0,n.sendMessageNow)(this.context,e,t,o)):s.SchemaObject.matchesTypesFor(e,[i.SessionCloseMessage.getTypeName()])?this.context.setState(r.Closed):(0,n.queueMessage)(this.context,e,t,o)},t.prototype.sendBytes=function(e){(0,n.queueBytes)(this.context,e)},t}(a);n.DisconnectedState=l;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=r.Closed,t.possibleNextStates=[],t}return o(t,e),t}(a);n.ClosedState=p},{100:100,112:112}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TokenRefreshManager=void 0;var o=function(){function e(){this.timers=new Map}return e.prototype.scheduleRefresh=function(t,n,o,r){var i=this.timers.get(t);i||(i={numberOfAttempts:0},this.timers.set(t,i)),i.refreshTimeoutId&&(clearTimeout(i.refreshTimeoutId),i.refreshTimeoutId=void 0),i.expiredTimeoutId&&(clearTimeout(i.expiredTimeoutId),i.expiredTimeoutId=void 0);var s=1e3*n-e.tokenRefreshBufferMs,a=1e3*n-e.tokenExpirationBufferMs;s>0?i.numberOfAttempts=0:(++i.numberOfAttempts,s=e.tokenRefreshBackoffIntervalMs,a=e.tokenExpirationBufferMs),i.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(i.refreshTimeoutId=setTimeout((function(){o()}),s)),r&&(i.expiredTimeoutId=setTimeout((function(){r()}),a))},e.prototype.clearRefreshTimeouts=function(){this.clearTimeouts(!1)},e.prototype.clearAllTimeouts=function(){this.clearTimeouts(!0)},e.prototype.clearTimeouts=function(e){var t=this;this.timers.forEach((function(n,o){n.refreshTimeoutId&&(clearTimeout(n.refreshTimeoutId),n.refreshTimeoutId=void 0),e&&n.expiredTimeoutId&&(clearTimeout(n.expiredTimeoutId),n.expiredTimeoutId=void 0),n.expiredTimeoutId||t.timers.delete(o)}))},e.tokenRefreshBufferMs=24e4,e.tokenExpirationBufferMs=12e4,e.tokenRefreshBackoffIntervalMs=3e4,e.tokenRefreshMaximumAttempts=3,e}();n.TokenRefreshManager=o},{}],82:[function(e,t,n){"use strict";var o=e("extendsHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketSessionManager=void 0;var r=e(30),i=e(100),s=e(112),a=e(144),c=e(74),u=e(78),l=e(80),p=e(83),f=function(e){function t(t,n,o,s,a,f,d){var h,g=e.call(this)||this;return g.cvParent=new r.CorrelationVector,g.logOp=new r.Operation({operationName:"SessionState",success:!0}).start(),g.sessionStateChangeLogCountLimiter=new c.LogCountLimiter("SessionState"),g.stats=n,g.allStates=((h={})[l.SessionState.Initing]=new l.InitingState(g),h[l.SessionState.Running]=new l.RunningState(g),h[l.SessionState.Disconnected]=new l.DisconnectedState(g),h[l.SessionState.Closed]=new l.ClosedState(g),h),g.setState(l.SessionState.Initing),g.messageEndpoint=new i.MessageEndpoint("c"),g.messageEndpoint.setClientMetadata(a),g.messageEndpoint.setEgress(g.egress.bind(g)),g.messageEndpoint.onMessage(i.SessionCloseMessage.getTypeName(),(function(e,t){g.onSessionCloseMessage(e,t)})),g.webSocketWorkerManager=new p.WebSocketWorkerManager(t,a,o,s,g.ingress.bind(g),g.onConnectionClose.bind(g),(function(){g.onSessionClose(void 0,"WSNotSupported")}),d),g.messageQueue=new u.MessageQueue({sendMessage:function(e,t,n){return g.state.sendMessage(e,t,n)},sendBytes:g.sendBytes.bind(g),canSendMessage:function(){return g.state.canSendMessage()},dropOnlySequencedSyncsOnReseed:d.dropOnlySequencedSyncsOnReseedEnabled}),s.on("connect",(function(e,t,n,o,r,i){g.setState(l.SessionState.Running,"",{isSessionReseedingStarted:e&&t}),g.emit("connect",e,n,o,r,i)})),s.on("reconnect",(function(){return g.emit("reconnect")})),g.resetNextSyncSequenceId=function(){return g.emit("resetNextSyncSequenceId")},g.tokenRefreshManager=f,g}return o(t,e),t.prototype.setState=function(e,t,n){var o=this;if(!this.state||e!==this.state.stateName){var i=this.state&&this.state.stateName?l.SessionState[this.state.stateName]:"undefined",s="undefined"===i&&e===l.SessionState.Initing||this.state.possibleNextStates.indexOf(e)>=0;this.sessionStateChangeLogCountLimiter.log((function(){o.logOp.stop(),o.logOp.resourceId="New state: "+(s?l.SessionState[e]:i),o.logOp.resultDescription="Previous state: "+i,o.logOp.dimension0="Attempted state: "+(l.SessionState[e]||"undefined"),o.logOp.resultSignature=t+(o.state&&!s?"Unexpected state change":""),o.logOp.success=s,r.Log.info(573167323,r.LogCategory.CoreDefault,o.logOp)})),s&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(n))}},t.prototype.init=function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.webSocketWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)},t.prototype.sendMessage=function(e,n){this.retrySendMessage(e,n,t.maxRetries)},t.prototype.sendBytes=function(e){this.state.sendBytes(e)},t.prototype.onMessage=function(e,t){this.messageEndpoint.onMessage(e,t)},t.prototype.getCorrelationVector=function(){return this.cvParent},t.prototype.forceReconnect=function(e){var t=this;return this.extensionConfigs=e||this.extensionConfigs,this.webSocketWorkerManager.close(!1),new Promise((function(e){return setTimeout((function(){e(t.webSocketWorkerManager.init(t.extensionConfigs))}),100)}))},t.prototype.closeSession=function(){this.sendMessage(new i.SessionCloseMessage),this.webSocketWorkerManager.close(!0),this.onSessionClose(void 0,"ClientRequested")},t.prototype.ingress=function(e){var t,n=this;try{t=JSON.parse(e)}catch(e){r.Log.error(573167324,r.LogCategory.CoreDefault,new r.SessionHealthEvent({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0,source:r.SessionHealthSource.ClientRuntime,reason:r.SessionHealthReason.Client,impact:r.SessionHealthImpact.MissingOutput,affectedWorkflows:["All"],message:""}))}t&&this.messageEndpoint.ingress(t,(function(e,t){return n.egress(e||t,(function(){}))}))},t.prototype.egress=function(e,t){e&&this.webSocketWorkerManager.egress(e).then((function(){return t()})).catch((function(e){return t(e)}))},t.prototype.onSessionCloseMessage=function(e,t){e.reconnectAllowed?this.webSocketWorkerManager.close():this.onSessionClose(e,"CloseMessageReceived"),t()},t.prototype.onSessionClose=function(e,t){this.setState(l.SessionState.Closed,t),this.tokenRefreshManager.clearAllTimeouts(),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e)},t.prototype.onConnectionClose=function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=c.Utils.getCurrentTimeMs(),this.emit("disconnect",e)},t.prototype.retrySendMessage=function(e,n,o){var r=this,i=t.maxRetries-o;this.state.sendMessage(e,(function(t,i){t&&o>0&&r.canBeRetried(e)&&r.isTransientError(t)?r.retrySendMessage(e,n,o-1):n&&n(t,i)}),i)},t.prototype.canBeRetried=function(e){return!s.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName(),i.MicroSyncMessage.getTypeName()])},t.prototype.isTransientError=function(e){var t=e.error;return t!==i.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==i.SendMessageErrorReason.UnexpectedSeedMessage&&t!==i.SendMessageErrorReason.UnsupportedSyncMessage&&t!==i.SendMessageErrorReason.AnnotationTokenNotFound&&t!==u.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==u.ClientSendMessageErrorReason.DroppedAsOldestInQueue},t.maxRetries=2,t}(a.EventEmitter);n.WebSocketSessionManager=f},{100:100,112:112,144:144,30:30,74:74,78:78,80:80,83:83}],83:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorkerManager=n.calculateTimeToWaitForNextTry=void 0;var o=e(112),r=e(100),i=e(30),s=e(74),a=e(27),c=e(64);n.calculateTimeToWaitForNextTry=function(e,t){var n=0,o=s.Utils.getCurrentTimeMs()?s.Utils.getCurrentTimeMs()-t:0,r=[1e3,2e3,5e3,1e4,6e4];return n=r[Math.max(0,Math.min(r.length-1,e-1))],n=Math.max(n-o,1e3)};var u=function(){function e(t,n,o,r,a,u,l,p){var f=this;this.logCountLimiter=new s.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.offlineInterval=void 0,this.alreadyLoggedReconnectAttempt=!1,this.httpTestsLeft=5,this.httpTestsSuccessCount=0,this.wsOpenCount=0,this.testHttpConnection=function(e){var t=s.Utils.convertWebSocketUrlToHttp(f.globalUrl),n=!e,o=null!=e?e:new i.Operation({operationName:"HttpsTest",resourceId:t,success:!1,resultDescription:"",resultSignature:"HttpResponse:"}).start(),r={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":o.cv},body:JSON.stringify(s.Utils.createHealthCheckRequest(f.clientMetadata))};(0,c.internalFetch)(t,r,(function(e,t){e?(o.dimension1="HttpErr",o.resultDescription+="HttpErr: "+e.message):t&&t.ok?(o.dimension1="HttpOK",f.leaveOfflineMode(),f.httpTestsSuccessCount++,n&&(o.success=!0)):(o.dimension1="HttpNoResp",o.resultDescription+="HttpStatus: "+(null==t?void 0:t.status)),n&&o.stop(),f.logCountLimiter.log((function(){i.Log.info(558445283,i.LogCategory.CoreDefault,o)}))}))},this.globalUrl=t,this.clientMetadata=n,this.workerFactory=o,this.sessionInitializer=r,this.ingress=a,this.onConnectionClose=u,this.onDetectedWSBlock=l,this.closeWSBlockedSession=p.closeWSBlockedSessionEnabled,this.sessionOfflineModeEnabled=p.sessionOfflineModeEnabled}return e.prototype.init=function(t,n,o){var r=this;if(void 0===o&&(o=!1),this.permanentlyClosed)return Promise.reject("permanentlyClosed");if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=t||this.extensionConfigs;var s=function(){if(o||!r.alreadyLoggedReconnectAttempt){var t=o?e.initialAttemptTimeout:e.reconnectAttemptTimeout;r.connTimeout=setTimeout((function(){var e=new i.Operation({operationName:"ConnectionFailingOrSlow",dimension0:o?"Initial":"Reconnect",dimension1:t.toString(),dimension2:r.currentReconnectAttempt.toString()});i.Log.info(572838096,i.LogCategory.CoreDefault,e),r.alreadyLoggedReconnectAttempt=!o,r.connTimeout=void 0}),t)}};return n?this.pendingInitPromise=n().catch((function(e){i.Log.error(572838097,i.LogCategory.CoreDefault,"Error occurred during calling the custom init promise: "+e)})).then((function(){s(),r.initInternal()})):(this.pendingInitPromise=Promise.resolve(),s(),this.initInternal()),this.pendingInitPromise},e.prototype.egress=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressInternal(e)})):(this.egressInternal(e),Promise.resolve())},e.prototype.egressBytes=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())},e.prototype.close=function(e){this.worker&&this.worker.close(),this.isWorkerReady=!1,this.worker=null,this.permanentlyClosed=e||this.permanentlyClosed,this.permanentlyClosed&&(this.leaveOfflineMode(),clearTimeout(this.connTimeout))},e.prototype.initInternal=function(){var e=this;this.isWorkerReady=!1,this.permanentlyClosed||this.isOffline()||(this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),(0,n.calculateTimeToWaitForNextTry)(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs)):this.tryToConnectAndInitializeSession())},e.prototype.egressInternal=function(e){var t;this.isWorkerReady||o.SchemaObject.matchesTypesFor(e,[r.SessionInitMessage.getTypeName()])?(o.SchemaObject.matchesTypesFor(e,[r.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),t=a.JSOND.serialize(e)):t=JSON.stringify(e),this.worker.egress(t)):o.SchemaObject.matchesTypesFor(e,[r.Response.getTypeName()])||i.Log.error(572838098,i.LogCategory.CoreDefault,new i.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.egressBytesInternal=function(e){this.isWorkerReady?this.worker.egress(e):i.Log.error(572838099,i.LogCategory.CoreDefault,new i.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.tryToConnectAndInitializeSession=function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=s.Utils.getCurrentTimeMs();var t=function(n){e.permanentlyClosed||e.isOffline()||(e.connect(e.sliceUrl?e.sliceUrl:e.globalUrl),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(o,r){if(n.success=!o,n.resultDescription=o?"WS Error: "+o.error:"",n.resourceId=r?r.sliceUrl:"",n.dimension0=n.success?"WSOK":"WSFail",o||!e.worker)return e.sliceUrl=void 0,e.close(),e.httpTestsLeft>0?(e.httpTestsLeft--,e.testHttpConnection(n.stop())):(e.closeWSBlockedSession&&0===e.wsOpenCount&&e.httpTestsSuccessCount>=5?(e.permanentlyClosed=!0,n.dimension1="WSBlocked",e.onDetectedWSBlock()):e.sessionOfflineModeEnabled&&0===e.httpTestsSuccessCount&&(e.startOfflineMode(),n.dimension1="WSOffline"),e.logCountLimiter.log((function(){i.Log.info(572838100,i.LogCategory.CoreDefault,n.stop())}))),void e.initInternal();if(e.logCountLimiter.log((function(){i.Log.info(555823373,i.LogCategory.CoreDefault,n.stop())})),r.forceReconnect){e.close();var s=new i.Operation({operationName:"ForcedReconnect"}).start();s.resultSignature="globalUrl: "+e.globalUrl+". sliceUrl: "+e.sliceUrl,e.sliceUrl=void 0,setTimeout((function(){t(s)}),1e3)}else clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.ready();e.resetHttpTestsCounter()}}))},n=new i.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #"+this.currentReconnectAttempt}).start();t(n)},e.prototype.connect=function(e){var t=this;this.worker=this.workerFactory(),this.worker.init(e,this.ingress,(function(){t.wsOpenCount++,t.leaveOfflineMode()}),(function(e){t.onConnectionClose(e),t.close()}))},e.prototype.ready=function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0},e.prototype.castBinaryData=function(e){if(e){if(Array.isArray(e.__binaryMembers__))for(var t=0,n=e.__binaryMembers__;t<n.length;t++){var o=n[t];ArrayBuffer.isView(e[o])||(e[o]=new Uint8Array(e[o]))}for(var r=0,i=Object.keys(e);r<i.length;r++){var s=i[r];"object"==typeof e[s]&&null!==e[s]&&this.castBinaryData(e[s])}}},e.prototype.isOffline=function(){return!!this.offlineInterval},e.prototype.startOfflineMode=function(){var e=this;this.offlineInterval=setInterval((function(){e.testHttpConnection()}),6e4)},e.prototype.leaveOfflineMode=function(){this.isOffline()&&(clearInterval(this.offlineInterval),this.offlineInterval=void 0,this.resetHttpTestsCounter(),this.tryToConnectAndInitializeSession())},e.prototype.resetHttpTestsCounter=function(){this.httpTestsLeft=5,this.httpTestsSuccessCount=0},e.initialAttemptTimeout=1e5,e.reconnectAttemptTimeout=2e4,e.className="WebSocketWorkerManager",e}();n.WebSocketWorkerManager=u},{100:100,112:112,27:27,30:30,64:64,74:74}],84:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketWorker=void 0;var o=e(148),r=e(30),i=e(74),s=function(){function e(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.pendingEgress=[]}return e.prototype.init=function(t,n,i,s){var a=this;this.ws=new o(t),this.logOp=new r.Operation({operationName:e.className,success:!0}).start();var c=function(e){a.logPingLatencyOp&&(a.logPingLatencyOp.success=e,r.Log.info(572838091,r.LogCategory.CoreDefault,a.logPingLatencyOp.stop()),a.logPingLatencyOp=void 0)};this.ws.addEventListener("open",(function(t){i(),e.logCountLimiter.log((function(){a.logOp.resourceId="OnOpen",a.logOp.resultDescription="",a.logOp.success=!0,r.Log.info(572838092,r.LogCategory.CoreDefault,a.logOp.stop())})),a.hasBeenOpened=!0,a.pendingEgress.forEach((function(e){a.egress(e)})),a.pendingEgress=[],a.pingInterval=setInterval((function(){a.logPingLatencyOp&&(--a.remainingPingFailures,c(!1)),a.remainingPingFailures>0&&a.hasBeenOpened&&a.lastPongTime<a.lastEgressTime&&(a.logPingLatencyOp=new r.Operation({operationName:"Ping",success:!0,dimension0:a.ws.bufferedAmount>=0?a.ws.bufferedAmount.toString().length.toString():void 0}).start(),a.ws.send(e.pingPongMessage,(function(e){e&&(--a.remainingPingFailures,c(!1))})))}),3e4)})),this.ws.addEventListener("message",(function(t){a.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(c(!0),a.lastPongTime=Date.now()):n(t.data)})),this.ws.addEventListener("error",(function(t){a.errorMessage=t.message,e.logCountLimiter.log((function(){a.logOp.resourceId="OnError",a.logOp.resultDescription=a.errorMessage,a.logOp.success=!1,r.Log.info(572838093,r.LogCategory.CoreDefault,a.logOp.stop())})),a.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){a.logOp.resourceId="OnClose",a.logOp.resultDescription=t?"code: "+t.code+". reason: "+t.reason:"",a.logOp.success=!0,r.Log.info(572838094,r.LogCategory.CoreDefault,a.logOp.stop())})),a.pingInterval&&(clearInterval(a.pingInterval),a.pingInterval=void 0),s(a.errorMessage)}))},e.prototype.egress=function(t){var n=this;this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnFirstEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,r.Log.info(572838095,r.LogCategory.CoreDefault,n.logOp.stop())})))})):this.pendingEgress.push(t)},e.prototype.close=function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close()},e.className="WebSocketWorker",e.logCountLimiter=new i.LogCountLimiter(e.className),e.pingPongMessage="~",e}();n.WebSocketWorker=s},{148:148,30:30,74:74}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SingleItemWorkflow=void 0;var o=e(17),r=e(74),i=function(){function e(e,t){var n,r,i,s,a;this.kind=o.WorkflowKind.SingleItem,this.isStateful=!1,this.id=e,t&&(this.inputTypes=null!==(n=t.inputTypes)&&void 0!==n?n:this.inputTypes,this.outputTypes=null!==(r=t.outputTypes)&&void 0!==r?r:this.outputTypes,this.requestedContextTypesRules=null!==(i=t.requestedContextTypesRules)&&void 0!==i?i:this.requestedContextTypesRules,this.definitionOverrideTargetWorkflows=null!==(s=t.definitionOverrideTargetWorkflows)&&void 0!==s?s:this.definitionOverrideTargetWorkflows,this.correlatedSignals=0!==(null===(a=t.correlatedSignals)||void 0===a?void 0:a.length)?t.correlatedSignals:this.correlatedSignals)}return e.create=function(t){return new e(t)},e.prototype.setInputTypes=function(e){return this.inputTypes=(0,r.buildArrayOfTypes)(e),this},e.prototype.setOutputTypes=function(e){return this.outputTypes=(0,r.buildArrayOfTypes)(e),this},e.prototype.setRequiredContextTypes=function(e){var t;return(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).push({contextTypes:e,cardinality:-3}),this},e.prototype.setOptionalContextTypes=function(e){var t;return(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).push({contextTypes:e,cardinality:-1}),this},e.prototype.setLambdaType=function(e){return this.factory=e,this},e.prototype.setDefinitionOverrideTargetWorkflows=function(e){return this.definitionOverrideTargetWorkflows=e,this},e.prototype.setCorrelatedSignals=function(e){return 0!==e.length&&(this.correlatedSignals=e),this},e.prototype.setLambda=function(e,t){return this.factory=function(){return{init:t||function(e){return Promise.resolve()},execute:e,dispose:function(){}}},this},e.prototype.validateOptions=function(){return{isValid:!0}},e}();n.SingleItemWorkflow=i},{17:17,74:74}],86:[function(e,t,n){"use strict";var o=e("spreadArrayHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowModel=void 0;var r=e(112),i=function(){function e(e,t){void 0===t&&(t=[]),this.scopeItem=void 0,this.rootItem=void 0,this.normalizeFilter=function(e){if(!e)return function(e){return void 0!==e};if("function"==typeof e)throw new Error("Not implemented yet");if((e.id?1:0)+(e.ids?1:0)+(e.itemType?1:0)+(e.itemTypes?1:0)!=1)throw new Error("Exactly one condition expected on IItemFilter");if(e.itemType)return function(t){return t&&r.SchemaObject.matchesTypesFor(t.body,[e.itemType])};if(e.itemTypes)return function(t){return t&&r.SchemaObject.matchesTypesFor(t.body,e.itemTypes)};throw new Error("Not implemented yet")},this.items=o(o([],t,!0),[e],!1)}return e.prototype.getItem=function(e){throw new Error("Method not implemented.")},e.prototype.getItems=function(e){throw new Error("Method not implemented.")},e.prototype.getItemBody=function(e){return this.getItemBodies(e)[0]},e.prototype.getItemBodies=function(e){var t=this.normalizeFilter(e);return this.items.filter(t).map((function(e){return e.body}))},e.prototype.getItemByReference=function(e){throw new Error("Method not implemented.")},e.prototype.getItemBodyByReference=function(e){throw new Error("Method not implemented.")},e}();n.WorkflowModel=i},{112:112}],87:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AuthTokenType=n.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(n.IdentityProvider||(n.IdentityProvider={})),function(e){e[e.Augloop=0]="Augloop",e[e.Substrate=1]="Substrate"}(n.AuthTokenType||(n.AuthTokenType={}))},{}],88:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(87),n),o(e(89),n),o(e(90),n),o(e(91),n),o(e(92),n),o(e(93),n),o(e(94),n)},{87:87,89:89,90:90,91:91,92:92,93:93,94:94}],89:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],90:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExceptionType=n.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(n.MessageType||(n.MessageType={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(n.ExceptionType||(n.ExceptionType={}))},{}],91:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(n.Ppt||(n.Ppt={}))},{}],92:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],93:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.TextTileEventType||(e.TextTileEventType={}))}(n.Tiling||(n.Tiling={}))},{}],94:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(n.TypeCategory||(n.TypeCategory={}))},{}],95:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(96),n)},{96:96}],96:[function(e,t,n){"use strict";var o=e("assignHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.isAncestorOrEqualTo=n.getSafeNumber=n.isValidItemId=n.splitItemPathKey=n.makeItemPathKey=n.shallowCloneItemWithPath=void 0;n.shallowCloneItemWithPath=function(e,t){return o(o({},t),{parentPath:e})};n.makeItemPathKey=function(e){return Array.isArray(e)?5===e.length?e[0]+"\\"+e[1]+"\\"+e[2]+"\\"+e[3]+"\\"+e[4]:4===e.length?e[0]+"\\"+e[1]+"\\"+e[2]+"\\"+e[3]:3===e.length?e[0]+"\\"+e[1]+"\\"+e[2]:2===e.length?e[0]+"\\"+e[1]:1===e.length?e[0]:e.join("\\"):"(malformed path)"};n.splitItemPathKey=function(e){return e.split("\\")};n.isValidItemId=function(e){return e&&e.length>0&&e.length<100&&e.indexOf("\\")<0};n.getSafeNumber=function(e,t){return void 0===t&&(t=0),Number.isFinite(e)?e:t};n.isAncestorOrEqualTo=function(e,t){if(e.length>t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}},{}],97:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(98),n),o(e(99),n)},{98:98,99:99}],98:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowDefinitionOverrideMessage=n.SessionCloseResponse=n.TelemetryFlushMessage=n.TelemetryMessage=n.DiagnosticTraceMessage=n.RuntimeInitMessage=n.WorkflowExecutionResponse=n.WorkflowExecutionRequest=n.WorkflowRegistrationMessage=void 0;var o=e(112),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_WorkflowRegistrationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.WorkflowRegistrationMessage=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_WorkflowExecutionRequest"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.WorkflowExecutionRequest=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_WorkflowExecutionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.WorkflowExecutionResponse=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_RuntimeInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.RuntimeInitMessage=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_DiagnosticTraceMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DiagnosticTraceMessage=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_TelemetryMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TelemetryMessage=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_TelemetryFlushMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TelemetryFlushMessage=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_SessionCloseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionCloseResponse=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Internal_WorkflowDefinitionOverrideMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.WorkflowDefinitionOverrideMessage=f},{112:112}],99:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],100:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(101),n),o(e(102),n),o(e(103),n)},{101:101,102:102,103:103}],101:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.KeepAlive=n.TokenProvisionResponse=n.TokenProvisionMessage=n.AnnotationResultsMessage=n.SessionDeleteMessage=n.SyncResponse=n.MicroSyncMessage=n.SyncMessage=n.AnnotationConfigUpdateResponse=n.AnnotationConfigUpdateMessage=n.AnnotationReleaseResponse=n.AnnotationReleaseMessage=n.AnnotationResultStateMessage=n.AnnotationActivationResponse=n.AnnotationActivationMessage=n.CacheDumpRequestResponse=n.CacheDumpRequestMessage=n.SessionCloseMessage=n.SessionInitResponse=n.SessionInitMessage=n.TimeoutErrorResponse=n.ErrorResponse=n.Response=n.Message=void 0;var o=e(112),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Message"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Message=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Response"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Response=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_ErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ErrorResponse=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TimeoutErrorResponse=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionInitMessage=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionInitResponse=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionCloseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionCloseMessage=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.CacheDumpRequestMessage=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.CacheDumpRequestResponse=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationActivationMessage=d;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationActivationResponse=h;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationResultStateMessage=g;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationReleaseMessage=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationReleaseResponse=m;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationConfigUpdateMessage=v;var T=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationConfigUpdateResponse=T;var S=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SyncMessage=S;var w=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_MicroSyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.MicroSyncMessage=w;var b=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SyncResponse=b;var _=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SessionDeleteMessage=_;var C=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AnnotationResultsMessage=C;var k=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TokenProvisionMessage=k;var x=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TokenProvisionResponse=x;var O=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_KeepAlive"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.KeepAlive=O},{112:112}],102:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MessageEndpoint=n.extractMessageNameFromTypeName=n.ProcessMessageErrorReason=n.SendMessageErrorReason=void 0;var o,r,i=e(30),s=e(112),a=e(101),c=e(105);function u(e){for(var t,n=0,o=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];n<o.length;n++){var r=o[n];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var i=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,i?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found"}(o=n.SendMessageErrorReason||(n.SendMessageErrorReason={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation."}(r=n.ProcessMessageErrorReason||(n.ProcessMessageErrorReason={})),n.extractMessageNameFromTypeName=u;var l=function(){function e(e){this.nextMessageId=1,this.pendingResponseCallbacks=new c.Cache({sweepInterval:5e3}),this.pendingMessageCallbacks=new c.Cache({sweepInterval:5e3}),this.messageCallbacks=new Map,this.messageIdPrefix=e,this.source="c"===e?i.SessionHealthSource.ClientRuntime:i.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}return e.prototype.setClientMetadata=function(e){this.clientMetadata=e},e.prototype.setEgress=function(e){this.egress=e},e.prototype.ingress=function(e,t){var n=s.SchemaObject.getBaseTypesFor(e),o=s.SchemaObject.getTypeNameFor(e);o===a.Response.getTypeName()||n&&n.indexOf(a.Response.getTypeName())>=0?(this.processResponse(e),t()):this.processMessage(e,t),o!==a.SessionCloseMessage.getTypeName()||e.reconnectAllowed||this.clearAllPendingResponses()},e.prototype.sendMessage=function(e,t,n,o){var r=this;void 0===o&&(o=0);var c=new i.SessionHealthEvent({sessionHealthEventName:"SendMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingInput:i.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:u(s.SchemaObject.getTypeNameFor(e)),dimension0:o.toString()}).start(),l=function(){if(c.setClientMetadata(r.clientMetadata),c.success)i.Log.info(572836e3,i.LogCategory.CoreDefault,c.stop());else{var e="ErrorWithoutPendingResponse"===c.resultSignature||"ResponseCallbackException"===c.resultSignature||"We called into done callback"!==c.message;c.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),i.Log.error(572836001,i.LogCategory.CoreDefault,c.stop())}};e.messageId=""+this.messageIdPrefix+this.nextMessageId++;var p=s.SchemaObject.getTypeNameFor(e)===a.SessionCloseMessage.getTypeName();if(!n&&!p){var f=function(n,o){var i;if(n?(c.success=!1,c.resultSignature=n.error,c.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):c.resultSignature="Success",t)try{c.message="We called into done callback",t(n,o)}catch(e){c.success=!1,c.resultSignature="ResponseCallbackException",c.resultDescription="Web"===(null===(i=r.clientMetadata)||void 0===i?void 0:i.appPlatform)?JSON.stringify({message:e.message,stack:e.stack}):JSON.stringify({message:e.message})}r.pendingMessageCallbacks.del(e.messageId),l(),r.updateSendMessageStats(c.success,c.durationMs,n?new Error(n.error):void 0)};this.pendingResponseCallbacks.put(e.messageId,f,1e4,(function(){f(new a.TimeoutErrorResponse({error:"Timeout waiting for response"}),void 0)}))}this.egress(e,(function(t){var n,o;if(t){var i=r.pendingResponseCallbacks.get(e.messageId);i?(r.pendingResponseCallbacks.del(e.messageId),i(new a.ErrorResponse({error:t.message}))):p?(c.success=null!==(o=null===(n=t.message)||void 0===n?void 0:n.endsWith("Client disconnected."))&&void 0!==o&&o,c.resultSignature="ErrorSendingSessionCloseMessage",c.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,l()):(c.success=!1,c.resultSignature="ErrorWithoutPendingResponse",c.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,l())}}))},e.prototype.onMessage=function(e,t){this.messageCallbacks.set(e,t)},e.prototype.getStats=function(){return this.stats},e.prototype.hasMessageCallback=function(e){return this.messageCallbacks.has(e)},e.prototype.cancelPendingResponseCallbacks=function(){var e=this;this.pendingResponseCallbacks.forEach((function(t,n){t&&(e.pendingResponseCallbacks.del(n),t(new a.ErrorResponse({error:"Cancelled"})))}))},e.prototype.clearAllPendingResponses=function(){if(0!=this.pendingResponseCallbacks.size()){var e=new i.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size().toString(),success:!0});i.Log.info(572836002,i.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}},e.prototype.processMessage=function(e,t){var n,o=this,r=new i.SessionHealthEvent({sessionHealthEventName:"ProcessMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingOutput:i.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),c=function(){if(r.setClientMetadata(o.clientMetadata),r.success)i.Log.info(572836003,i.LogCategory.CoreDefault,r.stop());else{var e="UnsupportedMessage"===r.resourceId||"Timeout"===r.resultSignature||"OnResponseInvokedMoreThanOnce"===r.resultSignature||"MessageCallbackException"===r.resultSignature||"We called into messageCallback"!==r.message;r.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),i.Log.error(572836032,i.LogCategory.CoreDefault,r.stop())}},l=this.messageCallbacks.get(s.SchemaObject.getTypeNameFor(e));l?r.resourceId=u(s.SchemaObject.getTypeNameFor(e)):l=function(t,n){r.resourceId=u(s.SchemaObject.getTypeNameFor(e)),"MalformedMessageName"!==r.resourceId&&(r.resourceId="UnsupportedMessage"),n(new a.ErrorResponse({error:"Message type "+s.SchemaObject.getTypeNameFor(e)+" is not supported"}))};this.pendingMessageCallbacks.put(e.messageId,void 0,1e4,(function(){r.success=!1,r.resultSignature="Timeout",r.resultDescription="Timeout processing message callback",c(),i.Log.error(572836033,i.LogCategory.CoreDefault,"Timeout processing "+r.resourceId),o.updateProcessMessageStats(!1,r.durationMs,new Error("timeout"))}));var p=!1;try{r.message="We called into messageCallback",l(e,(function(n,i){o.pendingMessageCallbacks.del(e.messageId),p?(r.success=!1,r.resultSignature="OnResponseInvokedMoreThanOnce",r.resultDescription="Invoked onResponse for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+" more than once"):n?(r.success=!1,r.resultSignature=n.error,r.resultDescription="Error for "+s.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):r.resultSignature="Success",p=!0,c(),n&&!s.SchemaObject.matchesTypesFor(n,[a.ErrorResponse.getTypeName()])&&(n=new a.ErrorResponse({error:"Internal Server Error"})),o.updateProcessMessageStats(r.success,r.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):i?(i.messageId=e.messageId,t(void 0,i)):t()}))}catch(o){this.pendingMessageCallbacks.del(e.messageId),r.success=!1,r.resultSignature="MessageCallbackException",r.resultDescription="Web"===(null===(n=this.clientMetadata)||void 0===n?void 0:n.appPlatform)?JSON.stringify({message:o.message,stack:o.stack}):JSON.stringify({message:o.message}),c(),this.updateProcessMessageStats(!1,r.durationMs,o),t()}},e.prototype.processResponse=function(e){var t,n=new i.Operation({operationName:"ProcessResponse"});n.success=!0,n.setClientMetadata(this.clientMetadata),n.start();var o=this.pendingResponseCallbacks.get(e.messageId);o?(this.pendingResponseCallbacks.del(e.messageId),s.SchemaObject.matchesTypesFor(e,[a.ErrorResponse.getTypeName()])?o(e):o(void 0,e)):(n.resultSignature="NoPendingMessage",n.resultDescription=""+e.messageId,n.success=!1),"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&(n.resourceId=u(s.SchemaObject.getTypeNameFor(e)),i.Log.info(572836034,i.LogCategory.CoreDefault,n.stop()))},e.prototype.updateSendMessageStats=function(e,t,n){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||n?e&&n&&i.Log.warn(572836036,i.LogCategory.CoreDefault,"Succeeded send message provided error object."):i.Log.warn(572836035,i.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(n&&n.message===o.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)},e.prototype.updateProcessMessageStats=function(e,t,n){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||n?e&&n&&i.Log.warn(572836038,i.LogCategory.CoreDefault,"Succeeded process message provided error object."):i.Log.warn(572836037,i.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(n&&n.message===r.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)},e}();n.MessageEndpoint=l},{101:101,105:105,112:112,30:30}],103:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.currentProtocolVersion=void 0,n.currentProtocolVersion=2},{}],104:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var o=function(){function e(e){if(this.cache=new Map,this.options=e||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return e.prototype.put=function(e,t,n,o,r,i,s){if(null==n||n<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var a={value:t,lastUsed:r?Date.now():void 0,expire:n+Date.now(),idleDurationMs:r,expireCallback:o,expiringTriggerTime:i+Date.now(),expiringCallback:s};return this.cache.set(e,a),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t},e.prototype.del=function(e){if(this.options.delCallback){var t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}var n=this.cache.delete(e);return 0===this.size()&&this.clear(),n},e.prototype.clear=function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()},e.prototype.get=function(e){var t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value},e.prototype.keys=function(){return this.cache.keys()},e.prototype.forEach=function(e){this.cache.forEach((function(t,n){e(t.value,n)}))},e.prototype.size=function(){return this.cache.size},e.prototype.updateExpireTime=function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)},e.prototype.onInterval=function(){var e=this,t=Date.now();this.cache.forEach((function(n,o){if(n.idleDurationMs&&n.lastUsed<t-n.idleDurationMs)return e.del(o),void(e.options.idleCallback&&e.options.idleCallback(o,n.value));n.expire<t&&(e.del(o),n.expireCallback&&n.expireCallback(o,n.value)),n.expiringTriggerTime<t&&n.expiringCallback&&(n.expiringCallback(o,n.value),n.expiringCallback=void 0)}))},e}();n.Cache=o},{}],105:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(104),n)},{104:104}],106:[function(e,t,n){var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.AnnotationMetaDataChangeEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.sessionKey="",e.prototype.annotationType="",e.prototype.annotationState=0,e.prototype.workflowId="",e}(),t.exports=r},{}],107:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(106),n),o(e(108),n),o(e(109),n),o(e(110),n)},{106:106,108:108,109:109,110:110}],108:[function(e,t,n){var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.OperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e}(),t.exports=r},{}],109:[function(e,t,n){var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.SessionHealthEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.subReason="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e}(),t.exports=r},{}],110:[function(e,t,n){var o={util:{},roots:{default:{}}},r=(o.util,o.roots.default||(o.roots.default={}));r.WorkflowOperationEvent=function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.joinContextId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e}(),t.exports=r},{}],111:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(n.AnnotationState||(n.AnnotationState={}))},{}],112:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(111),n),o(e(113),n),o(e(114),n),o(e(115),n),o(e(116),n),o(e(117),n),o(e(118),n),o(e(120),n),o(e(119),n),o(e(121),n),o(e(122),n)},{111:111,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122}],113:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BinaryClassificationAnnotation=n.Annotation=void 0;var o=e(115),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_Annotation"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Annotation=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return Object.defineProperty(e.prototype,"metadata",{get:function(){return this.M_},set:function(e){this.M_=e},enumerable:!1,configurable:!0}),e.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.BinaryClassificationAnnotation=i},{115:115}],114:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SignalOperation=n.MicroSyncOperation=n.DeltaUpdateOperation=n.VisibilityOperation=n.FocusOperation=n.PurgeOperation=n.DeleteOperation=n.UpdateOperation=n.UpdateAnnotationMetaDataOperation=n.MoveOperation=n.AddOperation=n.OperationWithSiblingContext=n.Operation=n.ItemChangesDelta=n.ItemDelta=void 0;var o=e(115),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemDelta"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ItemDelta=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemChangesDelta"},e.getBaseTypes=function(){return["AugLoop_Core_ItemDelta"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ItemChangesDelta=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Operation"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Operation=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.OperationWithSiblingContext=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_AddOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.AddOperation=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MoveOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.MoveOperation=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.UpdateAnnotationMetaDataOperation=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.UpdateOperation=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DeleteOperation=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.PurgeOperation=d;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_FocusOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.FocusOperation=h;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.VisibilityOperation=g;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DeltaUpdateOperation=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MicroSyncOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.MicroSyncOperation=m;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_SignalOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SignalOperation=v},{115:115}],115:[function(e,t,n){"use strict";var o=e("spreadArrayHelper");Object.defineProperty(n,"__esModule",{value:!0}),n.SchemaObject=void 0;var r=function(){function e(t){e.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SchemaObject"},e.getBaseTypes=function(){return[]},e.getTypeNameFor=function(e){return e&&e.H_?e.H_.T_:void 0},e.getBaseTypesFor=function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]},e.getAllTypesFor=function(t){var n=e.getTypeNameFor(t);return n?o([n],e.getBaseTypesFor(t),!0):[]},e.matchesTypesFor=function(t,n){if(!Array.isArray(n)||0===n.length)return!0;for(var o=e.getTypeNameFor(t),r=e.getBaseTypesFor(t),i=0,s=n;i<s.length;i++){var a=s[i];if(a===o)return!0;if(r.indexOf(a)>=0)return!0}return!1},e.assign=function(e,t,n){if(n)for(var o=0,r=Object.keys(n);o<r.length;o++){var i=r[o];t[i]=n[i]}return t.H_=e.H_,t},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SchemaObject=r},{}],116:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Signal=void 0;var o=e(115),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_Signal"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Signal=r},{115:115}],117:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.UserCommandsHolder=n.EventsHolder=n.TenantContextHolder=n.UserContextHolder=n.ContextHolder=n.DynamicContext=n.GridNeighborhoodContext=n.GridCell=n.SubDocument=n.Document=n.Session=n.TileGroup=n.Binary=n.Blob=void 0;var o=e(115),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Blob"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Blob=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Binary"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Binary=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TileGroup"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TileGroup=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Session"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Session=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Document"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.Document=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SubDocument"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.SubDocument=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridCell"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.GridCell=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.GridNeighborhoodContext=p;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DynamicContext"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DynamicContext=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ContextHolder"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.ContextHolder=d;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UserContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.UserContextHolder=h;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TenantContextHolder"},e.getBaseTypes=function(){return["AugLoop_Core_ContextHolder"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TenantContextHolder=g;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_EventsHolder"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.EventsHolder=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UserCommandsHolder"},e.getBaseTypes=function(){return["AugLoop_Core_EventsHolder"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.UserCommandsHolder=m},{115:115}],118:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],119:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],120:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],121:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0})},{}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GridConstants=void 0;var o=function(){function e(){}return e.lowerIndexBound=1,e.maxNumberOfRows=1048576,e.maxNumberOfColumns=16384,e.firstColumnName="A",e.lastColumnName="XFD",e}();n.GridConstants=o},{}],123:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(124),n),o(e(125),n),o(e(126),n),o(e(127),n)},{124:124,125:125,126:126,127:127}],124:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.TextTileDeltaUnit=n.TextTileDeltaType=void 0,function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete",e[e.Update=2]="Update"}(n.TextTileDeltaType||(n.TextTileDeltaType={})),function(e){e[e.Chars=0]="Chars",e[e.Word=1]="Word",e[e.PartialSentence=2]="PartialSentence",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(n.TextTileDeltaUnit||(n.TextTileDeltaUnit={}))},{}],125:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FormattedTextTileDelta=n.TextTileDelta=void 0;var o=e(112),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_TextTileDelta"},e.getBaseTypes=function(){return["AugLoop_Core_ItemDelta"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TextTileDelta=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_FormattedTextTileDelta"},e.getBaseTypes=function(){return["AugLoop_Text_TextTileDelta","AugLoop_Core_ItemDelta"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.FormattedTextTileDelta=i},{112:112}],126:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DateTile=n.PersonTile=n.TaskTile=n.DynamicTextContext=n.FormattedTextTile=n.TextTile=void 0;var o=e(112),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_TextTile"},e.getBaseTypes=function(){return[]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TextTile=r;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_FormattedTextTile"},e.getBaseTypes=function(){return["AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.FormattedTextTile=i;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_DynamicTextContext"},e.getBaseTypes=function(){return["AugLoop_Core_DynamicContext"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DynamicTextContext=s;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_TaskTile"},e.getBaseTypes=function(){return["AugLoop_Text_FormattedTextTile","AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.TaskTile=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_PersonTile"},e.getBaseTypes=function(){return["AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.PersonTile=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Text_DateTile"},e.getBaseTypes=function(){return["AugLoop_Text_TextTile"]},e.typeGuard=function(t){return o.SchemaObject.matchesTypesFor(t,[e.getTypeName()])},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();n.DateTile=u},{112:112}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SpecialIndentType=n.ObjectType=n.Alignment=n.UnderlineType=n.CapsType=n.FontWeight=n.ListType=n.AnchorMode=void 0,function(e){e[e.Unspecified=0]="Unspecified",e[e.Inline=1]="Inline",e[e.Floating=2]="Floating"}(n.AnchorMode||(n.AnchorMode={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered",e[e.Lim=3]="Lim",e[e.Nil=4]="Nil",e[e.Any=5]="Any",e[e.NoList=6]="NoList",e[e.Invalid=7]="Invalid"}(n.ListType||(n.ListType={})),function(e){e[e.DontCare=1]="DontCare",e[e.Thin=2]="Thin",e[e.ExtraLight=3]="ExtraLight",e[e.Light=4]="Light",e[e.Normal=5]="Normal",e[e.Medium=6]="Medium",e[e.SemiBold=7]="SemiBold",e[e.Bold=8]="Bold",e[e.ExtraBold=9]="ExtraBold",e[e.Heavy=10]="Heavy"}(n.FontWeight||(n.FontWeight={})),function(e){e[e.NoCaps=0]="NoCaps",e[e.SmallCaps=1]="SmallCaps",e[e.AllCaps=2]="AllCaps",e[e.AllPetiteCaps=3]="AllPetiteCaps",e[e.PetiteCaps=4]="PetiteCaps",e[e.Unicase=5]="Unicase",e[e.Titling=6]="Titling",e[e.Other=7]="Other"}(n.CapsType||(n.CapsType={})),function(e){e[e.None=0]="None",e[e.Words=1]="Words",e[e.SingleLine=2]="SingleLine",e[e.DoubleLine=3]="DoubleLine",e[e.HeavyLine=4]="HeavyLine",e[e.DottedLine=5]="DottedLine",e[e.DottedHeavyLine=6]="DottedHeavyLine",e[e.DashLine=7]="DashLine",e[e.DashHeavyLine=8]="DashHeavyLine",e[e.DashLongLine=9]="DashLongLine",e[e.DashLongHeavyLine=10]="DashLongHeavyLine",e[e.DotDashLine=11]="DotDashLine",e[e.DotDashHeavyLine=12]="DotDashHeavyLine",e[e.DotDotDashLine=13]="DotDotDashLine",e[e.DotDotDashHeavyLine=14]="DotDotDashHeavyLine",e[e.WavyLine=15]="WavyLine",e[e.WavyHeavyLine=16]="WavyHeavyLine",e[e.WavyDoubleLine=17]="WavyDoubleLine"}(n.UnderlineType||(n.UnderlineType={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Center=2]="Center",e[e.Justified=3]="Justified",e[e.Other=4]="Other",e[e.None=5]="None",e[e.JustifyLow=6]="JustifyLow",e[e.Distributed=7]="Distributed",e[e.ThaiDistributed=8]="ThaiDistributed"}(n.Alignment||(n.Alignment={})),function(e){e[e.Image=0]="Image",e[e.TextBox=1]="TextBox",e[e.Chart=2]="Chart",e[e.SmartArt=3]="SmartArt",e[e.Drawing=4]="Drawing",e[e.EquationObject=5]="EquationObject",e[e.Ink=6]="Ink",e[e.InkSpace=7]="InkSpace",e[e.InkEndOfLine=8]="InkEndOfLine",e[e.LineBreak=9]="LineBreak",e[e.PageBreak=10]="PageBreak",e[e.PageNumbers=11]="PageNumbers",e[e.FootnoteEndnote=12]="FootnoteEndnote",e[e.FootnoteEndnoteReferenceMark=13]="FootnoteEndnoteReferenceMark",e[e.Tab=14]="Tab",e[e.UnsupportedObject=15]="UnsupportedObject",e[e.Other=16]="Other"}(n.ObjectType||(n.ObjectType={})),function(e){e[e.Initial=0]="Initial",e[e.FirstLine=1]="FirstLine",e[e.Hanging=2]="Hanging"}(n.SpecialIndentType||(n.SpecialIndentType={}))},{}],128:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(129),n)},{129:129}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.WorkflowFlights=n.parseFlights=void 0;n.parseFlights=function(e){if(!e)return new o([],new Set,new Map);for(var t=e.split(";"),n=new Set,r=new Map,i=0,s=t;i<s.length;i++){var a=s[i].trim();if(""!==a){n.add(o.normalizeName(a));var c=a.split(":"),u=c[0],l=c[1],p=o.normalizeName(u);p&&r.set(p,l)}}return new o(t,n,r)};var o=function(){function e(e,t,n){this.originalFlights=e,this.normalizedFlights=t,this.keyValueFlightsMap=n}return e.normalizeName=function(e){return null==e?void 0:e.toLowerCase()},e.prototype.hasFlight=function(t){var n=e.normalizeName(t),o=this.normalizedFlights.has(n),r=this.keyValueFlightsMap.has(n);return o||r},e.prototype.getBooleanValue=function(e,t){var n;switch(null===(n=this.getStringValue(e))||void 0===n?void 0:n.toLowerCase()){case"true":return!0;case"false":return!1;default:return t}},e.prototype.getIntValue=function(e,t){var n=this.getStringValue(e),o=Number.parseInt(n,10);return Number.isNaN(o)?t:o},e.prototype.getStringValue=function(t,n){var o;return null!==(o=this.keyValueFlightsMap.get(e.normalizeName(t)))&&void 0!==o?o:n},e.prototype.getAll=function(){return this.originalFlights},e}();n.WorkflowFlights=o},{}],130:[function(e,t,n){"use strict";var o=e("exportStarHelper");Object.defineProperty(n,"__esModule",{value:!0}),o(e(131),n)},{131:131}],131:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.getContextTypes=void 0;n.getContextTypes=function(e,t){for(var n=[],o=0,r=null!=e?e:[];o<r.length;o++){var i=r[o];if(void 0===t||t===i.cardinality)for(var s=0,a=i.contextTypes;s<a.length;s++){var c=a[s];n.push([c,i.cardinality])}}return n}},{}],132:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ConsoleLogger=void 0;var o=e(135),r=e(134),i=function(){function e(){}return e.tagIntToString=function(t){return t<=e.maxNumericTag?t.toString():t>>24>=this.minOldSchemeHighByteValue?String.fromCharCode(t>>24&255,t>>16&255,t>>8&255,255&t):e.map.charAt(t>>24&63)+e.map.charAt(t>>18&63)+e.map.charAt(t>>12&63)+e.map.charAt(t>>6&63)+e.map.charAt(63&t)},e.getLogMessage=function(t,n,o){return"tag_"+e.tagIntToString(t)+" ["+r.LogCategory[n]+"] "+o},e.prototype.sendTraceTag=function(t,n,r,i){var s=this.logMessage;switch(r){case o.TraceLevel.Error:s=this.logError;break;case o.TraceLevel.Warning:s=this.logWarning;break;case o.TraceLevel.Info:s=this.logInfo;break;case o.TraceLevel.Verbose:s=this.logVerbose;break;case o.TraceLevel.Spam:default:s=this.logMessage}try{s(e.getLogMessage(t,n,i))}catch(e){var a="undefined"!=typeof navigator?navigator:void 0;if(a&&!/rv:11.0/i.test(a.userAgent))throw e}},e.prototype.shipAssertTag=function(t,n,o,r){console.assert(o,e.getLogMessage(t,n,r))},e.prototype.debugAssertTag=function(e,t,n,o){this.shipAssertTag(e,t,n,o)},e.prototype.logMessage=function(e){"log"in console&&console.log(e)},e.prototype.logError=function(e){"error"in console&&console.error(e)},e.prototype.logWarning=function(e){"warn"in console&&console.warn(e)},e.prototype.logInfo=function(e){"info"in console&&console.info(e)},e.prototype.logVerbose=function(e){"debug"in console&&console.debug(e)},e.maxNumericTag=65535,e.minOldSchemeHighByteValue=36,e.map="abcdefghijklmnopqrstuvwxyz0123456789",e}();n.ConsoleLogger=i},{134:134,135:135}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.NoopLogger=void 0;var o=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}();n.NoopLogger=o},{}],134:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.LogCategory=void 0,n.LogCategory=o,function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_MSOSP_OTelJS=225]="msoulscat_MSOSP_OTelJS",e[e.msoulscat_MSOSP_OTelJSInWebWoker=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.msoulscat_MSOSP_OTelJSWebWorkerPrototype=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_PptView=822]="msoulscat_Wac_PptView",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_WordDesigner=3016]="msoulscat_Wac_WordDesigner",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker",e[e.msoulscat_Wac_UnifiedUiHost=3027]="msoulscat_Wac_UnifiedUiHost",e[e.msoulscat_Wac_EquationTools=3033]="msoulscat_Wac_EquationTools"}(o||(n.LogCategory=o={}))},{}],135:[function(e,t,n){"use strict";var o;Object.defineProperty(n,"__esModule",{value:!0}),n.TraceLevel=void 0,n.TraceLevel=o,function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(o||(n.TraceLevel=o={}))},{}],136:[function(e,t,n){(function(t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.initializeLogger=function(e){if(!e)throw new Error("The 'logger' argument is missing");s.setLogger(e)},n.ULS=n.UlsLoggerWrapper=void 0;var o=e(133),r=e(132),i=function(){function e(){this.externalLogger="production"!==t.env.NODE_ENV?new r.ConsoleLogger:new o.NoopLogger}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,n,o){this.externalLogger.sendTraceTag(e,t,n,o)},e.prototype.debugAssertTag=function(e,t,n,o){this.externalLogger.debugAssertTag(e,t,n,o)},e.prototype.shipAssertTag=function(e,t,n,o){this.externalLogger.shipAssertTag(e,t,n,o)},e}();n.UlsLoggerWrapper=i;var s=new i;n.ULS=s}).call(this,{env:{NODE_ENV:"production"}})},{132:132,133:133}],137:[function(e,t,n){function o(e,t,n,o,r,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(o,r)}t.exports=function(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){o(s,r,i,a,c,"next",e)}function c(e){o(s,r,i,a,c,"throw",e)}a(void 0)}))}}},{}],138:[function(e,t,n){t.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},{}],139:[function(e,t,n){t.exports=function(e){return e&&e.__esModule?e:{default:e}}},{}],140:[function(e,t,n){var o=e(138);t.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o(e,t,n[t])}))}return e}},{138:138}],141:[function(e,t,n){t.exports=e(149)},{149:149}],142:[function(e,t,n){var o="undefined"!=typeof self?self:this,r=function(){function e(){this.fetch=!1,this.DOMException=o.DOMException}return e.prototype=o,new e}();!function(e){!function(t){var n="URLSearchParams"in e,o="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,s="ArrayBuffer"in e;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],c=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function u(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return o&&(t[Symbol.iterator]=function(){return t}),t}function f(e){this.map={},e instanceof f?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function g(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){var t;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:r&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&r&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||c(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(g)}),this.text=function(){var e,t,n,o=d(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(S)}),this.json=function(){return this.text().then(JSON.parse)},this}f.prototype.append=function(e,t){e=u(e),t=l(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},f.prototype.delete=function(e){delete this.map[u(e)]},f.prototype.get=function(e){return e=u(e),this.has(e)?this.map[e]:null},f.prototype.has=function(e){return this.map.hasOwnProperty(u(e))},f.prototype.set=function(e,t){this.map[u(e)]=l(t)},f.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},f.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),p(e)},f.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),p(e)},f.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),p(e)},o&&(f.prototype[Symbol.iterator]=f.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function T(e,t){var n,o,r=(t=t||{}).body;if(e instanceof T){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new f(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new f(t.headers)),this.method=(n=t.method||this.method||"GET",o=n.toUpperCase(),v.indexOf(o)>-1?o:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function S(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(r))}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new f(t.headers),this.url=t.url||"",this._initBody(e)}T.prototype.clone=function(){return new T(this,{body:this._bodyInit})},m.call(T.prototype),m.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new f(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var b=[301,302,303,307,308];w.redirect=function(e,t){if(-1===b.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},t.DOMException=e.DOMException;try{new t.DOMException}catch(e){t.DOMException=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},t.DOMException.prototype=Object.create(Error.prototype),t.DOMException.prototype.constructor=t.DOMException}function _(e,n){return new Promise((function(o,i){var s=new T(e,n);if(s.signal&&s.signal.aborted)return i(new t.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function c(){a.abort()}a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new f,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),o=n.shift().trim();if(o){var r=n.join(":").trim();t.append(o,r)}})),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var r="response"in a?a.response:a.responseText;o(new w(r,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new t.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&r&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",c),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",c)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}_.polyfill=!0,e.fetch||(e.fetch=_,e.Headers=f,e.Request=T,e.Response=w),t.Headers=f,t.Request=T,t.Response=w,t.fetch=_,Object.defineProperty(t,"__esModule",{value:!0})}({})}(r),r.fetch.ponyfill=!0,delete r.fetch.polyfill;var i=r;(n=i.fetch).default=i.fetch,n.fetch=i.fetch,n.Headers=i.Headers,n.Request=i.Request,n.Response=i.Response,t.exports=n},{}],143:[function(e,t,n){"use strict";function o(e){if(this._capacity=i(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,o=this._capacity,r=0;r<e;++r)t[r]=this[n+r&o-1];return t},o.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var o=this._capacity;if(n+t>o){for(var r=0;r<t;++r){this._checkCapacity(n+1),this[i=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n}return n}for(var i=this._front,r=0;r<t;++r)this[i+n&o-1]=arguments[r],i++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},o.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var o=n-1;o>=0;o--){this._checkCapacity(t+1);var r=this._capacity;this[s=(this._front-1&r-1^r)-r]=arguments[o],t++,this._length=t,this._front=s}return t}var i=this._front;for(o=n-1;o>=0;o--){var s;this[s=(i-1&r-1^r)-r]=arguments[o],i=s}return this._front=i,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);r=this._capacity;return this[o=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,o=0;o<e;++o)this[t+o&n-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(i(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length;n+o>t&&function(e,t,n,o,r){for(var i=0;i<r;++i)n[i+o]=e[i+t],e[i+t]=void 0}(this,0,this,t,n+o&t-1)};var r=Array.isArray;function i(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}t.exports=o},{}],144:[function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,o,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,o||e,i),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,i=n.length,s=new Array(i);o<i;o++)s[o]=n[o].fn;return s},u.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,o,i,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,i),!0;case 6:return l.fn.call(l.context,t,n,o,i,s),!0}for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var f,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),p){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,o);break;default:if(!c)for(f=1,c=new Array(p-1);f<p;f++)c[f-1]=arguments[f];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return c(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||o&&!s.once||n&&s.context!==n||c(this,i);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&u.push(s[a]);u.length?this._events[i]=1===u.length?u[0]:u:c(this,i)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&c(this,t)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}],145:[function(e,t,n){(function(e){!function(e){function t(){}function n(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===r.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function o(e){for(var t=0,n=Math.min(65536,e.length+1),o=new Uint16Array(n),r=[],i=0;;){var s=t<e.length;if(!s||i>=n-1){if(r.push(String.fromCharCode.apply(null,o.subarray(0,i))),!s)return r.join("");e=e.subarray(t),i=t=0}if(0==(128&(s=e[t++])))o[i++]=s;else if(192==(224&s)){var a=63&e[t++];o[i++]=(31&s)<<6|a}else if(224==(240&s)){a=63&e[t++];var c=63&e[t++];o[i++]=(31&s)<<12|a<<6|c}else if(240==(248&s)){65535<(s=(7&s)<<18|(a=63&e[t++])<<12|(c=63&e[t++])<<6|63&e[t++])&&(s-=65536,o[i++]=s>>>10&1023|55296,s=56320|1023&s),o[i++]=s}}}if(e.TextEncoder&&e.TextDecoder)return!1;var r=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(t.prototype,"encoding",{value:"utf-8"}),t.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,o=0,r=Math.max(32,n+(n>>>1)+7),i=new Uint8Array(r>>>3<<3);t<n;){var s=e.charCodeAt(t++);if(55296<=s&&56319>=s){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,s=((1023&s)<<10)+(1023&a)+65536)}if(55296<=s&&56319>=s)continue}if(o+4>i.length&&(r+=8,r=(r*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(r)).set(i),i=a),0==(4294967168&s))i[o++]=s;else{if(0==(4294965248&s))i[o++]=s>>>6&31|192;else if(0==(4294901760&s))i[o++]=s>>>12&15|224,i[o++]=s>>>6&63|128;else{if(0!=(4292870144&s))continue;i[o++]=s>>>18&7|240,i[o++]=s>>>12&63|128,i[o++]=s>>>6&63|128}i[o++]=63&s|128}}return i.slice?i.slice(0,o):i.subarray(0,o)},Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(n.prototype,"fatal",{value:!1}),Object.defineProperty(n.prototype,"ignoreBOM",{value:!1});var i=o;"function"==typeof Buffer&&Buffer.from?i=function(e){return Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(i=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return o(e)}finally{URL.revokeObjectURL(t)}}),n.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),i(e)},e.TextEncoder=t,e.TextDecoder=n}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],146:[function(e,t,n){"use strict";var o=e(139),r=o(e(141)),i=o(e(140)),s=o(e(137));Object.defineProperty(n,"__esModule",{value:!0});var a=e(147);var c=["get","getKey","getAll","getAllKeys","count"],u=["put","add","delete","clear"],l=new Map;function p(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(l.get(t))return l.get(t);var n=t.replace(/FromIndex$/,""),o=t!==n,i=u.indexOf(n)>=0;if(n in(o?IDBIndex:IDBObjectStore).prototype&&(i||c.indexOf(n)>=0)){var a=function(){var e=(0,s.default)(r.default.mark((function e(t){var s,a,c,u,l,p,f=arguments;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=this.transaction(t,i?"readwrite":"readonly"),c=a.store,u=f.length,l=new Array(u>1?u-1:0),p=1;p<u;p++)l[p-1]=f[p];return o&&(c=c.index(l.shift())),e.next=6,Promise.all([(s=c)[n].apply(s,l),i&&a.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return l.set(t,a),a}}}a.replaceTraps((function(e){return(0,i.default)({},e,{get:function(t,n,o){return p(t,n)||e.get(t,n,o)},has:function(t,n){return!!p(t,n)||e.has(t,n)}})})),n.unwrap=a.unwrap,n.wrap=a.wrap,n.deleteDB=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.blocked,o=indexedDB.deleteDatabase(e);return n&&o.addEventListener("blocked",(function(){return n()})),a.wrap(o).then((function(){}))},n.openDB=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=n.blocked,r=n.upgrade,i=n.blocking,s=n.terminated,c=indexedDB.open(e,t),u=a.wrap(c);return r&&c.addEventListener("upgradeneeded",(function(e){r(a.wrap(c.result),e.oldVersion,e.newVersion,a.wrap(c.transaction))})),o&&c.addEventListener("blocked",(function(){return o()})),u.then((function(e){s&&e.addEventListener("close",(function(){return s()})),i&&e.addEventListener("versionchange",(function(){return i()}))})).catch((function(){})),u}},{137:137,139:139,140:140,141:141,147:147}],147:[function(e,t,n){"use strict";var o,r,i=function(e,t){return t.some((function(t){return e instanceof t}))};var s=new WeakMap,a=new WeakMap,c=new WeakMap,u=new WeakMap,l=new WeakMap;var p={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||c.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return h(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function f(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).indexOf(e)>=0?function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e.apply(g(this),n),h(s.get(this))}:function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return h(e.apply(g(this),n))}:function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),r=1;r<n;r++)o[r-1]=arguments[r];var i=e.call.apply(e,[g(this),t].concat(o));return c.set(i,t.sort?t.sort():[t]),h(i)}}function d(e){return"function"==typeof e?f(e):(e instanceof IDBTransaction&&function(e){if(!a.has(e)){var t=new Promise((function(t,n){var o=function(){e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=function(){t(),o()},i=function(){n(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)}));a.set(e,t)}}(e),i(e,o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function h(e){if(e instanceof IDBRequest)return t=e,(n=new Promise((function(e,n){var o=function(){t.removeEventListener("success",r),t.removeEventListener("error",i)},r=function(){e(h(t.result)),o()},i=function(){n(t.error),o()};t.addEventListener("success",r),t.addEventListener("error",i)}))).then((function(e){e instanceof IDBCursor&&s.set(e,t)})).catch((function(){})),l.set(n,t),n;var t,n;if(u.has(e))return u.get(e);var o=d(e);return o!==e&&(u.set(e,o),l.set(o,e)),o}var g=function(e){return l.get(e)};n.instanceOfAny=i,n.replaceTraps=function(e){p=e(p)},n.reverseTransformCache=l,n.unwrap=g,n.wrap=h},{}],148:[function(e,t,n){(function(e){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==e?n=e.WebSocket||e.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],149:[function(e,t,n){var o=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function a(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{a({},"")}catch(e){a=function(e,t,n){return e[t]=n}}function c(e,t,n,o){var r=t&&t.prototype instanceof p?t:p,i=Object.create(r.prototype),s=new _(o||[]);return i._invoke=function(e,t,n){var o="suspendedStart";return function(r,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw i;return k()}for(n.method=r,n.arg=i;;){var s=n.delegate;if(s){var a=S(s,n);if(a){if(a===l)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var c=u(e,t,n);if("normal"===c.type){if(o=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o="completed",n.method="throw",n.arg=c.arg)}}}(e,n,s),i}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function p(){}function f(){}function d(){}var h={};h[r]=function(){return this};var g=Object.getPrototypeOf,y=g&&g(g(C([])));y&&y!==t&&n.call(y,r)&&(h=y);var m=d.prototype=p.prototype=Object.create(h);function v(e){["next","throw","return"].forEach((function(t){a(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){var o;this._invoke=function(r,i){function s(){return new t((function(o,s){!function o(r,i,s,a){var c=u(e[r],e,i);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==typeof p&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){o("next",e,s,a)}),(function(e){o("throw",e,s,a)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return o("throw",e,s,a)}))}a(c.arg)}(r,i,o,s)}))}return o=o?o.then(s,s):s()}}function S(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,S(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var o=u(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,l;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(n.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:k}}function k(){return{value:void 0,done:!0}}return f.prototype=m.constructor=d,d.constructor=f,f.displayName=a(d,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,a(e,s,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},v(T.prototype),T.prototype[i]=function(){return this},e.AsyncIterator=T,e.async=function(t,n,o,r,i){void 0===i&&(i=Promise);var s=new T(c(t,n,o,r),i);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},v(m),a(m,s,"Generator"),m[r]=function(){return this},m.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var o=t.pop();if(o in e)return n.value=o,n.done=!1,n}return n.done=!0,n}},e.values=C,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(n,o){return s.type="throw",s.arg=e,t.next=n,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var a=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(a&&c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),b(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;b(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}("object"==typeof t?t.exports:{});try{regeneratorRuntime=o}catch(e){Function("r","regeneratorRuntime = r")(o)}},{}],assignHelper:[function(e,t,n){var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};t.exports=o},{}],awaiterHelper:[function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{c(o.next(e))}catch(e){i(e)}}function a(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((o=o.apply(e,t||[])).next())}))};t.exports=o},{}],exportStarHelper:[function(e,t,n){var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};t.exports=r},{}],extendsHelper:[function(e,t,n){var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.exports=r},{}],generatorHelper:[function(e,t,n){var o=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.exports=o},{}],readHelper:[function(e,t,n){var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return s};t.exports=o},{}],spreadArrayHelper:[function(e,t,n){var o=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))};t.exports=o},{}],valuesHelper:[function(e,t,n){var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.exports=o},{}]},{},[48])(48)}));
//# sourceMappingURL=al.min.js.map
