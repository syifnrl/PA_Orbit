'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[8],{1304:function(C,L,b){b.r(L);b.d(L,"RtcUtils",function(){return r});C=b(0);var f=b(8),c=b(1347),u=b(32);class r{static qLf(t,k=c.RealtimeChannel.zzg){let m;try{m=u.c(t)}catch(l){throw t=String.format("Failed to JSON-serialize payload : {0}",l),f.ULS.sendTraceTag(18637072,500,10,t),Error.argument("payload",t);}if(m.length>k)throw t=String.format("Payload exceeds maximum length: {0} > {1}.",m.length,k),f.ULS.sendTraceTag(18637074,
500,10,t),Error.argument("payload",t);return m}static deserialize(t,k,m){if(!t)return null;if(Object.getType(t)!==String){var l=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",k,Object.getType(t).getName(),m);f.ULS.sendTraceTag(18637075,500,10,l);return null}l=null;try{l=u.a(t)}catch(x){t=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",k,x,m),f.ULS.sendTraceTag(18637077,
500,10,t)}return l}static $fc(t){if(!t)return"";if("string"===typeof t)return t.toString();try{return u.c(t)}catch(k){return t.toString()}}static oil(t){let k,m,l;k=0;l=m=null;if(!t)return{eLi:k,fLi:m,exception:l};try{const x=t.source;x&&Object.getType(x)===String&&(l=x);const w=t.context;w&&(t=w,k=t.status?t.status:0,m=t.statusText?t.statusText:null)}catch(x){}return{eLi:k,fLi:m,exception:l}}}Object(C.a)(r,"RtcUtils",null,[])},1336:function(C,L,b){b.r(L);C=b(0);var f=b(8),c=b(41),u=b(73),r;(function(l){l[l.SendNotification=
0]="SendNotification";l[l.SendPersistentState=1]="SendPersistentState";l[l.FindSession=2]="FindSession";l[l.Last=3]="Last"})(r||(r={}));Object(C.b)("ApiType",r);var t;(function(l){l[l.AttemptCount=0]="AttemptCount";l[l.SuccessCount=1]="SuccessCount";l[l.DropCount=2]="DropCount";l[l.FailedCount=3]="FailedCount";l[l.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";l[l.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";l[l.ThrottledCount=6]="ThrottledCount";l[l.Last=7]="Last"})(t||(t=
{}));Object(C.b)("EventCountType",t);var k=b(1442);b.d(L,"FrequentLoggingMetrics",function(){return m});class m{constructor(l){this.R9h=this.Foi=null;this.B3i=this.Cri=0;this.rA=null;this.TEh=this.Umf=0;this.nf=l;this.L3l();this.sef=this.vwh=this.znf=!1;this.X6c=0}get Phl(){return this.sef}dzn(l){this.TEh=l;window.setInterval(Object(c.a)(this,this.vxg,"logMetricsBatchAndReset"),l);this.Umf=(new Date).getTime()}bV(l,x){this.Sqn(l)&&!this.vwh||this.Phl||!window.navigator.onLine||this.nf.xsa||(this.rA[l][x]++,
this.znf=!0)}L3l(){this.rA=Array(3);for(let l=0;3>l;l++){this.rA[l]=Array(7);for(let x=0;7>x;x++)this.rA[l][x]=0}}KJk(){const l={};for(let x=0;3>x;x++)for(let w=0;7>w;w++)this.rhm(x,w)&&(l[r[x]+t[w]]=this.rA[x][w]);l.FSDomain=this.Foi;l.ConnectionDomain=this.R9h;l.FSRetryInterval=this.Cri;l.MaxPayloadSize=this.B3i;l.LogNumber=this.X6c;1===this.X6c&&(l.FSLatencies=k.a.instance.Yzl(),l.ConLatencies=k.a.instance.wvl());return l}rhm(l,x){return 2===l&&3!==x&&0!==x?!1:!0}Sqn(l){return 2===l?!1:!0}vxg(){if(this.znf){this.X6c++;
if((new Date).getTime()-this.Umf<5E3+this.TEh){var l=u.a.toJSON(this.KJk());f.ULS.sendTraceTag(50644352,500,15,l)}this.Umf=(new Date).getTime();for(l=0;3>l;l++)for(let x=0;7>x;x++)this.rA[l][x]=0;this.znf=!1}}Stm(){this.vwh=!0}static get instance(){return m.na}static create(l){m.instance||(m.na=new m(l));return m.instance}}m.na=null;Object(C.a)(m,"FrequentLoggingMetrics",null,[862])},1347:function(C,L,b){b.r(L);C=b(0);var f=b(8),c=b(41),u=b(407),r=b(1533),t=b(76),k=b(2);class m{constructor(jb,$a){this.status=
jb;this.BLc=$a}}Object(C.a)(m,"UserStatusInfo",null,[]);var l=b(46),x=b(1442);class w{constructor(jb,$a){this.data=jb;this.timeStamp=$a}}Object(C.a)(w,"PresenceData",null,[]);class G{constructor(jb){this.Z$=!1;this.cQa=0;this.abf=!1;this.setTimeout=G.QUf;this.clearTimeout=G.FUf;this.Jrm=Object(c.a)(this,this.Gqm,"logRtcConnectingUsageStatement");this.Uy=jb}SDm(){this.Z$||(this.cQa=this.setTimeout(()=>{this.Z$=!1;this.e1i()},8E3),this.Z$=!0,this.abf=!1)}FEm(){this.fE()}tKm(){this.e1i()}e1i(){this.fE();
this.abf||(this.abf=!0,this.Jrm())}Gqm(){f.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",this.Uy)}fE(){this.Z$&&this.clearTimeout(this.cQa);this.cQa=0;this.Z$=!1}static QUf(jb,$a){return window.setTimeout(jb,$a)}static FUf(jb){window.clearTimeout(jb)}}Object(C.a)(G,"ConnectedUsageKpiLogger",null,[881]);class D{constructor(){this.kkj=this.NRg;this.nkj=this.QRg;this.mkj=this.PRg;this.rkj=this.XRg;this.qkj=this.WRg;this.iSg=this.jSg;this.fSg=this.gSg;this.Oic=
this.dSg;this.yPd=this.eSg;this.lkj=this.ORg;this.Zsa=this.RDg;this.X6a=this.VDg}NRg(){}QRg(){}PRg(){}XRg(){}WRg(){}gSg(){}eSg(){}dSg(){}jSg(){}ORg(){}RDg(){}VDg(){}}Object(C.a)(D,"NoopRealtimeChannelMetrics",null,[869,178]);class H{}H.Q_d="presenceUpdated";H.updateNotification="updateNotification";H.uej="persistentStateCleared";H.updatePersistentState="persistentStateUpdated";Object(C.a)(H,"RtcClientMethodNames",null,[]);class M{}M.l0l="realtimeChannelHub";M.Q_d="UpdatePresence";M.GV="SendUpdateNotification";
M.J6f="GetCompletePersistentStateWithMetadata";M.updatePersistentState="UpdatePersistentState";M.voc="UpdateClientInfo";Object(C.a)(M,"RtcHubMethodNames",null,[]);class J{constructor(jb){this.py=jb}g4m(jb){this.py.on(H.Q_d,jb)}Q4m(jb){this.py.on(H.updateNotification,jb)}f4m(jb){this.py.on(H.updatePersistentState,jb)}e4m(jb){this.py.on(H.uej,jb)}QJn(jb){this.py.off(H.Q_d,jb)}XJn(jb){this.py.off(H.updateNotification,jb)}PJn(jb){this.py.off(H.updatePersistentState,jb)}OJn(jb){this.py.off(H.uej,jb)}Q_d(jb){return this.py.invoke(M.Q_d,
jb)}voc(jb){return this.py.invoke(M.voc,jb)}GV(jb,$a){return this.py.invoke(M.GV,jb,$a)}J6f(jb){return this.py.invoke(M.J6f,jb)}updatePersistentState(jb,$a){return this.py.invoke(M.updatePersistentState,jb,$a)}}Object(C.a)(J,"RealtimeChannelProxy",null,[878,879,880]);class F{constructor(){this.O9e=this.Zoh=!1;this.M9e=0;this.paf=this.Buf=this.Auf=this.P8e=!1;this.Uef=0;this.pMh=!1;this.oMh=this.nMh=0;this.gtf=!1;this.mtf=this.ltf=this.otf=this.htf=0}get kGk(){return this.O9e}get jGk(){return this.M9e}get rBk(){return this.P8e}get esn(){return this.Auf}get fsn(){return this.Buf}get hTk(){return this.paf}get wue(){return this.Uef}get Adn(){return this.pMh}get ysj(){return this.nMh}get zdn(){return this.oMh}get vdn(){return this.gtf}get wdn(){return this.htf}get Dsj(){return this.otf}get zsj(){return this.ltf}get Asj(){return this.mtf}static createInstance(jb){const {RealtimeChannel:$a}=
b(1347);return jb?Object.assign(new F,{Zoh:jb.ea("AwayStatusManagerIsEnabled"),O9e:jb.ea("AwayStatusOneMinuteTimeoutIsEnabled"),M9e:jb.jb("AwayCoauthorThresholdMs",9E5),P8e:jb.ea("RtcAllowCrossDomainAccessEnabled"),Auf:jb.ea("ShouldLogOnContentNotification"),Buf:jb.ea("ShouldLogOnHostSubscriptionNotification"),paf:jb.ea("RtcClientMetricsEnabled"),Uef:jb.jb("RtcFindSessionRequestTimeoutInMS",6E4),pMh:jb.ea("RtcJsClientFrequentlyLogsMetrics"),nMh:jb.jb("RtcJsClientFrequentMetricsLatencyThresholdInMS",
1E3),oMh:jb.jb("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),gtf:jb.ea("RtcClientMessageTelemetryEnabled"),htf:jb.jb("RtcClientMessageTelemetrySampleSize",5),otf:jb.jb("RtcSendTelemetryMessageIntervalInMS",3E5),ltf:jb.jb("RtcLogClientMessageMetricsTimeOutInMs",2E4),mtf:jb.jb("RtcMaxPayloadSizeInCharactersOverride",$a.zzg)}):Object.assign(new F,{Zoh:!1,O9e:!1,M9e:9E5,P8e:!1,Auf:!1,Buf:!0,paf:!1,Uef:9E4,gtf:!1,htf:5,otf:3E5,ltf:2E4,mtf:$a.zzg})}}Object(C.a)(F,"RealtimeChannelSettings",null,[877]);
class A extends Sys.EventArgs{constructor(jb,$a){super();this.newState=jb;this.oldState=$a}}Object(C.a)(A,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class N extends Sys.EventArgs{constructor(jb,$a){super();this.gTk=jb;this.Qub=$a}}Object(C.a)(N,"ClientInfoEventArgs",Sys.EventArgs,[]);class B extends Sys.EventArgs{constructor(jb){super();this.presence=jb}}Object(C.a)(B,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);var E=b(1678),P=b(1677),T=b(1675);class V extends Sys.EventArgs{constructor(jb,
$a=null){super();this.wl=jb;this.erk=$a}get type(){return this.wl}get kia(){return this.erk}}Object(C.a)(V,"UpdateNotificationEventArgs",Sys.EventArgs,[]);class I extends Sys.EventArgs{constructor(){super()}}Object(C.a)(I,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class R extends Sys.EventArgs{constructor(jb,$a,ya,wa,Fa,bb){super();this.TVc=jb;this.KOf=$a;this.ZWk=ya;this.hmi=Fa;this.gMf=wa;this.dF=bb}}Object(C.a)(R,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class ba extends Sys.EventArgs{constructor(jb){super();
this.hubConnection=jb}}Object(C.a)(ba,"RefreshProxyEventArgs",Sys.EventArgs,[]);class ha extends Sys.EventArgs{constructor(jb,$a){super();this.rra=jb;this.errorMessage=$a}}Object(C.a)(ha,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class na extends Sys.EventArgs{constructor(jb,$a,ya){super();this.type=jb;this.presence=$a;this.Qub=ya}}Object(C.a)(na,"SendPersistentStateEventArgs",Sys.EventArgs,[]);class da extends Sys.EventArgs{constructor(jb,$a,ya,wa){super();this.type=jb;this.kia=$a;this.k9k=ya;
this.Qub=wa}}Object(C.a)(da,"SendUpdateNotificationEventArgs",Sys.EventArgs,[]);class ia extends Sys.EventArgs{constructor(){super()}}Object(C.a)(ia,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class ma extends Sys.EventArgs{constructor(jb){super();this.$me=jb}}Object(C.a)(ma,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class qa extends Sys.EventArgs{constructor(jb,$a){super();this.type=jb;this.gQn=$a}}Object(C.a)(qa,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,
[]);var ka=b(62);class va{constructor(){this.ka=new ka.a}uYm(jb,$a){this.ka.raiseEvent("CSC",new A(jb,$a))}gZm(jb){this.ka.raiseEvent("RP",new ba(jb))}ATe(jb){this.ka.raiseEvent("RC",jb)}jZm(){this.ka.raiseEvent("RMID")}fZm(jb,$a,ya,wa,Fa,bb){this.ka.raiseEvent("RPS",new R(jb,$a,ya,wa,Fa,bb))}njj(jb,$a){this.ka.raiseEvent("UPSR",new qa(jb,$a))}bjj(jb,$a){this.ka.raiseEvent("PU",new T.a(jb,$a))}NYm(jb){this.ka.raiseEvent("MPU",new B(jb))}TQg(jb,$a,ya,wa){this.ka.raiseEvent("SUN",new da(jb,$a,ya,wa))}wZm(jb,
$a){this.ka.raiseEvent("UNR",new V(jb,$a))}hjj(jb,$a,ya){this.ka.raiseEvent("SP",new na(jb,$a,ya))}cZm(jb,$a){this.ka.raiseEvent("PSU",new P.a(jb,$a))}bZm(jb){this.ka.raiseEvent("PSC",new E.a(jb))}IYm(jb){this.ka.raiseEvent("IPSC",new E.a(jb))}xZm(jb){this.ka.raiseEvent("UPSC",new ma(jb))}kZm(jb,$a){this.ka.raiseEvent("SPC",new ia(jb,$a))}fjj(jb,$a){this.ka.raiseEvent("RCF",new ha(jb,$a))}FYm(jb){this.ka.raiseEvent("CPSWM",new I(jb))}vZm(jb,$a){this.ka.raiseEvent("UCI",new N(jb,$a))}QQa(jb){this.ka.addHandler("CSC",
jb)}IQd(jb){this.ka.removeHandler("CSC",jb)}wzk(jb){this.ka.addHandler("RP",jb)}vzk(jb){this.ka.addHandler("RC",jb)}zzk(jb){this.ka.addHandler("RMID",jb)}uzk(jb){this.ka.addHandler("RPS",jb)}Uzk(jb){this.ka.addHandler("UPSR",jb)}ihb(jb){this.ka.addHandler("PU",jb)}tjc(jb){this.ka.removeHandler("PU",jb)}Xxk(jb){this.ka.addHandler("IPU",jb)}Rzk(jb){this.ka.addHandler("UCI",jb)}Dzk(jb){this.ka.addHandler("SUN",jb)}Yxk(jb){this.ka.addHandler("IUNR",jb)}Wea(jb){this.ka.addHandler("UNR",jb)}CQc(jb){this.ka.removeHandler("UNR",
jb)}Jie(jb){this.ka.addHandler("PSU",jb)}EUe(jb){this.ka.removeHandler("PSU",jb)}Wxk(jb){this.ka.addHandler("IPSU",jb)}Iie(jb){this.ka.addHandler("PSC",jb)}DUe(jb){this.ka.removeHandler("PSC",jb)}Vxk(jb){this.ka.addHandler("IPSC",jb)}Tzk(jb){this.ka.addHandler("UPSC",jb)}Czk(jb){this.ka.addHandler("SP",jb)}Fzk(jb){this.ka.addHandler("SPC",jb)}static getInstance(){return va.na||(va.na=new va)}}va.na=null;Object(C.a)(va,"RtcEventHub",null,[876]);var ja=b(70),Ma=b(139);class Ha{constructor(jb){this.Ldd=
null;this.I8a=0;this.K7b=!1;this.Kn=jb;this.Kn.QQa(Object(c.a)(this,this.fta,"onConnectionStateChanged"))}fta(jb,$a){this.I8a=$a.newState}XKm(){f.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Kn.ATe()}B2l(jb){this.Ldd.init(jb)}}Object(C.a)(Ha,"ARtcMessageHandler",null,[]);var X=b(79);class W{constructor(){this.Presence=null;this.TimeStamp=0}}Object(C.a)(W,"PresenceDataEntryForClients",null,[]);var fa=b(73);class ra{constructor(jb,$a=""){this.xmk=
jb;this.vFa=$a}send(){return this.xmk()}get messageId(){return this.vFa}}Object(C.a)(ra,"MessageHandler",null,[890]);var Aa=b(1470);class Ba extends Sys.EventArgs{constructor(jb,$a,ya,wa){super();this.KVg=jb;this.reconnectDelay=$a;this.reason=ya;this.QZg=wa}}Object(C.a)(Ba,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);class ta{constructor(){this.Ovf=this.lh=null}get ti(){return this.lh?this.Ovf?this.Ovf.getTime()-this.lh.getTime():(new Date).getTime()-this.lh.getTime():0}start(){this.lh=new Date}stop(){this.Ovf=
new Date}}Object(C.a)(ta,"SimpleStopwatch",null,[]);var xa=b(1537),za;(function(jb){jb[jb.contentUpdate=0]="contentUpdate";jb[jb.editorsTableUpdate=1]="editorsTableUpdate";jb[jb.fileNameUpdate=2]="fileNameUpdate";jb[jb.wetContentUpdate=3]="wetContentUpdate";jb[jb.persistedContentUpdate=4]="persistedContentUpdate";jb[jb.clientRtcReconnectRequest=5]="clientRtcReconnectRequest";jb[jb.replicationTelemetry=6]="replicationTelemetry";jb[jb.lockUpdate=7]="lockUpdate";jb[jb.collabServiceContentUpdate=8]="collabServiceContentUpdate";
jb[jb.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";jb[jb.saveTargetUpdate=10]="saveTargetUpdate";jb[jb.uploadToOcsUpdate=11]="uploadToOcsUpdate";jb[jb.labelUpdate=12]="labelUpdate";jb[jb.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";jb[jb.subscribeOrExtend=14]="subscribeOrExtend";jb[jb.elapsedBootTelemetry=15]="elapsedBootTelemetry";jb[jb.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";jb[jb.clientToClientResponseMessage=17]="clientToClientResponseMessage";
jb[jb.verifyNotificationPipeline=18]="verifyNotificationPipeline";jb[jb.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";jb[jb.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";jb[jb.last=21]="last"})(za||(za={}));Object(C.b)("UpdateNotificationType",za);class la extends Ha{constructor(jb,$a,ya,wa,Fa,bb,Eb,hb,nb,Pb){super(Eb);this.py=null;this.OEh=!1;this.vFa=0;this.Gqf=new Ma.a;this.xd=jb;this.SGh=this.RGh=0;this.Ldd=$a;this.Ldd.Lie(Object(c.a)(this,this.XKm,"onTooManyUndeliveredMessages"));
this._clientId=ya;this.mkk=Fa;this.Kn.wzk(Object(c.a)(this,this.NIm,"onRefreshProxyRequired"));this.Kn.uzk(Object(c.a)(this,this.LIm,"onRefreshAllPersistentStateRequest"));this.Kn.Dzk(Object(c.a)(this,this.GV,"sendUpdateNotification"));this.Kn.Xxk(Object(c.a)(this,this.BGm,"onInternalPresenceUpdated"));this.Kn.Yxk(Object(c.a)(this,this.CGm,"onInternalUpdateNotificationReceived"));this.Kn.Wxk(Object(c.a)(this,this.AGm,"onInternalPersistentStateUpdated"));this.Kn.Vxk(Object(c.a)(this,this.zGm,"onInternalPersistentStateCleared"));
this.Kn.Czk(Object(c.a)(this,this.jTd,"sendPersistentState"));this.Kn.Rzk(Object(c.a)(this,this.voc,"updateClientInfo"));this.Ad=bb;this.Uy=wa;this.rA=hb;this.e2=nb;this.w7c=Pb;this.sEa=Object(ja.a)(String,k.AFrameworkApplication.sessionStartInfoSettings.Application)||""}NIm(jb,$a){this.py=this.mkk($a.hubConnection);this.Ldd.reset();this.py.g4m(Object(c.a)(this,this.zca,"onPresenceUpdated"));this.py.f4m(Object(c.a)(this,this.Jgc,"onPersistentStateUpdated"));this.py.e4m(Object(c.a)(this,this.bOc,"onPersistentStateCleared"));
this.py.Q4m(Object(c.a)(this,this.Ana,"onUpdateNotificationReceived"))}fta(jb,$a){this.I8a=$a.newState;2===$a.newState&&this.nhn()}nhn(){for(let jb of this.Gqf)this.GV(null,new da(jb.key,jb.value,!1,new u.a));this.Gqf=new Ma.a}LIm(jb,$a){$a.gMf();for(jb=0;3>jb;++jb)this.Ygn(jb,$a)}Ygn(jb,$a){try{this.py.J6f(jb).done(ya=>{$a.TVc($a.KOf,"GetCompletePresenceSuccess")&&($a.ZWk.tKm(),f.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.Uy),this.Kn.jZm(),this.iIm(jb,
ya),this.Kn.FYm(ya),$a.hmi.Na(jb)&&this.Kn.hjj(jb,$a.hmi.J(jb),new u.a))}).fail(ya=>{const {RtcUtils:wa}=b(1304);$a.TVc($a.KOf,"GetCompletePresenceFail")&&(f.ULS.sendTraceTag(3249541,500,15,"Failed to retrieve complete session state : {0} for [{1}]",wa.$fc(ya),this.Uy),this.Kn.ATe())}).always(()=>{$a.dF&&$a.dF.stop()})}catch(ya){f.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",
$a.KOf,ya.message)}}jTd(jb,$a){var {RtcUtils:ya}=b(1304);jb=$a.presence;let wa;const Fa=$a.Qub;this.e2.bV(1,0);try{wa=ya.qLf(jb,this.w7c)}catch(Eb){this.e2.bV(1,3);f.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Eb.message);Fa.setException(Eb);return}ya=new t.a;ya.$(this._clientId,Object.assign(new W,{Presence:jb,TimeStamp:(new Date).getTime()}));this.Kn.njj($a.type,ya);if(2!==this.I8a)this.rA.Oic(),this.e2.bV(1,2),Fa.mf(null);else{var bb=
this.vFa.toString();++this.vFa;jb=new ra(()=>this.ohn($a.type,wa,bb),bb);jb=this.MIj(0,$a.type).add(jb);jb.oOe(Eb=>{2===Eb&&this.e2.bV(1,6);Fa.mf(null)});jb.nOe(()=>{})}}ohn(jb,$a,ya){let wa=null;const Fa=new ta,bb=new Aa.a;f.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.Uy);if(2!==this.I8a)return this.rA.Oic(),this.e2.bV(1,2),f.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.Uy),bb.azg(),bb;this.Ad&&20>this.RGh&&(wa=this.Ad.Pe("WebServiceCall",
"Send Presence Message"),this.RGh++);Fa.start();bb.CHd(1);try{this.py.updatePersistentState(jb,$a).done(()=>{this.rA.fSg();this.e2.bV(1,1);f.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",ya,this.Uy);bb.fJb(1);Fa&&(Fa.stop(),Fa.ti>this.xd.ysj?this.e2.bV(1,4):this.e2.bV(1,5))}).fail(Eb=>{const {RtcUtils:hb}=b(1304);this.K7b||(this.rA.Oic(),this.e2.bV(1,3),f.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",
ya,hb.$fc(Eb),this.Uy));bb.fJb(2)}).always(()=>{wa&&wa.stop()})}catch(Eb){f.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",Eb.message),this.e2.bV(1,3),bb.fJb(2)}return bb}voc(jb,$a){({RtcUtils:jb}=b(1304));const ya=$a.gTk,wa=$a.Qub;let Fa;try{Fa=jb.qLf(ya,this.w7c)}catch(bb){f.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",bb.message);wa.setException(bb);return}try{this.py.voc(Fa).done(()=>
{f.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(bb=>{const {RtcUtils:Eb}=b(1304);this.K7b||f.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",Eb.$fc(bb));wa.mf(null)})}catch(bb){f.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",bb.message),wa.mf(null)}}GV(jb,$a){({RtcUtils:jb}=b(1304));const ya=$a.type,wa=$a.kia,Fa=$a.k9k,bb=$a.Qub;let Eb;this.e2.bV(0,0);try{Eb=jb.qLf(wa,this.w7c)}catch(nb){this.e2.bV(0,
3);f.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",nb.message);bb.setException(nb);return}if(2!==this.I8a)Fa?this.Gqf.$(ya,wa):(this.rA.Oic(),this.e2.bV(0,2)),bb.mf(null);else{var hb=this.vFa.toString();++this.vFa;$a=new ra(()=>this.Rhn(ya,Eb,hb),hb);$a=this.MIj(1,ya).add($a);$a.oOe(nb=>{2===nb&&this.e2.bV(0,6);bb.mf(null)});$a.nOe(()=>{})}}Rhn(jb,$a,ya){let wa=null;const Fa=new ta,bb=new Aa.a;f.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",
this.Uy);if(2!==this.I8a)return this.rA.Oic(),this.e2.bV(0,2),f.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",this.Uy),bb.azg(),bb;this.Ad&&3===jb&&20>this.SGh&&(wa=this.Ad.Pe("WebServiceCall","Send WetContent Update"),this.SGh++);Fa.start();bb.CHd(1);this.py.GV(jb,$a).done(()=>{this.rA.fSg();this.e2.bV(0,1);f.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",ya,this.Uy);bb.fJb(1);Fa&&(Fa.stop(),Fa.ti>
this.xd.ysj?this.e2.bV(0,4):this.e2.bV(0,5))}).fail(Eb=>{const {RtcUtils:hb}=b(1304);this.K7b||(this.rA.Oic(),this.e2.bV(0,3),f.ULS.sendTraceTag(3249507,500,15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",ya,hb.$fc(Eb),this.Uy));bb.fJb(2)}).always(()=>{wa&&wa.stop()});return bb}v1(){this.py.QJn(Object(c.a)(this,this.zca,"onPresenceUpdated"));this.py.PJn(Object(c.a)(this,this.Jgc,"onPersistentStateUpdated"));this.py.OJn(Object(c.a)(this,this.bOc,"onPersistentStateCleared"));
this.py.XJn(Object(c.a)(this,this.Ana,"onUpdateNotificationReceived"))}BGm(jb,$a){this.zca($a.GZa,$a.pre)}zca(jb){this.rA.yPd();this.Jgc(0,jb)}AGm(jb,$a){this.Jgc($a.type,$a.GZa)}iIm(jb,$a){const ya={};for(let wa in $a)ya[wa]=$a[wa].Presence;this.S$i(jb,ya,$a)}Jgc(jb,$a){this.rA.yPd();this.S$i(jb,$a)}S$i(jb,$a,ya=null){var {RtcUtils:wa}=b(1304);if(f.ULS.jT(500,100))for(var Fa in $a);delete $a[this._clientId];if(!fa.a.isEmpty($a)){for(var bb in $a)Fa=bb,$a[Fa]=wa.deserialize($a[bb],"Presence",Fa,!1,
this.w7c);wa=new t.a;bb=(new Date).getTime();for(let Eb in $a){Fa=$a[Eb];let hb=Eb,nb;ya?(nb=ya[hb],nb.Presence=Fa):nb=Object.assign(new W,{Presence:Fa,TimeStamp:bb});wa.$(hb,nb)}this.Kn.njj(jb,wa);switch(jb){case 0:this.OEh||(f.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.Uy),this.OEh=!0,k.AFrameworkApplication.qf&&k.AFrameworkApplication.qf.T2i());this.Kn.bjj($a,[]);break;default:this.Kn.cZm(jb,$a)}}}zGm(jb,$a){this.bOc($a.$me)}bOc(jb){this.rA.yPd();
if(f.ULS.jT(500,100))for(let $a=0;$a<jb.length;++$a);jb.length&&(this.Kn.xZm(jb),this.Kn.bZm(jb),this.Kn.bjj({},jb))}CGm(jb,$a){this.Ana($a.type,$a.kia)}Ana(jb,$a=null){this.xd.esn&&0===jb&&f.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===jb){const ya=k.AFrameworkApplication.K.Ga("OwningFeatureCrewForRtcNotificationKpis");if(ya&&0<ya.length){const wa=new Map;wa.set("AreaName","RealTimeCoauth");wa.set("FeatureName","RtcNotification");wa.set("SkipAria",
"True");X.Health.instance.recordKpiUsage("ContentUpdateNotificationReceived",0,ya,wa)}}this.xd.fsn&&13===jb&&f.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",$a||"<none>"));this.rA.yPd();5===jb?($a=(jb=this.nPm($a))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",jb.reason,jb.reconnectDelay):"Received client reconnection request from the server without params.",f.ULS.sendTraceTag(18637071,
500,50,$a),this.Kn.ATe(jb)):($a=b(1304).RtcUtils.deserialize($a,String.format("UpdateNotification-{0}",za[jb]),null,!1,this.w7c),this.Kn.wZm(jb,$a))}nPm(jb){try{if(!jb||""===jb)return null;const $a=JSON.parse(jb);return new Ba($a[xa.a.mYg],$a[xa.a.udn],$a[xa.a.ydn],$a[xa.a.QZg])}catch($a){return f.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",$a.message),null}}MIj(jb,$a){return this.Ldd.fRl(this.gRl(jb,$a))}gRl(jb,$a){return jb+","+$a}}Object(C.a)(la,"RtcMessageHandler",
Ha,[]);class Sa{Bci(jb,$a=""){const {MaxOutstandingThrottler:ya}=b(1534);return ya.createInstance(jb,$a)}k2k(jb,$a=""){const {MaxRateThrottler:ya}=b(1536);return ya.createInstance(jb,$a)}}Object(C.a)(Sa,"ThrottlerFactory",null,[872]);var Pa=b(1538);class fb{constructor(jb){this.xd=null;this.wh=!1;this.ka=new ka.a;this.onf=new t.a;this.mnf=new t.a;this.dxf=jb;this.btc=this.dxf.Bci($a=>$a.send(),"GlobalMaxOustandingThrottler");this.btc.Lie(()=>{this.ka.raiseEvent("TMUDM")})}init(jb){this.wh||(this.xd=
jb,this.btc.init(this.xd.ROb,this.xd.UTl),this.wh=!0)}fRl(jb){var {MaxRateThrottler:$a}=b(1536),{MaxOutstandingThrottler:ya}=b(1534);this.wh||this.init(new Pa.a($a.Rei,ya.efi,ya.Zei,fb.avm));({value:$a}=this.onf.Ab(jb)).returnValue||(({value:$a}=this.mnf.Ab(jb)).returnValue||($a="MaxOutstandingThrottler-"+jb,$a=this.dxf.Bci(Object(c.a)(this.btc,this.btc.add,"add"),$a),$a.init(this.xd.ROb,this.xd.$um),$a.Lie(()=>{this.ka.raiseEvent("TMUDM")}),this.mnf.add(jb,$a)),ya="MaxRateThrottler-"+jb,$a=this.dxf.k2k(Object(c.a)($a,
$a.add,"add"),ya),$a.init(this.xd.Iwm),this.onf.add(jb,$a));return $a}reset(){for(let jb of this.onf)jb.value.hSg();for(let jb of this.mnf)jb.value.hSg(),jb.value.reset();this.btc.hSg();this.btc.reset()}Lie(jb){this.ka.addHandler("TMUDM",jb)}}fb.avm=1E3;Object(C.a)(fb,"ThrottlerManager",null,[871]);var db;(function(jb){jb[jb.unspecified=0]="unspecified";jb[jb.word=1]="word";jb[jb.excel=2]="excel";jb[jb.powerPoint=3]="powerPoint";jb[jb.test=4]="test";jb[jb.wacFrontEnd=5]="wacFrontEnd";jb[jb.oneNote=
6]="oneNote";jb[jb.visio=7]="visio";jb[jb.officeMobile=8]="officeMobile";jb[jb.cosmosDBChangefeed=9]="cosmosDBChangefeed";jb[jb.last=10]="last"})(db||(db={}));Object(C.b)("RtcClientAppName",db);const Qa=(jb,$a,ya,wa,Fa,bb,Eb,hb,nb=null,Pb=null,bc=null,gb=null)=>{const Lb=F.createInstance(k.AFrameworkApplication.K),Ic=k.AFrameworkApplication.buildVersion?k.AFrameworkApplication.buildVersion:"1.0",vb=wb(jb,$a,Eb,Ic),xb=Lb.hTk?b(1676).RealtimeChannelMetrics.createInstance(vb):new D;var Db=b(1336).FrequentLoggingMetrics.create(Fa);
Lb.Adn&&Db.dzn(Lb.zdn);var ab="";ab=nb&&""!==nb?nb:"/rtc2/";Db.Foi=l.a.JN(ab);const dc=ab+"signalr";nb=ab+"findsession";const tb=M.l0l;ab=new Sa;bc=bc||va.getInstance();f.ULS.shipAssertTag(556867617,500,Lb.Asj<=b(1347).RealtimeChannel.C3i,"Client attempting to override max payload size beyond absolute limit");const yb=Math.min(Lb.Asj,b(1347).RealtimeChannel.C3i);Db.B3i=yb;Db=new la(Lb,new fb(ab),jb,vb,rc=>new J(rc.createHubProxy(tb)),hb,bc,xb,Db,yb);Pb||(Pb=b(1578).FindSessionStrategy.createInstance($a,
Fa,nb,hb,Ic,Eb,jb,vb,bc,bb,wa,gb));Pb.wue=Lb.wue;$a=new G(vb);ya=ya?ya.split(","):null;jb=new (b(1347).RealtimeChannel)(jb,ya,vb,hb,()=>$.hubConnection(dc),Pb,Db,$a,bc,xb,Lb,Fa);jb.init();return jb},wb=(jb,$a,ya)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",jb,ib(db[ya]),ib("browser"),$a),ib=jb=>jb?jb.charAt(0).toLocaleUpperCase()+jb.substring(1,jb.length):jb;b.d(L,"RealtimeChannel",function(){return Ta});class Ta{constructor(jb,$a,ya,wa,Fa,bb,Eb,hb,nb,Pb,bc,gb){this.Mvf=
!1;this.Iia=null;this.A$=new t.a;this.HZc=1;this.$oa=null;this.kj=!1;this.rlf=(new Date(0)).getTime();this.mOh=0;this._clientId=jb;this.uge=$a;this.Jia=0;this.Ad=wa;this.$af=hb;this.dmk=Eb;this.A1j=nb;this.R5j=Fa;this.dxb=bb;this.Uy=ya;this.rA=Pb;this.xd=bc;this.nf=gb;this.Ynk=1>100*Math.random()}get cJb(){return this.dxb.cJb}set cJb(jb){this.dxb.cJb=jb}get rMb(){return this.dmk}get Kn(){return this.A1j}init(){this.Kn.vzk(Object(c.a)(this,this.nre,"disconnectAndCreateNewConnection"));this.Kn.Uzk(Object(c.a)(this,
this.nLm,"onUpdatePersistentStateRequestReceivedInternal"));this.Kn.Tzk(Object(c.a)(this,this.mLm,"onUpdatePersistentStateClearedRequestReceived"));this.nf.KBb(this.rA);k.AFrameworkApplication.QH(()=>{const {FrequentLoggingMetrics:jb}=b(1336);this.rA.iSg();jb.instance&&jb.instance.vxg()});this.Rci();this.qal();this.Kn.Fzk(Object(c.a)(this,this.ALn,"updateConnectionQueryString"))}qal(){try{const ya=$.signalR;if(!ya)throw Error.invalidOperation("Failed to retrieve Signalr object");const wa=ya.version;
if(!wa)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===wa){var jb=ya.transports;if(!jb)throw Error.invalidOperation("Failed to retrieve transports object");var $a=jb.longPolling;if(!$a)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!$a.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");$a.supportsKeepAlive=this.p4k()}}catch(ya){f.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",
ya.message)}}p4k(){return()=>!1}Rci(){const jb=++this.HZc;this.rlf=(new Date(0)).getTime();this.$oa=this.R5j();this.Kn.gZm(this.$oa);this.$oa.stateChanged($a=>{this.VDm($a,jb)});this.$oa.connectionSlow(Object(c.a)(this,this.mKm,"onSlowConnection"));this.$oa.error(Object(c.a)(this,this.eKm,"onSignalRError"));this.$oa.log=Object(c.a)(this,this.fKm,"onSignalRLog")}TVc(jb,$a){return jb!==this.HZc?(f.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",$a),!1):!0}connect(){2!==
this.Jia&&1!==this.Jia&&(f.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.Uy),this.$af.SDm(),x.a.instance.ezn(),this.fta(1,this.Jia),this.eFj())}eFj(){const jb=this.HZc;this.Mvf=!1;this.rA.kkj();this.dxb.WMl(Object(c.a)(this,this.WWk,"connectSignalrConnection"),Object(c.a)(this,this.v9i,"onFailureToConnect"),Object(c.a)(this.rMb,this.rMb.B2l,"initThrottlerManager"),Object(c.a)(this,this.TVc,"verifyConnectionToken"),jb)}v9i(jb=null){this.rA.mkj();let $a=null;
!jb||"documentsessiondeleted"!==($a=jb.toLowerCase())&&"documentsessionexpired"!==$a?this.nre():(f.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",this.Uy,jb),this.disconnect())}nre(jb,$a=null){f.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.Iia);jb=(jb=2===this.Jia||1===this.Jia)&&!this.rMb.K7b;let ya=!0,wa=0;$a&&Object.getType($a)!==Object.getType(Sys.EventArgs.Empty)&&
$a.KVg&&""!==$a.KVg&&(jb=!0,this.dxb.$nn($a.KVg),ya=$a.QZg,wa=$a.reconnectDelay);jb&&this.fta(1,this.Jia);++this.HZc;this.rMb.v1();this.fAn(ya);this.dxb.ybl();this.Rci();jb&&window.setTimeout(Object(c.a)(this,this.eFj,"startConnecting"),Math.min(wa,3E4))}ALn(){let jb=null;const $a=({correlationId:jb}=this.dxb.kxi()).returnValue;this.$oa.qs=$a;f.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.Uy,jb)}WWk(jb){const {FrequentLoggingMetrics:$a}=
b(1336);this.rlf=(new Date).getTime();let ya=null;this.$oa.qs=({correlationId:ya}=this.dxb.kxi()).returnValue;this.xd.rBk&&(this.$oa.url=jb,$a.instance&&($a.instance.R9h=l.a.JN(jb)));let wa=null;this.Ad&&(wa=this.Ad.Pe("WebServiceCall","ConnectToServer"));f.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",this.Uy);jb={};this.uge&&(jb.transport=1===this.uge.length?this.uge[0]:this.uge);jb.pingInterval=null;x.a.instance.xPd(1,0);jb.waitForPageLoad=!1;this.$oa.start(jb,null).done(Fa=>
{this.rA.nkj();x.a.instance.xPd(1,1,!0);f.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",Fa.id,ya)}).fail(Fa=>{const {RtcUtils:bb}=b(1304);f.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1}, callback parameter:{2} for [{3}]",this.dxb.B3,ya,bb.$fc(Fa),this.Uy);this.v9i();this.rA.lkj(Fa);x.a.instance.xPd(1,1,!1);this.Kn.fjj(0,{["CorrelationId"]:ya,["ErrorDetails"]:Fa,["ConnectionState"]:r.a[this.Jia]})}).always(()=>
{const {FrequentLoggingMetrics:Fa}=b(1336);wa&&wa.stop();Fa.instance&&(Fa.instance.sef=!1)})}disconnect(){const {FrequentLoggingMetrics:jb}=b(1336);0===this.Jia?f.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.Uy):(this.rA.qkj(),jb.instance&&(jb.instance.sef=!0),f.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.Uy),this.rMb.K7b=!0,this.$af.FEm(),this.fta(0,this.Jia),this.nre(),this.rMb.K7b=!1)}fAn(jb){const $a=
this.lNk(),ya=this.$oa,wa=this.Iia,Fa=()=>{if(this.Mvf)f.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.Mvf=!0,ya.stop(!0,jb)}catch(bb){f.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",bb.message)}};0<$a?(f.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",wa,$a),window.setTimeout(Fa,$a)):(f.ULS.sendTraceTag(36804372,500,50,"Stopping connection [{0}].",wa),Fa())}lNk(){let jb=0;0===
this.$oa.state&&(jb=this.rlf+Ta.XRn-(new Date).getTime(),0>jb&&(jb=0));return jb}get connectionState(){return this.Jia}QQa(jb){this.Kn.QQa(jb)}IQd(jb){this.Kn.IQd(jb)}fvj(jb){this.jTd(0,jb)}jTd(jb,$a){const ya=new u.a;this.Kn.hjj(jb,$a,ya);return ya.task}ihb(jb){this.Kn.ihb(jb)}tjc(jb){this.Kn.tjc(jb)}Jie(jb){this.Kn.Jie(jb)}EUe(jb){this.Kn.EUe(jb)}Iie(jb){this.Kn.Iie(jb)}DUe(jb){this.Kn.DUe(jb)}bxd(jb){return this.LSl(jb)}G8b(){return this.d5f(0)}d5f(jb){const $a={};for(let ya of this.A$)ya.value.Na(jb)&&
($a[ya.key]=ya.value.J(jb).data);return $a}LSl(jb){return this.A$.Na(jb)&&this.A$.J(jb).Na(0)?this.A$.J(jb).J(0).data:null}nLm(jb,$a){for(let ya of $a.gQn)this.A$.Na(ya.key)||this.A$.$(ya.key,new Ma.a),jb=ya.value,this.A$.J(ya.key).$($a.type,new w(jb.Presence,new Date(jb.TimeStamp))),ya.key===this._clientId&&0===$a.type&&this.Kn.NYm(jb.Presence)}mLm(jb,$a){for(const ya of $a.$me)this.A$.remove(ya)}xrl(){const jb=new Ma.a;if(!this.A$.Na(this._clientId))return jb;for(let $a of this.A$.J(this._clientId))jb.$($a.key,
$a.value.data);return jb}GV(jb,$a=null,ya=!1){const wa=new u.a;this.Kn.TQg(jb,$a,ya,wa);return wa.task}Wea(jb){this.Kn.Wea(jb)}CQc(jb){this.Kn.CQc(jb)}kGb(jb){let $a,ya;return({value:$a}=this.A$.Ab(jb)).returnValue&&({value:ya}=$a.Ab(0)).returnValue?new m(this.PSl(ya),ya.timeStamp):null}Osd(){const jb={};for(let $a of this.A$)$a.value.Ab(0).returnValue&&(jb[$a.key]=this.kGb($a.key));return jb}voc(jb){const $a=new u.a;this.Kn.vZm(jb,$a);return $a.task}get clientId(){return this._clientId}get Hwn(){return this.Ynk}dispose(){const {FrequentLoggingMetrics:jb}=
b(1336);this.kj||(this.rMb.v1(),this.nf.tQd(this.rA),this.rA.iSg(),jb.instance&&jb.instance.vxg(),this.kj=!0)}VDm(jb,$a){this.TVc($a,"StateChangedSignalR")&&this.fta(this.tai(jb.newState),this.tai(jb.oldState))}fta(jb,$a){var {FrequentLoggingMetrics:ya}=b(1336),{ClientToClientMessageTelemetry:wa}=b(1594);if((1!==this.Jia||0!==$a||1!==jb)&&this.Jia!==$a){const Fa=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.Jia,
$a,jb]));f.ULS.sendTraceTag(3290053,500,10,Fa)}if(this.Jia!==jb){switch(jb){case 2:ya.instance&&ya.instance.Stm();this.Iia=this.$oa.id;f.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.Iia,this.Uy);this.srm(this.$oa);f.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");ya=null;this.Ad&&(ya=this.Ad.Pe("WebServiceCall","Receive First Presence"));wa=this.HZc;this.Kn.fZm(Object(c.a)(this,this.TVc,"verifyConnectionToken"),wa,this.$af,Object(c.a)(this,
this.gMf,"clearExistingPersistentState"),this.xrl(),ya);this.xd.vdn&&(ya=100*Math.random()<=this.xd.wdn,b(1594).ClientToClientMessageTelemetry.oGc(this.Kn,this.xd,ya).start());break;case 1:2===$a&&f.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.Iia);break;case 0:if(wa.instance&&wa.instance.stop(),this.rMb.K7b)f.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.Iia);else{1===$a&&(f.ULS.sendTraceTag(7672737,500,
50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",this.Iia),this.rA.rkj());2===$a&&f.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.Iia);this.nre();return}}this.Jia=jb;this.Kn.uYm(jb,$a)}}srm(jb){if(jb&&jb.transport&&jb.transport.name){jb=jb.transport.name;var $a=jb.toLowerCase();
"websockets"===$a?f.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",jb,this.Uy):"serversentevents"===$a?f.ULS.sendTraceTag(4290752,500,50,"Transport name - {0} for [{1}]",jb,this.Uy):"foreverframe"===$a?f.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",jb,this.Uy):"longpolling"===$a?f.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",jb,this.Uy):"mocktransport"!==$a&&f.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",
jb)}else f.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}mKm(){f.ULS.sendTraceTag(3249544,500,50,"Detected that the connection [{0}] is slow",this.Iia)}eKm(){f.ULS.sendTraceTag(3249545,600,10,"SignalR ERROR for connection [{0}];",this.Iia)}fKm(jb){jb=b(1304).RtcUtils.$fc(jb);this.Hwn&&2E3>this.mOh&&!jb.startsWith("Invok")&&!jb.startsWith("Trigger")&&(f.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",jb),this.mOh++)}gMf(){let jb;const $a=[];({value:jb}=this.A$.Ab(this._clientId)).returnValue&&
this.A$.remove(this._clientId);for(let ya of this.A$.keys)Array.add($a,ya);for(const ya of $a)this.A$.remove(ya);jb&&this.A$.$(this._clientId,jb);this.Kn.IYm($a)}tai(jb){switch(jb){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",jb,"Unknown SignalR state");}}PSl(jb){return jb&&jb.timeStamp?(new Date).getTime()-jb.timeStamp.getTime()>(this.xd.kGk?6E4:this.xd.jGk)?2:1:1}static createInstance(jb,$a,ya,wa,Fa,bb,Eb,hb=null,nb=null,Pb=null,
bc=null,gb=null,Lb=null){return Qa(jb,$a,ya,Lb,wa,Fa,bb,Eb,hb,nb,Pb,gb,bc)}}Ta.C3i=31E3;Ta.zzg=8E3;Ta.XRn=15E3;Object(C.a)(Ta,"RealtimeChannel",null,[844,845])},1442:function(C,L,b){b.d(L,"a",function(){return f});C=b(0);class f{constructor(){this.XOh=!1;this.cPa=null;this.Bsh=0;this.Sef=this.Wdi();this.m4d=this.Wdi();this.zRb=this.Xsc=0;this.du=()=>new Date}get JAn(){return this.XOh}Wdi(){const c=Array(6);for(let u=0;u<c.length;u++)c[u]=0;return c}Yzl(){return this.Sef.toString()}wvl(){return this.m4d.toString()}ezn(){this.cPa=
this.du()}xPd(c,u,r=!1){this.JAn||(r&&(this.XOh=!0),r=this.du(),0===c&&5<this.Xsc||1===c&&5<this.zRb||(this.Bsh<c?(1===this.Xsc%2&&(this.Sef[this.Xsc]=-1,this.Xsc++),this.Bsh=c,1===u&&(this.m4d[this.zRb]=-1,this.zRb++),this.m4d[this.zRb]=this.i8g(r),this.zRb++):0===c?(this.Sef[this.Xsc]=this.i8g(r),this.Xsc++):(this.m4d[this.zRb]=this.i8g(r),this.zRb++)))}i8g(c){const u=c.getTime()-this.cPa.getTime();this.cPa=c;return u}static get instance(){f.na||(f.na=new f);return f.na}static set instance(c){f.na=
c}}f.na=null;Object(C.a)(f,"LatencyMetrics",null,[])},1470:function(C,L,b){C=b(0);class f{constructor(){this.Wph=this.Vaf=!1;this.callback=null}WJb(u){this.callback=u;this.KKj()}U2i(u){this.Vaf||(this.Vaf=!0,this.K5j=u,this.KKj())}KKj(){this.Vaf&&this.callback&&!this.Wph&&(this.Wph=!0,this.callback(this.K5j))}}Object(C.a)(f,"CompletionTask",null,[]);b.d(L,"a",function(){return c});class c{constructor(){this.JFh=new f;this.HFh=new f}oOe(u){this.JFh.WJb(u)}nOe(u){this.HFh.WJb(u)}CHd(u){this.JFh.U2i(u)}fJb(u){this.HFh.U2i(u)}azg(){this.CHd(2);
this.fJb(2)}}Object(C.a)(c,"MessageStatus",null,[889])},1533:function(C,L,b){b.d(L,"a",function(){return f});C=b(0);var f;(function(c){c[c.disconnected=0]="disconnected";c[c.connecting=1]="connecting";c[c.connected=2]="connected"})(f||(f={}));Object(C.b)("ChannelConnectionState",f)},1534:function(C,L,b){b.r(L);b.d(L,"MaxOutstandingThrottler",function(){return r});C=b(0);var f=b(41),c=b(62);L=b(1535);var u=b(1470);class r extends L.a{constructor(t,k=""){super(t,k);this.sMc=this.ROb=0;this.ka=new c.a;
this.Xtc=!1;this.Cae=this.H4d=this.n4d=this.cxf=0;this.Y$=[];this.clearTimeout=r.FUf}add(t){this.Ytc||this.init(r.efi,r.Zei);this.i1b++;const k=new u.a;this.tKc?this.nYe(t,k):this.Cae<this.sMc?this.eTd(t,k):(this.nYe(t,k),this.Xtc=!1);return k}eTd(t,k){t=this.WMh(t);const m=this.setTimeout(Object(f.a)(this,this.mHm,"onMessageWaitTimeExpired"),this.ROb);++this.Cae;Array.add(this.Y$,m);const l=this.n4d;t.oOe(x=>{k.CHd(x)});t.nOe(x=>{this.n4d===l&&(this.lHm(l,m),k.fJb(x))})}lHm(t,k){this.n4d===t&&(--this.Cae,
this.clearTimeout(k),Array.remove(this.Y$,k),this.tKc&&this.Hhn())}Hhn(){this.tKc&&!this.Xtc&&(this.cxf=this.setTimeout(Object(f.a)(this,this.Ihn,"sendThrottledMessageFromTimer"),0),this.Xtc=!0)}Ihn(){this.Xtc=!1;if(this.tKc){const t=this.Xfe,k=this.fxc;this.Gkd(!1);this.eTd(t,k)}}mHm(){++this.H4d;this.H4d>Math.floor(this.sMc/2)&&(this.H4d=-1E9,this.ka.raiseEvent("TMUDM"))}Lie(t){this.ka.addHandler("TMUDM",t)}reset(){this.i1b=this.Kdd=this.E0c=this.H4d=0;++this.n4d;for(const t of this.Y$)this.clearTimeout(t);
this.Cae=0;this.Y$=[];this.Gkd(!0);this.Xtc&&(this.clearTimeout(this.cxf),this.cxf=0,this.Xtc=!1)}init(t,k){this.Ytc||(this.ROb=t,this.sMc=k,this.Ytc=!0)}static createInstance(t,k=""){return new r(t,k)}static FUf(t){window.clearTimeout(t)}}r.efi=15E3;r.Zei=5;Object(C.a)(r,"MaxOutstandingThrottler",L.a,[883,884])},1535:function(C,L,b){b.d(L,"a",function(){return c});C=b(0);var f=b(8);class c{constructor(u,r=""){this.E0c=this.Kdd=0;this.Hjf=!1;this.fxc=this.Xfe=null;this.Ytc=!1;this.WMh=u;this.NIj=
r;this.setTimeout=c.QUf;this.i1b=this.Kdd=this.E0c=0}hSg(){0<this.i1b&&0<this.E0c&&f.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.NIj,this.E0c,this.i1b);0<this.i1b&&0<this.Kdd&&f.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.NIj,this.Kdd,this.i1b)}get tKc(){return this.Hjf}nYe(u,r){this.Kdd++;this.Gkd(!0);this.Hjf=!0;this.Xfe=u;this.fxc=r}Gkd(u){this.Hjf=!1;this.fxc&&u&&(this.E0c++,this.fxc.azg());this.fxc=
this.Xfe=null}static QUf(u,r){return window.setTimeout(u,r)}}Object(C.a)(c,"ThrottlerBase",null,[])},1536:function(C,L,b){b.r(L);b.d(L,"MaxRateThrottler",function(){return u});C=b(0);var f=b(41);L=b(1535);var c=b(1470);class u extends L.a{constructor(r,t=""){super(r,t);this.DMc=0;this.s6c=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(r){this.Ytc||(this.DMc=r,this.Ytc=!0)}add(r){this.Ytc||this.init(u.Rei);this.i1b++;const t=this.currentTime(),k=new c.a;this.s6c>t&&(this.s6c=
t);this.tKc?(this.Gkd(!0),this.nYe(r,k)):this.s6c+this.DMc<=t?this.eTd(r,k):(this.nYe(r,k),this.setTimeout(Object(f.a)(this,this.Ghn,"sendThrottledMessage"),this.s6c+this.DMc-t));return k}Ghn(){if(this.tKc){const r=this.Xfe,t=this.fxc;this.Gkd(!1);this.eTd(r,t)}}eTd(r,t){this.s6c=this.currentTime();r=this.WMh(r);r.oOe(k=>{t.CHd(k)});r.nOe(k=>{t.fJb(k)})}static createInstance(r,t=""){return new u(r,t)}}u.Rei=200;Object(C.a)(u,"MaxRateThrottler",L.a,[885,884])},1537:function(C,L,b){b.d(L,"a",function(){return f});
C=b(0);class f{}f.mYg="rr";f.ydn="rd";f.udn="rbp";f.QZg="sa";Object(C.a)(f,"RtcReconnectParams",null,[])},1538:function(C,L,b){b.d(L,"a",function(){return f});C=b(0);class f{constructor(c,u,r,t){this.Iwm=c;this.ROb=u;this.$um=r;this.UTl=t}}Object(C.a)(f,"ThrottlerManagerSettings",null,[])},1578:function(C,L,b){b.r(L);C=b(0);var f=b(8),c=b(41),u=b(75),r=b(1533);class t{}t.DMc="throttling_messageDelay";t.cEd="enabled";t.ROb="throttling_timeToWaitForResponse";t.sMc="throttling_maxNumberOfOutstandingMessages";
t.bHi="throttling_globalMaxNumberOfOutstandingMessages";t.errorMessage="errorMessage";t.yDj="url";t.fXa="queryString";t.B3="connectionString";Object(C.a)(t,"RtcFindSessionOutputFieldNameConstants",null,[]);var k=b(2),m=b(46),l=b(36),x=b(269),w=b(1387),G=b(73),D=b(16),H=b(130);class M{constructor(){this.cHi=this.z3i=this.A3i=this.F3i=0;this.UGe=!1;this.correlationId=this.B3=this.fXa=this.LOf=this.errorMessage=null}get gWk(){return this.LOf+"?"+this.fXa}}Object(C.a)(M,"FindSessionResponse",null,[]);
var J=b(547);class F{constructor(ba,ha,na,da,ia,ma){this.Deb=null;const {FindSessionStrategy:qa}=b(1578);this.skk=ba;ba=String.format("{0}={1}",J.a.clientId,D.a.Xh(da));ba=String.format("{0}&{1}={2}",ba,J.a.userSessionId,D.a.Xh(ia));ba=String.format("{0}&{1}={2}",ba,J.a.dRj,D.a.Xh(na.toString()));ba=String.format("{0}&{1}={2}",ba,J.a.userType,D.a.Xh("1"));ba=String.format("{0}&{1}={2}",ba,J.a.pRj,D.a.Xh(ha));ba=String.format("{0}&{1}={2}",ba,J.a.D7h,D.a.Xh(qa.iTk));(ha=F.u5f(na,ma))&&(ba=String.format("{0}&{1}",
ba,ha));this.S5j=ba}klj(){this.Deb=this.skk()}qpl(){this.Deb&&""!==this.Deb||(this.klj(),f.ULS.sendTraceTag(575784194,500,this.Deb&&""!==this.Deb?50:15,"Query signature delegate called for refresh returned: {0} ",this.Deb));const ba=String.format("{0}={1}",J.a.b8a,D.a.Xh(this.Deb));return String.format("{0}&{1}",ba,this.S5j)}static u5f(ba,ha){return 4===ba?String.format("{0}={1}",J.a.v6i,"1"):ha?ha.xdg():null}}Object(C.a)(F,"FindSessionQueryStringGenerator",null,[]);var A=b(1336),N=b(1442),B=b(1304),
E=b(1538);class P{}P.sll="FSType";Object(C.a)(P,"RtcFindSessionRequestHeaders",null,[]);class T{}T.d_m="polling";Object(C.a)(T,"RtcFindSessionTypes",null,[]);var V=b(1537);class I{}I.lRn="RTC-TokenProofkey";I.Khm="RTC-IsWacJsBootFsRequest";Object(C.a)(I,"RtcRequestHeaders",null,[]);b.d(L,"FindSessionStrategy",function(){return R});class R{constructor(ba,ha,na,da,ia,ma,qa,ka,va,ja,Ma,Ha,X=null){this.kDh=(new Date(0)).getTime();this.WEh=0;this.L$d=!1;this.gNh=null;this.JSg=36E5;this.wrc=R.KMi;this.d1c=
0;this.Njc=null;this.I8a=0;this.qRc=this.T9h=null;this.tlk=[t.cEd,t.errorMessage,t.yDj,t.B3,t.fXa,t.bHi,t.sMc,t.ROb,t.DMc];this.slk=[t.cEd,t.errorMessage];this.B3=this.cJb=null;this.pwh=new F(Ma?Ma:()=>k.AFrameworkApplication.Fk,ia,ma,qa,ba,ha);this.RYc=Ha;this.Ad=da;this.nf=ha;this.Wef=na;this.Uy=ka;this.Kn=va;this.F1c=X;this.qwh=!1;this.wue=9E4;ja&&ja.execute(W=>{W.UBb(()=>{f.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.Uy);this.pwh.klj()})});
2>=100*Math.random()&&(this.JSg=3E5);A.FrequentLoggingMetrics.instance&&(A.FrequentLoggingMetrics.instance.Cri=this.JSg)}$nn(ba){this.qRc=ba}init(){this.Kn.zzk(Object(c.a)(this,this.zan,"resetGetMachineIdDelay"));this.Kn.QQa(Object(c.a)(this,this.fta,"onConnectionStateChanged"))}fta(ba,ha){this.I8a=ha.newState;2===ha.newState&&(this.d1c=0)}kxi(){let ba;ba=this.Njc.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.Njc.fXa,R.lQf,D.a.Xh(ba)),correlationId:ba}}WMl(ba,ha,na,da,ia){this.Wgn(()=>
{da(ia,"GetMachineIdSuccess")&&(f.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.B3,this.Uy),ba(this.gNh),na(this.hRl()))},ma=>{da(ia,"GetMachineIdFailure")&&(f.ULS.sendTraceTag(4060129,500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.Uy),ha(ma))},da,ia)}ybl(){this.l7h();this.E1l()}Wgn(ba,ha,na,da){f.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.B3);if(this.B3)ba();
else{var ia=this.xMk();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(ba,ha,na,da)},ia)}}sendFindSessionRequestToServerInternal(ba,ha,na,da){na(da,"RequestMachineId")&&(this.kDh=(new Date).getTime(),na=l.a.me(),this.lxe(ia=>{const ma=l.a.me();this.Hdj(ia);this.n1g();ba();ia=l.a.me()-ma;f.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",ia)},ia=>{const ma=l.a.me();this.l7h();A.FrequentLoggingMetrics.instance&&A.FrequentLoggingMetrics.instance.bV(2,3);ha(ia);
ia=l.a.me()-ma;f.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",ia)},!1),na=l.a.me()-na,f.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",na))}E1l(){this.wrc+=R.zFl;this.wrc=Math.min(this.wrc,R.Ium)}xMk(){var ba=(new Date).getTime();ba=this.kDh+this.wrc-ba;0>ba&&(ba=0);return ba}Hdj(ba){try{this.Njc=ba,this.cJb=ba.gWk,this.B3=ba.B3,this.T9h=ba.fXa,this.gNh=ba.LOf}catch(ha){f.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",
ha.toString())}}l7h(){this.B3=null;this.m7h()}n1g(){this.m7h();this.L$d=!0;this.WEh=window.setTimeout(Object(c.a)(this,this.K1m,"refreshMachineId"),this.JSg)}m7h(){this.L$d&&(window.clearTimeout(this.WEh),this.L$d=!1)}K1m(){this.L$d=!1;this.lxe(ba=>{const ha=this.T9h!==ba.fXa,na=this.B3!==ba.B3,da=this.B3;this.Hdj(ba);0!==this.I8a&&(na?(f.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",da||"null",ba.B3),this.Kn.ATe()):(this.Kn.kZm(ha,na),
this.n1g()))},()=>{A.FrequentLoggingMetrics.instance&&A.FrequentLoggingMetrics.instance.bV(2,3);this.n1g()},!0)}zan(){this.wrc=R.KMi}hRl(){return new E.a(this.Njc.F3i,this.Njc.A3i,this.Njc.z3i,this.Njc.cHi)}rGn(ba){if(Object.getType(ba)!==Object)return null;for(let ha in ba);return this.Q0k(ba)}Q0k(ba){if(!(t.cEd in ba))return null;const ha=ba[t.cEd];var na=ha?this.tlk:this.slk;for(const da of na)if(!(da in ba))return null;na=Object.assign(new M,{UGe:ba[t.cEd],errorMessage:ba[t.errorMessage],correlationId:H.a.create().toString()});
ha&&(na.LOf=ba[t.yDj],na.fXa=ba[t.fXa],na.B3=ba[t.B3],na.cHi=ba[t.bHi],na.z3i=ba[t.sMc],na.A3i=ba[t.ROb],na.F3i=ba[t.DMc]);return na}Zzl(ba,ha){f.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.F1c.Goi.continueWith(()=>{this.F1c.Goi.result?(f.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),ba(this.F1c.Hoi)):(f.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),ha(this.F1c.Hoi))})}pqj(ba,ha,
na,da,ia=!1){return ma=>{N.a.instance.xPd(0,1);ba&&ba.stop();this.RYc=this.qRc=null;this.c1i(ma.data,!0,ha);var qa=B.RtcUtils.deserialize(ma.data.Rd,"FindSession",null);if(qa)if(qa=this.rGn(qa)){if(qa.UGe&&qa.fXa&&qa.B3){f.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.Uy);this.Pmm(ma.data);na(qa);return}ha.FindSessionFailureReason="FindSessionInvalidResponse";ha.IsRtcEnabled=qa.UGe;ha.IsQueryStringEmpty=!qa.fXa;ha.IsConnectionStringEmpty=!qa.B3;f.ULS.sendTraceTag(4290720,
500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.Uy,qa.UGe,!qa.fXa,!qa.B3)}else ha.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",f.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.Uy);else ha.FindSessionFailureReason="FindSessionDeserializeServerResponseFailed",f.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",
this.Uy);this.gjj(ha,ia);da(null)}}hqj(ba,ha,na,da=!1){return ia=>{N.a.instance.xPd(0,1);ba&&ba.stop();this.RYc=this.qRc=null;this.c1i(ia.data,!1,ha);let ma=null;var qa="unknown";let ka="unknown";ia.data&&((qa=ia.data.Ri)&&R.mSd in qa&&(ma=qa[R.mSd].toString()),qa=w.a[ia.data.status],ka=ia.data.Ge.toString());ha.FindSessionFailureReason="FindSessionRequestFailed";ha.HttpErrorCode=ka;ha.HttpErrorStatus=qa;ha[R.mSd]=ma;f.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",
qa,ka,this.Uy,ma,da);this.gjj(ha,da);na(ka)}}lxe(ba,ha,na=!1){let da=null;f.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.Uy);const ia={};var ma=this.pwh.qpl();ia[x.a.tP]=H.a.create().toString();this.qRc&&""!==this.qRc?ma=String.format("{0}&{1}={2}",ma,V.a.mYg,this.qRc):this.RYc&&""!==this.RYc&&(ma=String.format("{0}&{1}={2}",ma,V.a.mYg,this.RYc),ia[I.lRn]="True",ia[I.Khm]="True");ma=this.Wef+"?"+ma;na&&(ia[P.sll]=T.d_m);const qa={};qa.IsNetworkOfflineBeforeSendRequest=
this.nf.xsa;qa.HasAvailableConnectionsBeforeSendRequest=this.nf.xHc;qa.MaxConnectionsAllowed=this.nf.jJb;qa.IsRefreshMachineId=na;this.F1c&&!this.qwh?(this.Zzl(this.pqj(null,qa,ba,ha,na),this.hqj(null,qa,ha,na)),this.qwh=!0):(this.Ad&&(da=this.Ad.Pe("WebServiceCall","GetMachineIdFromTheServer")),A.FrequentLoggingMetrics.instance&&A.FrequentLoggingMetrics.instance.bV(2,0),0>this.nf.MBb(ma,1,null,ia,[R.Voe,R.mSd,R.rJd,R.lYg,R.G5i,R.J7i,R.I7i],!1,1,this.pqj(da,qa,ba,ha,na),this.hqj(da,qa,ha,na),null,
null,!1,null,this.wue,"3",null,!0)&&(5<this.d1c&&200>this.d1c&&f.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.d1c),window.setTimeout(()=>{this.d1c++;ha("-1")},1E3)))}c1i(ba,ha,na){na||(na={});na.IsNetworkOfflineAfterRequestComplete=this.nf.xsa;na.IsRequestSucceeded=ha;ba&&(na.EnqueueTime=ba.Nfa,na.InvokedTime=ba.px,na.CompletedTime=ba.hE,ba.Ri&&(R.Voe in ba.Ri&&(na.CorrelationId=ba.Ri[R.Voe]),R.rJd in
ba.Ri&&(na[R.rJd]=ba.Ri[R.rJd])));f.ULS.sendTraceTag(38633565,500,ha?50:15,B.RtcUtils.$fc(na))}gjj(ba,ha){ba||(ba={});ba.ConnectionState=r.a[this.I8a];ha||this.Kn.fjj(1,ba)}Pmm(ba){try{var ha=!1,na=!1,da=ba.Ri,ia=m.a.JN(ba.request.get_url());if(da&&R.lYg in da){const ja=da[R.lYg].toString().toLocaleLowerCase();na="true"===ja;ha="false"===ja}da=!1;const va=0<=ia.toLocaleLowerCase().indexOf("collab");na&&!va?da=!0:ha&&va&&(da=!0);if(da){ha={};ha.HostName=ia;ha.Status=w.a[ba.status];ha.HttpStatus=ba.Ge.toString();
var ma=ba.request.get_headers();for(let ja in ma){var qa=ma[ja];(ia=ja)&&0<ia.length&&(na=0,qa&&(na=qa.toString().length),ha["r_"+ia]=na)}if(ba.Ri){const ja=new u.a;ja.add(R.Voe);ja.add(R.rJd);ja.add(R.mSd);ja.add(R.J7i);ja.add(R.I7i);ja.add(R.G5i);R.qwk(ha,ba.Ri,ja)}R.fwk(ba.request.get_url(),ha);var ka=G.a.toJSON(ha);f.ULS.sendTraceTag(559437006,500,15,ka)}}catch(va){f.ULS.sendTraceTag(559437007,500,10,"DomainLandingIncorretDC exception[{0}]",va.toString())}}static createInstance(ba,ha,na,da,ia,
ma,qa,ka,va,ja,Ma,Ha=null){return R.J1k(ba,ha,na,da,ia,ma,qa,ka,va,ja,Ma,Ha)}static J1k(ba,ha,na,da,ia,ma,qa,ka,va,ja,Ma,Ha=null){ba=ba||H.a.create().toString();ba=new R(ba,ha,na,da,ia,ma,qa,ka,va,ja,null,Ma,Ha);ba.init();return ba}static qwk(ba,ha,na){for(let da of na)da in ha&&(ba[da]=ha[da])}static fwk(ba,ha){if(ba){var na=ba.indexOf("?");if(-1!==na)for(ba=ba.substr(na+1).split("&"),na=0;na<ba.length;++na){var da=ba[na].split("=");if(2===da.length){const ia=da[0];if(ia&&0<ia.length){let ma=0;if(da=
da[1])ma=da.length;ha["q_"+ia]=ma}}}}}}R.zFl=3E3;R.Ium=3E5;R.iTk="1.0";R.KMi=1E3;R.Voe="X-CorrelationId";R.lQf="corrid";R.mSd="RtcErrorCode";R.rJd="X-OfficeCluster";R.lYg="X-NewEnv";R.G5i="X-MSEdge-Ref";R.I7i="X-OFFICEFD";R.J7i="X-OfficeFE";Object(C.a)(R,"FindSessionStrategy",null,[870])},1594:function(C,L,b){b.r(L);C=b(0);var f=b(8),c=b(41),u=b(407),r=b(51),t=b(75);class k{constructor(l){this.messageId=l;this.Khn=(new Date).getTime();this.Mug=new t.a}}Object(C.a)(k,"MessageLatencyDetails",null,[]);
b.d(L,"ClientToClientMessageTelemetry",function(){return m});class m{constructor(l,x,w){this.O0a=null;this.Vmf=this.Vtf=0;this.xd=x;this.KFh=w;this.Zbd=!1;this.Kn=l;this.Kn.Wea(Object(c.a)(this,this.A_m,"receiveMessage"))}start(){if(this.KFh&&!this.Zbd){const l=this.xd.Dsj;this.Vmf=this.xd.zsj;l<=this.Vmf?(f.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",
this.xd.Dsj,this.xd.zsj),this.KFh=!1):(this.Zbd=!0,this.Vtf=window.setInterval(Object(c.a)(this,this.Eh,"sendMessage"),l))}}Eh(){if(this.Zbd){const l=r.a.create().toString();this.O0a=new k(l);this.Kn.TQg(16,l,!1,new u.a);window.setTimeout(()=>{this.Kom(l)},this.Vmf)}}Kom(l){this.O0a&&this.O0a.messageId===l&&(0<this.O0a.Mug.count?(l=this.O0a.Mug.toArray().join(","),f.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",l)):f.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),
this.O0a=null)}stop(){this.Vtf&&(window.clearInterval(this.Vtf),this.Zbd=!1)}A_m(l,x){16===x.type?this.Kn.TQg(17,x.kia,!1,new u.a):17===x.type&&this.Zbd&&x.kia&&this.dVm(x.kia)}dVm(l){l&&this.O0a&&l.toString()===this.O0a.messageId&&(l=(new Date).getTime()-this.O0a.Khn,this.O0a.Mug.add(l))}static get instance(){return m.na}static oGc(l,x,w){return m.instance||(m.na=new m(l,x,w))}}m.na=null;Object(C.a)(m,"ClientToClientMessageTelemetry",null,[])},1675:function(C,L,b){b.d(L,"a",function(){return f});
C=b(0);class f extends Sys.EventArgs{constructor(c,u){super();this.GZa=c;this.pre=u}}Object(C.a)(f,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1676:function(C,L,b){b.r(L);b.d(L,"RealtimeChannelMetrics",function(){return t});C=b(0);var f=b(8),c=b(175),u=b(73),r=b(1304);class t{constructor(){this.ZGh=this.$Gh=this.aHh=this.VGh=this.UGh=this.WGh=this.B8c=this.Aof=0;this.H6d=this.Ilf=this.u6c=this.ylf=this.zlf=this.qlf=this.szb=this.$5c=this.guc=this.plf=this.G6d=this.Ksc=null;this.hnf=this.u7c=this.eNh=
this.Pqh=0;this.LFh=!1;this.kkj=this.NRg;this.nkj=this.QRg;this.mkj=this.PRg;this.rkj=this.XRg;this.qkj=this.WRg;this.iSg=this.jSg;this.fSg=this.gSg;this.Oic=this.dSg;this.yPd=this.eSg;this.lkj=this.ORg;this.Zsa=this.RDg;this.X6a=this.VDg}NRg(){this.Aof++;this.plf=new Date;this.Ksc||(this.Ksc=new Date)}QRg(){this.B8c++;this.szb=new Date;this.G6d||(this.G6d=this.szb);this.u6c=this.szb;this.wWk()}PRg(){this.WGh++;this.qlf=new Date}XRg(){this.UGh++;this.guc=new Date}WRg(){this.VGh++;this.$5c=new Date}gSg(){this.zlf=
new Date;this.aHh++}eSg(){this.H6d||(this.H6d=new Date);this.$Gh++}dSg(){this.ylf=new Date;this.ZGh++}jSg(){!this.LFh&&this.Aof&&(f.ULS.sendTraceTag(39321871,500,15,u.a.toJSON(this.vUk())),this.LFh=!0)}ORg(k){let m,l;({eLi:k,fLi:m,exception:l}=r.RtcUtils.oil(k));k&&k!==c.a.HD&&(f.ULS.sendTraceTag(40157596,500,15,u.a.toJSON({["HttpErrorCode"]:k,["HttpErrorStatus"]:m,["Exception"]:l})),c.a.QBd(k)&&this.Pqh++,c.a.AEd(k)&&this.eNh++)}RDg(){this.Ilf=new Date}VDg(){this.guc=this.u6c=new Date}vUk(){return{["numberOfConnectionAttempts"]:this.Aof,
["numberOfSuccessfulConnections"]:this.B8c,["numberOfFailedConnections"]:this.WGh,["numberOfDisconnectedConnections"]:this.UGh,["numberOfExplicitDisconnectedConnections"]:this.VGh,["numberOfSentMessages"]:this.aHh,["numberOfReceivedMessages"]:this.$Gh,["numberOfLostMessages"]:this.ZGh,["firstConnectionAttempt"]:this.Ksc?this.Ksc:null,["firstMessageReceived"]:this.H6d?this.H6d:null,["firstConnectionSuccess"]:this.G6d?this.G6d:null,["lastConnectionAttempt"]:this.plf?this.plf:null,["lastConnectionSuccess"]:this.szb?
this.szb:null,["lastConnectionFailure"]:this.qlf?this.qlf:null,["lastMessageSent"]:this.zlf?this.zlf:null,["lastMessageLost"]:this.ylf?this.ylf:null,["lastDisconnect"]:this.guc?this.guc:null,["lastExplicitDisconnect"]:this.$5c?this.$5c:null,["lastTimeOnline"]:this.u6c?this.u6c:null,["lastTimeOffline"]:this.Ilf?this.Ilf:null,["maxDisconnectedTimeMs"]:this.u7c,["maxExplicitDisconnectedTimeMs"]:this.hnf,["clientConnectionErrors"]:this.Pqh,["serverConnectionErrors"]:this.eNh}}wWk(){this.Ksc&&1===this.B8c&&
(this.u7c=Math.max(this.u7c,this.szb.getTime()-this.Ksc.getTime()));this.guc&&1<this.B8c&&(this.u7c=Math.max(this.u7c,this.szb.getTime()-this.guc.getTime()));this.$5c&&1<this.B8c&&(this.hnf=Math.max(this.hnf,this.szb.getTime()-this.$5c.getTime()))}static createInstance(k){t.na||(t.na=new t,f.ULS.sendTraceTag(39321870,500,50,"RealtimeChannelMetrics initialized for client {0}",k));return t.na}}t.na=null;Object(C.a)(t,"RealtimeChannelMetrics",null,[869,178])},1677:function(C,L,b){b.d(L,"a",function(){return f});
C=b(0);class f extends Sys.EventArgs{constructor(c,u){super();this.type=c;this.GZa=u}}Object(C.a)(f,"PersistentStateUpdateEventArgs",Sys.EventArgs,[])},1678:function(C,L,b){b.d(L,"a",function(){return f});C=b(0);class f extends Sys.EventArgs{constructor(c){super();this.$me=c}}Object(C.a)(f,"PersistentStateClearedEventArgs",Sys.EventArgs,[])},1798:function(C,L,b){b.r(L);var f=b(0),c=b(41);class u{constructor(Ja,sb){this.C$=null;this.n$c=Ja;this.vjk=sb}init(){this.n$c.continueWith(()=>{this.C$=this.n$c.result;
this.C$.Cyc(Object(c.a)(this,this.p8,"onUsersUpdated"))})}p8(){u.zFf(this.C$.llb())&&(this.C$.FUe(Object(c.a)(this,this.p8,"onUsersUpdated")),this.vjk.IsRealCoauthSession=!0)}get qem(){return this.C$?u.zFf(this.C$.llb()):!1}static zFf(Ja){let sb=null;for(const ub of Ja)if(ub)if(Ja=ub.isAnonymous||!ub.email?ub.clientId:ub.email.toUpperCase(),!sb)sb=Ja;else if(sb!==Ja)return!0;return!1}}Object(f.a)(u,"CoauthTelemetry",null,[758]);var r=b(8),t=b(407),k=b(70),m=b(2),l;(function(Ja){Ja[Ja.badStatePreventedTelemetry=
0]="badStatePreventedTelemetry";Ja[Ja.notImplemented=1]="notImplemented";Ja[Ja.renderHandled=2]="renderHandled";Ja[Ja.renderHandledWithVeto=3]="renderHandledWithVeto"})(l||(l={}));Object(f.b)("CoauthorGalleryTelemetryEndResult",l);var x=b(79),w=b(73),G=b(113);class D{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf){this.FJh=this.hrh=this.FG=null;this.Oda=Ja;this.afe=new t.a;this.va=ub;this.Faf=sb;this.M5=Cc;this.ae=ic;this.Kqf=Ud;this.eAb=ae;this.K2j=He;this.Iyh=this.Cyh=!1;this.bge=0;this.erh=1;this.SQb=
lf;this.Fed=this.va.ea("PeoplesWellExtraButtonInfoIsEnabled");this.sEa=Object(k.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get DFj(){return this.afe.task}init(){G.Task.WAA.call(null,this.eAb,this.Faf,this.Kqf).continueWith(()=>{this.FG=this.eAb.result;this.hrh=this.Faf.result;this.FJh=this.Kqf.result;G.Task.WAA.call(null,this.Faf.result.NAc,this.Kqf.result.SIj).continueWith(()=>{this.erh=this.hrh.NAc.result;this.bge=this.FJh.SIj.result;this.FG.Cyc(Object(c.a)(this,
this.kPe,"onUsersUpdatedEventListener"));this.FG.llb().length&&this.p8()})})}kPe(){this.p8()}p8(){this.K2j(this.FG.llb())?(this.FG.FUe(Object(c.a)(this,this.kPe,"onUsersUpdatedEventListener")),this.lFm(this.Cyh)):this.afe.xM(1);this.Cyh=!0}lFm(Ja){this.Iyh?this.DFj.continueWith(()=>{r.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",l[this.DFj.result])}):(this.Iyh=!0,this.LVm(0===this.erh&&!Ja))}LVm(Ja){Ja?this.M5.Ik(4,Object(c.a)(this,this.FHg,"onInteractiveReady")):
this.afe.xM(1)}FHg(){const Ja=this.ae.xw("AppInitStatus_interactivityReady");r.ULS.shipAssertTag(42259235,325,!!this.bge);const sb=this.bge-Ja,ub={};ub.InteractiveTime=Ja;ub.ReactRenderComplete=this.bge;ub.HadTabSwitch=this.SQb();ub.IsModernGallery=this.Fed;r.ULS.sendTraceTag(594883104,325,50,w.a.toJSON(ub));this.Fed?(r.ULS.sendTraceTag(42062997,325,15,sb.toString()),this.afe.xM(this.xRn(sb)?3:2)):r.ULS.sendTraceTag(594883103,325,15,sb.toString())}xRn(Ja){const sb=Ja>this.va.jb("CoauthorGalleryTimeToRenderDurationMs",
1E4),ub="Word"===this.sEa;if(this.SQb())return r.ULS.sendTraceTag(50455714,325,50,sb.toString()),!1;ub&&x.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);sb&&(ub&&x.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),r.ULS.sendTraceTag(42062998,325,15,Ja.toString()));return sb}}Object(f.a)(D,"CoauthorGalleryTelemetry",null,[757]);class H{constructor(Ja){this.FG=null;this.a4d={};this.Tbe=
{};this.M3c=null;this.eAb=Ja}Zye(Ja){const sb=new t.a;this.init().continueWith(()=>{Ja in this.a4d?sb.xM(this.a4d[Ja]):this.Tbe[Ja]=sb});return sb.task}init(){if(this.M3c)return this.M3c.task;this.M3c=new t.a;this.eAb.continueWith(()=>{this.FG=this.eAb.result;this.FG.Cyc(Object(c.a)(this,this.p8,"onUsersUpdated"));this.IPj();this.M3c.mf(null)});return this.M3c.task}IPj(){const Ja=this.FG.llb();Ja.sort(Object(c.a)(this,this.aWk,"comparePresenceUsers"));this.a4d={};for(let sb=0;sb<Ja.length&&Ja[sb]&&
Ja[sb].p6a;sb++)this.Zvk(this.a4d,Ja[sb].clientId,sb)}Zvk(Ja,sb,ub){Ja[sb]=ub;sb in this.Tbe&&(this.Tbe[sb].xM(ub),delete this.Tbe[sb])}p8(){this.IPj()}aWk(Ja,sb){return Ja.p6a>sb.p6a?1:Ja.p6a<sb.p6a?-1:0}}Object(f.a)(H,"CoauthorPositionFinder",null,[756]);var M=b(75);class J{constructor(Ja,sb,ub,Cc){this.C$=null;this.ydf=this.Rnf=!1;this.n$c=Ja;this.owf=sb;this.va=ub;this.Juc=Cc}get qei(){return this.va.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}get KUl(){return this.va.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GuestCoauthFloodgateEnabled",
!1)}init(){this.n$c.continueWith(()=>{this.C$=this.n$c.result;this.C$.Cyc(Object(c.a)(this,this.p8,"onUsersUpdated"))})}p8(){this.tUk(this.C$.llb());!this.Rnf||this.qei&&!this.ydf||this.C$.FUe(Object(c.a)(this,this.p8,"onUsersUpdated"))}tUk(Ja){const sb=new M.a;let ub=0;for(const Cc of Ja)Cc&&Cc.isAnonymous&&(m.AFrameworkApplication.Yi("70eb6120;2gfeb930"),this.qei&&!this.ydf&&(sb.contains(Cc.userName)?(r.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected"),this.ydf=!0):sb.add(Cc.userName)),
Cc.clientId===this.Juc||this.Rnf||(ub++,2<=ub&&this.Som()))}Som(){r.ULS.sendTraceTag(527556870,302,50,"Multiple guests simultaneously coauthoring");this.Rnf=!0;this.KUl&&this.owf&&this.owf.continueWith(()=>{window.setTimeout(()=>{this.owf.result.logActivity("MultipleGuestsCoauthoring",null)},5E3)})}}Object(f.a)(J,"GuestCoauthTelemetry",null,[]);var F=b(245);class A{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(f.a)(A,"PL",null,[]);var N=b(32);
class B{constructor(){this.ct=this.vt=this.d=0}static vvj(Ja,sb,ub){const Cc=new B;Cc.d=Ja;Cc.vt=sb;Cc.ct=ub;return N.c(Cc)}}Object(f.a)(B,"VD",null,[]);var E=b(295);class P{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf){this.lNh=!1;this._id=Ja;this.lh=sb;this.Pp=ub;this.Snf=Cc;this.$wf=ic;this.J1b=Ud;this.cSb=ae;this.taf=He;this.SQb=lf;this.sEa=Object(k.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}A4e(Ja){G.Task.WAA(this.Snf,this.$wf).continueWith(()=>{if(this.Snf.result<=
this.$wf.result)Ja.xM(!1);else{var sb=this.Pp-this.lh,ub=new A;ub.id=this._id;ub.et=this.Pp;ub.st=this.lh;ub.d=this.Pp-this.lh;ub.mp=this.Snf.result;ub.tp=this.$wf.result;ub.ct=this.Gul(this.taf);ub.vc=this.SQb();var Cc=N.c(ub),ic="Word"===this.sEa;r.ULS.sendTraceTag(42078597,302,15,Cc);if(ic){const Ud=new Map;Ud.set("data",Cc);x.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Ud)}sb>this.J1b.value&&!this.lNh&&!ub.vc&&(this.lNh=!0,Ja.xM(!0),ub=Object.assign(new E.a,{inStaging:!0,
extendedProperties:new Map}),ub.extendedProperties.set("data",Cc),ic&&x.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,ub),sb<this.cSb.value&&r.ULS.sendTraceTag(42078598,302,15,B.vvj(sb,this.J1b.value,this.cSb.value)));Ja.task.isCompleted||Ja.xM(!1)}})}Gul(Ja){switch(Ja){case 2:return"NonWac";case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(f.a)(P,"PresenceLatencyActivityLogger",null,[]);class T{constructor(Ja,sb,ub){this.gqh=
this.crh=this.J3d=this.$3d=this.hqc=0;this._id=Ja;this.J1b=sb;this.cSb=ub;this.sEa=Object(k.a)(String,m.AFrameworkApplication.sessionStartInfoSettings.Application)||""}get xXh(){return this.hqc}set xXh(Ja){this.hqc=Ja;this.pLf()}get f8h(){return this.$3d}set f8h(Ja){this.$3d=Ja;this.pLf()}get O4h(){return this.J3d}set O4h(Ja){this.J3d=Ja;this.pLf()}get g8h(){return 0!==this.crh}get P4h(){return 0!==this.gqh}pLf(){!this.g8h&&this.hqc&&this.$3d&&(this.crh=this.A4e(this.$3d,"CoauthGalleryLightupDurationTooLong"));
!this.P4h&&this.hqc&&this.J3d&&(this.gqh=this.A4e(this.J3d,"CanvasPresenceLightupDurationTooLong"))}A4e(Ja,sb){const ub=Ja-this.hqc;var Cc=new A;Cc.id=this._id;Cc.et=Ja;Cc.st=this.hqc;Cc.d=ub;var ic=N.c(Cc);Ja="Word"===this.sEa;Cc="CanvasPresenceLightupDurationTooLong"===sb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===sb?r.ULS.sendTraceTag(572289499,302,15,ic):r.ULS.sendTraceTag(571524118,302,15,ic);if(Ja){var Ud=new Map;Ud.set("data",ic);
x.Health.instance.recordKpiUsage(Cc,0,"wordcollabrel",Ud)}return ub>this.J1b.value?(Ud=Object.assign(new E.a,{inStaging:!0,extendedProperties:new Map}),Ud.extendedProperties.set("data",ic),ic=ub<this.cSb.value,Ud.extendedProperties.set("cash",ic?"true":"false"),Ja&&x.Health.instance.recordKpiFailure(Cc,sb,!1,!0,Ud),r.ULS.sendTraceTag(572289500,302,15,B.vvj(ub,this.J1b.value,this.cSb.value)),ic?2:1):3}}Object(f.a)(T,"PresenceLightupLatencyLogger",null,[]);var V=b(37),I=b(148);class R{constructor(Ja,
sb,ub,Cc,ic,Ud,ae=null,He=null,lf=null){this.vKh={};this.Eaf={};this.NCh=new M.a;this.N3c=this.FG=this.Jj=null;this.GOh=this.FOh=0;this.J1b=new F.a(()=>ae.DI("PresenceBootLatencyThreshold",1E4));this.cSb=new F.a(()=>ae.DI("PresenceBootLatencyCutoffThreshold",6E4));this.Urk=new F.a(()=>ae.DI("PresenceLightupLatencyThreshold",2E3));this.I6j=new F.a(()=>ae.DI("PresenceLightupLatencyCutoffThreshold",1E4));this.Cjk=Cc;this.grh=Ja;this.sMh=sb;this.eAb=ub;this.ae=ic;this.Juc=He;this.SQb=Ud;this.Jc=lf;this.uph=
!1;this.init()}eqd(Ja,sb,ub=null,Cc=0){ub&&(r.ULS.shipAssertTag(42274970,302,!this.Juc||this.Juc===ub,"_myClientId is already set and you are trying to update it to something different"),this.Juc=ub);const ic=new t.a;this.init().continueWith(()=>{this.sIm(Ja);this.afl(ic,Ja,sb,Cc)})}get I5i(){return this.Juc||"{"+m.AFrameworkApplication.userSessionId+"}"}init(){if(this.N3c)return this.N3c.task;this.N3c=new t.a;this.SQb()&&r.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.grh.continueWith(()=>
{const Ja=this.grh.result,sb=Ja.NAc,ub=Ja.Mxm;ub.continueWith(()=>{sb.continueWith(()=>{this.Jc&&this.Jc.addQosPillar("RealTimeCoauth");this.O7g(sb.result,ub.result);this.N3c.mf(null)})})});this.sMh.continueWith(()=>{this.Jj=this.sMh.result;this.Jj.QQa(Object(c.a)(this,this.sJm,"onRtcConnection"));this.Jj.Wea(Object(c.a)(this,this.yDm,"onCoauthorBootReceived"))});this.eAb.continueWith(()=>{this.FG=this.eAb.result;this.FG.Cyc(Object(c.a)(this,this.kPe,"onUsersUpdatedEventListener"));0<this.FG.llb().length&&
this.p8()});return this.N3c.task}Dui(){return this.ae.C3(V.a.Eda)?this.ae.xw(V.a.Eda):I.a.cya?window.performance.timing.fetchStart:-1}sJm(Ja,sb){this.uph||2!==sb.newState||(Ja=Date.now()-this.Dui(),sb={},sb.clientId=this.I5i,sb.bootTime=Ja,this.uph=!0,this.Jj.GV(15,sb))}yDm(Ja,sb){if(15===sb.type){Ja=Date.now();sb=sb.kia;var ub=sb.bootTime;this.N9f(sb.clientId).xXh=Ja-ub}}kPe(){this.p8()}p8(){const Ja=Date.now();var sb=this.FG.llb();const ub=new M.a;for(const Cc of sb)this.NCh.contains(Cc.clientId)||
(this.NCh.add(Cc.clientId),ub.add(Cc.clientId));if(0<ub.count)for(let Cc of ub)sb=this.N9f(Cc),sb.g8h||(sb.f8h=Ja)}sIm(Ja){Ja=this.N9f(Ja);Ja.P4h||(Ja.O4h=Date.now())}N9f(Ja){return Ja in this.Eaf?this.Eaf[Ja]:this.Eaf[Ja]=new T(Ja,this.Urk,this.I6j)}O7g(Ja,sb=0){this.FOh=Ja;this.GOh=sb?sb:(new Date).getTime()}afl(Ja,sb,ub,Cc){ub=ub?ub.getTime():(new Date).getTime();sb in this.vKh?Ja.wM():(Cc=new P(sb,this.bPl(),ub,this.Zye(this.I5i),this.Zye(sb),this.J1b,this.cSb,Cc,this.SQb),this.vKh[sb]=Cc,Cc.A4e(Ja))}bPl(){return 1===
this.FOh?this.GOh:this.Dui()}Zye(Ja){return this.Cjk.Zye(Ja)}}Object(f.a)(R,"PresenceBootTelemetry",null,[755]);var ba=b(119),ha=b(167),na=b(186),da=b(23),ia=b(679);class ma{get name(){return"Common.App.CoauthTelemetry"}Hb(Ja){Ja.register(u,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").singleInstance().zd(()=>new u(ia.a.ot(Ja.Ca("Common.IPeopleInfoProvider")),m.AFrameworkApplication.qf));Ja.register(D,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").singleInstance().zd(()=>
new D(m.AFrameworkApplication.pa,ia.a.ot(Ja.Ca("Common.ICoauthoringTelemeryInfoProvider")),m.AFrameworkApplication.K,ba.a.get_instance(),na.a.instance,ia.a.ot(Ja.Ca("Common.IPeoplesWell")),ia.a.ot(Ja.Ca("Common.IPeopleInfoProvider")),u.zFf,()=>this.$1h()));Ja.register(R,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").singleInstance().zd(()=>new R(ia.a.ot(Ja.Ca("Common.ICoauthoringTelemeryInfoProvider")),ia.a.ot(Ja.Ca("Common.IRealtimeChannelBasic")),
ia.a.ot(Ja.Ca("Common.IPeopleInfoProvider")),Ja.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),na.a.instance,()=>this.$1h(),m.AFrameworkApplication.K,null,x.Health.instance));Ja.register(H,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").singleInstance().zd(()=>new H(ia.a.ot(Ja.Ca("Common.IPeopleInfoProvider"))));Ja.register(J,"Common.App.CoauthTelemetry.GuestCoauthTelemetry").singleInstance().zd(()=>new J(ia.a.ot(Ja.Ca("Common.IPeopleInfoProvider")),
ia.a.ot(Ja.Ca("Common.ISystemInitiatedFeedback")),m.AFrameworkApplication.K,"{"+m.AFrameworkApplication.userSessionId+"}"))}init(){m.AFrameworkApplication.K.wq(()=>{da.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();da.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();m.AFrameworkApplication.K.ea("CoauthorGalleryTelemetryIsEnabled")&&da.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();m.AFrameworkApplication.K.ea("CashTelemetryIsEnabled")&&
(da.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),da.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}$1h(){return I.a.cya&&na.a.instance.C3(V.a.Tvb)?0<na.a.instance.xw(V.a.Tvb)[V.a.E4e]:!1}static main(){ha.a.instance.Sb(new ma)}}Object(f.a)(ma,"CoauthTelemetryPackage",null,[1,2]);class qa extends Sys.EventArgs{constructor(){super()}}Object(f.a)(qa,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var ka;(function(Ja){Ja[Ja.notYetStarted=
0]="notYetStarted";Ja[Ja.polling=1]="polling";Ja[Ja.subscribed=2]="subscribed";Ja[Ja.blocked=3]="blocked";Ja[Ja.permanentlyStopped=4]="permanentlyStopped"})(ka||(ka={}));Object(f.b)("RtcHostNotificationSubscriptionState",ka);var va=b(81),ja=b(1226),Ma=b(62);class Ha{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf){this.gf=!1;this.mka=this.Svc=this.aqa=this.Yeb=null;this.ddd=Ha.Y7e;this.ka=new Ma.a;this.TAb=new ja.a(0);this.TAb.dDf(Object(c.a)(this,this.qKm,"onStateMachineChanged"));this.cmk=Ja;this.Gde=sb;
this.bmk=ub;this.jtf=Cc;this.fb=ic;this.Ng=Ud;ae.execute(Of=>{this.gf||(this.Svc=Of,this.Svc.Wea(Object(c.a)(this,this.Ana,"onUpdateNotificationReceived")),this.start())});He.execute(Of=>{this.gf||(this.mka=Of,Of.UBb(Object(c.a)(this,this.LWa,"onTokenRefreshed")))});this.$fe=lf}get KTc(){return this.TAb.currentState}get wUi(){return!this.Ng||this.Ng.jBa}get LUi(){return 2===this.KTc&&this.$fe()<this.ddd}start(){0!==this.KTc?r.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",
ka[this.KTc]):(this.TAb.event(1),this.k_g(null))}k_g(){this.Yeb=null;if(this.wUi){r.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",ka[this.KTc]);let Ja=null;this.jtf&&this.jtf.length&&(Ja={},Ja.etts=this.jtf);this.Svc.GV(14,Ja,!0);this.Rtj(this.cmk)}else this.TAb.event(3)}Rtj(Ja){this.Yeb=va.a.Iya(1,1E3*Ja,Object(c.a)(this,this.k_g,"sendSubscribeEvent"),this.Gde,192,"RtcHostNotificationSubscribe");this.fb.rb(this.Yeb)}lfn(Ja){Ja=1E3*(Ja+this.bmk);
const sb=this.$fe().getTime()+Ja;this.ddd=new Date(sb);Ja-=this.Gde;this.aqa?this.fb.FV(this.aqa,Ja):(this.aqa=va.a.Iya(1,Ja,Object(c.a)(this,this.jGn,"transitionToPollingEvent"),this.Gde/2,194,"RtcHostNotificationTransitionToPolling"),this.fb.rb(this.aqa))}jGn(){this.aqa=null;2===this.KTc&&(this.TAb.event(1),r.ULS.shipAssertTag(573100185,502,!!this.Yeb,"Missing task to ensure that we re-subscribe."))}LWa(){this.dVl()}dVl(){3===this.KTc&&this.wUi&&(this.TAb.event(this.LUi?2:1),this.k_g(null))}Ana(Ja,
sb){if(13===sb.type&&(Ja=sb.kia,r.ULS.sendTraceTag(573100183,502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:Ja,["DurationBeforeExpirationToResubscribeInSec"]:this.Gde}),sb=Ja.cts,!this.cIn(sb))){if(Ja.sb){var ub=2;this.lfn(Ja.cts)}else ub=1,this.ddd=Ha.Y7e,this.aqa&&(this.fb.ie(this.aqa),this.aqa=null);this.TAb.event(ub);this.Yeb?this.fb.FV(this.Yeb,1E3*sb):this.Rtj(sb)}}cIn(Ja){if(!isNaN(Ja)&&isFinite(Ja)&&0<Ja)return!1;this.RFj(!1);return!0}RFj(Ja){this.Yeb&&
(this.fb.ie(this.Yeb),this.Yeb=null);this.aqa&&(this.fb.ie(this.aqa),this.aqa=null);this.Svc&&(this.Svc.CQc(Object(c.a)(this,this.Ana,"onUpdateNotificationReceived")),this.Svc=null);this.mka&&(this.mka.BQc(Object(c.a)(this,this.LWa,"onTokenRefreshed")),this.mka=null);Ja||this.TAb.event(4)}qKm(Ja,sb){Ja=sb.newState;const ub=sb.gOg,Cc={};Cc.NewState=ka[Ja];Cc.PreviousState=ka[ub];Cc.PreviousStateHits=sb.hOg;Cc.PreviousStateTransitionTime=sb.iOg.toISOString();Cc.IsSubscribed=this.LUi;this.ddd!==Ha.Y7e&&
(Cc.SubscriptionExpiringTime=this.ddd.toISOString());r.ULS.sendTraceTag(572346515,502,4===Ja?15:50,"HostNotificationChanged: {0}",Cc);this.ka.raiseEvent("HN",new qa(ub,Ja))}dispose(){this.gf||(this.gf=!0,this.RFj(!0),this.aqa&&(this.fb.ie(this.aqa),this.aqa=null))}}Ha.Y7e=new Date(0);Object(f.a)(Ha,"RtcHostNotificationSubscriptionManager",null,[759,12]);var X=b(354);class W{constructor(){this.wh=this.gf=!1}get name(){return"RtcHostNotificationSubscription"}Hb(Ja){Ja.register(Ha,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").singleInstance().zd(()=>
{const sb=m.AFrameworkApplication.K;return new Ha(sb.jb("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),sb.jb("RtcHostNotificationRetryIntervalBufferInSeconds",120),sb.jb("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.oNl(sb),m.AFrameworkApplication.tb,X.SessionStatusManager.instance,Ja.Ca("Common.IRealtimeChannelBasic"),Ja.Ca("Common.ISessionExpirationManager"),()=>new Date)})}init(){m.AFrameworkApplication.K.wq(()=>{!this.gf&&m.AFrameworkApplication.K.ea("RtcHostNotificationEnabled")&&
(this.wh=!0,da.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.gf||(this.gf=!0,this.wh&&da.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}oNl(Ja){return Ja.iz("RtcEventTypesToSubscribe")?Ja.kx("RtcEventTypesToSubscribe"):null}static main(){ha.a.instance.Sb(new W)}}Object(f.a)(W,"RtcHostNotificationSubscriptionPackage",null,[1,2]);class fa{constructor(Ja=0){this.capabilities=
Ja}lUa(Ja){return!!(this.capabilities&Ja)}vtb(Ja){this.capabilities|=Ja}equals(Ja){return!(this.capabilities-Ja.capabilities)}clone(){return new fa(this.capabilities)}toString(){return Object.prototype.toString.call(this)}}Object(f.a)(fa,"UserCapabilities",null,[]);class ra{constructor(Ja,sb,ub,Cc,ic=null,Ud=null,ae=null,He=null,lf=!1,Of=!1,hf=!1,rh=0,Li=null,Jj=0){this.clientId=Ja;this.userName=sb;this.color=ub;this.capabilities=Cc||new fa;this.gkd=ic;this.chatThreadDiscoveryUri=He;this.inChat=Of;
this.email=Ud;this.client=ae;this.isAnonymous=lf;this.isReadOnly=hf;this.p6a=rh;this.presenceStatus=Li;this.P4b=Jj}equals(Ja){return!!Ja&&Ja.color===this.color&&Ja.userName===this.userName&&Ja.clientId===this.clientId&&Ja.isAnonymous===this.isAnonymous&&Ja.email===this.email&&Ja.inChat===this.inChat&&this.capabilities.equals(Ja.capabilities)&&Ja.presenceStatus===this.presenceStatus&&Ja.P4b===this.P4b}clone(){return new ra(this.clientId,this.userName,this.color,this.capabilities.clone(),this.gkd,this.email,
this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.p6a,this.presenceStatus,this.P4b)}h0(){return this.Yb()&&!!this.userName&&!(this.userName===CommonUIStrings.l_AnonymousUserName&&!this.isAnonymous)}Yb(){return!!this.clientId}toString(){return Object.prototype.toString.call(this)}static a1k(Ja){return new ra(Ja,null,null,new fa,null,null,null,null,!1,!1,!1,0,null)}}Object(f.a)(ra,"PresenceUser",null,[712]);class Aa{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf){this.clientId=
Ja;this.SkypeChatThreadId=ub;this.chatThreadDiscoveryUri=Cc;this.inChat=ic;this.localColbaltSessionId=sb;this.capabilities=Ud;this.email=ae;this.isReadOnly=He;this.userName=lf;this.isAnonymous=Of;this.presenceStatus=hf}}Object(f.a)(Aa,"SerializablePresenceUserData",null,[]);class Ba extends ra{constructor(Ja,sb,ub,Cc,ic=null,Ud=null,ae=null,He=null,lf=null,Of=!1,hf=!1,rh=!1,Li=null){super(Ja,sb,ub,Cc,Ud,ae,He,lf,Of,hf,rh);this.nD=ic;this.presenceStatus=Li}getData(){return new Aa(this.clientId,this.nD,
this.gkd,this.chatThreadDiscoveryUri,this.inChat,this.capabilities.capabilities,this.email,this.isReadOnly,this.userName,this.isAnonymous,this.presenceStatus)}$ye(Ja){return(Ja=Ja.value)?Ja.user:null}clone(){return new Ba(this.clientId,this.userName,this.color,this.capabilities.clone(),this.nD,this.gkd,this.email,this.client,this.chatThreadDiscoveryUri,this.isAnonymous,this.inChat,this.isReadOnly,this.presenceStatus)}static N5b(Ja){return Ja.clientId?new Ba(Ja.clientId,Ja.userName,null,new fa(void 0===
Ja.capabilities?0:Ja.capabilities),Ja.localColbaltSessionId,Ja.SkypeChatThreadId,Ja.email,null,Ja.chatThreadDiscoveryUri,Ja.isAnonymous,Ja.inChat,Ja.isReadOnly,Ja.presenceStatus):null}static cci(Ja,sb,ub,Cc=null,ic=null,Ud=null,ae=null,He=null,lf=!1,Of=!1,hf=!1,rh=null){return Ja?new Ba(Ja,sb,null,new fa(void 0===ub?0:ub),Cc,ic,Ud,ae,He,hf,lf,Of,rh):null}}Object(f.a)(Ba,"PresenceUser",ra,[1112,1113,712]);class ta extends Ba{constructor(){super();this.iPc=this.wwg=null}FGl(){const Ja=m.AFrameworkApplication.userName,
sb=m.AFrameworkApplication.K.Ga("UserPrincipalName"),ub=this.wwg?this.wwg.nD:null,Cc=m.AFrameworkApplication.Zoc||m.AFrameworkApplication.Ksa,ic=this.iPc?this.iPc.getStatus():null;return new Ba(this.clientId,Ja,this.color,this.capabilities,ub,this.gkd,sb,this.client,this.chatThreadDiscoveryUri,Cc,this.inChat,this.isReadOnly,ic)}}Object(f.a)(ta,"MyPresenceUser",Ba,[1165,712]);var xa=b(904);class za{constructor(Ja,sb,ub,Cc,ic){this.xd=Ja;this._clientId=sb;this.A7j=ic;this.Z$j=ub||(()=>null);this.$$j=
Cc||(()=>null)}get id(){return this.xd.id}get nfd(){return this.xd.nfd}get rfd(){return this.xd.rfd}get qfd(){return this.xd.qfd}get pfd(){return this.xd.pfd}get ofd(){return this.xd.ofd}get zhe(){return this.xd.zhe}get fAf(){return this.xd.fAf}get cOb(){return this.xd.cOb}get i_e(){return this.xd.i_e}get aMe(){return this.xd.aMe}get clientId(){return this._clientId}get bxd(){return this.Z$j}get kGb(){return this.$$j}get nbl(){return this.A7j}static createInstance(Ja,sb,ub,Cc,ic=!1){return new za(Ja,
sb,ub,Cc,ic)}}Object(f.a)(za,"PeoplesWellSettings",null,[]);var la=b(12),Sa=b(53),Pa=b(151),fb=b(78),db=b(216),Qa=b(230),wb=b(410),ib=b(337);class Ta extends db.a{constructor(){super();this.JoinTimeInMS=0;this.IsAnonymous=!1;this.ImageUrl=null;this.CanJump=this.ActiveStatus=!1;this.Upn=null}get ControlType(){return 5}}Object(f.a)(Ta,"PeopleButtonProps",db.a,[]);var jb=b(370),$a=b(791),ya=b(16),wa=b(130),Fa=b(350),bb=b(76);class Eb{constructor(Ja){this.D0d=new bb.a;this.KTf=null;this.clientId=Ja}tpn(Ja){this.F5m();
this.Ljn(Ja);for(const sb of Ja)sb.clientId!==this.clientId&&this.DVh(sb)}get vfh(){const Ja=[];for(let sb of this.D0d.values){const ub=this.Cuj(sb);Array.add(Ja,ub)}return Ja}get MJb(){return this.D0d.count}iCf(Ja,sb){Ja=Ja.toUpperCase();let ub;({value:ub}=this.D0d.Ab(Ja)).returnValue||(ub=[],this.D0d.$(Ja,ub));Array.add(ub,sb)}F5m(){this.D0d=new bb.a}Ljn(Ja){for(const sb of Ja)if(sb.clientId===this.clientId){this.KTf=sb;break}}}Object(f.a)(Eb,"UserTracker",null,[982]);class hb extends Eb{constructor(Ja,
sb){super(Ja);this.aak=sb}DVh(Ja){Ja.isAnonymous||!Ja.email?this.iCf(Ja.clientId,Ja):this.KTf&&Fa.a.Xi().equals(this.KTf.email,Ja.email)||this.iCf(Ja.email,Ja)}Cuj(Ja){let sb=new Date(0),ub=0<Ja.length?Ja[0]:null;for(const Cc of Ja)(Ja=this.aak(Cc.clientId))&&sb.getTime()<Ja.BLc.getTime()&&(sb=Ja.BLc,ub=Cc);return ub}}Object(f.a)(hb,"UniqueUserTracker",Eb,[]);class nb extends Eb{constructor(Ja){super(Ja)}DVh(Ja){this.iCf(Ja.clientId,Ja)}Cuj(Ja){return Ja[0]}}Object(f.a)(nb,"UserInstanceTracker",Eb,
[]);const Pb=(Ja,sb,ub)=>ub?new hb(Ja,sb):new nb(Ja);var bc=b(66),gb=b(1191),Lb=b(13);class Ic{constructor(Ja,sb=null,ub=null,Cc=null){this.FG=null;this.gxf=new t.a;this.TYc=null;this.xd=Ja;this.LQe=sb;ub&&ub.continueWith(()=>{this.FG=ub.result;this.FG.Cyc(Object(c.a)(this,this.p8,"onUsersUpdated"));this.MPd()});Cc&&Cc.continueWith(()=>{this.TYc=Cc.result;this.TYc.UZn(Object(c.a)(this,this.p8,"onUsersUpdated"));this.MPd()});new ra(this.settings.clientId,"Anonymous user","#cccccc",new fa(7));this.CFe=
this.Bkf=!0;this.Ugf=this.Jqf=!1;this.ILa=Pb(this.settings.clientId,this.settings.kGb,Ja.nbl)}get settings(){return this.xd}get X8l(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.ea("ColorPresenceHashIsEnabled"):!1}get YPi(){return m.AFrameworkApplication.K?m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled"):!1}hwl(){let Ja;let sb,ub,Cc,ic;var Ud=this.iwl();this.ILa.MJb?1===this.ILa.MJb?(sb=!0,ub=this.settings.cOb.cluster,Cc=this.settings.cOb.Gnd,ic=this.ILa.vfh[0].color):
(sb=!0,ub=this.settings.aMe.cluster,Cc=this.settings.aMe.Gnd,ic=""):(sb=!1,ic=Cc=ub="");Ja=Ud[0];Ud=Ud.slice(1);return{HMm:Ja,IMm:Ud,DMm:sb,T6n:ub,FMm:Cc,EMm:ic}}iwl(){if(2<=this.ILa.MJb)return[String.format(CommonUIStrings.l_PeoplesWellStateNumberOfOtherPeopleEditingHere,this.ILa.MJb)];if(1===this.ILa.MJb){const Ja=this.ILa.vfh[0],sb=this.settings.kGb(Ja.clientId);return sb&&2===sb.status?[CommonUIStrings.l_PeoplesWellStateUserIsInactive,Ja.userName]:[Ja.isReadOnly?CommonUIStrings.l_PeoplesWellStateUserIsAlsoViewing:
CommonUIStrings.l_PeoplesWellStateUserIsAlsoEditing,Ja.userName]}return[CommonUIStrings.l_PeoplesWellStateYouAreAllByYourself]}QSl(Ja){return this.RSl(Ja)}p4h(Ja,sb,ub){return sb?this.dOk(sb)?(Ja=this.settings.kGb(Ja))&&2===Ja.status?!1:!0:(ub&&r.ULS.sendTraceTag(4482394,325,50,"User has presence data but app can't use it"),!1):(ub&&r.ULS.sendTraceTag(4482393,325,50,"User does not have any presence data"),!1)}fPl(Ja){return Ja.isReadOnly?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOffline:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}RSl(Ja){if(!Ja.capabilities.lUa(1))return this.fPl(Ja);
const sb=Ja.isReadOnly,ub=this.settings.kGb(Ja.clientId);Ja=this.settings.bxd(Ja.clientId);if(!ub)return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;switch(ub.status){case 1:return Ja?sb?CommonUIStrings.l_PeoplesWellUserStatusIsViewingOnline:this.PYk(Ja)||CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown:CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown;case 2:return CommonUIStrings.l_PeoplesWellUserStatusIsInactive;default:return CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}}QCl(Ja){if(this.LQe.MHe)return this.LQe.iCc(Ja.email,
"O365",m.AFrameworkApplication.Fk,0)}FSl(Ja){Ja=this.settings.kGb(Ja.clientId);return!Ja||Ja&&1===Ja.status?!0:!1}HSl(Ja){var sb=String.format("buttonPeoplesWellUser-{0}",Ja.clientId),ub=Ja.clientId,Cc=this.QSl(Ja);const ic=Ja.userName,Ud=Ja.color;var ae=Object,He=ae.assign,lf=new Ta,Of=this.settings.zhe.toString(),hf=this.settings.i_e.cluster,rh=this.settings.i_e.Gnd,Li=this.rwi(),Jj=Ja.isAnonymous,Fg;if(Fg=[ic],Fg.length){var Ni=new Sys.StringBuilder("STRARRY@");for(const di of Fg)Ni.append(di?
di.length:0),Ni.append(","),Ni.append(di),Ni.append(",");Fg=Ni.toString().slice(0,-1)}else Fg=null;sb=He.call(ae,lf,{Id:sb,Command:Of,LabelText:"{0}",Image32by32:hf,Image32by32Class:rh,MenuItemId:ub,CommandValueId:ub,Alt:ic,DisplayMode:Li,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word",Description:Cc,ImageBackColor:Ud,IsAnonymous:Jj,LabelTextUserGeneratedPlaceholderReplacements:Fg,Upn:Ja.email});m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled")&&
this.LQe&&(ub=this.QCl(Ja),Cc=this.FSl(Ja),sb.ImageUrl=ub,sb.ActiveStatus=Cc,sb.JoinTimeInMS=Ja.p6a,Ja=this.p4h(Ja.clientId,this.settings.bxd(Ja.clientId),!1),sb.CanJump=Ja,""===ub&&r.ULS.sendTraceTag(40969413,302,50,"ImageURL collection failed"));return sb}oBl(){return Object.assign(new db.a,{Id:"BasicChat",Command:"2288458806",LabelText:CommonUIStrings.l_StartGroupChat,LabelCss:"display:block; max-width:160px; padding:0px; white-space:normal; word-wrap:break-word"})}rwi(){return this.X8l?"Initials":
"Menu32"}ISl(Ja){const sb=[];for(const ub of Ja)Ja=this.HSl(ub),Array.add(sb,Ja);return sb}fFe(){return 0<this.ILa.MJb}UXm(Ja){if(!this.Bkf)return!0;this.CFe||(Ja[gb.a.Visible]=!0);let sb,ub,Cc,ic,Ud;({HMm:sb,IMm:ub,DMm:Cc,FMm:ic,EMm:Ud}=this.hwl());Ja[gb.a.LabelText]=sb;ub&&ub.length&&(Ja[gb.a.LabelTextUserGeneratedPlaceholderReplacements]=ub);Ja[gb.a.ImageIsVisible]=Cc;Ja[gb.a.Image16by16Class]=ic;Ja[gb.a.ImageBackColor]=Ud;this.Bkf=!1;return!0}wRm(Ja){if(0>=this.ILa.MJb)return!1;var sb=this.Lxn(this.ILa.vfh),
ub=this.ISl(sb);sb=Object.assign(new wb.a,{Id:"menuCoauthors",MaxWidth:"220px",MenuSectionList:[]});ub=Object.assign(new ib.a,{Id:"msCoauthors",ControlsId:"msCoauthorsControls",DisplayMode:this.rwi(),ControlList:ub});m.AFrameworkApplication.K.ea("WordEditorDisplayPeoplesWellLabelIsEnabled")&&this.LQe&&(ub.Title=CommonUIStrings.l_PeoplesWellFlyoutLabel,ub.TitleId="menuCoauthorsTitle",ub.Theme="Light");Array.add(sb.MenuSectionList,ub);m.AFrameworkApplication.K.ea("DocChatIsEnabled")&&m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled")&&
m.AFrameworkApplication.la&&m.AFrameworkApplication.la.eb.lo&&(ub=[],Array.add(ub,this.oBl()),ub=Object.assign(new ib.a,{Id:"msGroupChat",ControlsId:"msGroupChatControl",ControlList:ub}),Array.add(sb.MenuSectionList,ub));m.AFrameworkApplication.la&&m.AFrameworkApplication.la.eb.lo?Ja.MenuItems=sb:Ja.PopulationXML=Qa.t(sb);return!0}tfh(Ja){r.ULS.sendTraceTag(4482395,325,50,"PeoplesWell: Received user button click");Ja=Ja.MenuItemId;if(!Ja)return!1;const sb=this.settings.bxd(Ja);if(!this.p4h(Ja,sb,
!0))return!1;this.vim(sb);return!0}C1m(){const Ja=this.Rrl();this.ILa.tpn(Ja);this.CFe&&1<=this.ILa.MJb&&(r.ULS.sendTraceTag(6092429,325,50,"PeoplesWell: User is no longer forever alone."),this.CFe=!1);this.Bkf=!0}p8(){this.Ugf||(window.setTimeout(()=>{this.MPd();this.Ugf=!1},3E3),this.Ugf=!0)}Rrl(){let Ja;Ja=this.Qrl()||[];for(const sb of Ja)this.ien(sb);return Ja}ien(Ja){Ja.clientId||(Ja.clientId=wa.a.create().toString());Ja.userName||(Ja.userName="Anonymous user");Ja.capabilities||(Ja.capabilities=
new fa);Ja.color||(Ja.color="#cccccc");Ja.p6a||(Ja.p6a=0)}Lxn(Ja){const sb=[];Array.addRange(sb,Ja);sb.sort(Ic.uMm);return sb}c4m(){m.AFrameworkApplication.K.ea("CoauthorGalleryTelemetryIsEnabled")&&!this.Jqf&&(m.AFrameworkApplication.pa.OX(Lb.a.dNf)&&jb.a.isSharedUxGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DoNotRegisterCoauthorsRenderedMultiplTimes")||m.AFrameworkApplication.pa.Aa(Lb.a.dNf,bc.a.frame,Object(c.a)(this,this.zDm,"onCoauthorGalleryFirstRender"),96));this.d4m();this.Jqf=!0;
this.MPd()}zDm(Ja,sb,ub,Cc,ic){this.gxf.xM(ic.RenderTime);return 32}get SIj(){return this.gxf.task}MPd(){if(!this.Jqf&&(this.gxf.xM((new Date).getTime()),r.ULS.sendTraceTag(42567504,325,50,"We are trying to render the coauthor gallery before we are ready to record the render time"),this.YPi))return;this.C1m();this.YPi&&this.CFe?m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||$a.a.gNc("ribbon","coauthorGallery"):
(m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.GeneralizedRibbonTTVRReporting",!1)||($a.a.MJa("ribbon","coauthorGallery"),$a.a.Eqb("ribbon","coauthorGallery")),this.D1m())}dispose(){this.FG&&(this.FG.FUe(Object(c.a)(this,this.p8,"onUsersUpdated")),this.FG=null);this.TYc&&(this.TYc.B7n(Object(c.a)(this,this.p8,"onUsersUpdated")),this.TYc=null)}static uMm(Ja,sb){return Ja.capabilities.lUa(1)&&sb.capabilities.lUa(1)||!Ja.capabilities.lUa(1)&&
!sb.capabilities.lUa(1)?ya.a.localeCompare(Ja.userName,sb.userName):Ja.capabilities.lUa(1)?-1:1}}Object(f.a)(Ic,"APeoplesWell",null,[905,12]);var vb=b(14);class xb extends Ic{constructor(Ja,sb,ub=null,Cc=null){super(Ja,ub,Cc);this.ybb=()=>!0;this.ga=sb}WXm(Ja){return this.UXm(Ja)}yRm(Ja){return this.wRm(Ja)}yQn(Ja){return this.tfh(Ja)}Gmb(Ja,sb,ub,Cc,ic,Ud){Ja=!1;switch(ub){case 1:Ja=ic(Cc);break;case 2:Ja=Ud(Cc)}return xb.GHk(Ja)}B9l(Ja,sb,ub,Cc,ic){return this.Gmb(Ja,sb,ub,ic,()=>this.fFe(),this.ybb)}VXm(Ja,
sb,ub,Cc,ic){return this.Gmb(Ja,sb,ub,ic,Object(c.a)(this,this.WXm,"queryUsersProxy"),this.ybb)}xRm(Ja,sb,ub,Cc,ic){return this.Gmb(Ja,sb,ub,ic,this.ybb,Object(c.a)(this,this.yRm,"populateFlyoutContentsProxy"))}aVk(Ja,sb,ub,Cc,ic){return this.Gmb(Ja,sb,ub,ic,this.ybb,this.ybb)}$Uk(Ja,sb,ub,Cc,ic){return this.Gmb(Ja,sb,ub,ic,this.ybb,this.ybb)}xQn(Ja,sb,ub,Cc,ic){return this.Gmb(Ja,sb,ub,ic,this.ybb,Object(c.a)(this,this.yQn,"userButtonClickProxy"))}fQm(Ja,sb,ub,Cc,ic){return this.Gmb(Ja,sb,ub,ic,
this.ybb,()=>{this.MPd();return!0})}d4m(){this.ga.ma(this.settings.nfd,vb.a.application,Object(c.a)(this,this.B9l,"isControlEnabledHandler"));this.ga.Aa(this.settings.rfd,vb.a.application,Object(c.a)(this,this.VXm,"queryUsersHandler"),96);this.ga.Aa(this.settings.pfd,vb.a.application,Object(c.a)(this,this.aVk,"commandMenuOpenHandler"),96);this.ga.Aa(this.settings.ofd,vb.a.application,Object(c.a)(this,this.$Uk,"commandMenuCloseHandler"),96);this.ga.Aa(this.settings.qfd,vb.a.application,Object(c.a)(this,
this.xRm,"populateFlyoutContentsHandler"),96);this.ga.ma(this.settings.zhe,vb.a.application,Object(c.a)(this,this.xQn,"userButtonClickHandler"));this.ga.Aa(this.settings.fAf,vb.a.application,Object(c.a)(this,this.fQm,"peoplesWellRefreshControlHandler"),96)}static GHk(Ja){return Ja?32:8}}Object(f.a)(xb,"ABox4PeoplesWell",Ic,[]);var Db=b(3),ab=b(49),dc=b(10),tb=b(30),yb=b(174);class rc{static isSupported(Ja){for(let sb=0;sb<rc.QGj.length;sb++)if(Ja===rc.QGj[sb])return!0;return!1}}rc.QGj=[1];Object(f.a)(rc,
"RTTDataVersion",null,[]);var fc=b(1443);const uc=Ja=>{if("number"!==typeof Ja.RK||"number"!==typeof Ja.DK)return!1;let sb,ub=!1,Cc=!1,ic=!1;switch(Ja.RK){case 0:Cc=sb=!0;break;case 1:ic=ub=Cc=sb=!0;break;case 2:if(null!=Ja.PE&&"number"!==typeof Ja.PE)return!1;sb=!0;break;case 4:sb=!0;break;case 3:Cc=sb=!0;break;case 5:ub=sb=!0;break;default:return!1}return sb&&("number"!==typeof Ja.PS||"number"!==typeof Ja.TS)||Cc&&("object"!==typeof Ja.OS||!Ja.OS||!fc.validateVersionedCpData(Ja.OS))||ub&&("number"!==
typeof Ja.PE||"number"!==typeof Ja.TE)||ic&&("object"!==typeof Ja.OE||!Ja.OE||!fc.validateVersionedCpData(Ja.OE))?!1:!0},Uc=Ja=>{let sb="";if("number"!==typeof Ja.I)return{returnValue:!1,hsa:"Invalid PacketId Type"};if("number"!==typeof Ja.O)return{returnValue:!1,hsa:"Invalid Operation Type"};if("string"!==typeof Ja.A)return{returnValue:!1,hsa:"Invalid ClientId Type"};if("object"!==typeof Ja.AN)return{returnValue:!1,hsa:"Invalid Anchor Object Type"};if(!Ja.AN)return{returnValue:!1,hsa:"Null AnchorObject"};
if(!uc(Ja.AN)){let ub;try{ub=N.c(Ja.AN)}catch(Cc){ub=String.format("Failed to JSON-serialize payload : {0}",Cc)}8E3<ub.length&&(ub=String.format("Payload exceeds maximum length: {0} > {1}, not logging",ub.length,8E3));sb="Invalid AnchorObject: "+ub+", Client: "+Ja.C;return{returnValue:!1,hsa:sb}}return!Ja.O&&Ja.AN.RK?(sb="Invalid RangeKind:"+Ja.AN.RK+" for Caret",{returnValue:!1,hsa:sb}):2===Ja.O&&("number"!==typeof Ja.TF||"undefined"!==typeof Ja.TX&&"string"!==typeof Ja.TX||1!==Ja.AN.RK&&Ja.AN.RK)?
{returnValue:!1,hsa:"Invalid TypingData"}:3!==Ja.O||"object"===typeof Ja.AP&&Ja.AP&&"number"===typeof Ja.AP.TFA&&"number"===typeof Ja.AP.PN&&"number"===typeof Ja.AP.TN&&2===Ja.AN.RK?6!==Ja.O||"object"===typeof Ja.MP&&Ja.MP&&"number"===typeof Ja.MP.PM&&"number"===typeof Ja.MP.TM&&5===Ja.AN.RK?4!==Ja.O||"object"===typeof Ja.SP&&Ja.SP&&"number"===typeof Ja.SP.PA&&"number"===typeof Ja.SP.TA&&"number"===typeof Ja.SP.PB&&"number"===typeof Ja.SP.TBS&&3===Ja.AN.RK&&(Ja.AN.PS===Ja.SP.PA||Ja.AN.PS===Ja.SP.PB)?
7!==Ja.O||"object"===typeof Ja.SPS&&Ja.SPS&&"string"===typeof Ja.SPS.SF&&"boolean"===typeof Ja.SPS.SL?null!=Ja.ISS&&"number"!==typeof Ja.ISS?{returnValue:!1,hsa:"invalid StrictlySequentialId"}:{returnValue:!0,hsa:sb}:{returnValue:!1,hsa:"Invalid SymbolData"}:{returnValue:!1,hsa:"Invalid SplitParaData"}:{returnValue:!1,hsa:"Invalid RemoveParaData"}:{returnValue:!1,hsa:"Invalid AddParaData"}};var tc=b(1406);class Tb{constructor(Ja,sb=null,ub=null){this.S8=this.oLg=this.G$g=null;null!=Ja&&(this.G$g=
Ja);null!=sb&&(this.oLg=sb);null!=ub&&(this.S8=ub)}}Object(f.a)(Tb,"AddParaData",null,[]);class qb{constructor(Ja=null,sb=null){this.nUc=this.nLg=null;null!=Ja&&(this.nLg=Ja);null!=sb&&(this.nUc=sb)}}Object(f.a)(qb,"MergeRemoveParaData",null,[]);class Jb{constructor(Ja,sb,ub,Cc,ic,Ud,ae=null,He=null,lf=null,Of=null,hf=null,rh=null,Li=0,Jj=null){this.zXd=this.text=this.Enc=this.Lmc=this.bId=this.qyc=this.Hua=null;this.packetId=Ja;this.client=ub;this.qD=Cc;this.clientId=sb.toLowerCase();this.d_=ic;
this.version=Li;Ud&&(this.Hua=Ud);null!=ae&&(this.Enc=ae);void 0!==He&&null!==He&&(this.text=He);lf&&(this.qyc=lf);Of&&(this.bId=Of);hf&&(this.Lmc=hf);rh&&(this.zXd=rh);this.strictlySequentialId=Jj}}Object(f.a)(Jb,"RTTData",null,[]);class Zb{constructor(Ja=null,sb=null,ub=null,Cc=null){this.F$g=this.mLg=this.C$g=this.lLg=null;null!=Ja&&(this.lLg=Ja);null!=sb&&(this.C$g=sb);null!=ub&&(this.mLg=ub);null!=Cc&&(this.F$g=Cc)}}Object(f.a)(Zb,"SplitParaData",null,[]);class ec{constructor(Ja=null,sb=null){this.k9g=
this.j9g=null;Ja&&(this.j9g=Ja);null!=sb&&(this.k9g=sb)}}Object(f.a)(ec,"SymbolData",null,[]);class zc{constructor(Ja,sb=null,ub=null){null!=Ja&&(this.TFA=Ja);null!=sb&&(this.PN=sb);null!=ub&&(this.TN=ub)}}Object(f.a)(zc,"SerializableAddParaDataV1",null,[]);class Oc{constructor(Ja=null,sb=null){null!=Ja&&(this.PM=Ja);null!=sb&&(this.TM=sb)}}Object(f.a)(Oc,"SerializableMergeRemoveParaDataV1",null,[]);class ud{}Object(f.a)(ud,"SerializableRTTDataV1",null,[]);class Ad{constructor(Ja=null,sb=null,ub=
null,Cc=null){null!=Ja&&(this.PA=Ja);null!=sb&&(this.TA=sb);null!=ub&&(this.PB=ub);null!=Cc&&(this.TBS=Cc)}}Object(f.a)(Ad,"SerializableSplitParaDataV1",null,[]);class xd{constructor(Ja=null,sb=null){Ja&&(this.SF=Ja);null!=sb&&(this.SL=sb)}}Object(f.a)(xd,"SerializableSymbolDataV1",null,[]);const re=Ja=>{var sb;if(!({hsa:sb}=Uc(Ja)).returnValue)return r.ULS.sendTraceTag(9188759,302,15,"Failed to parse RTT packet, InvalidFieldInfo {0}",sb),null;let ub=sb=null,Cc=null,ic=null,Ud=null,ae=null,He=null,
lf=null;Ja.WD&&(sb=Ja.WD);null!=Ja.TF&&(ub=Ja.TF);void 0!==Ja.TX&&null!==Ja.TX&&(Cc=Ja.TX);Ja.AP&&(ic=new Tb(Ja.AP.TFA,Ja.AP.PN,Ja.AP.TN));Ja.MP&&(Ud=new qb(Ja.MP.PM,Ja.MP.TM));Ja.SP&&(ae=new Zb(Ja.SP.PA,Ja.SP.TA,Ja.SP.PB,Ja.SP.TBS));Ja.SPS&&(He=new ec(Ja.SPS.SF,Ja.SPS.SL));null!=Ja.ISS&&(lf=Ja.ISS);return new Jb(Ja.I,Ja.A,Ja.C,Ja.O,tc.a(Ja.AN),sb,ub,Cc,ic,Ud,ae,He,1,lf)},mc=Ja=>{let sb=Ja;if("number"===typeof sb.V){if(1===sb.V)return re(Ja);r.ULS.sendTraceTag(9188758,302,15,"Unsupported Version");
return null}let ub=0,Cc=null;for(let ic=0;ic<Ja.length;ic++)sb=Ja[ic],rc.isSupported(sb.V)&&sb.V>ub&&(ub=sb.V,Cc=Ja[ic]);return 1===ub?re(Cc):null},Ab=Ja=>{if(Ja){const sb=new ud;sb.I=Ja.packetId;sb.V=1;sb.A=Ja.clientId;sb.C=Ja.client;sb.O=Ja.qD;sb.AN=tc.c(Ja.d_);Ja.Hua&&(sb.WD=Ja.Hua);null!=Ja.Enc&&(sb.TF=Ja.Enc);void 0!==Ja.text&&null!==Ja.text&&0<Ja.text.length&&(sb.TX=Ja.text);Ja.qyc&&(sb.AP=new zc(Ja.qyc.G$g,Ja.qyc.oLg,Ja.qyc.S8));Ja.bId&&(sb.MP=new Oc(Ja.bId.nLg,Ja.bId.nUc));Ja.Lmc&&(sb.SP=
new Ad(Ja.Lmc.lLg,Ja.Lmc.C$g,Ja.Lmc.mLg,Ja.Lmc.F$g));Ja.zXd&&(sb.SPS=new xd(Ja.zXd.j9g,Ja.zXd.k9g));sb.ISS=Ja.strictlySequentialId;Ja=sb}else Ja=null;return Ja};var oc=b(51);class Mc{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf){this.LocalCobaltSessionId=Ja;this.SkypeChatThreadId=sb;this.ChatThreadDiscoveryUri=ub;this.InChat=Cc;this.Capabilities=ic;this.Email=Ud;this.UserName=ae;this.IsAnonymous=He;this.PresenceStatus=lf}}Object(f.a)(Mc,"SerializableWacData",null,[]);class Ec{constructor(){this.Vee=this.Uee=
0}jHl(){this.Vee===Number.MAX_VALUE&&(this.Vee=0);this.Vee++;return this.Vee}iHl(){this.Uee===Number.MAX_VALUE&&(this.Uee=0);this.Uee++;return this.Uee}static get instance(){return Ec.vok}}Ec.vok=new Ec;Object(f.a)(Ec,"StrictlySequentialIdGenerator",null,[174]);var kd=b(1333);class Xd{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He=0){this.GFa=null;this.dryDeletion=0;this.eN=Ja;this.Y0a=Ud;this.Ic=ic;this.W1b=ae;this.Ob=sb;this.shapeId=He;this.XWa=ub;this.lha=ae.create(this,Cc,ic,Ud)}clone(){return new Xd(this.eN,
this.Ob,this.XWa,this.lha.xpc,this.Ic,this.Y0a,this.W1b,this.shapeId)}get paragraphId(){return this.GFa?this.GFa:this.eN.UFb(this.Ob)}FIg(){this.GFa||(this.GFa=this.paragraphId,this.lha.FIg())}Yb(){return 0<=this.lha.cp}getData(){const Ja=this.lha.xpc;return Ja?new kd.a(0,this.Ob,this.XWa,Ja,null,null,null,0,this.shapeId):null}static N5b(Ja,sb,ub,Cc,ic){return sb?new Xd(sb,parseInt(Ja.D7a),Ja.Uub,Ja.MY,ub,Cc,ic,Ja.shapeId):null}}Object(f.a)(Xd,"WordPresenceIp",null,[157,72,158]);class Bc{constructor(Ja,
sb,ub){this.k9a=this.Mma=this.p7c=!1;this.Wzb=Ja;this.Icb=ub;this.user=sb}get ip(){return this.Icb}get pMc(){return this.p7c}set pMc(Ja){(this.p7c=Ja)&&this.ip.FIg()}Obg(){const Ja=Ec.instance.iHl();return new Jb(this.Wzb,this.user.clientId,1,0,this.ip?this.ip.getData():null,new Mc(this.user.nD,this.user.gkd,this.user.chatThreadDiscoveryUri,this.user.inChat,this.user.capabilities.capabilities,this.user.email,this.user.userName,this.user.isAnonymous,this.user.presenceStatus),void 0,void 0,void 0,void 0,
void 0,void 0,void 0,Ja)}Yxi(){return this.user.clientId+(this.ip?this.ip.paragraphId.toString():oc.a.nil.toString())}Yb(){const Ja=!!this.user&&this.user.Yb(),sb=!this.ip||this.ip.Yb();return Ja&&sb}clone(){const Ja=new Bc;Ja.Wzb=this.Wzb;Ja.p7c=this.p7c;Ja.user=this.user?this.user.clone():null;Ja.Icb=this.ip?this.ip.clone():null;Ja.Mma=this.Mma;Ja.k9a=this.k9a;return Ja}static get Ka(){return da.a.instance.sa("Box4.IFeatureHelper")}static kRf(Ja,sb,ub,Cc,ic){if(!Ja||!Bc.Ka.isFeatureEnabled(194)||
!sb)return null;if(Ja.qD)return r.ULS.sendTraceTag(7685324,302,15,"Presence packet is of unexpected operationType {0}",Ja.qD),null;let Ud;Ud=void 0!==Ja.Hua&&null!==Ja.Hua?Ba.cci(Ja.clientId,Ja.Hua.UserName,Ja.Hua.Capabilities,Ja.Hua.LocalCobaltSessionId,Ja.Hua.SkypeChatThreadId,Ja.Hua.Email,Ja.client,Ja.Hua.ChatThreadDiscoveryUri,Ja.Hua.InChat,!1,Ja.Hua.IsAnonymous,Ja.Hua.PresenceStatus):Ba.cci(Ja.clientId,null,0,void 0,void 0,void 0,Ja.client);return new Bc(Ja.packetId,Ud,Xd.N5b(Ja.d_,sb,ub,Cc,
ic))}}Object(f.a)(Bc,"WordPresenceInfo",null,[167,72]);class jd extends xb{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf,rh,Li,Jj){super(Ja,Ud,Jj,sb);this.I4j=ub;this.nmk=Cc;this.Nkk=ic;this.Da=ae;jd.xs=He;this.eN=lf;this.Ic=Of;this.Y0a=hf;this.Fzf=rh;this.w_a=Li}tfh(Ja){this.w_a.dWi(Ja.CommandValueId);return super.tfh(Ja)}vim(Ja){let sb;({UNg:sb}=this.arg(Ja)).returnValue&&(this.nmk(sb.ip.paragraphId,sb.ip.lha.cp),m.AFrameworkApplication.K.ea("WordEditorMoveIpToUserLocationIsEnabled")&&(Ja=jd.dOl(sb),
void 0!==Ja&&null!==Ja?(r.ULS.sendTraceTag(20764574,325,50,"Attempting to move IP to the editing location of the selected user"),this.Da.setSelection(Ja),Sa.FocusManager.jA()&&Sa.FocusManager.instance().wf(Pa.AFrame.ao)):r.ULS.sendTraceTag(20764575,325,50,"IP will not be moved since the selection is either null or undefined")),Ja=new va.a(2,1,0,()=>{this.ga.ob(Db.a.HVd,2,sb)}),fb.a.instance.rb(Ja))}nCi(Ja){return Ja?(Ja=Bc.kRf(mc(Ja),this.eN,this.Ic,this.Y0a,this.Fzf.instance))&&Ja.Yb()&&Ja.ip?Ja:
null:null}dOk(Ja){return this.Ydm(Ja)?this.pOk(Ja)?!0:(r.ULS.sendTraceTag(41236613,325,50,"Cannot jump to user location because paragraph has not been loaded yet"),!1):(r.ULS.sendTraceTag(41236612,325,50,"Cannot jump to user location because presence is not valid"),!1)}Ydm(Ja){return!!this.nCi(Ja)}arg(Ja){Ja=this.nCi(Ja);return{returnValue:!!Ja,UNg:Ja}}pOk(Ja){let sb;return({UNg:sb}=this.arg(Ja)).returnValue?this.I4j(sb.ip.paragraphId,sb.ip.lha.cp):!1}Qrl(){if(!this.FG)return[];const Ja=[];for(let sb of this.FG.llb())sb.userName?
Ja.push(sb):r.ULS.sendTraceTag(592229832,304,15,"The looked up RTC User has no name");return Ja}PYk(Ja){let sb;return({UNg:sb}=this.arg(Ja)).returnValue&&sb.user&&sb.user.presenceStatus&&"0"!==sb.user.presenceStatus?String.format(WordEditorIntl.WordEditorStrings.l_PresenceStatusOnPage,sb.user.presenceStatus):CommonUIStrings.l_PeoplesWellUserStatusLocationUnknown}D1m(){this.Nkk(this.settings.id)}static createInstance(Ja,sb,ub,Cc,ic,Ud,ae){const He=la.App.oa.za,lf=m.AFrameworkApplication.pa,Of=ab.a.instance,
hf=da.a.instance.resolve("Box4.ICoauthCashTelemetry");return new jd(Ja,sb,rh=>He.Rb.gj?He.Rb.Ole(rh,!0):!1,(rh,Li)=>{He.Rb.gj&&He.Rb.ukc(rh,Li,!0,!0)},()=>{la.App.Yq.hz.P_d()},lf,Of,He,ub,Cc,ic,Ud,hf,ae)}static dOl(Ja){const sb=jd.xs.jc.kd.Ta(Ja.ip.paragraphId);if(void 0===sb||null===sb)return r.ULS.sendTraceTag(20764576,325,15,"The node could not be obtained"),null;if(!dc.ParagraphReader.nb(sb))return r.ULS.sendTraceTag(20764577,325,15,"The obtained node is not a paragraph node"),null;Ja=tb.a.Kb(sb,
Ja.ip.lha.cp);return new yb.Selection([Ja],!0)}}jd.xs=null;Object(f.a)(jd,"WordEditorPeoplesWell",xb,[]);class Vc{get name(){return"WordEditor.PeoplesWellControl"}Hb(Ja){Vc.Z=Ja}init(){m.AFrameworkApplication.K.wq(Object(c.a)(this,this.Gw,"onFullAppSettingsReady"))}Gw(){m.AFrameworkApplication.zMg?Vc.J8a.LN().continueWith(Object(c.a)(this,this.NKd,"onRtcProxyReady")):r.ULS.sendTraceTag(23196872,325,50,"PeoplesWell control is explicitly disabled. Skipping initialization attempt")}NKd(){Vc.Jj=Vc.J8a.LN().result;
if(Vc.Jj){var Ja=()=>{const sb=la.App.oa.za;return sb?sb.jc?sb.jc.kd:(r.ULS.sendTraceTag(23196876,325,15,"ActivePage is null"),null):(r.ULS.sendTraceTag(23196875,325,15,"Workspace is null"),null)};la.App.Sra().continueWith(()=>{const sb=la.App.Sra().result.Kg,ub=xa.CuiHelper.cKl(m.AFrameworkApplication.ln,m.AFrameworkApplication.ln,m.AFrameworkApplication.ln,m.AFrameworkApplication.ln),Cc=za.createInstance(ub,sb,Object(c.a)(Vc.Jj.XVe,Vc.Jj.XVe.bxd,"getUserPresence"),Object(c.a)(Vc.Jj.XVe,Vc.Jj.XVe.kGb,
"getUserStatusInfo"),m.AFrameworkApplication.K.ea("WordEditorPresenceDedupeMultipleCoauthorInstances"));da.a.instance.ha("RealtimePresenceUI.WordEditorPeoplesWell",()=>jd.createInstance(Cc,ia.a.ot(Vc.Z.Ca("Common.IPeopleInfoProvider")),Vc.Z.sa("WordEditor.ParagraphWordIdMapping"),Vc.Z.sa("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ja,Vc.Z.Ca("WordEditor.Presence.IWordPresenceCpFactory"),Vc.Z.resolve("Common.App.People.IPeopleManager"))).as("Common.IPeoplesWell").singleInstance();
Vc.na=da.a.instance.resolve("Common.IPeoplesWell");Vc.na.c4m();r.ULS.sendTraceTag(23196877,325,50,"PeoplesWellControl is fully initialized")})}else r.ULS.sendTraceTag(23196873,325,15,"Can't initialize the PeoplesWell control because can't get a handle to RtcProxy")}dispose(){Vc.na&&(Vc.na.dispose(),Vc.na=null)}static get J8a(){return Vc.CAb||(Vc.CAb=da.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}}Vc.na=null;Vc.Z=null;Vc.Jj=null;Vc.CAb=null;Object(f.a)(Vc,"WordEditorPeoplesWellControlPackage",
null,[1,2]);var Ye=b(71),Cd=b(190);class of{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf=!1){this.Owb=null;this.bff=!0;this.irf=this.Ss=this.N9e=null;this.ka=new Ma.a;this.T0a=Ja;this.Ppa=sb;this.fKh=ub;this.D$c=Cc;this.$oh=Ud;of.fb=ic;this.Sjk=ae;this.cU=He;this.Ukk=lf;G.Task.WAA(sb,ub).continueWith(Object(c.a)(this,this.r2l,"initOnTaskReady"))}Wzk(Ja){this.ka.addHandler("u",Ja)}ojj(){this.ka.raiseEvent("u",null,this)}r2l(){this.Ppa.result&&this.fKh.result&&(this.Ss=this.Ppa.result,this.irf=this.fKh.result,
this.Ss.ihb(Object(c.a)(this,this.zca,"onPresenceUpdated")),this.N9e=new va.a(2,2,this.$oh,Object(c.a)(this,this.MKn,"updateAwayClientsTask"),88),of.fb.rb(this.N9e))}zca(Ja,sb){(this.bff||this.C_m(sb.GZa))&&of.fb.FV(this.N9e,0)}C_m(Ja){for(let ub in Ja){var sb=this.D$c.$ye({key:ub,value:Ja[ub]});if(sb&&sb.clientId&&(sb=sb.clientId.toLowerCase(),(sb=this.Owb[sb]||this.Owb[sb.toUpperCase()])&&2===sb.status))return!0}return!1}MKn(Ja){var sb=this.Ss.Osd();if(sb){var ub=new Date,Cc=!1;if(this.bff){this.Owb=
sb;this.bff=!1;var ic=this.Owb;for(var Ud in ic){sb=Ud;var ae=ic[Ud];ae.BLc<ub&&(ub=ae.BLc);2===ae.status&&(Cc=!0,this.irf.FQd(sb))}Cc&&this.ojj();of.fb.FV(Ja,this.AAi(ub))}else{ae=new M.a;Ud=!1;var He=this.Owb;for(ic in He){He=ic;if(!(He in this.Owb)||this.T0a.clientId===He)continue;var lf=this.Owb[He];const Of=sb[He];if(lf&&Of){lf=lf.status;const hf=Of.status;2===lf&&1===hf?(ae.add(He),r.ULS.sendTraceTag(38052609,392,50,He+" returned from away")):1===lf&&2===hf&&(Ud=Cc=!0,this.irf.FQd(He),r.ULS.sendTraceTag(38052610,
392,50,He+" went away"));1===hf&&Of.BLc<ub&&(ub=Of.BLc)}}this.Owb=sb;of.fb.FV(Ja,this.AAi(ub));(0<ae.count||Cc)&&this.ojj();0<ae.count&&!this.Ukk?(Ja=this.Lul(ae),this.CEn(Ja)):Ja=new M.a;(Ud||0<Ja.count)&&this.Sjk(Lb.a.Ukd,2)}}}CEn(Ja){if(Ja.count)for(let sb of Ja)Ja=this.cU.Qqa(String.format(CommonUIStrings.l_EditorsToastArriving,sb),!1),Ja.image=5,Ja.b0="CoAuth_AuthorStatus_16x16x32",this.cU.BB(Ja)}Lul(Ja){const sb=this.Ss.G8b(),ub=new M.a;for(let Cc in sb){const ic={key:Cc,value:sb[Cc]};if(Ja.contains(ic.key)){const Ud=
this.D$c.$ye(ic);Ud&&(ub.add(Ud.userName),Ja.remove(ic.key))}}ub.count||r.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return ub}AAi(Ja){const sb=new Date;return Math.max(Ja.getTime()+this.$oh-sb.getTime(),0)}}of.fb=null;Object(f.a)(of,"AwayManager",null,[]);var Je=b(719);class gd{constructor(Ja=0){this.updates=Ja}get ygg(){return 0!==this.updates}lUa(Ja){return!!(this.updates&Ja)}vtb(Ja){this.updates|=Ja}toString(){if(this.lUa(0))return"none";const Ja=new M.a;this.lUa(1)&&
Ja.add("user(s) joined");this.lUa(2)&&Ja.add("user(s) disconnected");this.lUa(4)&&Ja.add("user(s) updated");return Ja.toArray().join(", ")}}Object(f.a)(gd,"UserUpdateEvent",null,[]);var Te=b(29);class cg{constructor(Ja,sb,ub,Cc,ic=null){this.ka=new Ma.a;this.TO=this.Jj=null;this.nGh=this.DGh=this.kj=!1;this.Rr=new bb.a;Ja.continueWith(()=>{this.Jj=Ja.result;this.Jj.ihb(Object(c.a)(this,this.Caj,"onRtcPresenceUpdate"));this.Jj.QQa(Object(c.a)(this,this.Baj,"onRtcConnectionChange"));this.Seh(null,null)});
sb.continueWith(()=>{this.TO=sb.result;this.TO.ghb(Object(c.a)(this,this.XJd,"onEditorsTableUpdated"))});ic&&ic.continueWith(()=>{ic.result.Wzk(Object(c.a)(this,this.Seh,"updateUserStatus"));this.Seh(null,null)});this.dAb=ub;this.D$c=Cc}get users(){return this.Rr}Cyc(Ja){this.ka.addHandler("UU",Ja)}FUe(Ja){this.ka.removeHandler("UU",Ja)}Seh(){if(this.Jj){var Ja=!1,sb=this.Jj.Osd();for(let Cc in sb){var ub=sb[Cc];const ic=Cc;this.users.Na(ic)&&(ub=this.CKj(ub),Ja=this.users.J(ic).P4b!==ub||Ja,this.users.J(ic).P4b=
ub)}Ja&&(Ja=new gd(4),this.VWe(Ja))}}CKj(Ja){return 1===Ja.status?0:1}llb(){this.users.count||(this.DGh||(Te.b(42316242,302,50,"No users available at PeopleInfoProvider.GetAllUsers call"),this.DGh=!0),this.ORm());const Ja=[];for(let sb of this.users)Array.add(Ja,sb.value);return Ja}ORm(){if(this.Jj){var Ja=this.Jj.G8b();this.eAg(Ja)}if(this.TO){Ja=this.TO.Jsd();for(const sb of Ja)sb.Id&&(Ja=this.Tdi(sb.Id),this.Reh(new gd,Ja))}}E1i(Ja){({value:Ja}=this.users.Ab(Ja));return Ja}dispose(){this.kj||(this.Jj&&
(this.Jj.tjc(Object(c.a)(this,this.Caj,"onRtcPresenceUpdate")),this.Jj.IQd(Object(c.a)(this,this.Baj,"onRtcConnectionChange"))),this.TO&&this.TO.noj(Object(c.a)(this,this.XJd,"onEditorsTableUpdated")),this.kj=!0)}Baj(Ja,sb){2===sb.newState&&(Ja=this.eAg(this.Jj.G8b()),Ja.ygg&&this.VWe(Ja))}XJd(Ja,sb){Ja=new gd;var ub=this.TO.Jsd();r.ULS.sendTraceTag(561894485,302,50,"editorstablemanager coauthors count is {0}, editorstableupdate old count of coauthors is {1}, editorstableupdate new count of coauthors is {2}",
ub.length,sb.FBm,sb.h6i);const Cc=new bb.a;for(var ic of ub){ub=ic.Id;const Ud=this.Tdi(ub);this.Reh(Ja,Ud);Cc.$(ub,Ud)}if((sb=sb.leaving)&&0<sb.length)for(ic=0;ic<sb.length;ic++)r.ULS.sendTraceTag(562415168,302,50,"{0} users in coauth gallery. User leaving the editor table: {1}",this.users.count,sb.J(ic).Id),({value:ub}=this.users.Ab(sb.J(ic).Id)).returnValue?ub?(this.users.remove(sb.J(ic).Id),Ja.vtb(2),Cc.$(sb.J(ic).Id,ub)):r.ULS.sendTraceTag(561287839,302,50,"Empty entry in PIP users: {0}",sb.J(ic).Id):
r.ULS.sendTraceTag(570426140,302,15,"Disconnected user not found: {0}",sb.J(ic).Id);sb=this.Jj.G8b();for(let Ud in sb)ic=this.D$c.$ye({key:Ud,value:sb[Ud]}),Cc.$(ic.clientId,ic);for(let Ud of this.users)Cc.Na(Ud.value.clientId)||(r.ULS.sendTraceTag(561287840,302,15,"Coauth Gallery contains user not in Editors Table or RTC presence: {0}",Ud.key),this.users.remove(Ud.key),Ja.vtb(2));Ja.ygg&&this.VWe(Ja)}Caj(Ja,sb){Ja=this.eAg(sb.GZa);for(const ub of sb.pre)this.users.Na(ub)&&(Ja.vtb(2),this.users.J(ub).P4b=
2);Ja.ygg&&this.VWe(Ja)}eAg(Ja){const sb=new gd;if(!Ja)return sb;for(let Cc in Ja){var ub=this.D$c.$ye({key:Cc,value:Ja[Cc]});ub&&(ub=ub.clone(),this.Reh(sb,ub))}return sb}Reh(Ja,sb){if(sb){var ub=sb.clientId;var Cc=this.wbn(sb);({value:sb}=this.users.Ab(ub)).returnValue?sb.equals(Cc)||(Ja.vtb(4),this.users.$(ub,Cc)):(r.ULS.sendTraceTag(562415169,302,50,"{0} users in coauth gallery. User joining: {1}",this.users.count,ub),Ja.vtb(1),this.users.$(ub,Cc))}}Tdi(Ja){return this.users.Na(Ja)?this.users.J(Ja):
ra.a1k(Ja)}wbn(Ja){if(!Ja||!Ja.clientId||!this.TO)return Ja;const sb=Ja.clone();sb.P4b=this.Kul(Ja);if(Ja=this.TO.rFc(sb.clientId))sb.isReadOnly=sb.isReadOnly||Ja.IsReadOnly?!0:!1,sb.userName=this.vbn(sb,Ja),sb.capabilities=this.xwm(sb.capabilities,Ja.Capabilities),sb.email=sb.email||Ja.SIPAddress||Ja.EmailAddress,Ja.JoinCoauthTime&&(sb.p6a=Ja.JoinCoauthTime);sb.color=this.dAb.axd(new Je.a(sb.email,void 0,sb.userName,void 0,sb.isAnonymous,sb.clientId),3);return sb}Kul(Ja){if(!this.Jj)return 2;if(Ja&&
Ja.clientId){const sb=this.Jj.Osd();if(Ja.clientId in sb)return this.CKj(sb[Ja.clientId])}return 2}UVk(Ja,sb){sb.Name&&Ja.userName&&sb.Name!==Ja.userName&&!this.nGh&&(this.nGh=!0,Te.b(42316243,302,15,"User names in EditorsTable and RTC don't match"))}xwm(Ja,sb){Ja=Ja||new fa;sb&&(sb.SupportsRealtimeChannel&&Ja.vtb(1),sb.SupportsRename&&Ja.vtb(2),sb.SupportsChat&&Ja.vtb(4));return Ja}vbn(Ja,sb){this.UVk(Ja,sb);return sb.Name||Ja.userName||(Ja.isAnonymous||sb.IsAnonymous?CommonUIStrings.l_GuestUserName:
null)}VWe(Ja){r.ULS.sendTraceTag(42316245,302,100,"PeopleInfoProvider update detected: {0}",Ja.toString());this.ka.raiseEvent("UU")}}Object(f.a)(cg,"PeopleInfoProvider",null,[1008,12]);var Jg;(function(Ja){Ja[Ja.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";Ja[Ja.peopleImageClassName=1]="peopleImageClassName";Ja[Ja.peopleImageClusterPath=4]="peopleImageClusterPath";Ja[Ja.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";Ja[Ja.imageDimension=6]="imageDimension";
Ja[Ja.rtl=8]="rtl";Ja[Ja.pointerInputManager=9]="pointerInputManager";Ja[Ja.clickInputManager=10]="clickInputManager";Ja[Ja.vertical=11]="vertical";Ja[Ja.zIndex=12]="zIndex";Ja[Ja.contextMenuInputManager=13]="contextMenuInputManager";Ja[Ja.imageDomElement=14]="imageDomElement";Ja[Ja.useIdleTooltip=15]="useIdleTooltip";Ja[Ja.viewportBoundsCallback=16]="viewportBoundsCallback";Ja[Ja.flipHorizontalDirection=17]="flipHorizontalDirection";Ja[Ja.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";
Ja[Ja.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";Ja[Ja.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(Jg||(Jg={}));Object(f.b)("PresenceTooltipSettingKeys",Jg);class Ga{constructor(){this.Qs={}}get(Ja,sb=null){Ja=Jg[Ja];return"number"===typeof sb?(sb=this.Qs[Ja])?Number.parseInvariant(sb.toString()):0:this.Qs[Ja]}add(Ja,sb){this.Qs[Jg[Ja]]=sb}k2a(Ja,sb){Jg[Ja]in this.Qs||(this.Qs[Jg[Ja]]=sb)}remove(Ja){delete this.Qs[Jg[Ja]]}}Object(f.a)(Ga,"PresenceTooltipSettings",null,
[]);class Oa extends Ma.a{constructor(Ja){super();this._element=null;this.element=Ja}get element(){return this._element}set element(Ja){this._element=Ja}get visible(){return"visible"===this.element.style.visibility}set visible(Ja){this.element.style.visibility=Ja?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl(Ja){this.element.dir=Ja?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex(Ja){this.element.style.zIndex=String(Ja)}dispose(){this.element&&
this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement(Ja){return this.element.ownerDocument.createElement(Ja)}bua(){return!0}static qdi(Ja){return"prControl"+(Ja?"Rtl":"")}}Object(f.a)(Oa,"BasePresenceControl",Ma.a,[12,941]);class Wb extends Sys.EventArgs{constructor(Ja,sb){super();this.type=Ja;this.kg=sb}}Wb.e0="InteractivityChanged";Object(f.a)(Wb,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class Ac{static sxl(Ja){return Ac.txl(Ja)}static txl(Ja){const sb=
document.createElementNS(Ac.$hh,"svg");sb.setAttribute("viewBox",String.format(Ac.H6k,Ac.bSj,Ac.aSj));sb.appendChild(Ac.NPl(Ja));return sb}static NPl(Ja){const sb=Ac.bSj/Ja,ub=2*sb,Cc=Ac.aSj/2;Ja=(Ja-12-8)*sb/2;const ic=document.createElementNS(Ac.$hh,"g");Sys.UI.DomElement.addCssClass(ic,Ac.G6k);for(let Ud=1;3>=Ud;Ud++)ic.appendChild(Ac.Bul(Ud,ub,Ja+(6*Ud-2)*sb,Cc));return ic}static Bul(Ja,sb,ub,Cc){const ic=document.createElementNS(Ac.$hh,"circle");Sys.UI.DomElement.addCssClass(ic,String.format("{0}-{1}",
Ac.yRk,Ja));ic.setAttribute("cx",String.format("{0}",ub));ic.setAttribute("cy",String.format("{0}",Cc));ic.setAttribute("r",String.format("{0}",sb));return ic}}Ac.$hh="http://www.w3.org/2000/svg";Ac.G6k="prDancingDots";Ac.yRk="prAnimateCircle";Ac.H6k="0 0 {0} {1}";Ac.aSj=40;Ac.bSj=120;Object(f.a)(Ac,"ModernPresenceTooltipDancingDots",null,[]);var sd=b(91),Xe=b(97),xe=b(7),we=b(59),bf=b(132),ch=b(54);class Pf extends Oa{constructor(Ja,sb){super(Ja);this.BRh=this.vyb=this.laf=this._img=this.PQ=this.Pt=
this.ag=null;this.y1a=sb.get(8,!1);this.byb=sb.get(6,0);this.rrk=sb.get(15,!1);this.xd=sb;this.Hvh=0;this.element=Ja;this.element.className=Pf.D2f;this._span=document.createElement("span");this.element.appendChild(this._span);this.b8j=Ac.sxl(sb.get(6,0));this.wD(sb);this._state=5}F2b(Ja){this.addHandler(Wb.e0,Ja)}ojc(Ja){this.removeHandler(Wb.e0,Ja)}get user(){return this.BRh}get state(){return this._state}dispose(){this.element&&(this.ag.kb(xe.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),
this.ag.kb(xe.a.nz,this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")),this.Pt.kb(xe.a.pointerDown,this.element,Object(c.a)(this,this.ZF,"onPointerDown")),this.Pt.kb(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut")),this.Pt.kb(xe.a.pointerOver,this.element,Object(c.a)(this,this.R4,"onPointerOver")),this.PQ.kb(this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}wD(Ja){this.ag=Ja.get(10);this.ag.Ea(xe.a.click,
this.element,Object(c.a)(this,this.onClick,"onClick"));this.ag.Ea(xe.a.nz,this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior"));this.Pt=Ja.get(9);this.Pt.Ea(xe.a.pointerOver,this.element,Object(c.a)(this,this.R4,"onPointerOver"));this.Pt.Ea(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut"));this.Pt.Ea(xe.a.pointerDown,this.element,Object(c.a)(this,this.ZF,"onPointerDown"));this.PQ=Ja.get(13);this.PQ.Ea(this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior"))}hide(Ja=
null,sb=0,ub=0){this.rrk&&Ja?this.hvn(Ja,sb,ub):(3===this.state&&this.Zmj(),this.visible=!1,this._state=5)}hvn(Ja,sb,ub=0){this.show(Ja,sb,15,4,void 0,ub)}cCj(Ja,sb,ub=!1,Cc=!1,ic=!1,Ud=0){this.show(Ja,sb,20,ub?2:Cc?1:0,ic,Ud)}Kun(Ja,sb,ub,Cc=!1,ic=0){this.show(Ja,sb,ub+20,3,Cc,ic)}show(Ja,sb,ub,Cc=3,ic=!1,Ud=0){!Ja||Cc===this.state&&this.wZl(sb,ub)||(this.Utk(Cc,ic,Ud),this.lqa(Ja,Cc,Ud),this._state=Cc,4===Ud||0===Ud&&!this.y1a?this.element.style.left=sb+"px":this.element.style.right=sb+"px",this.element.style.top=
ub+"px",this.visible=!0)}lqa(Ja,sb,ub){this.BRh=Ja;ch.a.HA(this._span);bf.a.v7h(this._span);this._span.id="fly_"+Ja.clientId;this._span.style.backgroundColor=Ja.color;4!==sb?(this._span.style.height=this.byb+"px",this._span.style.lineHeight=this.byb+"px",bf.a.mNb(this._span,"border-radius",this.byb+"px")):4===ub||0===ub&&!this.y1a?this._span.style.left="0px":this._span.style.right="0px";2!==sb&&(4===sb?ch.a.dA(this._span,""):1===sb?this._span.appendChild(this.b8j):(this._span.setAttribute("dir","auto"),
ub=ya.a.Kyi(Ja.userName,!1),(!Ja.isAnonymous||m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&ub||0!==sb?(Ja=Ja.userName,0===sb&&(Ja=ub,bf.a.mNb(this._span,"text-align","center")),ch.a.dA(this._span,Ja)):(this._img||(this._img=this.f_k()),this._span.appendChild(this._img),bf.a.mNb(this._span,"text-align","start"))))}onClick(Ja){if(0===this.state)return this.raiseEvent(Wb.e0,new Wb(1,Ja)),!0;3===this.state&&r.ULS.sendTraceTag(50436114,
302,50,"User clicked on presence pill.");return!1}sV(Ja){3===this.state&&this.raiseEvent(Wb.e0,new Wb(3,Ja));return!1}R4(Ja){3!==Ja.ed&&this.raiseEvent(Wb.e0,new Wb(2,Ja));return!1}ZF(Ja){if(3!==Ja.ed)return!0;this.raiseEvent(Wb.e0,new Wb(4,Ja));return!1}f_k(){const Ja=document.createElement("img");Ja.src=sd.a.A3("doughperson_white_glyph.svg");Ja.setAttribute("Unselectable","on");we.a.Qq(Ja,we.a.ig,we.a.Ix);return Xe.createClusteredImageFromClusterWithImageClass(this.byb,this.byb,null,null,Pf.snl,
"",!1,"",this.element.ownerDocument,Ja)}Utk(Ja,sb=!1,ub=0){if(!this.TBd(this.state)||!this.TBd(Ja))switch(Sys.UI.DomElement.removeCssClass(this.element,this.laf),this.state){case 4:3===Ja?this.Vgb(Pf.E2f,Pf.Tpi):this.TBd(Ja)&&this.Vgb(Pf.C2f,Pf.Tpi);break;case 3:4===Ja?this.Vgb(Pf.H2f,Pf.Spi):this.TBd(Ja)&&(sb&&this.Zmj(),this.Vgb(Pf.C2f,Pf.Spi,sb?Pf.rnl:""));break;case 0:case 1:case 2:4===Ja?this.Vgb(Pf.H2f,Pf.F2f):3===Ja&&(sb&&this.Quk(),this.Vgb(Pf.E2f,Pf.F2f,sb?Pf.Upi:"",3===ub?Pf.vnl:Pf.tnl));
break;default:4===Ja?this.Vgb(Pf.H2f):3===Ja?this.Vgb(Pf.E2f):this.TBd(Ja)&&this.Vgb(Pf.C2f)}}Vgb(...Ja){this.laf=Ja.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.laf)}Quk(){this.Hvh=window.setTimeout(()=>{this.element&&(this.vyb=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.vyb),this.element.style.zIndex="2",this.vyb.style.zIndex="1")},300)}Zmj(){window.clearTimeout(this.Hvh);this.vyb&&(Sys.UI.DomElement.removeCssClass(this.vyb,Pf.F2f+" "+Pf.Upi),Sys.UI.DomElement.addCssClass(this.vyb,
Pf.qnl),G.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.vyb.parentNode&&this.element.parentNode.removeChild(this.vyb)}),bf.a.mjc(this.element,"z-index"))}TBd(Ja){return 0===Ja||1===Ja||2===Ja}wZl(Ja,sb){const ub=bf.a.P0(this.element.style.top);return bf.a.P0(this.element.style.left)===Ja&&ub===sb}CWg(Ja){3===Ja&&bf.a.NG(this.element,"left")?(Ja=bf.a.P0(this.element.style.left),bf.a.mjc(this.element,"left"),this.element.style.right=-1*Ja+"px"):4===Ja&&bf.a.NG(this.element,
"right")&&(Ja=bf.a.P0(this.element.style.right),bf.a.mjc(this.element,"right"),this.element.style.left=-1*Ja+"px")}}Pf.D2f="prModernFlyout UIFont";Pf.H2f="flyoutIdle";Pf.E2f="flyoutExpanded";Pf.C2f="flyoutCollapsed";Pf.Tpi="flyoutFromIdle";Pf.Spi="flyoutFromExpanded";Pf.F2f="flyoutFromCollapsed";Pf.Upi="flyoutStacked";Pf.rnl="flyoutFromStacked";Pf.qnl="flyoutFadeOut";Pf.snl="cui-img-cont-float cui-img-20by20";Pf.tnl="flyoutLtrDir";Pf.vnl="flyoutRtlDir";Object(f.a)(Pf,"ModernPresenceTooltipFlyoutControl",
Oa,[]);class Eg{constructor(Ja,sb,ub=2,Cc=4){this.offsetTop=Ja;this.offsetLeft=sb;this.ZRj=ub;this.HKi=Cc}}Object(f.a)(Eg,"FlyoutsPositioningInfo",null,[]);var th=b(36);class Ph{constructor(Ja=!1,sb=!1){this.Kl=Ja;this.kff=sb}kEl(Ja,sb,ub,Cc,ic){const Ud=ic.y,ae=ic.height;var He=this.Ctl(Cc);const lf=He+sb,Of=Ja*ub+2*(Ja-1);ub=null;1===Ja||this.VNk(He,Of,Ud,ae)?Ja=new Eg(0,0,2):(Ja=this.m2f(lf,Of,Ud,ae),Ja.offsetTop-=He);this.kff?ub=new Eg(0,0,void 0,this.Kl?4:3):(Cc=this.Btl(Cc,ic),He=Math.max(0,
ic.x),ic=ic.width,sb=Cc+sb,this.WNk(Cc,He,ic)?ub=new Eg(0,0,void 0,this.Kl?3:4):this.XNk(sb,He)&&(ub=new Eg(0,0,void 0,this.Kl?4:3)),ub||(ub=this.kml(Cc,sb,He,ic)));return new Eg(Ja.offsetTop,ub.offsetLeft,Ja.ZRj,ub.HKi)}Ctl(Ja){return th.a.oTa(Ja)}Btl(Ja,sb){return this.Kl?sb.width-th.a.O5f(Ja):th.a.Yve(Ja)}VNk(Ja,sb,ub,Cc){return Ja+sb<=ub+Cc}m2f(Ja,sb,ub,Cc){let ic=1,Ud=Math.max(ub,Ja-sb);sb>Ja-ub&&(ic=2,Ud=sb<Cc?Cc-sb:ub);return new Eg(Ud,0,ic)}WNk(Ja,sb,ub){return Ja+150<=sb+ub}XNk(Ja,sb){return 150<=
Ja-sb}kml(Ja,sb,ub,Cc){Cc-sb>=Ja-ub?Ja=4:(sb=Ja,Ja=3);return new Eg(0,sb,void 0,Ja)}}Object(f.a)(Ph,"ModernPresenceTooltipPositioner",null,[]);class pf{constructor(Ja,sb,ub,Cc,ic,Ud,ae){this.bja=Ja;this._parent=sb;this.irh=ub;this.s5j=Cc;this.lbk=ic;this.bxc=Ud;this.y1a=ae;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update(Ja,sb){if(3!==Ja)if(5!==Ja&&this.bja&&this.bja.length){if(4===Ja){var ub=this.lbk;var Cc=(this.bxc-ub)/
2;this.element.style.height=this.bxc+"px";this.element.style.width=this.bxc+"px";Ja=bf.a.P0(this.bja[0].element.style.top);sb=bf.a.P0(this.y1a?this.bja[0].element.style.right:this.bja[0].element.style.left)}else ub=this.irh,Cc=(this.bxc-ub)/2,this.element.style.height=this.bxc+"px",this.element.style.width=this.Nul()+2*Cc+"px",Ja=bf.a.P0(this.bja[this.bja.length-1].element.style.top),sb=this.fNk(this.bja[this.bja.length-1].element,ub,sb);bf.a.mNb(this.element,"border-radius",this.bxc+"px");this.element.style.top=
Ja-Cc-ub+"px";this.y1a?this.element.style.right=sb-Cc+"px":this.element.style.left=sb-Cc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&this.element.parentNode.removeChild(this.element)}fNk(Ja,sb,ub){return this.y1a&&!ub?bf.a.P0(Ja.style.right):this.y1a||ub?this.y1a&&ub?-bf.a.P0(Ja.style.left)-sb:-bf.a.P0(Ja.style.right)-sb:bf.a.P0(Ja.style.left)}Nul(){return this.bja&&this.bja.length?this.irh+Math.min(this.bja.length-1,
2)*this.s5j:0}}Object(f.a)(pf,"ModernPresenceTooltipTarget",null,[]);var rk=b(170),Xi=b(185);class Vf extends Oa{constructor(Ja,sb,ub){super(Ja);this.Wvc=this.x0a=this.Fzh=this.MTb=!1;this.Rr=[];this.v3c={};this.xd=ub;this.Kl=ub.get(8,!1);this.Ryh=ub.get(15,!1);this.Y6j=ub.get(12,0);this.CCb=ub.get(6,0);this.QAb=sb;this.SRh=ub.get(16);this.kff=ub.get(17,!1);this.obk=ub.get(19,!1);this.Kjk=ub.get(20,!1);this.i$d=0;this.Djk=new Ph(this.Kl,this.kff);this.rXc=this.bwi();this.SYb=!1;this.aqc=[];this.y3c=
[];this.element.id=Vf.gFb();this.element.className=Oa.qdi(this.Kl);this.wjb&&(this.zIndex=this.wjb);this.rtl=this.Kl;this.f0g(sb);this.mea=this.createElement("div");this.mea.className="prFlyoutContainer";this.element.appendChild(this.mea);this.bja=[];this.Ryb=new pf(this.aba,this.element,this.CCb,4,6,32,this.Kl);this.Pt=ub.get(9);this.Pt.Ea(xe.a.pointerDown,this.Ryb.element,Object(c.a)(this,this.NNc,"onHitTarget"));this.Pt.Ea(xe.a.pointerOver,this.Ryb.element,Object(c.a)(this,this.NNc,"onHitTarget"));
this.Pt.Ea(xe.a.pointerOut,this.Ryb.element,Object(c.a)(this,this.NNc,"onHitTarget"))}get DRe(){return Xi.a.clone(this.Rr)}get aba(){return this.bja}get wjb(){return this.Y6j}get Tkb(){return this.aba?this.aba.length:0}get Vnc(){return 0<this.Tkb?this.aba[0].state:5}get iog(){return 3===this.Vnc&&!this.MTb}F2b(Ja){this.addHandler(Wb.e0,Ja)}ojc(Ja){this.removeHandler(Wb.e0,Ja)}dispose(){if(this.iog)this.SYb=!0;else{if(this.aba)for(const Ja of this.aba)Ja.ojc(Object(c.a)(this,this.k7a,"onInteractivityChanged")),
Ye.a.np(Ja);this.bja=null;this.Pt.kb(xe.a.pointerDown,this.Ryb.element,Object(c.a)(this,this.NNc,"onHitTarget"));this.Pt.kb(xe.a.pointerOver,this.Ryb.element,Object(c.a)(this,this.NNc,"onHitTarget"));this.Pt.kb(xe.a.pointerOut,this.Ryb.element,Object(c.a)(this,this.NNc,"onHitTarget"));super.dispose()}}fTc(){this.QAc();this.visible=!0}EVd(){this.visible=!0;this.mmi();this.MTb=!0}i5g(){this.EVd()}hide(){this.Dnj();this.bnb();this.Ryb.update(this.Vnc,this.Wvc)}lqa(Ja){const sb=this.Vnc,ub=this.MTb;Ja.clientId||
(Ja.clientId=(Vf.T3c++).toString());if(Ja.clientId in this.v3c){var Cc=this.c8b(Ja.clientId);if(0<=Cc){Cc=this.Rr[Cc];if(Cc.color===Ja.color&&Cc.userName===Ja.userName)return;this.osb(Ja.clientId)}}this.hide();Cc=new Pf(this.createElement("div"),this.xd);Cc.F2b(Object(c.a)(this,this.k7a,"onInteractivityChanged"));this.mea.insertBefore(Cc.element,this.mea.firstChild);this.v3c[Ja.clientId]=Cc;Array.add(this.Rr,Ja);Array.add(this.aba,Cc);this.wQj(sb,ub);this.visible=!0}osb(Ja){if(this.iog)Array.add(this.y3c,
Ja);else{var sb=this.Vnc,ub=this.MTb;this.hide();this.EQd(Ja);this.wQj(sb,ub)}}wQj(Ja,sb){0>=this.Rr.length?this.hide():3===Ja&&sb?this.EVd():this.fTc()}R_f(Ja){if(this.iog&&this.obk)return!1;Ja=Vf.lbg(Ja);if(this.mea!==Ja&&ch.a.LAa(this.mea,Ja))return!0;for(const sb of this.aba)if(ch.a.LAa(sb.element,Ja))return!0;return!1}position(Ja,sb){this.element.style.top=sb+"px";this.element.style.left=Ja+"px"}QAc(Ja=!1){if(!Ja||this.x0a){this.Fzh&&this.Nyj(!0);var sb=Math.min(3,this.Tkb)-1;Ja=0;var ub=1,Cc=
0;this.Wvc&&(Ja=this.rXc,ub=-1,Cc=-this.CCb);for(let ic=this.Tkb-1;ic>sb;ic--)this.aba[ic].cCj(this.Rr[ic],-4*sb*ub+Cc,!0,!1,!0,Ja);for(;0<=sb;sb--)this.aba[sb].cCj(this.Rr[sb],-4*sb*ub+Cc,0<sb,Array.contains(this.aqc,this.Rr[sb].clientId),sb!==this.i$d,Ja);this.i$d=0;this.Ryb.update(0,this.Wvc);this.zIndex=this.wjb;this.MTb=!1;this.Dnj(0);this.SYb&&this.dispose()}}mmi(){this.Fzh&&this.Nyj(!1);this.zIndex=this.wjb+1;let Ja,sb,ub;({offsetX:sb,offsetY:Ja,GKi:ub}=this.Oln());for(let Cc=0;Cc<this.Tkb;Cc++)this.aba[Cc].Kun(this.Rr[Cc],
sb,Ja+(this.CCb+2)*Cc,Cc!==this.i$d,ub)}bnb(){let Ja=0,sb=0;this.Wvc&&(Ja=this.rXc,sb=-6);for(let ub=0;ub<this.Tkb;ub++)this.aba[ub].hide(this.Rr[ub],sb,Ja);this.zIndex=this.wjb;this.visible=this.MTb=!1;this.SYb&&this.dispose()}lNf(Ja=0){Ja?(this.x0a=!0,G.Task.delay(Ja).continueWith(()=>{this.Ryh?this.y_l():this.QAc(!0);this.x0a=!1})):this.Ryh?this.hide():this.QAc()}y_l(){this.x0a&&this.hide()}mHk(){if(m.AFrameworkApplication.la&&m.AFrameworkApplication.la.eb.Qma&&rk.c()){const Ja=appChrome.selectors.getShyState();
return Ja.isActive&&0!==Ja.state}return!1}k7a(Ja,sb){Ja=this.Vnc;this.mHk()||2!==sb.type&&(4!==sb.type||3===Ja)?4===sb.type&&3===Ja?(this.x0a&&(this.x0a=!1),this.lNf()):3!==sb.type||3!==Ja||this.MTb||(1<this.Tkb?(this.x0a=!0,G.Task.delay(250).continueWith(()=>{this.QAc(!0);this.x0a=!1})):this.lNf()):(this.x0a&&(this.x0a=!1),3!==Ja&&(this.mmi(),3===sb.kg.ed&&this.lNf(2E3)));this.raiseEvent(Wb.e0,sb)}NNc(Ja){3===Ja.ed?this.k7a(this,new Wb(4,Ja)):Ja.eventName===xe.a.pointerOver?this.k7a(this,new Wb(2,
Ja)):Ja.eventName===xe.a.pointerOut&&this.k7a(this,new Wb(3,Ja));return!1}f0g(Ja){this.element.style.width=Ja+"px";this.element.style.height=this.CCb+"px"}EQd(Ja){this.x5m(Ja);Ja=this.c8b(Ja);if(!(0>Ja)){var sb=this.Rr[Ja];Array.removeAt(this.Rr,Ja);delete this.v3c[sb.clientId];sb=this.aba[Ja];this.mea.removeChild(sb.element);this.xd.get(18,!1)&&sb.ojc(Object(c.a)(this,this.k7a,"onInteractivityChanged"));Array.removeAt(this.aba,Ja);sb.dispose()}}Dnj(Ja=5){if(this.y3c.length){this.visible&&this.bnb();
for(let sb=0;sb<this.y3c.length;sb++)this.EQd(this.y3c[sb]);Array.clear(this.y3c);0>=this.Rr.length||5===Ja?this.hide():0===Ja&&this.fTc()}}c8b(Ja){for(let sb=0;sb<this.Rr.length;sb++)if(this.Rr[sb].clientId===Ja)return sb;return-1}kym(Ja){if(Ja in this.v3c){var sb=this.c8b(Ja);if(sb){const ub=this.Rr[sb];Ja=this.v3c[Ja];Array.removeAt(this.Rr,sb);Array.insert(this.Rr,0,ub);Array.removeAt(this.aba,sb);Array.insert(this.aba,0,Ja);this.mea.removeChild(Ja.element);this.mea.appendChild(Ja.element);this.QAc()}}}x5m(Ja){-1===
this.c8b(Ja)?r.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):Array.contains(this.aqc,Ja)&&(Array.remove(this.aqc,Ja),this.Rr[0].clientId===Ja&&0<this.aqc.length&&this.kym(this.aqc[this.aqc.length-1]),this.Rr[0].clientId===Ja&&1===this.Vnc&&this.QAc())}Nyj(Ja){Ja?Sys.UI.DomElement.addCssClass(this.mea,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.mea,"prBackgroundSelection")}Oln(){let Ja,sb;sb=Ja=0;var ub=this.rXc;if(this.SRh){const Cc=
this.SRh(this);if(!Cc)return{offsetX:Ja,offsetY:sb,GKi:ub};const ic=4===this.Vnc;ub=this.Djk.kEl(this.Tkb,ic?6:this.CCb,this.CCb,this.element,Cc);sb=ub.offsetTop;this.i$d=this.cDl(ub.ZRj,ub.offsetTop);ub=ub.HKi;ub!==this.rXc&&(this.CWg(ub),this.element.dir=3===ub?"rtl":"ltr",this.rXc=ub);ub!==this.bwi()?(Ja=this.Kjk?-2:ic?-6:-this.CCb,this.Wvc=!0):this.Wvc=!1}return{offsetX:Ja,offsetY:sb,GKi:ub}}cDl(Ja,sb){if(1===Ja)return this.Tkb-1;Ja=Math.abs(sb);return 0<Ja?Ja/(this.CCb+2):0}CWg(Ja){for(let sb=
0;sb<this.Tkb;sb++)this.aba[sb].CWg(Ja)}bwi(){return this.Kl?3:4}static gFb(){return String.format("{0}-{1}","presencetooltip",Vf.T3c++)}static lbg(Ja){return Ja.Ua.rawEvent.relatedTarget}}Vf.T3c=0;Object(f.a)(Vf,"ModernPresenceTooltipControl",Oa,[994,12]);var Qc=b(238),pd=b(241);class mf{constructor(Ja){this.xd=Ja;this.xd.k2a(10,Qc.a.instance);this.xd.k2a(9,Cd.a.instance);this.xd.k2a(6,20);this.xd.k2a(13,pd.a.instance);this.xd.k2a(17,!1)}SQf(Ja,sb=!1){this.xd.k2a(15,sb);return new Vf(Ja,20,this.xd)}}
Object(f.a)(mf,"ModernPresenceTooltipFactory",null,[993]);class ef extends Oa{constructor(Ja,sb){super(Ja);this.Rr=null;this.y1a=sb.get(8,!1);this.byb=sb.get(6,0);this.element=Ja;this.element.className=ef.D2f;this._ul=this.createElement("ul");this.element.appendChild(this._ul);this.ag=sb.get(10);this.ag.Ea(xe.a.click,this.element,Object(c.a)(this,this.onClick,"onClick"));this.Pt=sb.get(9);this.Pt.Ea(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut"));this.Pt.Ea(xe.a.pointerDown,
this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior"));this.PQ=sb.get(13);this.PQ.Ea(this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior"))}F2b(Ja){this.addHandler(Wb.e0,Ja)}ojc(Ja){this.removeHandler(Wb.e0,Ja)}get users(){return this.Rr}dispose(){this.element&&(this.ag.kb(xe.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.Pt.kb(xe.a.pointerDown,this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")),
this.Pt.kb(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut")),this.PQ.kb(this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}hide(){this.visible=!1}show(Ja,sb,ub){this.hide();!Ja||0>=Ja.length||(this.y1a?this.element.style.right=sb+"px":this.element.style.left=sb+"px",this.element.style.top=ub+"px",this.nxk(Ja),this.visible=!0)}nxk(Ja){this.Rr=Ja;ch.a.HA(this._ul);for(let sb=Ja.length-1;0<=sb;sb--)this.lqa(Ja[sb])}lqa(Ja){const sb=
document.createElement("li");sb.style.backgroundColor=Ja.color;sb.style.height=this.byb+"px";sb.id="fly_"+Ja.clientId;sb.style.lineHeight=this.byb+"px";ch.a.dA(sb,Ja.userName);sb.setAttribute("dir","auto");this._ul.appendChild(sb)}onClick(){this.hide();return!1}sV(Ja){this.raiseEvent(Wb.e0,new Wb(3,Ja));return!1}}ef.D2f="prFlyout UIFont";Object(f.a)(ef,"PresenceTooltipFlyoutControl",Oa,[]);class Ae extends Oa{constructor(Ja,sb,ub){super(Ja);this._img=null;this.Rr=[];this.element.className="prGlyph";
this.xd=sb;this.Avc=this.xd.get(9);this.Jl=this.xd.get(10);this.PQ=this.xd.get(13);this.K_l();this.lqa(ub);this.ijf=!1}get Hqb(){return this.Rr.length}get users(){return this.Rr}F2b(Ja){this.addHandler(Wb.e0,Ja)}ojc(Ja){this.removeHandler(Wb.e0,Ja)}dispose(){this.gJn();super.dispose()}lqa(Ja){Array.add(this.Rr,Ja);2===this.Hqb?this.uua(!0):1===this.Hqb?this.uua(!1):this.uua(this.ijf)}osb(Ja){this.Zjl(Ja)&&(1<this.Hqb&&this.uua(!0),1===this.Hqb?this.uua(!1):1>this.Hqb&&this.hide())}show(){this.uua(2<=
this.Hqb);this.visible=!0}hide(){this.visible=!1}PCl(Ja){return Ja?this.Lui(0,5):this.Lui(1,4)}Zjl(Ja){for(let sb=0;sb<this.Hqb;sb++)if(this.Rr[sb].clientId===Ja)return Ja=this.Rr[sb],Array.removeAt(this.Rr,sb),Ja;return null}uua(Ja){this.ijf!==Ja&&(this._img&&this.element.removeChild(this._img),this._img=this.PCl(Ja),this.element.appendChild(this._img),this.ijf=Ja);this._img.childNodes[0].style.backgroundColor=this.Rr[this.Rr.length-1].color}Lui(Ja,sb){const ub=this.xd.get(6,0),Cc=this.xd.get(14);
return Xe.createClusteredImageFromClusterWithImageClass(ub,ub,this.xd.get(Ja),this.xd.get(sb),"cui-img-cont-float cui-img-16by16","",!1,"",this.element.ownerDocument,Cc?Cc.cloneNode(!0):null)}R4(Ja){3!==Ja.ed&&this.raiseEvent(Wb.e0,new Wb(2,Ja));return!1}onClick(Ja){this.raiseEvent(Wb.e0,new Wb(1,Ja));return!0}sV(Ja){3!==Ja.ed&&this.raiseEvent(Wb.e0,new Wb(3,Ja));return!1}gJn(){this.element&&(this.Avc.kb(xe.a.pointerDown,this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")),
this.Avc.kb(xe.a.pointerOver,this.element,Object(c.a)(this,this.R4,"onPointerOver")),this.Avc.kb(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut")),this.Jl.kb(xe.a.nz,this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")),this.Jl.kb(xe.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.PQ.kb(this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")))}K_l(){this.element&&(this.Avc.Ea(xe.a.pointerDown,this.element,
Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")),this.Avc.Ea(xe.a.pointerOver,this.element,Object(c.a)(this,this.R4,"onPointerOver")),this.Avc.Ea(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut")),this.Jl.Ea(xe.a.nz,this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")),this.Jl.Ea(xe.a.click,this.element,Object(c.a)(this,this.onClick,"onClick")),this.PQ.Ea(this.element,Object(c.a)(this,this.bua,"stopPropagationAndPreventDefaultBehavior")))}}
Object(f.a)(Ae,"PresenceTooltipGlyph",Oa,[]);class id extends Oa{constructor(Ja,sb,ub){super(Ja);this.Rr=[];this.dP=[];this.V0a=0;this.xcd=this.Rsc=!1;this.Bnh=null;this.b8d={};this.xd=ub;this.Kl=ub.get(8,!1);this.cwa=ub.get(11,!1);Ja=ub.get(12,0);this.imageDimension=ub.get(6,0);this.QAb=sb;this.element.id=id.gFb();this.element.className=Oa.qdi(this.Kl);Ja&&(this.zIndex=Ja);this.rtl=this.Kl;this.f0g(sb);this.INa=this.createElement("div");this.INa.className=this.cwa?"prContainerV":"prContainerHr";
this.element.appendChild(this.INa);this.Jwh=Array(this.V0a);for(sb=0;sb<this.V0a;sb++)this.Ila[sb]=new ef(this.createElement("div"),this.xd),this.Ila[sb].F2b(Object(c.a)(this,this.k7a,"onInteractivityChanged")),this.element.appendChild(this.Ila[sb].element)}get DRe(){return Xi.a.clone(this.Rr)}get Ila(){return this.Jwh}get mTh(){return this.Bnh}get o_e(){return this.imageDimension+2}get width(){return this.cwa?this.o_e:this.QAb}get height(){return this.cwa?this.QAb:this.o_e}F2b(Ja){this.addHandler(Wb.e0,
Ja)}ojc(Ja){this.removeHandler(Wb.e0,Ja)}dispose(){if(this.Ila)for(const Ja of this.Ila)Ja.ojc(Object(c.a)(this,this.k7a,"onInteractivityChanged")),Ye.a.np(Ja);Ye.a.jWe(this.dP);this.dP=this.Jwh=null;super.dispose()}fTc(){this.bnb();this.D5g();this.visible=!0;this.Rsc=!1}EVd(){!this.dP||1>this.dP.length||(this.bnb(),this.visible=!0,this.D5g(),this.sRe(this.dP[this.dP.length-1]),this.Rsc=!0)}i5g(){if(this.dP&&!(1>this.dP.length)){this.visible=!0;this.D5g();var Ja=0;for(const sb of this.dP)this.sRe(sb,
Ja++);this.Rsc=!1;this.xcd=!0}}hide(){this.visible=!1;this.bnb();for(let Ja=0;Ja<this.dP.length;Ja++)this.dP[Ja].hide();this.Rsc=!1}g6h(){if(!this.xcd)return!1;let Ja=0;for(const sb of this.Ila)sb.visible&&Ja++;return this.xcd=0<Ja&&(this.Rr.length<=this.V0a?Ja===this.Rr.length:Ja===this.V0a)}lqa(Ja){if(!(0>=this.V0a)){Ja.clientId||(Ja.clientId=(id.T3c++).toString());if(Ja.clientId in this.b8d){var sb=this.c8b(Ja.clientId);if(0<=sb){sb=this.Rr[sb];if(sb.color===Ja.color&&sb.userName===Ja.userName)return;
this.osb(Ja.clientId)}}sb=this.g6h();var ub=0;if(this.Rr.length<this.V0a){var Cc=new Ae(this.createElement("div"),this.xd,Ja);Cc.F2b(Object(c.a)(this,this.k7a,"onInteractivityChanged"));this.Kl&&!this.cwa&&0<this.Rr.length?this.INa.insertBefore(Cc.element,this.INa.firstChild):(this.INa.appendChild(Cc.element),ub=this.dP.length);Array.add(this.dP,Cc)}else this.Kl&&!this.cwa?Cc=this.dP[0]:(ub=this.dP.length-1,Cc=this.dP[ub]),Cc.lqa(Ja);Cc.show();this.b8d[Ja.clientId]=Cc;Array.add(this.Rr,Ja);this.DOj(Cc,
ub);sb&&this.i5g()}}osb(Ja){const sb=this.g6h();sb&&this.bnb();this.EQd(Ja);this.Rr.length>=this.V0a&&this.dP.length<this.V0a&&this.G_m();0>=this.Rr.length?this.hide():sb&&this.i5g()}EQd(Ja){var sb=this.c8b(Ja);0>sb||(Ja=this.Rr[sb],Array.removeAt(this.Rr,sb),sb=this.b8d[Ja.clientId],delete this.b8d[Ja.clientId],sb.osb(Ja.clientId),this.DOj(sb),0>=sb.Hqb&&(this.INa.removeChild(sb.element),Array.remove(this.dP,sb),sb.dispose()))}G_m(){var Ja=this.rIl();!Ja||1>=Ja.users.length||(Ja=Array.clone(this.Rr),
Ja.forEach(sb=>{this.EQd(sb.clientId)}),Ja.forEach(sb=>{this.lqa(sb)}))}c8b(Ja){for(let sb=0;sb<this.Rr.length;sb++)if(this.Rr[sb].clientId===Ja)return sb;return-1}rIl(){return this.Kl&&!this.cwa?this.dP[0]:this.dP[this.dP.length-1]}position(Ja,sb){this.element.style.top=sb+"px";this.element.style.left=Ja+"px"}D5g(){for(let Ja=0;Ja<this.dP.length;Ja++)this.dP[Ja].show()}bnb(){for(let Ja=0;Ja<this.V0a;Ja++)this.Ila[Ja].hide();this.xcd=!1}sRe(Ja,sb=0){if(Ja)if(this.Bnh=Ja,this.cwa){const ub=this.imageDimension;
if(1<Ja.users.length)this.Ila[sb].show(Ja.users,ub,this.height-this.imageDimension);else{const Cc=this.INa.children.length;for(let ic=0;ic<this.INa.children.length;ic++)Ja.element===this.INa.children[ic]&&this.Ila[sb].show(Ja.users,ub,this.height-(Cc-ic)*this.o_e+2)}}else this.Ila[sb].show(Ja.users,this.width,0)}k7a(Ja,sb){var ub=Object(k.a)(Ae,Ja);ub=ub?this.ioi(ub):-1;if(2===sb.type||1===sb.type&&-1!==ub&&!this.Ila[ub].visible)this.sRe(Ja);else if(1===sb.type)this.bnb(),this.Rsc=!1;else if(3===
sb.type){if(this.R_f(sb.kg))return;this.Rsc||this.bnb()}this.raiseEvent(Wb.e0,sb)}R_f(Ja){Ja=id.lbg(Ja);let sb=!1;for(const ub of this.Ila)if(ch.a.LAa(ub.element,Ja)){sb=!0;break}return this.INa!==Ja&&ch.a.LAa(this.INa,Ja)||sb}DOj(Ja,sb=0){const ub=this.T7l(Ja);ub&&0>=Ja.Hqb?this.Ila[sb].hide():ub?this.sRe(Ja):this.Ila[sb].hide()}ioi(Ja){let sb=0;for(const ub of this.dP){if(Ja===ub)return sb;sb++}return-1}T7l(Ja){const sb=this.ioi(Ja);return!!this.mTh&&Ja===this.mTh&&-1!==sb&&this.Ila[sb].visible}f0g(Ja){this.V0a=
Ja===this.imageDimension?1:Math.floor(Ja/this.o_e);this.cwa?(this.element.style.height=Ja+"px",this.element.style.width=this.imageDimension+"px"):(this.element.style.width=Ja+"px",this.element.style.height=this.imageDimension+"px")}static gFb(){return String.format("{0}-{1}","presencetooltip",id.T3c++)}static lbg(Ja){Ja=Ja.Ua.rawEvent;return Ja.relatedTarget||Ja.toElement}}id.T3c=0;Object(f.a)(id,"PresenceTooltipControl",Oa,[994,12]);class Ah{constructor(Ja){this.xd=Ja;this.xd.k2a(10,Qc.a.instance);
this.xd.k2a(9,Cd.a.instance);this.xd.k2a(6,16);this.xd.k2a(13,pd.a.instance)}SQf(Ja){return new id(Ja,16,this.xd)}}Object(f.a)(Ah,"PresenceTooltipFactory",null,[993]);var Bh=b(252),wg=b(107),li=b(58),Hh=b(6),vj=b(5),uh=b(21),ai=b(86),pk=b(38),fk=b(527),ak=b(282),Kg=b(244);class sk extends Sys.EventArgs{constructor(Ja,sb){super();this.paragraphId=Ja;this.okm=sb}}Object(f.a)(sk,"PresenceControlRenderedEventArgs",Sys.EventArgs,[]);class fh extends Oa{constructor(Ja,sb,ub,Cc,ic,Ud=null,ae=null){super(null);
this.T7d=this.Zn=null;this.ZFd=!1;this.GDa=0;this.Nq=Ja;this.Odd=sb;this.Pt=ub;this.Bg=Cc;this.w_a=ic;fh.iUb=0;this.mYh=new bb.a;this.arj=new bb.a;this.O2=Ud;this.va=ae;this.B9j=this.va.jb("PresenceIpRenderedFloodgateTimeLapseSec",30);this.Gqk=this.va.jb("PresenceIpRenderedFloodgateTriggerThreshold",3);this.EEa=0}get nqb(){return m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled")}Lxk(Ja){this.addHandler("CR",Ja)}loj(Ja){this.removeHandler("CR",Ja)}yTe(){this.raiseEvent("CR",new sk(this.Nq.ip.paragraphId,
this.ZFd))}fBg(){if(Object(Kg.a)(Vf,this.Zn)){const Ja=Object(k.a)(Vf,this.Zn);fh.iUb=0<fh.iUb?fh.iUb+1:Ja.wjb+1;Ja.zIndex=fh.iUb;this.element.style.zIndex=String(fh.iUb)}}Qan(){if(Object(Kg.a)(Vf,this.Zn)){const Ja=Object(k.a)(Vf,this.Zn);fh.iUb=Ja.wjb;Ja.zIndex=Ja.wjb;this.element.style.zIndex=String(Ja.wjb)}}W0i(){this.O2&&!this.BGn()&&this.O2.continueWith(()=>{this.O2.result.logActivity("PresenceIpRendered","PresenceIpRenderedFloodgateEnabled",this.B9j)&&this.EEa++})}BGn(){return this.EEa>=this.Gqk}static p0i(){fh.xwh||
(fh.xwh=!0,r.ULS.sendTraceTag(4006594,302,50,"First presence ip rendered on the page"))}static gFb(Ja){return fh.A0l+Ja.Yxi()}}fh.Sfj="data-presence-control";fh.Bcj="OverlayControlElementOwner";fh.A0l="ipId_";fh.Tfj="WacPresence";fh.nNm="PresenceIpPaddingDiv";fh.xwh=!1;fh.iUb=0;Object(f.a)(fh,"APresenceControl",Oa,[1170,12]);class Hf{constructor(){this.rotation=this.height=this.width=this.top=this.left=0;this.BNb=!1}}Object(f.a)(Hf,"PresenceImageControlStyle",null,[1169]);class ui extends fh{constructor(Ja,
sb,ub,Cc,ic,Ud=null,ae=null){super(Ja,sb,ub,Cc,ic,Ud,ae)}osb(Ja){this.Zn&&this.Zn.osb(Ja)}h4e(){return this.Zn?this.Zn.DRe.length:0}updatePosition(Ja){if(this.element&&this.element.parentNode){var sb=this.ryi(Ja);if(sb){var ub=Sys.UI.DomElement.getBounds(this.element.parentNode),Cc,ic;({left:ub,top:Cc,height:ic,width:sb}=this.FKl(sb,ub,this.element.parentNode,this.Bg.instance));this.element.style.top=Cc+"px";this.element.style.left=ub+"px";this.element.style.height=ic+"px";this.element.style.width=
sb+"px";ub=this.zyi(Ja);bf.a.ada(this.element,ub);Ja=this.i9f(Ja,this.Nq.ip.shapeId);this.qzj(ub,sb,this.isSelected(Ja),m.AFrameworkApplication.isRtl);this.vmc()}}}WI(){this.element&&(ch.a.Fr(this.element),this.Zn.osb(this.Nq.user.clientId),this.yTe())}D9h(Ja,sb,ub,Cc){sb=new Hf;if(!Cc||!ub)return sb;ub=this.ryi(Ja);if(!ub)return sb;sb.top=ub.y;sb.left=ub.x;sb.height=ub.height;sb.width=ub.width;sb.rotation=this.OMl(Ja);sb.BNb=!0;return sb}dpj(Ja,sb,ub,Cc){fh.p0i();this.T7d=Ja;if(Cc){const ic=this.i9f(Ja,
this.Nq.ip.shapeId);if(!ic)return;const Ud=!this.element;Ud&&this.VQf(sb.ownerDocument,Ja);Ud||!this.element.parentNode?ic.appendChild(this.element):this.element.parentNode!==ic&&(this.element.parentNode.removeChild(this.element),ic.appendChild(this.element));this.Zn.lqa(this.Nq.user);this.element.style.borderColor=this.Nq.user.color;this.element.id=fh.gFb(this.Nq);ub.BNb&&(this.element.style.height=ub.height+"px",this.element.style.top=ub.top+"px",this.element.style.left=ub.left+"px",this.element.style.width=
ub.width+"px",bf.a.ada(this.element,ub.rotation),bf.a.ada(this.Zn.element,-1*ub.rotation),this.qzj(ub.rotation,ub.width,this.isSelected(ic),m.AFrameworkApplication.isRtl),this.vmc())}this.ZFd=!Cc;this.yTe()}OMl(Ja){return this.element&&this.element.parentNode&&this.pDi(bf.a.getTransform(this.element.parentNode))?this.pDi(bf.a.getTransform(this.element)):this.zyi(Ja)}pDi(Ja){return Ja&&-1<Ja.indexOf("deg")&&(Ja=parseInt(Ja.substring(Ja.indexOf("(")+1,Ja.indexOf("deg"))),!isNaN(Ja))?Ja:0}fOj(Ja){this.element.style.borderColor=
this.Nq.user.color;this.element.id=fh.gFb(this.Nq);this.updatePosition(Ja)}VQf(Ja,sb){this.element=Ja.createElement("div");this.element.setAttribute(fh.Sfj,!0);wg.a.ql(this.element,fh.Bcj,this);this.element.className=ui.tTm;m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.LoopsCoAuthSelectionIssueFixIsEnable",!1)&&(Ja=sb.Ia)&&Ja.rI&&(this.element.style.pointerEvents="none");this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.Zn=this.Odd.SQf(this.createElement("div"),
!0);this.Zn.lqa(this.Nq.user);this.Zn.hide();this.Pt.Ea(xe.a.pointerOut,this.Zn.element,Object(c.a)(this,this.sV,"onPointerOut"));this.Pt.Ea(xe.a.pointerDown,this.Zn.element,Object(c.a)(this,this.ePe,"onTooltipTouch"));this.Zn.element.classList.add(fh.Tfj);this.element.appendChild(this.Zn.element)}FKl(Ja,sb,ub,Cc){let ic=Ja.y,Ud=Ja.x,ae=Ja.height;Ja=Ja.width;(1<Math.abs(sb.width-ub.offsetWidth)||1<Math.abs(sb.height-ub.offsetHeight))&&Cc&&(ic=Math.round(ic/Cc.Ei),Ud=Math.round(Ud/Cc.Ei),ae=Math.round(ae/
Cc.Ei),Ja=Math.round(Ja/Cc.Ei));return{left:Ud,top:ic,height:ae,width:Ja}}isSelected(Ja){return Object(pk.a)(Ja,ak.a.vjb)}qzj(Ja,sb,ub,Cc){this.Zn.element.style.left="auto";this.Zn.element.style.top="auto";this.Zn.element.style.right="auto";this.Zn.element.style.bottom="auto";ub=ub?Math.round(.5*ui.FDa)+ui.cFn:0;0<=Ja&&90>Ja||360===Ja?(this.Zn.element.style.top=-.5*ui.FDa-ub+"px",Cc?this.Zn.element.style.right=sb-.5*ui.FDa+"px":this.Zn.element.style.left=sb-.5*ui.FDa+"px"):90<=Ja&&180>Ja?(this.Zn.element.style.left=
-.5*ui.FDa-ub+"px",Cc?this.Zn.element.style.bottom=-.5*ui.FDa+"px":this.Zn.element.style.top=-.5*ui.FDa+"px"):180<=Ja&&270>Ja?(this.Zn.element.style.bottom=-.5*ui.FDa-ub+"px",Cc?this.Zn.element.style.left=sb-.5*ui.FDa+"px":this.Zn.element.style.right=sb-.5*ui.FDa+"px"):(this.Zn.element.style.right=-.5*ui.FDa-ub+"px",Cc?this.Zn.element.style.top=-.5*ui.FDa+"px":this.Zn.element.style.bottom=-.5*ui.FDa+"px")}Be(Ja,sb){const ub=this.Hxe(Ja,sb);return ub?ub.properties:(Ja=this.xyi(Ja,sb))?Ja.properties:
null}i9f(Ja,sb){var ub=this.Hxe(Ja,sb);return ub&&(ub=ub.W4a(Ja.Cf))?ub.element:(sb=this.xyi(Ja,sb))?Object(k.a)(fk.a,sb).Qd(Ja.Za).htmlElement:null}Hxe(Ja,sb){Ja=ai.i(Ja.Ia,5);for(const ub of Ja)if(ub.properties.getValue(Hh.a.fEb)===sb)return ub;return null}xyi(Ja,sb){Ja=vj.GraphIterator.ua(Ja.Ia);let ub=Ja.Va(6);for(;ub;){const Cc=ub.properties.getValue(Hh.a.fEb);if(uh.ImageReader.Xr(ub)&&Cc===sb)return ub;ub=Ja.Kd(6)}return null}HCl(Ja){const sb=li.a.ze(uh.ImageReader.Tz(Ja),0);Ja=li.a.ze(uh.ImageReader.UA(Ja),
1);return{Iua:sb,a_l:Ja}}zyi(Ja){Ja=this.Be(Ja,this.Nq.ip.shapeId);return uh.ImageReader.WX(Ja)}ryi(Ja){var sb=this.Nq.ip;if(!sb||!sb.shapeId)return null;var ub=this.Be(Ja,sb.shapeId);const Cc=this.i9f(Ja,sb.shapeId);if(!ub||!Cc)return null;({Iua:Ja,a_l:sb}=this.HCl(ub));let ic=1,Ud=1;ub.hasProperty(Hh.a.TY)?(ub=ub.getValue(Hh.a.TY),ic+=li.a.ze(ub[0],0),Ud+=li.a.ze(ub[2],1)):(ic+=0<Cc.offsetWidth?(Cc.offsetWidth-Ja)/2:2,Ud+=0<Cc.offsetHeight?(Cc.offsetHeight-sb)/2:2);return new Sys.UI.Bounds(Math.round(ic),
Math.round(Ud),Math.round(Ja),Math.round(sb))}sV(){this.M4i();return!1}ePe(Ja){this.Zn&&3===Ja.ed&&(2!==this.GDa?(this.fBg(),this.vmc()):this.M4i());return!1}M4i(){this.Zn&&(this.Zn.fTc(),this.GDa=1)}vmc(){for(const Ja of this.Zn.DRe)if(Ja.clientId===this.Nq.user.clientId&&!Ja.equals(this.Nq.user)){this.Zn.lqa(this.Nq.user);break}if(this.Nq.k9a||2===this.GDa)this.Zn.EVd(),this.Nq.k9a=!1,this.Nq.Mma=!0,this.GDa=2;this.Nq.Mma&&1!==this.GDa||(this.Zn.fTc(),this.Nq.Mma=!0,this.GDa=1)}}ui.tTm="WACImgPresenceHighlight";
ui.FDa=20;ui.cFn=6;Object(f.a)(ui,"PresenceImageControl",fh,[]);var Nf=b(277);class Mk{constructor(){this.height=this.top=this.left=this.ePi=0;this.BNb=!1;this.mM=this.kh=null}}Object(f.a)(Mk,"PresenceIpControlStyle",null,[1169]);var Nj=b(77);class nj extends fh{constructor(Ja,sb,ub,Cc,ic,Ud=null,ae=null,He=null){super(Ja,sb,ub,Cc,ic,Ud,ae);this.Dcd=this.Jcb=this.Gwc=null;this.FG=He}VQf(Ja){this.element=Ja.createElement("div");this.element.setAttribute(fh.Sfj,!0);wg.a.ql(this.element,fh.Bcj,this);
this.element.className=fh.nNm;this.element.dir=m.AFrameworkApplication.isRtl?"rtl":"ltr";this.Pt.Ea(xe.a.pointerOver,this.element,Object(c.a)(this,this.R4,"onPointerOver"));this.nqb&&(this.Pt.Ea(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut")),this.Pt.Ea(xe.a.pointerDown,this.element,Object(c.a)(this,this.ePe,"onTooltipTouch")));this.Jcb=this.createElement("div");this.Jcb.className=nj.uTm;this.nqb||(this.Dcd=this.createElement("div"),this.Dcd.className=nj.xTm,this.Jcb.appendChild(this.Dcd));
this.Zn=this.Odd.SQf(this.createElement("div"),this.nqb);Ja=this.va.ea("NoPresenceUserLookUpBeforeRender");this.FG&&!Ja&&(this.Nq.user=this.FG.E1i(this.Nq.user.clientId)||this.Nq.user);this.Zn.lqa(this.Nq.user);this.Zn.hide();this.Zn.element.classList.add(this.nqb?fh.Tfj:nj.aQm);this.Jcb.appendChild(this.Zn.element);this.element.appendChild(this.Jcb)}R4(Ja){!this.Zn||this.nqb&&!this.Zn.R_f(Ja)||(this.fBg(),this.tWe(Ja));this.fOj(this.T7d);return!1}sV(){this.Zn&&this.bY();return!1}ePe(Ja){this.Zn&&
3===Ja.ed&&(2!==this.GDa?(this.fBg(),this.tWe(Ja)):this.bY());return!1}E8k(){this.Gwc&&(fb.a.instance.ie(this.Gwc),this.Gwc=null)}vmc(Ja){for(var sb of this.Zn.DRe)if(sb.clientId===this.Nq.user.clientId&&!sb.equals(this.Nq.user)){this.Zn.lqa(this.Nq.user);break}sb=!1;nj.l7k===this.Nq.user.color?({value:sb}=this.mYh.Ab(this.Nq.user.clientId,!1),sb||(this.mYh.$(this.Nq.user.clientId,!0),r.ULS.sendTraceTag(17954772,302,50,'{ "ClientID" : "'+this.Nq.user.clientId+'" , "Event" : "RenderGrayPawn"}'))):
({value:sb}=this.arj.Ab(this.Nq.user.clientId,!1),sb||(this.arj.$(this.Nq.user.clientId,!0),r.ULS.sendTraceTag(17954773,302,50,'{ "ClientID" : "'+this.Nq.user.clientId+'" , "Event" : "RenderColoredPawn"}')));return Ja||this.Nq.k9a||2===this.GDa?(this.W0i(),this.Zn.EVd(),this.Nq.k9a=!1,this.Nq.Mma=!0,this.GDa=2,nj.gEn):this.Nq.Mma&&1!==this.GDa?0:(this.W0i(),this.Zn.fTc(),this.Nq.Mma=!0,this.GDa=1,nj.fEn)}tWe(Ja=null){this.E8k();const sb=this.vmc(!!Ja);this.nqb&&Ja&&Ja.eventName===xe.a.pointerOver||
this.dfn(sb)}bY(){this.Zn&&this.GDa&&(this.Qan(),this.Zn.hide(),this.GDa=0)}dfn(Ja){this.Gwc=new va.a(2,1,Ja,()=>{this.Gwc=null;this.bY()},56);fb.a.instance.rb(this.Gwc)}updatePosition(Ja){if(this.element&&this.element.parentNode){var sb=this.azi(Ja);if(sb){Ja=Sys.UI.DomElement.getBounds(this.element.parentNode);sb=new Sys.UI.Bounds(sb.x-Ja.x,sb.y-Ja.y,nj.iPi,sb.height);var ub;({left:Ja,top:sb,height:ub}=this.IKl(sb,Ja,this.element.parentNode,this.Bg.instance));this.element.style.height=2*nj.EOc+
ub+"px";this.element.style.top=sb-nj.EOc+"px";this.element.style.left=Ja-nj.EOc+"px";this.Jcb.style.height=Math.max(nj.F4i,ub)+"px";this.tWe()}}}WI(){this.element&&(ch.a.Fr(this.element),this.yTe())}D9h(Ja,sb,ub,Cc,ic){const Ud=new Mk;if(!Cc||!ub)return Ud;Cc=this.azi(Ja);if(!Cc)return Ud;var ae=ub;ub=Ja;if(Ja.nn){var He=Ja.qb;ae=Ja.Oh.PGc(this.Nq.ip.lha.cp);0>ae&&0==ae;Ja.qb.lsa?ch.a.LAa(He.editingElement,Ja.Oh.Bj.J(ae))||(ub=Ja.source.Mh(Nj.InteractiveViewManager.instance.sc.Za),sb=ub.Oh.Bj.J(ae)):
sb=ub.Oh.Bj.J(ae);ae=sb.getBoundingClientRect()}ae=new Sys.UI.Bounds(Cc.x-ae.x,Cc.y-ae.y,nj.iPi,Cc.height);Ja=ae.y;Cc=ae.x;ae=ae.height;He=this.Bg.instance;ic&&He&&(ic=He.Ei,Ja=Math.round(Ja/ic),Cc=Math.round(Cc/ic),ae=Math.round(ae/ic));Ud.top=Ja-nj.EOc;Ud.left=Cc-nj.EOc;Ud.height=2*nj.EOc+ae;Ud.ePi=Math.max(nj.F4i,ae);Ud.BNb=!0;Ud.kh=sb;Ud.mM=ub;return Ud}dpj(Ja,sb,ub,Cc){fh.p0i();this.T7d=Ja;Ja=ub.kh;sb=ub.mM;if(Cc){const ic=!this.element;ic&&this.VQf(Ja.ownerDocument);ic||!this.element.parentNode?
Ja.appendChild(this.element):this.element.parentNode!==Ja&&(this.element.parentNode.removeChild(this.element),Ja.appendChild(this.element));this.T7d=sb;Ja=this.Nq.user.color;this.Jcb.style.borderColor=Ja;this.nqb||(this.Dcd.style.borderColor=Ja);this.element.id=fh.gFb(this.Nq);ub.BNb&&(this.element.style.height=ub.height+"px",this.element.style.top=ub.top+"px",this.element.style.left=ub.left+"px",this.Jcb.style.height=ub.ePi+"px",this.tWe())}this.ZFd=!Cc;this.yTe()}dispose(){this.element&&(this.WI(),
this.Pt.kb(xe.a.pointerOver,this.element,Object(c.a)(this,this.R4,"onPointerOver")),this.nqb&&(this.Pt.kb(xe.a.pointerOut,this.element,Object(c.a)(this,this.sV,"onPointerOut")),this.Pt.kb(xe.a.pointerDown,this.element,Object(c.a)(this,this.ePe,"onTooltipTouch"))),Ye.a.np(this.Zn),this.element=this.Zn=null);super.dispose()}fOj(Ja){const sb=this.Nq.user.color;this.Jcb.style.borderColor=sb;this.nqb||(this.Dcd.style.borderColor=sb);this.element.id=fh.gFb(this.Nq);this.updatePosition(Ja)}IKl(Ja,sb,ub,
Cc){let ic=Ja.y,Ud=Ja.x;Ja=Ja.height;(1<Math.abs(sb.width-ub.offsetWidth)||1<Math.abs(sb.height-ub.offsetHeight))&&Cc&&(ic=Math.round(ic/Cc.Ei),Ud=Math.round(Ud/Cc.Ei),Ja=Math.round(Ja/Cc.Ei));return{left:Ud,top:ic,height:Ja}}azi(Ja){const sb=this.Nq.ip;if(!sb)return null;let ub;try{const Cc=sb.lha.cp;ub=Nf.a.oP(Cc,Ja,0<Cc,!1,!1,!1)}catch(Cc){r.ULS.sendTraceTag(4301318,302,50,"Could not determine the bounds of IP: isYielding={0} message={1} stack={2}",fb.a.instance.fp,Cc.message,Cc.stack),ub=null}return ub}}
nj.aQm="WacPawn";nj.iPi=2;nj.fEn=7E3;nj.gEn=2E3;nj.EOc=5;nj.uTm="presenceIp";nj.xTm="PresenceSmallBox";nj.F4i=10;nj.l7k="0xcccccc";Object(f.a)(nj,"PresenceIpControl",fh,[]);class $k{constructor(Ja,sb,ub,Cc,ic=null,Ud=null,ae=null){this.b_c={};this.$Zc={};this.Sqh={};this.Odd=Ja;this.Pt=sb;this.Ek=ub;this.w_a=Cc;this.O2=ic;this.va=Ud;this.FG=ae}get d6k(){return this.b_c}get kei(){return this.$Zc}EKl(Ja){const sb=!!this.va&&this.va.ea("PeoplesWellExtraButtonInfoIsEnabled");return Ja.ip.shapeId&&sb?
this.JKl(Ja):this.KKl(Ja)}JKl(Ja){const sb=Ja.ip.shapeId.toString();this.Sqh[Ja.user.clientId]=sb;const ub=this.$Zc[sb];return ub?(ub.Nq=Ja,{returnValue:ub,f4e:!0}):{returnValue:this.$Zc[sb]=new ui(Ja,this.Odd,this.Pt,this.Ek,this.w_a,this.O2,this.va),f4e:!1}}KKl(Ja){const sb=Ja.user.clientId,ub=this.b_c[sb];return ub&&ub.Nq.user.equals(Ja.user)?(ub.Nq=Ja,{returnValue:ub,f4e:!0}):{returnValue:this.b_c[sb]=new nj(Ja,this.Odd,this.Pt,this.Ek,this.w_a,this.O2,this.va,this.FG),f4e:!1}}bzi(Ja){return this.b_c[Ja]}CCl(Ja){return(Ja=
this.$Zc[this.Sqh[Ja]])&&!Ja.h4e()?Ja:null}tbl(){var Ja=this.b_c;for(const sb in Ja)Ja[sb].dispose();Ja=this.$Zc;for(const sb in Ja)Ja[sb].dispose()}}Object(f.a)($k,"PresenceControlProvider",null,[]);var ql=b(158);class Oj{constructor(){this.Wzb=0}EAi(){this.Wzb++;this.Wzb===Number.MAX_VALUE&&(this.Wzb=1);return this.Wzb}static get instance(){return Oj.H9c}}Oj.H9c=new Oj;Object(f.a)(Oj,"PacketIdGenerator",null,[175]);var wm=b(965);class rl{constructor(Ja,sb,ub){this.nfn=Ja;this.z1l=sb;this.HWi=ub}}
Object(f.a)(rl,"SuccessfulInboundReplicationCallbackData",null,[]);class Hl{constructor(Ja,sb,ub,Cc,ic,Ud,ae){this.tdn=Ja;this.igf=sb;this.yk=ub;this.eqk=ic;this.g8j=Ud;this.Wtc=Cc;this.nm=ae;this.tdn.Wea(Object(c.a)(this,this.Bdn,"rtcOnUpdateNotificationReceived"))}Bdn(Ja,sb){sb.type||(Ja=this.yk.iji>=this.g8j,this.eqk&&Ja?(Ja=this.igf())?Ja.Rki():r.ULS.sendTraceTag(19682513,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt."):this.BI())}BI(){const Ja=this.igf();
if(!Ja)r.ULS.sendTraceTag(19682514,500,15,"ActivePage ContentReplicator was null, we are abandoning the inbound attempt.");else if(!this.Wtc()&&Ja.y6a){let sb=-1;Object(Kg.a)(wm.a,Ja)&&(sb=Ja.vk.vXa());const ub=this.nm.Pe("Task","ShoulderTapInboundReplicationTimer");Ja.BI(Object(c.a)(this,this.uKm,"onSuccessfulReplication"),null,new rl(sb,ub,Ja.Bw))}}uKm(Ja){if(Ja=Object(k.a)(rl,Ja)){var sb=Ja.z1l.ti.toString(),ub=this.igf(),Cc=ub.Bw,ic="";Cc!==Ja.HWi&&(r.ULS.sendTraceTag(19964236,500,50,"Time saved due to force inbound on update notification message = {0} ms",
Ja.nfn.toString()),ic=this.XGl(ub,Cc,Ja.HWi));r.ULS.sendTraceTag(19964237,500,50,"Revisions: {0}, InboundDuration: {1}",ic,sb)}else r.ULS.sendTraceTag(19964235,500,10,"The callback data was null")}XGl(Ja,sb,ub){const Cc=new Sys.StringBuilder;Ja=Ja.node.kd.store.getRevision(sb);if(!Ja)return r.ULS.sendTraceTag(19964238,500,10,"The revision we got from the last replicator revisionId was null - {0}",{["lastRevisionId"]:sb}),"";for(Cc.append(Ja.id.guid);sb!==ub;){Cc.append(", ");Cc.append(sb.guid);Ja=
Ja.Bp;if(!Ja)break;sb=Ja.id}return Cc.toString()}}Object(f.a)(Hl,"ContentNotificationManager",null,[]);class vi extends Hl{constructor(Ja,sb,ub,Cc,ic,Ud,ae){super(Ja,sb,ub,Cc,ic,Ud,ae)}static get J8a(){return vi.CAb||(vi.CAb=da.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){if(la.App.oa){var Ja=la.App.oa.za;Ja&&(Ja.mqa(vi.CJd),Ja=Ja.jc)&&(vi.ry=Ja.contentReplicator,vi.ry&&la.App.Sra().continueWith(vi.xGg))}}static xGg(){vi.b4d=la.App.Sra().result;vi.b4d&&vi.b4d.eq&&vi.J8a.LN().continueWith(vi.NKd)}static NKd(){vi.Jj=
vi.J8a.LN().result;if(vi.Jj){var Ja=m.AFrameworkApplication.K,sb=Ja.ea("Box4ThrottleInboundRequests");Ja=Ja.jb("Box4ThrottleInboundsAtUserCount",20);vi.ry.zze=()=>vi.Jj.cJb;vi.Z3d=vi.Z3d||new vi(vi.Jj,()=>vi.ry,vi.b4d,()=>m.AFrameworkApplication.mi,sb,Ja,la.App.oa.Np);vi.Z3d.BI()}}static CJd(Ja){vi.Z3d||(Ja.YLb(vi.CJd),vi.init())}}vi.Z3d=null;vi.CAb=null;vi.Jj=null;vi.ry=null;vi.b4d=null;Object(f.a)(vi,"WordContentNotificationManager",Hl,[]);class Pj{constructor(Ja,sb,ub,Cc,ic,Ud){this.I4d=null;this.dKh=
Ja;this.Ic=ub;this.Y0a=Cc;this.Un=ic;this.Df=Ud;this.xpc=sb}clone(){return new Pj(this.dKh,this.xpc.clone(),this.Ic,this.Y0a,this.Un,this.Df)}get cp(){if(null!=this.I4d)return this.I4d;var Ja=this.dKh.paragraphId;if(Ja.equals(oc.a.nil))return 0;var sb=this.Y0a();if(!sb)return 0;Ja=sb.Ta(Ja);if(!Ja)return r.ULS.sendTraceTag(7685326,302,15,"Paragraph Node is null so returning a CP with value 0"),0;sb=this.Ic.G5b(this.Ic.F7a(Ja.characterData,Ja.ja),this.xpc);if(this.Un&&this.Df&&Ja.Wr){const ub=tb.a.Kb(Ja,
sb);ub.Ma=this.Df.qvd(Ja,sb,this.xpc.PRa);sb=this.Un.GU(ub,!0)}return sb}FIg(){null==this.I4d&&(this.I4d=this.cp)}equals(Ja){return Ja?this.xpc.isEqual(Ja.xpc,!1):!1}}Object(f.a)(Pj,"WordPresenceCp",null,[769,72,770]);class kl{constructor(Ja,sb){this.Un=Ja;this.Df=sb}create(Ja,sb,ub,Cc){return new Pj(Ja,sb,ub,Cc,this.Un,this.Df)}}Object(f.a)(kl,"Factory",null,[751]);var ag=b(481);class bo extends Sys.EventArgs{constructor(Ja,sb,ub){super();this.paragraphId=Ja;this.presence=sb;this.Rlg=ub}}Object(f.a)(bo,
"ParagraphChangedEventArg",Sys.EventArgs,[]);class xh{constructor(Ja){this.cp=Ja}equals(Ja){return Ja?this.cp===Ja.cp:!1}clone(){return new xh(this.cp)}}Object(f.a)(xh,"PresenceCp",null,[769,72]);class Xl{constructor(Ja,sb,ub,Cc,ic){this.paragraphId=Ja;this.cp=sb;this.length=ub;this.shapeId=Cc;this.dryDeletion=ic}}Object(f.a)(Xl,"SerializablePresenceIpData",null,[]);class Ih{constructor(Ja,sb,ub,Cc=0,ic=0){this.GFa=null;Ja&&(this.GFa=oc.a.qe(Ja));this.cKh=new xh(sb);this.XWa=ub;this.yNh=Cc;this.yuh=
ic}get paragraphId(){return this.GFa}get lha(){return this.cKh}get shapeId(){return this.yNh}get dryDeletion(){return this.yuh}Yb(){return 0<=this.lha.cp&&!!this.paragraphId&&!this.paragraphId.equals(oc.a.nil)}getData(){return new Xl(this.paragraphId.toString(),this.lha.cp,this.XWa,this.shapeId,this.dryDeletion)}clone(){const Ja=new Ih;Ja.GFa=this.paragraphId;Ja.cKh=this.lha?this.lha.clone():null;Ja.XWa=this.XWa;Ja.yNh=this.shapeId;Ja.yuh=this.dryDeletion;return Ja}static N5b(Ja){return Ja.paragraphId&&
void 0!==Ja.cp&&null!==Ja.cp&&void 0!==Ja.length&&null!==Ja.length?new Ih(Ja.paragraphId,Ja.cp,Ja.length,void 0,Ja.dryDeletion):null}}Object(f.a)(Ih,"PresenceIp",null,[157,72]);class Aj{constructor(Ja,sb){this.ip=Ja;this.user=sb}}Object(f.a)(Aj,"SerializablePresenceData",null,[]);class Be{constructor(Ja,sb){this.k9a=this.Mma=this.pMc=!1;this.Icb=sb;this.user=Ja}get ip(){return this.Icb}Obg(){return new Aj(this.ip?this.ip.getData():null,this.user.getData())}Yxi(){return this.user.clientId+(this.Icb?
this.Icb.paragraphId.toString():oc.a.nil.toString())}Yb(){const Ja=!!this.user&&this.user.Yb(),sb=!this.ip||this.ip.Yb();return Ja&&sb}clone(){const Ja=new Be;Ja.user=this.user?this.user.clone():null;Ja.Icb=this.Icb?this.Icb.clone():null;Ja.Mma=this.Mma;Ja.pMc=this.pMc;Ja.k9a=this.k9a;return Ja}static N5b(Ja){return Ja?new Be(Ba.N5b(Ja.user),Ja.ip?Ih.N5b(Ja.ip):null):null}}Object(f.a)(Be,"PresenceInfo",null,[167,72]);class Sd extends Ma.a{constructor(){super();this.V9c={};this.oab={};this.twh=!1}get eOm(){return this.V9c}get gTi(){return!!m.AFrameworkApplication.K&&
m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled")}PWh(Ja){this.addHandler("PPC",Ja)}Qoj(Ja){this.removeHandler("PPC",Ja)}sGc(Ja){return Ja.ip.paragraphId.toString()}DBf(Ja,sb=!1){this.twh||(this.twh=!0,r.ULS.sendTraceTag(4289312,302,50,"First presence added to data manager"));var ub=({vTm:Cc}=this.bhm(Ja)).returnValue;if(Cc&&!sb)(ub=this.oab[Ja.user.clientId])&&0<=ub.length&&(ub[ub.length-1].ip.XWa=Ja.ip.XWa);else{ub||this.Inj(Ja.user.clientId);this.gTi&&ub&&this.SMn(Ja);sb=this.sGc(Ja);
var Cc=Ja.user.clientId;var ic=this.V9c[sb]||[],Ud=this.oab[Cc]||[];Ud.length>=Sd.y3i&&(Ud=Ud.splice(-Sd.dBm,Sd.y3i));ub||ic.push(Cc);Ud.push(Ja);this.V9c[sb]=ic;this.oab[Cc]=Ud;Ja.ip.paragraphId.equals(oc.a.nil)||this.QQg(Ja.ip.paragraphId,Ja,!0)}}bhm(Ja){var sb=this.oab[Ja.user.clientId];const ub=!sb||0>=sb.length?null:sb[sb.length-1],Cc=!!ub&&this.sGc(ub)===this.sGc(Ja);sb=Cc&&ub.ip.lha.equals(Ja.ip.lha)&&ub.user.equals(Ja.user);this.gTi&&sb&&ub.ip.shapeId&&Ja.ip.shapeId&&ub.ip.shapeId!==Ja.ip.shapeId&&
(sb=!1);return{returnValue:Cc,vTm:sb}}SMn(Ja){const sb=this.l6k(Ja);sb&&sb.ip.shapeId&&(Ja.ip.shapeId&&Ja.ip.shapeId===sb.ip.shapeId||this.QQg(sb.ip.paragraphId,sb,!1))}l6k(Ja){Ja=this.oab[Ja.user.clientId];return!Ja||0>=Ja.length?null:Ja[Ja.length-1]}Inj(Ja){const sb=this.oab[Ja];if(sb&&0<sb.length){const ub=sb[0].ip.paragraphId,Cc=this.sGc(sb[0]);delete this.oab[Ja];this.P6m(Cc,Ja);ub.equals(oc.a.nil)||this.QQg(ub,sb[0],!1)}}s6f(Ja){return this.V9c[Ja]}Msd(Ja,sb,ub,Cc=!1){const ic=[],Ud=this.s6f(Ja);
if(!Ud)return ic;for(let ae=0;ae<Ud.length;ae++){const He=Ud[ae],lf=this.oab[He];let Of=!1;for(let hf=lf.length-1;0<=hf;hf--){const rh=lf[hf];if(Cc){if(rh.Mma&&rh.ip.paragraphId.equals(oc.a.qe(Ja))){Of=!0;ic.push(rh);break}}else if(Object(Kg.a)(Be,rh)?rh.ip.XWa===sb:rh.ip.XWa===ub){Of=!0;rh.pMc=!0;ic.push(rh);this.oab[He]=lf.splice(hf,lf.length);break}}!Of&&0<lf.length&&lf[0].pMc&&lf[0].ip.paragraphId.equals(oc.a.qe(Ja))&&ic.push(lf[0])}return ic}Grl(Ja){if(!Ja||!Ja.ra||!Ja.ra.node)return null;Ja=
this.Msd(Ja.ra.node.id.toString(),0,0,!0);Ja=this.USl(Ja);Ja.sort((sb,ub)=>{if(!(sb&&sb.userName&&ub&&ub.userName))return r.ULS.sendTraceTag(542165082,302,15,"Missing presence user info for user in PresenceInfos"),0});return Ja}USl(Ja){if(!Ja||!Ja.length)return[];const sb=[],ub=new ag.a(Fa.a.Xi());for(let Cc=0;Cc<Ja.length;Cc++){const ic=Ja[Cc].user;ic.isAnonymous&&ub.contains(ic.clientId)||!ic.isAnonymous&&ic.email&&ub.contains(ic.email)||(sb.push(ic),ub.add(ic.isAnonymous?ic.clientId:ic.email))}return sb}QQg(Ja,
sb,ub){this.raiseEvent("PPC",new bo(Ja,sb,ub))}P6m(Ja,sb){Array.remove(this.V9c[Ja],sb)}}Sd.y3i=10;Sd.dBm=2;Object(f.a)(Sd,"PresenceDataManager",Ma.a,[1118]);class Rd extends Sd{constructor(Ja,sb){super();this.grf=this.nHh=!1;this.EG=Ja;this.Ja=sb}DBf(Ja,sb=!1){this.Ja.isFeatureEnabled(194)&&this.Ja.isFeatureEnabled(162)&&Object(Kg.a)(Be,Ja)?this.nHh||(this.nHh=!0,r.ULS.sendTraceTag(7866380,302,15,"Presence packet received in old format")):(Object(Kg.a)(Be,Ja)&&(this.grf=!0),super.DBf(Ja,sb))}sGc(Ja){return this.grf?
super.sGc(Ja):Ja.ip.Ob.toString()}s6f(Ja){if(this.grf)return super.s6f(Ja);Ja=this.EG.Ta(oc.a.qe(Ja));if(!Ja)return null;Ja=Ja.fa(Hh.a.Ob,0);return this.eOm[Ja.toString()]}}Object(f.a)(Rd,"WordPresenceDataManager",Sd,[]);var ng=b(1282),Al=b(1199),sl=b(1675),Bl=b(19);class Ai{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf,rh,Li,Jj,Fg,Ni,di,Il,Jc,wf,Ze,Yh,en,wi){this.V1a=Array(5);this.xyf=this._started=this.Xtf=!1;this.erf=null;this.wKh=new ag.a(Fa.a.Xi());this.Ibe={};this.jkf=!1;this.py=Ja;this.Da=Cc;
this.FG=ic;this.cZb=Ud;this.tm=lf;this.d8j=Of;this.jAb=hf;this.rG=ub;this.Zxh=rh;this.$ff=Li;this.agf=Jj;this.E1j=ae;this.h8j=He;this.T0a=Fg;this.Nm=Ni;this.Nb=di;this.fb=Il;this.WPh=Yh;this.Fkk=wi;this.frf=wf;this.va=Ze;this.obe=sb;Ai.jce=new bb.a;for(Ja=0;Ja<this.obe.length;Ja++)this.obe[Ja].Slj(this);this.cZb.PWh(Object(c.a)(this,this.Ufj,"presenceOnParagraphChanged"));this.py.ihb(Object(c.a)(this,this.zca,"onPresenceUpdated"));en&&this.tm.h3(Object(c.a)(this,this.RNm,"pageViewScrolled"));this.py.ZTe(this)}get RMe(){return!!this.va&&
this.va.ea("PeoplesWellExtraButtonInfoIsEnabled")}RNm(){if(!this.xyf&&!this.tm.Kq){var Ja=new va.a(0,1,20,()=>{const sb=new M.a;var ub=this.jAb.d6k;for(var Cc in ub){const ic=ub[Cc];ic.ZFd&&sb.add(ic.Nq.ip.paragraphId)}if(this.RMe){ub=this.jAb.kei;for(const ic in ub)Cc=ub[ic],Cc.ZFd&&!sb.contains(Cc.Nq.ip.paragraphId)&&sb.add(Cc.Nq.ip.paragraphId)}this.Ysi(sb);this.xyf=!1},72);this.fb.rb(Ja);this.xyf=!0}}L9i(){this.Xtf&&(this.UZg(),this.Xtf=!1)}HUe(Ja=!1){this.WPh&&!Ja||this.Zoj()}Zoj(){const Ja=
new M.a,sb=this.Ibe;for(const ub in sb)Ja.add(oc.a.qe(ub));this.Ysi(Ja);this.Ibe={}}UZg(){this.Da.ya&&this.mvj(this.Da.ya.Ba,!0)}Bca(Ja,sb){this.mvj(sb.zi.Ba)}mvj(Ja,sb=!1){this.Fkk||(this.rG.Mn.kJa||sb?Ja?(sb=this.s3k(Ja))?this.py.c_g(sb):(this.py.c_g(null),r.ULS.sendTraceTag(4281418,302,50,"Not supported selection context {0}",Ja.ra.contextId)):this.py.c_g(null):this.Xtf=!0)}s3k(Ja){if(!this.RMe||!Ja.KVa)if(Ja=Bl.SelectionEditor.Xf(Ja,!0,!1),!Bl.SelectionEditor.qj(Ja))return null;return this.aJf(Ja)}aJf(Ja){const sb=
Ja.ra.cpBegin,ub=Ja.ra.node.id;Ja=this.$ff(Ja.ra.node);return new Ih(ub.toString(),sb,Ja)}zca(Ja,sb){Ja=sb.GZa;for(var ub in Ja){const Cc=Ja[ub];this.va.ea("CashTelemetryIsEnabled")&&this.eqd(Cc,new Date,null);Cc.ip?this.sBf(Cc):this.FQd(Cc.user.clientId)}sb=sb.pre;for(ub=0;ub<sb.length;++ub)this.h9k(sb[ub]);this.HUe()}eqd(Ja,sb,ub){if(this.frf)if(Ja&&Ja.user&&Ja.user.clientId){var Cc=Ja.user.clientId;this.wKh.contains(Cc)||(this.erf?(this.erf.eqd(Cc,sb,null,Ai.VMl(ub||Ja.user.client)),this.wKh.add(Cc)):
this.frf.continueWith(()=>{this.erf=this.frf.result;this.eqd(Ja,sb,ub)}))}else r.ULS.sendTraceTag(42262876,302,15,"invalid presence")}GKl(Ja){const sb=new M.a;for(let ub=0;ub<Ja.length;ub++)sb.add(this.MSl(Ja[ub]));return sb}sBf(Ja){var sb=null;Ja&&Ja.user&&(sb=Ja.user.client);Ja=Ja.clone();Ja.user=this.FG.E1i(Ja.user.clientId)||Ja.user;this.va.ea("CashTelemetryIsEnabled")&&this.eqd(Ja,new Date,sb);Ja.Yb()&&!Ja.user.h0()&&(sb=Ja.user.clientId,Ai.jce.Na(sb)||this.UHi(sb),this.qOn(sb),Ja.user.userName=
CommonUIStrings.l_AnonymousUserName);this.cZb.DBf(Ja,!1)}qOn(Ja){const {value:sb}=Ai.jce.Ab(Ja,!1);sb||(Ai.jce.$(Ja,!0),r.ULS.sendTraceTag(17954774,302,50,'{ "ClientID" : "'+Ja+'" , "Event" : "CreateAnonymousGrayPawn"}'))}UHi(){}FQd(Ja){this.cZb.Inj(Ja)}h9k(Ja){this.FQd(Ja);const sb=this.jAb.bzi(Ja);sb&&(sb.loj(Object(c.a)(this,this.GIg,"onPresenceRendered")),sb.dispose());this.RMe&&(Ja=this.jAb.CCl(Ja))&&(Ja.loj(Object(c.a)(this,this.GIg,"onPresenceRendered")),Ja.dispose())}SFb(Ja){if(12!==Ja.type)return new M.a;
Ja=this.cZb.Msd(Ja.id.toString(),this.$ff(Ja),this.agf(Ja));return 0>=Ja.length?new M.a:this.GKl(Ja)}GIg(Ja,sb){sb.paragraphId?this.AOn(sb.paragraphId.toString(),sb.okm,this.Ibe):r.ULS.shipAssertTag(8758481,302,!1,"null paraid")}AOn(Ja,sb,ub){!sb&&Ja in ub&&delete ub[Ja]}dispose(){this.stop();this.cZb.Qoj(Object(c.a)(this,this.Ufj,"presenceOnParagraphChanged"));this.py.tjc(Object(c.a)(this,this.zca,"onPresenceUpdated"));this.py.Pch(this);for(let Ja=0;Ja<this.obe.length;Ja++)this.obe[Ja].UMj(this);
Ye.a.jWe([this.E1j,this.h8j,this.py]);this.jAb.tbl()}MSl(Ja){let sb=!1;Ja=({f4e:sb}=this.jAb.EKl(Ja)).returnValue;sb||Ja.Lxk(Object(c.a)(this,this.GIg,"onPresenceRendered"));return Ja}rGi(Ja){Ja=this.rG.Ta(Ja);if(!Ja)return this.V1a[0]||(r.ULS.sendTraceTag(4281420,302,50,"Could not find the node in object space"),this.V1a[0]=!0),null;if(!dc.ParagraphReader.nb(Ja))return this.V1a[1]||(r.ULS.sendTraceTag(4281421,302,50,"Not a paragraph node"),this.V1a[1]=!0),null;if(!Ja.Qd(this.tm.Za))return this.V1a[2]||
(r.ULS.sendTraceTag(4281422,302,50,"No ViewElement found for this node"),this.V1a[2]=!0),null;if(!Ja.anchor)return this.V1a[3]||(r.ULS.sendTraceTag(4281423,302,50,"node is not anchored"),this.V1a[3]=!0),null;this.V1a[4]||(r.ULS.sendTraceTag(4564931,302,50,"Valid paragraph node found for rendering ip"),this.V1a[4]=!0);return Ja}mnj(Ja){Ja=this.cZb.Msd(Ja.toString(),-1,-1,!0);if(!Xi.a.le(Ja))for(const sb of Ja)(Ja=this.jAb.bzi(sb.user.clientId))&&Ja.element&&Ja.WI()}Ysi(Ja){if(Ja.count){var sb=new M.a;
for(var ub of Ja)(Ja=this.rGi(ub))?sb.add(Ja):this.mnj(ub);if(sb.count){ub=this.Nb.Wb(2);try{ub.set(this.Nm);for(const Cc of sb)this.Dhi(Cc)}finally{ub&&ub.dispose()}}}}Dhi(Ja){Ja.GI(this.tm.Za,32,!0);Ja.GI(this.d8j,32,!0)}ifn(Ja){this.Ibe[Ja.toString()]=null;this.WPh&&!this.jkf&&(Ja=new va.a(0,1,200,()=>{this.jkf=!1;this.Zoj()},70),this.fb.rb(Ja),this.jkf=!0)}Ufj(Ja,sb){sb.paragraphId&&(Ja=this.rG.Ta(sb.paragraphId))&&((Object(Kg.a)(Be,sb.presence)?this.$ff(Ja):this.agf(Ja))===sb.presence.ip.XWa&&
this.ifn(sb.paragraphId),this.RMe&&this.wTm(sb))}wTm(Ja){if(Ja.presence.ip.shapeId&&!Ja.Rlg){var sb=this.jAb.kei[Ja.presence.ip.shapeId.toString()];sb&&sb.osb(Ja.presence.user.clientId)}}stop(){this._started&&(this._started=!1,this.Da.Vna(Object(c.a)(this,this.Bca,"onSetSelectionFinished")),this.Zxh.Loj(Object(c.a)(this,this.L9i,"onGraphOutboundReplication")))}start(){if(!this._started){this._started=!0;this.Da.dE(Object(c.a)(this,this.Bca,"onSetSelectionFinished"));this.Zxh.AWh(Object(c.a)(this,
this.L9i,"onGraphOutboundReplication"));var Ja=this.py.G8b();delete Ja[this.T0a.clientId];this.zca(null,new sl.a(Ja,[]));this.UZg()}}HVd(Ja){if(Ja&&Ja.Yb()&&Ja.ip){var sb=this.cZb.Msd(Ja.ip.paragraphId.toString(),-1,-1),ub=!1,Cc=null;for(let ic=0;ic<sb.length;ic++)if(Cc=sb[ic],Cc.user.clientId===Ja.user.clientId){ub=Cc.k9a=!0;break}if(ub)if(sb=Cc.ip.paragraphId,Ja=this.rGi(sb)){sb=this.Nb.Wb(2);try{sb.Sa(Ja),this.Dhi(Ja)}finally{sb&&sb.dispose()}}else this.mnj(sb)}}static VMl(Ja){return Ja?Ja?1===
Ja?1:2===Ja?2:0:2:0}}Ai.jce=null;Object(f.a)(Ai,"PresenceManager",null,[1114,12,127,1115,1116,1117]);class Tf{constructor(Ja,sb,ub,Cc){this.Arc=null;this._started=this.Rif=!1;this.G1b=null;this.Jj=Cc;this.Da=sb;this.scf=Ja;this.jk=ub;this.Jj.ZTe(this)}start(){this._started||(this._started=!0,this.G1b={},this.scf.PWh(Object(c.a)(this,this.baj,"onPresenceOnParagraphChanged")),this.Da.dE(Object(c.a)(this,this.Aca,"onProcessSetSelectionFinished")),this.UOj(this.Da.ya))}stop(){this._started&&(this._started=
!1,this.G1b=null,this.scf.Qoj(Object(c.a)(this,this.baj,"onPresenceOnParagraphChanged")),this.Da.Vna(Object(c.a)(this,this.Aca,"onProcessSetSelectionFinished")))}Aca(Ja,sb){if(!m.AFrameworkApplication.mi&&(Ja=this.UOj(sb.zi),this.Arc&&Ja)){Ja=this.scf.Msd(this.Arc.toString(),-1,-1,!0);for(sb=0;sb<Ja.length;sb++)this.G1b[Ja[sb].user.clientId]=Ja[sb];0>=Ja.length||(Ja=this.F0k(Ja),this.jk.sendNotification(Ja,!0))}}F0k(Ja){if(1===Ja.length)return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphSingle,
Ja[0].user.userName);const sb=[],ub=Ja.length;for(let Cc=0;Cc<ub;Cc++)sb.push(Ja[Cc].user.userName);return String.format(Box4Intl.Box4Strings.l_OtherUsersEditingParagraphMany,sb.join(Box4Intl.Box4Strings.l_DisplayNameSeparator))}baj(Ja,sb){this.Da.ya&&!m.AFrameworkApplication.mi&&this.Rif&&this.Arc&&this.Arc.equals(sb.paragraphId)&&(Ja=null,!sb.Rlg||sb.presence.user.clientId in this.G1b?sb.Rlg||(Ja=this.gdi(sb.presence.user.userName,!1),delete this.G1b[sb.presence.user.clientId]):(Ja=this.gdi(sb.presence.user.userName,
!0),this.G1b[sb.presence.user.clientId]=sb.presence),Ja&&this.jk.sendNotification(Ja,!0))}gdi(Ja,sb){return String.format(sb?Box4Intl.Box4Strings.l_UserJoiningParagraph:Box4Intl.Box4Strings.l_UserLeavingParagraph,Ja)}dispose(){this.Jj.Pch(this);this.stop()}UOj(Ja){if(!Ja)return!1;Ja=Ja.Ba;if(!Ja)return!1;Ja=Ja.ra;if(!Ja)return!1;this.Rif=Bl.SelectionEditor.Cd(Ja);Ja=Ja.node.id;if(Ja.equals(this.Arc)||!this.Rif)return!1;this.Arc=Ja;this.G1b={};return!0}}Object(f.a)(Tf,"PresenceAccessibilityManager",
null,[12,127]);class de{constructor(Ja,sb){this._started=!1;this.TO=null;this.T8d=!1;this.Jj=Ja;sb&&(this.TO=sb,this.TO.ghb(Object(c.a)(this,this.XJd,"onEditorsTableUpdated")));this.Jj.ZTe(this)}start(){this._started||(this._started=!0,this.TO?this.Zuj():this.Jj.GV(1,this.Tbi()))}XJd(){this._started&&this.Zuj()}Zuj(){const Ja=this.T8d;(this.T8d=!!this.TO.eB)&&!Ja&&this.Jj.GV(1,this.Tbi())}Tbi(){const Ja={};Ja.Id="{"+m.AFrameworkApplication.userSessionId.toUpperCase()+"}";Ja.HQ=!1;Ja.NT=1;Ja.WEB=!0;
return Ja}stop(){this._started&&(this._started=this.T8d=!1)}dispose(){this.Jj.Pch(this);this.TO&&this.TO.noj(Object(c.a)(this,this.XJd,"onEditorsTableUpdated"))}}Object(f.a)(de,"EditorsTableNotifier",null,[12,127]);var bk=b(367),fj=b(20);class Pe extends Ai{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf,rh,Li,Jj,Fg,Ni,di,Il,Jc,wf,Ze,Yh,en,wi,Uj,Dd,Kd,Qd,Bd,Ei){super(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf,Li,Jj,Fg,Ni,Jc,wf,Ze,Yh,en,wi,Uj,Dd,Bd);this.yk=null;rh.Aa(fj.a.Mvn,vb.a.application,Pe.awk,64);rh.Aa(fj.a.tUg,
vb.a.application,Pe.tUg,64);rh.Aa(fj.a.iQg,vb.a.application,Pe.iQg,96);rh.Aa(Db.a.HVd,vb.a.application,Pe.Lvn,64);this.eN=di;this.Ic=Il;this.W1b=Kd;this.T0a.iPc=Qd;this.T0a.iPc.rzk(Pe.caj);Ei.continueWith(()=>{this.yk=Ei.result});r.ULS.sendTraceTag(4006600,302,50,"WordPresenceManager Initialized")}get Ka(){return da.a.instance.resolve("Box4.IFeatureHelper")}NTa(Ja){if(!Ja||!Ja.anchor)return null;for(Ja=Ja.anchor.Zk;Ja;Ja=Ja.Eo)if(Ja.j0)return Ja.Dj.node;return null}aJf(Ja){var sb=null;sb=m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled");
if(this.Ka.isFeatureEnabled(194)&&this.Ka.isFeatureEnabled(162)){var ub=Ja.ra.cpBegin,Cc=Ja.ra.node;sb&&uh.ImageReader.Xr(Cc)&&(Cc=this.NTa(Cc));if(!Cc)return r.ULS.sendTraceTag(51242309,302,15,"selectedNode is null"),null;Cc=this.agf(Cc);const Ud=Ja.ra.node.fa(Hh.a.Ob,0);if(!this.eN)return r.ULS.sendTraceTag(35997152,302,15,"paragraphWordIdMapping is null"),null;var ic=this.eN.value.UFb(Ud);const ae=Pe.EG.Ta(ic);if(!ae)return r.ULS.sendTraceTag(16791249,302,15,"Can't find pid "+ic),null;ub=this.Ic.kWc(this.Ic.F7a(ae.characterData,
ae.ja),ub);ub.PRa=-1===Ja.ra.Ma?0:Ja.ra.Ma;ic=0;sb&&Ja.KVa&&(ic=this.pOl(Ja));sb=new Xd(this.eN.value,Ud,Cc,ub,this.Ic,()=>Pe.EG,this.W1b,ic)}else sb=super.aJf(Ja);return sb}pOl(Ja){const sb=uh.ImageReader.Yfa(Ja.ra);return sb?sb.properties.fa(Hh.a.fEb,0):Ja.ra.node.properties.fa(Hh.a.fEb,0)}UHi(Ja){this.yk&&this.yk.eza&&this.yk.eza.BI(Object(c.a)(this,this.Qdl,"editorsReplicatorSucceededCallback"),Object(c.a)(this,this.Pdl,"editorsReplicatorFailedCallback"),Ja)}Qdl(Ja){const sb=!!this.yk.gF.rFc(Ja);
r.ULS.sendTraceTag(579179741,302,50,"ClientId:{0} isPresentAfterPoll:{1}",Ja,sb)}Pdl(Ja,sb){r.ULS.sendTraceTag(579179742,302,15,"EditorsReplicator failed with {0} when looking for ClientId {1}",sb,Ja)}static get Au(){return da.a.instance.resolve("Common.Utils.IAriaNotifier")}static LN(){return Pe.U3c.task}static get_instance(){return Pe.ice.task}static LKl(){return Pe.eKh.task}static get J8a(){return Pe.CAb||(Pe.CAb=da.a.instance.resolve("Box4.Presence.IRtcProxyProvider"))}static init(){Pe.ice||(Pe.ice=
new t.a);Pe.Dwh&&(r.ULS.sendTraceTag(4256585,302,50,"WordPresenceManager Init"),Pe.Dwh=!1);if(la.App.oa){var Ja=la.App.oa.za;Ja?(Ja.mqa(Pe.CJd),Pe.DYb=Ja.Rb,Pe.DYb&&Pe.DYb.gj?(Pe.WT=Ja.jc.contentReplicator,Pe.WT?(Pe.EG=Ja.jc.kd,Pe.EG?Pe.J8a.LN().continueWith(Pe.tJm):r.ULS.sendTraceTag(4006599,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to content ObjectSpace of the app")):r.ULS.sendTraceTag(4252228,302,15,"Can't initialize the WordPresenceManager because we can't get a reference to the GraphSpaceReplicator object")):
r.ULS.sendTraceTag(4006598,302,50,"PageView doesn't seem to have been initialized yet. Will try again once we know it's initialized")):r.ULS.sendTraceTag(4006597,302,15,"Can't initialize the WordPresenceManager because workspace is not initialized")}else r.ULS.sendTraceTag(4006596,302,15,"Can't initialize the WordPresenceManager because active AppFrame is not initialized")}static tJm(){Pe.Jj=Pe.J8a.LN().result;if(Pe.Jj){var Ja=[Pe.DYb.BOc,Pe.DYb.editingView.BOc],sb=ab.a.instance,ub=da.a.instance.resolve("Box4.Presence.WordPresenceDataManager"),
Cc=new Tf(ub,sb,Pe.Au,Pe.Jj),ic=m.AFrameworkApplication.K.ea("DoNotAddToEditorsTableOnFrameIsEnabled")?la.App.lc.gF:null;ic=new de(Pe.Jj,ic);var Ud=da.a.instance.vf("WordEditor.IParagraphWordIdMapping"),ae=da.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),He=da.a.instance.resolve("Common.IPeopleInfoProvider");Pe.na=new Pe(Pe.Jj,Ja,Pe.EG,sb,He,ub,Cc,ic,Pe.DYb,Pe.DYb.editingView.Za,da.a.instance.resolve("Box4.Presence.PresenceControlProvider"),m.AFrameworkApplication.pa,
Pe.WT,dc.ParagraphReader.textLength,dc.ParagraphReader.Raa,da.a.instance.resolve("Box4.Presence.MyPresenceUser"),Ud,ae,la.App.jj.Cm,new bk.a,fb.a.instance,ng.a.get_instance(),ia.a.ot(da.a.instance.Ca("Common.App.CoauthTelemetry.IPresenceBootTelemetry")),m.AFrameworkApplication.K,m.AFrameworkApplication.K.ea("Box4ThrottleAndBatchPresenceRendering"),m.AFrameworkApplication.K.ea("Box4DoNotRenderPresenceOutOfView"),da.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),da.a.instance.resolve("Common.IPresenceStatusProvider"),
!la.App.Vt&&!la.App.ap,la.App.Sra());r.ULS.sendTraceTag(23196878,302,50,"WordPresenceManager instance created");Pe.ice.mf(Pe.na);Pe.U3c.mf(Pe.na);Pe.eKh.mf(Pe.na);Ja=da.a.instance;Ja.ha("WordEditor.Presence.WordPresenceManager",()=>Pe.na).as("Common.IPresenceRemover").as("Common.IPresenceSender").singleInstance();Ja.resolve("WordEditor.Presence.WordPresenceManager")}else r.ULS.sendTraceTag(4203468,302,15,"Can't initialize the WordPresenceManager because can't get a handle to RtcProxy")}static CJd(Ja){Pe.na||
(r.ULS.sendTraceTag(4006601,302,50,"WordPresenceManager.OnAppIsInteractive: Trying to initialize again"),(Ja=Object(k.a)(13,Ja))&&Ja.YLb(Pe.CJd),Pe.init())}static caj(){Pe.na.UZg()}static awk(Ja,sb,ub,Cc,ic){ub=ic.split(",");if(!ub||3!==ub.length)return 8;Ja=ub[0].trim();sb=ub[1].trim();ub=Number.parseInvariant(ub[2].trim());Ja=new Be(new Ba(Ja),new Ih(sb,ub,-1));if(!Pe.U3c.task.isCompleted)return 8;sb=Pe.LN().result;sb.sBf(Ja);sb.HUe();return 32}static tUg(Ja,sb,ub,Cc,ic){if(!Pe.U3c.task.isCompleted)return 8;
Ja=Pe.LN().result;Ja.FQd(ic);Ja.HUe();return 32}static Lvn(Ja,sb,ub,Cc,ic){if(!Pe.U3c.task.isCompleted)return 8;Ja=Pe.LN().result;if(!Ja)return 8;Ja.HVd(ic);return 32}static iQg(Ja,sb,ub,Cc,ic){if(1===ub)return 32;if(!Pe.J8a.LN().isCompleted)return 8;Ja=Pe.J8a.LN().result;if(!Ja)return r.ULS.sendTraceTag(4301136,302,10,"rtcProxy is null when trying to display RTC connection status"),8;ic[Al.a.Value]=2===Ja.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnected:1===Ja.connectionState?WordEditorIntl.WordEditorStrings.L_RtcConnecting:
"";return 32}}Pe.na=null;Pe.Dwh=!0;Pe.ice=new t.a;Pe.U3c=new t.a;Pe.eKh=new t.a;Pe.EG=null;Pe.DYb=null;Pe.WT=null;Pe.Jj=null;Pe.CAb=null;Object(f.a)(Pe,"WordPresenceManager",Ai,[]);class Jh{constructor(Ja){this.ka=new Ma.a;this.X5=Ja;this.X5.CWR(()=>this.X5.result.Nxk(()=>{this.ka.raiseEvent("X")}))}rzk(Ja){this.ka.addHandler("X",Ja)}o8m(Ja){this.ka.removeHandler("X",Ja)}getStatus(){return this.X5.isCompleted&&this.X5.result?this.X5.result.Lnd.toString():"0"}}Object(f.a)(Jh,"WordPresenceStatusProvider",
null,[750]);class Kj{constructor(Ja,sb,ub,Cc){this.Jj=null;this.wwh=this.Qmf=!1;this.yk=Ja;this.Ija=sb;this.Ppa=ub;ub.continueWith(Object(c.a)(this,this.uJm,"onRtcReady"));this.jgk=Cc;this.jgk.wwg=this.Ija}uJm(){this.Ppa.isCompleted&&this.Ppa.result?(this.Jj=this.Ppa.result,this.Jj.ihb(Object(c.a)(this,this.zca,"onPresenceUpdated")),r.ULS.sendTraceTag(5604372,302,50,"Presence Update Monitor is ready.")):r.ULS.sendTraceTag(5604373,302,15,"RtcTask did not complete successfully. No monitoring")}zca(Ja,
sb){Ja=sb.GZa;for(const ub in Ja)if(sb=Ja[ub],!this.Qmf&&sb.user.nD&&sb.user.nD!==this.Ija.nD){r.ULS.sendTraceTag(5604375,302,15,"Presence received from different local cobalt session Mine:{0} Theirs:{1}",this.Ija.nD,sb.user.nD);this.Qmf=!0;break}this.Qmf&&this.Jj.tjc(Object(c.a)(this,this.zca,"onPresenceUpdated"));this.wwh||(r.ULS.sendTraceTag(5604374,302,50,"First presence received"),this.wwh=!0)}}Object(f.a)(Kj,"WordPresenceUpdateMonitor",null,[]);var $g=b(466),Nk=b(1347),df=b(199),tk=b(1677),
Ng=b(1678);class yh{constructor(Ja,sb,ub,Cc,ic,Ud,ae){this.ka=new Ma.a;this.yBh=this.HCh=this.$kf=this.MEh=!1;this.Ayf=this.Mge=0;this.Axc=null;this.T0a=Ud;this.T0a.clientId=Ja.clientId;this.Ss=Ja;this.Eia=sb;this.xB=Cc;this.J9j=ic;this.fb=ub;this.Xxb=new df.a;this.Wm=ae;this.Eia&&this.Eia.continueWith(()=>{this.Eia.Jm||this.Eia.Vh||this.Eia.result.HVh(Object(c.a)(this,this.p8i,"onAmIAloneChanged"))})}get connectionState(){return this.Ss.connectionState}ihb(Ja){this.ka.addHandler("PU",Ja)}tjc(Ja){this.ka.removeHandler("PU",
Ja)}QQa(Ja){this.ka.addHandler("CSC",Ja)}IQd(Ja){this.ka.removeHandler("CSC",Ja)}Jie(Ja){this.ka.addHandler("PSU",Ja)}EUe(Ja){this.ka.removeHandler("PSU",Ja)}Iie(Ja){this.ka.addHandler("PSC",Ja)}DUe(Ja){this.ka.removeHandler("PSC",Ja)}fvj(){}get clientId(){return this.Ss.clientId}Wea(Ja){this.ka.addHandler("UN",Ja)}CQc(Ja){this.ka.removeHandler("UN",Ja)}D2l(){this.Axc=Array(12);for(let Ja=0;12>Ja;Ja++)this.Axc[Ja]=0;this.HCh=this.Wm?this.Wm.ea("UpdateNotificationTaskExperimentIsEnabled"):!0;m.AFrameworkApplication.QH(()=>
{this.Irm()})}init(){this.Ss.QQa(Object(c.a)(this,this.fta,"onConnectionStateChanged"));this.Ss.ihb(Object(c.a)(this,this.zca,"onPresenceUpdated"));this.Ss.Jie(Object(c.a)(this,this.Jgc,"onPersistentStateUpdated"));this.Ss.Iie(Object(c.a)(this,this.bOc,"onPersistentStateCleared"));this.Ss.Wea(Object(c.a)(this,this.Ana,"onUpdateNotificationReceived"));this.Q9h();this.D2l()}ZTe(Ja){this.Xxb.contains(Ja,(sb,ub)=>sb===ub)||(this.Xxb.add(Ja),2===this.connectionState&&Ja.start())}Pch(Ja){for(let sb=0;sb<
this.Xxb.length;sb++)if(this.Xxb.J(sb)===Ja){this.Xxb.wI(sb);break}}connect(){this.$kf||this.Ss.connect()}disconnect(){this.Ss.disconnect()}get XVe(){return this.Ss}Yfi(Ja){return Be.N5b(Ja)}t_g(Ja,sb){return(new Be(Ja,sb)).Obg()}c_g(Ja){Ja&&Ja.Yb()&&!this.xB()?this.Ss.fvj(this.t_g(this.T0a.FGl(),Ja)):G.Task.KL(null)}jTd(Ja,sb){return this.Ss.jTd(Ja,sb)}d5f(Ja){return this.Ss.d5f(Ja)}Osd(){return this.Ss.Osd()}GV(Ja,sb,ub=!1){return this.Ss.GV(Ja,sb,ub)}G8b(){return this.Lbi(this.Ss.G8b())}voc(){return G.Task.KL(null)}get cJb(){return this.Ss.cJb}fta(Ja,
sb){2===sb.newState&&this.Xxb.forEach(ub=>{ub.start();return!0});sb.newState||this.Wm.ea("SendRTCMessagesWhileDisconnectedIsEnabled")&&!this.$kf||this.Xxb.forEach(ub=>{ub.stop();return!0});this.ka.raiseEvent("CSC",sb)}o2f(Ja){return Ja.toLowerCase()}zca(Ja,sb){if(!this.xB()){Ja=this.Lbi(sb.GZa);sb=this.Obi(sb.pre);var ub=new sl.a(Ja,sb);sb=new va.a(0,1,0,()=>{this.ka.raiseEvent("PU",ub)},57);this.fb.rb(sb)}}Lbi(Ja){const sb={};for(const Cc in Ja){var ub=Cc;const ic=this.Yfi(Ja[Cc]);ic&&ic.Yb()?sb[this.o2f(ub)]=
ic:r.ULS.sendTraceTag(562661590,302,50,"No Valid User {0}",ub)}return sb}Obi(Ja){const sb=Array(Ja.length);for(let ub=0;ub<Ja.length;ub++)sb[ub]=this.o2f(Ja[ub]);return sb}Jgc(Ja,sb){if(!this.xB()){var ub={};Ja=sb.GZa;for(var Cc in Ja)ub[this.o2f(Cc)]=Ja[Cc];Cc=new va.a(0,1,0,()=>{this.ka.raiseEvent("PSU",new tk.a(sb.type,ub))},80);this.fb.rb(Cc)}}bOc(Ja,sb){if(!this.xB()){Ja=this.Obi(sb.$me);var ub=new Ng.a(Ja);Ja=new va.a(0,1,0,()=>{this.ka.raiseEvent("PSC",ub)},81);this.fb.rb(Ja)}}Ana(Ja,sb){this.HCh?
this.wbj(sb):(Ja=new va.a(0,1,0,()=>{this.wbj(sb)},58),this.fb.rb(Ja))}wbj(Ja){var sb=Date.now();this.ka.raiseEvent("UN",Ja);sb=Date.now()-sb;500<=sb&&(this.Mge++,r.ULS.sendTraceTag(42563487,302,15,"Update Notification Heuristics: UpdateNotification Type {0} took {1} ms",Ja.type,sb),this.Gll(Ja));this.Ayf++}Gll(Ja){0>Ja.type||21<=Ja.type?r.ULS.sendTraceTag(42541602,302,15,"Update Notification Heuristics: UpdateNotification Type out of range {0}",Ja.type):this.Axc[Ja.type]++}Irm(){if(!this.yBh){var Ja=
{};Ja.TC=this.Ayf;Ja.HRC=this.Mge;this.Axc&&0<this.Mge&&(Ja.TBC=this.Axc);this.Mge=this.Ayf=0;this.Axc=null;r.ULS.sendTraceTag(42541603,302,50,"UpdateNotificationHeuristics: {0}",Ja);this.yBh=!0}}dispose(){this.Xxb=new df.a;this.Ss.IQd(Object(c.a)(this,this.fta,"onConnectionStateChanged"));this.Ss.tjc(Object(c.a)(this,this.zca,"onPresenceUpdated"));this.Ss.EUe(Object(c.a)(this,this.Jgc,"onPersistentStateUpdated"));this.Ss.DUe(Object(c.a)(this,this.bOc,"onPersistentStateCleared"));this.Ss.CQc(Object(c.a)(this,
this.Ana,"onUpdateNotificationReceived"));this.Eia&&this.Eia.continueWith(()=>{this.Eia.Jm||this.Eia.Vh||this.Eia.result.G7m(Object(c.a)(this,this.p8i,"onAmIAloneChanged"))});this.Ss.disconnect();r.ULS.sendTraceTag(4564935,302,50,"Disposing of rtcProxyCompleted")}p8i(){this.Q9h()}Q9h(){let Ja=!1;this.Eia?this.Eia.continueWith(()=>{this.Eia.Jm||this.Eia.Vh||(Ja=!this.Eia.result.amIAlone);this.Ss.connectionState||!Ja&&!this.J9j()?2!==this.Ss.connectionState||Ja||(this.disconnect(),r.ULS.sendTraceTag(4564937,
302,50,"Disconnecting because there are no other users in the doc")):(this.connect(),r.ULS.sendTraceTag(4564936,302,15,"Connecting because there are other authors in the doc"));!this.MEh&&Ja&&(r.ULS.sendTraceTag(4203466,302,50,"There are other real-time authors in this session"),this.MEh=!0)}):(this.connect(),r.ULS.sendTraceTag(589321547,302,50,"Connecting to rtc because Rtc Always On is enabled"))}apd(){this.$kf=!0;this.disconnect();r.ULS.sendTraceTag(4564938,302,50,"DisconnectForever")}}Object(f.a)(yh,
"RtcProxy",null,[1098,12,845,1099]);class Bj extends yh{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf,rh,Li){super(Ja,sb,ub,Cc,ic,Ud,Li);this.tL=null;this.eN=ae;this.Ic=He;this.Y0a=lf;this.H9c=Of;this.Jvf=hf;this.W1b=rh}get PH(){return this.tL||(this.tL=this.Jvf())}fta(Ja,sb){2===sb.newState&&r.ULS.sendTraceTag(4315102,302,50,"RTC Connected");this.UOn();super.fta(Ja,sb)}UOn(){this.PH&&this.PH.yV("RtcConnectionStatusLabel")}Yfi(Ja){return Bc.kRf(mc(Ja),this.eN,this.Ic,this.Y0a,this.W1b)}t_g(Ja,sb){return Object(Kg.a)(Xd,
sb)?(Ja=new Bc(this.H9c.EAi(),Ja,sb),Ab(Ja.Obg())):super.t_g(Ja,sb)}}Object(f.a)(Bj,"WordRtcProxy",yh,[]);class xi{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf,rh,Li){this.Ko=new t.a;this.ZNh=!0;this.Ad=sb;this.fb=ub;this.xB=Cc;this.T0a=ic;this.eN=Ud;this.lGa=ae;this.Y0a=He;this.H9c=lf;this.Jvf=Of;this.XFa=hf;this.W1b=rh;this.va=Li}LN(){this.$Gn();return this.Ko.task}Vud(){return $g.a.then(this.LN(),Ja=>Ja)}$Gn(){if(this.ZNh)if(this.ZNh=!1,la.App.fHe()&&la.App.mKc()){var Ja=m.AFrameworkApplication.Gd;
if(Ja){Ja=Nk.RealtimeChannel.createInstance("{"+m.AFrameworkApplication.userSessionId+"}",m.AFrameworkApplication.userSessionId,m.AFrameworkApplication.ZVe,Ja,this.XFa,1,this.Ad,this.va.Ga("RtcEndpointUrl"),void 0,void 0,null,this.va.ea("FindSessionOnBootIsEnabled")?da.a.instance.resolve("Common.IFindSessionUtils"):null,this.va.Ga("RtcBootToken"));var sb=this.va.ea("RtcAlwaysOnEnabled"),ub=new Bj(Ja,sb?null:la.App.Sra(),this.fb,this.xB,xi.rol,this.T0a,this.eN,this.lGa,this.Y0a,this.H9c,this.Jvf,this.W1b,
m.AFrameworkApplication.K);la.App.syj(ub);this.S3m(ub);ub.init();ql.App.Msb=ub;this.XFa.execute(Cc=>{Cc.SBb(()=>{ub.apd()})});this.Ko.mf(ub)}else r.ULS.sendTraceTag(8206365,302,15,"Can't initialize the RtcProxy because ClientRequestManager is null")}else r.ULS.sendTraceTag(8206362,302,10,"Can't initialize the RtcProxy because dependent scripts are not loaded")}S3m(Ja){const sb=da.a.instance;sb.ha("WordEditor.Presence.WordRtcProxy",()=>Ja).as("Box4.Presence.IRtcProxy").as("Common.IRealtimeChannelBasic").singleInstance();
sb.resolve("Common.IRealtimeChannelBasic")}static rol(){return!1}}Object(f.a)(xi,"WordRtcProxyProvider",null,[748,749]);class Ue{constructor(){this.Z=null;this.kj=!1}get name(){return"WordEditor.Presence"}init(){r.ULS.sendTraceTag(50995799,302,50,"PresencePackage Init");la.App.V4e&&(this.Z.resolve("WordEditor.Presence.WordRtcProxyProvider").LN(),Pe.init(),this.Z.resolve("WordEditor.Presence.WordPresenceUpdateMonitor"));la.App.v5b&&vi.init();this.Z.resolve("Common.App.Presence.AwayManager");this.Z.resolve("Common.IPeopleInfoProvider");
if(Ue.nBh){const Ja=this.Z.resolve("WordEditor.IMainViewModeManager");Ja.Ayc(this.WJg);Ue.bOa=1===Ja.XG}}dispose(){if(!this.kj){this.kj=!0;Pe.LN().continueWith(()=>{Ye.a.np(Pe.LN().result)});var Ja=this.Z.resolve("Box4.Presence.MyPresenceUser");Ja&&Ja.iPc&&Ja.iPc.o8m(Pe.caj)}}Hb(Ja){this.Z=Ja;this.Z.ha("Box4.Presence.MyPresenceUser",()=>new ta).as("Box4.Presence.IMyPresenceUser").as("Common.IPresenceUser").as("Common.IPresenceConverter").singleInstance();Ja.ha("WordEditor.Presence.IWordPresenceCpFactory",
()=>new kl(Ja.resolve("Box4.CpConversionManagerImpl"),Ja.resolve("Box4.IContentControlReader"))).singleInstance();Ja.ha("WordEditor.Presence.WordPresenceUpdateMonitor",()=>new Kj(new F.a(()=>la.App.lc),Bh.a.instance,Ja.resolve("WordEditor.Presence.WordRtcProxyProvider").Vud(),Ja.resolve("Box4.Presence.IMyPresenceUser"))).singleInstance();Ja.ha("WordEditor.Presence.WordRtcProxyProvider",()=>new xi(m.AFrameworkApplication.buildVersion,la.App.oa.Np,fb.a.instance,()=>m.AFrameworkApplication.mi,da.a.instance.resolve("Box4.Presence.IMyPresenceUser"),
da.a.instance.sa("WordEditor.ParagraphWordIdMapping"),da.a.instance.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),()=>m.AFrameworkApplication.la&&la.App.oa.za&&la.App.oa.za.jc?la.App.oa.za.jc.kd:null,Oj.instance,()=>da.a.instance.sa("WordEditor.IStatusBarUser"),da.a.instance.Ca("Common.ISessionExpirationManager"),da.a.instance.resolve("WordEditor.Presence.IWordPresenceCpFactory"),m.AFrameworkApplication.K)).singleInstance().as("Box4.Presence.IRtcProxyProvider").as("Common.Interface.IRtcBasicProvider");
Ja.ha("Box4.Presence.PresenceControlProvider",()=>new $k(Ue.Z4k(),Cd.a.instance,da.a.instance.Ca("Common.IZoomManager"),da.a.instance.resolve("Box4.ICoauthCashTelemetry"),ia.a.ot(da.a.instance.Ca("Common.ISystemInitiatedFeedbackWithTimeLapse")),m.AFrameworkApplication.K,Ja.resolve("Common.IPeopleInfoProvider"))).singleInstance();Ja.ha("Common.App.Presence.AwayManager",()=>new of(da.a.instance.resolve("Common.IPresenceUser"),da.a.instance.resolve("WordEditor.Presence.WordRtcProxyProvider").Vud(),Pe.LKl(),
da.a.instance.resolve("Common.IPresenceConverter"),fb.a.instance,m.AFrameworkApplication.K.ea("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:m.AFrameworkApplication.K.jb("AwayCoauthorThresholdMs",9E5),Object(c.a)(m.AFrameworkApplication.pa,m.AFrameworkApplication.pa.processAction,"processAction"),la.App.oa.notificationBar,m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled"))).singleInstance();Ja.ha("WordEditor.Presence.WordPresenceStatusProvider",()=>new Jh(ia.a.ot(da.a.instance.Ca("Common.ICurrentPageCalculator")))).as("Common.IPresenceStatusProvider").singleInstance();
Ja.ha("Common.App.Presence.PeopleInfoProvider",()=>new cg(Ja.resolve("WordEditor.Presence.WordRtcProxyProvider").Vud(),la.App.Sra().CWR(()=>la.App.Sra().result.gF),Ja.resolve("Common.App.People.IPeopleColorUtils"),Ja.resolve("Common.IPresenceConverter"),ia.a.ot(Ja.Ca("Common.App.Presence.AwayManager")))).as("Common.IPeopleInfoProvider").singleInstance();Ja.ha("Box4.Presence.WordPresenceDataManager",()=>new Rd(la.App.oa.za.jc.kd,da.a.instance.resolve("Box4.IFeatureHelper"))).as("Box4.IPresenceDataManager").singleInstance()}WJg(Ja,
sb){la.App.oa&&la.App.oa.Ow&&(Ue.lbe=null,Ue.bOa=1===sb.Mfc)}static get ocj(){if(!Ue.lbe&&la.App.oa&&la.App.oa.Ow){const Ja=ql.App.wn.Ow;Ue.lbe=Ue.bOa&&Ue.nBh?Ja.getElementsByClassName("PaginatedContentContainerDisplayWrapper")[0]:Ja.getElementsByClassName("OutlineContainerDisplayWrapper")[0]}return Ue.lbe}static Z4k(){const Ja=m.AFrameworkApplication.K.ea("PeoplesWellExtraButtonInfoIsEnabled"),sb=m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.PresenceIgnoreEventOnExpandedTooltip",
!1),ub=m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.PresenceIpWidthAdjustForFlyout",!1),Cc=new Ga;Cc.add(Jg.multipleBrowsersImageClassName,Xe.getImageClassWithCluster(m.AFrameworkApplication.YL,"MoreUsersGlyph16"));Cc.add(Jg.multipleBrowserImageClusterPath,m.AFrameworkApplication.ln);Cc.add(Jg.peopleImageClassName,Xe.getImageClassWithCluster(m.AFrameworkApplication.YL,Ja?"DoughboyWhiteGlyph_20x20x32":"SingleCollabUserGlyph16"));Cc.add(Jg.peopleImageClusterPath,m.AFrameworkApplication.ln);
Cc.add(Jg.zIndex,1);Cc.add(Jg.rtl,m.AFrameworkApplication.isRtl);Cc.add(Jg.viewportBoundsCallback,Ue.gTl);Cc.add(Jg.ignoreEventOnExpandedTooltip,sb);Cc.add(Jg.ipWidthAdjustForFlyout,ub);return Ja?new mf(Cc):new Ah(Cc)}static gTl(){return Ue.ocj?th.a.getElementBounds(Ue.ocj):null}}Ue.bOa=!0;Ue.nBh=m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.FlippedFlyoutForPaginationViewIsEnabled",!1);Ue.lbe=null;Object(f.a)(Ue,"WordPresencePackage",null,[1,2]);var sf=b(916),lm=b(1218),
Sc=b(921),De=b(143);class uk{constructor(Ja,sb){this.uBf=Ja;this.paragraphId=sb}get opType(){return 2}get operation(){return this.uBf}}Object(f.a)(uk,"RttAppliedAddParagraphOp",null,[155]);class Th{constructor(Ja,sb){this.g$m=Ja;this.paragraphId=sb}get opType(){return 6}get operation(){return this.g$m}}Object(f.a)(Th,"RttAppliedReplaceSymbolRangeOp",null,[155]);class kc{constructor(Ja,sb){this.i$m=Ja;this.paragraphId=sb}get opType(){return 1}get operation(){return this.i$m}}Object(f.a)(kc,"RttAppliedReplaceTextRangeOp",
null,[155]);class ei{constructor(Ja,sb,ub){this.HEj=Ja;this.n_e=sb;this.Dnd=ub}get opType(){return 4}get operation(){return this.HEj}get Csk(){return this.HEj.VBc()?this.Dnd:this.n_e}}Object(f.a)(ei,"RttAppliedSplitParagraphOp",null,[155]);class jg{constructor(){this.bxb=new bb.a}Ztg(Ja){return Ja.toString()}zfd(Ja,sb){Ja=this.Ztg(Ja);this.bxb.Na(Ja)||this.bxb.$(Ja,new M.a);this.bxb.J(Ja).add(sb)}mIg(Ja){switch(Ja.opType){case 1:var sb=Object(k.a)(kc,Ja);this.zfd(sb.paragraphId,Ja);break;case 6:sb=
Object(k.a)(Th,Ja);this.zfd(sb.paragraphId,Ja);break;case 4:sb=Object(k.a)(ei,Ja);this.zfd(sb.n_e,Ja);this.zfd(sb.Dnd,Ja);break;case 2:sb=Object(k.a)(uk,Ja),this.zfd(sb.paragraphId,Ja)}}NFm(Ja){return this.ZJb(Ja)}ZJb(Ja){Ja=this.Ztg(Ja);if(!this.bxb.Na(Ja))return new M.a;const sb=this.bxb.J(Ja);this.bxb.remove(Ja);for(let ub of sb)ub.operation&&(ub.operation.Xea=null);return sb}ZHl(Ja){let sb;return({value:sb}=this.bxb.Ab(this.Ztg(Ja),sb)).returnValue?sb:new M.a}Uql(Ja){for(let sb of this.bxb.values){if(!sb.count)continue;
if(2!==sb.J(0).opType)continue;const ub=sb.J(0);if(ub.uBf.jEg===Ja)return ub}return null}}Object(f.a)(jg,"RttAppliedOpTracker",null,[136]);var gj=b(214),Vk;(function(Ja){Ja[Ja.Ohl=0]="expired";Ja[Ja.o1n=1]="dried"})(Vk||(Vk={}));Object(f.b)("RemoveChangeReason",Vk);class Ef{constructor(){this.PLa=new gj.a}Qtk(Ja){if(!Ja)return r.ULS.sendTraceTag(7685333,355,15,"Cannot add a null change to RTTStore"),!1;const sb=Ja.Ob,ub=Ja.Ui;this.PLa.Na(sb)||this.PLa.add(sb,new gj.a);this.PLa.J(sb).$(ub,Ja);return this.F6k(sb,
ub)?(r.ULS.sendTraceTag(7619921,355,15,"Detected an infinite loop in paragraph {0}, dropping the last packet!",sb),this.PLa.J(sb).remove(ub),!1):!0}r$f(Ja,sb){if(!this.PLa.Na(Ja))return null;Ja=this.PLa.J(Ja);return Ja.Na(sb)?Ja.J(sb):null}Aye(Ja){const sb=new M.a;for(let ub of this.PLa.keys){const Cc=this.PLa.J(ub);for(let ic of Cc.keys){const Ud=Cc.J(ic);Ja(Ud)&&sb.add(Ud)}}return sb}znj(Ja,sb){let ub=null;({value:ub}=this.PLa.Ab(Ja.Ob,ub)).returnValue?(Ja.activity.rGg(Vk[sb]),ub.remove(Ja.Ui),
ub.count||this.PLa.remove(Ja.Ob)):r.ULS.sendTraceTag(50938848,355,15,"Cannot remove an op that not exist in _changes. WordId: {0}; Reason: {1}",Ja.Ob,sb)}aUg(Ja){this.znj(Ja,1)}eUg(Ja){this.znj(Ja,0)}F6k(Ja,sb){if(!this.PLa.Na(Ja))return!1;Ja=this.PLa.J(Ja);if(!Ja.Na(sb))return!1;for(var ub=Ja.J(sb);ub;){ub=ub.S8;if(ub===sb)return!0;if(!Ja.Na(ub))break;ub=Ja.J(ub)}return!1}}Object(f.a)(Ef,"RttDataStore",null,[134,135]);var tn=b(281),kh=b(65),Qe=b(275),Nn=b(17);class xg{constructor(Ja,sb){this.tr=
Ja;if(this.Bk=sb)Ja=this.Bk.Oe(12),Ja.Rt(Object(c.a)(this,this.RNe,"onGraphNodeConnected")),Ja.vy(Object(c.a)(this,this.ZJb,"onGraphNodeDisconnected")),Ja.tq(Object(c.a)(this,this.M9i,"onGraphPropertyChanged"))}dispose(){if(this.Bk){const Ja=this.Bk.Oe(12);Ja.wQ(Object(c.a)(this,this.RNe,"onGraphNodeConnected"));Ja.Hta(Object(c.a)(this,this.ZJb,"onGraphNodeDisconnected"));Ja.W0(Object(c.a)(this,this.M9i,"onGraphPropertyChanged"))}}RNe(Ja,sb){4===this.tr.opType?r.ULS.shipAssertTag(9204866,355,12===
sb.node.type||11===sb.node.type,"Unexpected graph modification detected during RTT edit"):r.ULS.shipAssertTag(9204867,355,!1,"Unexpected graph modification detected during RTT edit")}ZJb(){r.ULS.shipAssertTag(9204868,355,!1,"Unexpected graph modification detected during RTT edit")}M9i(){r.ULS.shipAssertTag(9204869,355,!1,"Unexpected graph modification detected during RTT edit")}}Object(f.a)(xg,"GraphChangeValidator",null,[12]);class el{constructor(Ja,sb,ub,Cc){this.id=Ja;this.cpBegin=sb;this.cpEnd=
ub;this.wPk=Cc}PQn(Ja){var sb=this.id===Ja.id;sb&&(sb=this.wPk.replace("\u00a0"," "),Ja=Ja.characterData.substr(this.cpBegin,this.cpEnd-this.cpBegin).replace("\u00a0"," "),sb=sb===Ja);return sb}}Object(f.a)(el,"RttOpValidator",null,[187]);class jh{constructor(Ja,sb){this.Xea=this.dwb=this.activity=null;this.opType=Ja;this.metadata=sb}Pcg(){return""}serialize(){return null}}Object(f.a)(jh,"RttOp",null,[154]);class gh extends jh{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf){super(lf,He);this.Ob=Ja;this.Ui=
sb;this.MY=ub;this.uca=Cc;this.S8=ic;this.MOb=Ud;this.jK=ae}udi(){return this.MY.isEqual(this.uca,!0)?new kd.a(0,this.Ob,this.Ui,this.MY,void 0,void 0,void 0,this.jK):new kd.a(1,this.Ob,this.Ui,this.MY,this.Ob,this.Ui,this.uca,this.jK)}static qLj(Ja,sb,ub,Cc,ic){Ja=Ja.d_;if(1===Ja.DTe&&(Ja.D7a!==Ja.UWa||Ja.Uub!==Ja.mUc))return r.ULS.sendTraceTag(8914769,355,15,"We received a ReplaceRange operation spanning multiple paragraphs"),sb=ub=null,Cc=ic=-1,{returnValue:!1,MY:sb,uca:ub,Ob:Cc,Ui:ic};if(Ja.jK)return sb=
ub=null,Cc=ic=-1,{returnValue:!1,MY:sb,uca:ub,Ob:Cc,Ui:ic};ub=sb=Ja.MY;1===Ja.DTe&&(ub=Ja.uca);Cc=Ja.D7a;ic=Ja.Uub;return{returnValue:!0,MY:sb,uca:ub,Ob:Cc,Ui:ic}}}Object(f.a)(gh,"RttReplaceRangeOp",jh,[]);var Ed=b(1216),Vj=b(383),hj=b(546);class zf extends hj.a{constructor(){super();this.RttStatusRecords=this.FileId=null}Jk(){return 110}static JR(Ja,sb){const ub=new zf;ub.FileId=Ja;ub.RttStatusRecords=sb;return ub}}Object(f.a)(zf,"RttStatusRequest",hj.a,[]);class Ke{}Object(f.a)(Ke,"RttStatusOp",
null,[]);class Bg{constructor(){this.contentState=this.contentType=this.timeToRender=this.strictlySequentialId=this.packetVersion=this.clientType=this.clientId=this.packetId=null}}Object(f.a)(Bg,"WireRttStatusOpRecord",null,[]);class wj extends Vj.a{constructor(){super();const {App:Ja}=b(158);this.lwc=new M.a;this.ptf=new M.a;this.vk=new Ed.a(m.AFrameworkApplication.K.jb("WordEditorRttStatusReplicatorIntervalMs",6E4));this.enabled=1;Ja.T8.register(this)}J_j(){const Ja=Date.now();for(let sb of this.lwc)sb.Xgc&&
1===sb.Xgc&&(sb.Xgc=2,sb.timeToRender=Ja-sb.metadata.T$g)}C5e(Ja){const sb=new Ke;sb.metadata=Ja.operation.metadata;sb.opType=Ja.opType;sb.Xgc=1;this.lwc.add(sb)}get MBa(){return"RttStatusReplicator"}Jba(){return this.Md&&2===this.Md.status?!0:1===this.enabled&&this.vk.h4()?this.lH():!1}lH(){for(let Ja of this.lwc)if(Ja.Xgc&&2===Ja.Xgc)return!0;return!1}u8a(){if(1===this._state){this._state=3;const sb=this.lwc.toArray().filter(ub=>2===ub.Xgc);var Ja=this.k0k(sb);Ja=zf.JR(m.AFrameworkApplication.rootQuerySignature,
Ja);sb.forEach(ub=>this.lwc.remove(ub));sb.forEach(ub=>this.ptf.add(ub));this.Md.Pq=Ja;this.Md.RE="RttStatusRequest";this.Md.status=1}else 3===this._state&&this.Md&&2===this.Md.status&&(this.vk.e9(),2!==this.Md.statusCode&&this.lwc.$B(0,this.ptf),this.ptf.clear(),this._state=1)}k0k(Ja){const sb=[];Ja.forEach(ub=>{const Cc=new Bg;Cc.clientId=ub.metadata.clientId;Cc.clientType=ub.metadata.clientType;Cc.packetId=ub.metadata.packetId;Cc.packetVersion=ub.metadata.packetVersion;Cc.strictlySequentialId=
ub.metadata.strictlySequentialId;Cc.contentType=ub.opType;Cc.contentState=ub.Xgc;Cc.timeToRender=ub.timeToRender;sb.push(Cc)});return sb}VSc(){return!0}BI(){}forceOutbound(){}}Object(f.a)(wj,"RttStatusReplicator",Vj.a,[]);class Ok{constructor(Ja,sb,ub,Cc,ic,Ud){this.packetId=Ja;this.clientId=sb;this.clientType=ub;this.T$g=Cc;this.packetVersion=ic;this.strictlySequentialId=Ud}static create(Ja){let sb=null;null!=Ja.strictlySequentialId&&(sb=Ja.strictlySequentialId);return new Ok(Ja.packetId,Ja.clientId,
Ja.client,Date.now(),Ja.version,sb)}}Object(f.a)(Ok,"RttOpMetadata",null,[]);class Yb extends jh{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf){super(4,lf);this.S8=0;this.Ob=Ja;this.Ui=sb;this.offset=ub;this.jK=Cc;this.Bhh=ic;this.D$g=Ud;this.$4e=ae;this.E$g=He;this.Bhh===this.Ob?this.S8=this.D$g:this.$4e===this.Ob?this.S8=this.E$g:(r.ULS.sendTraceTag(8397766,355,10,"Bad data passed to RttSplitParagraphOp"),this.S8=0)}VBc(){return this.Ob===this.$4e}get jDn(){return this.S8}get SSn(){return this.VBc()?this.Bhh:
this.$4e}get vIj(){return this.VBc()?this.D$g:this.E$g}serialize(){const Ja=new kd.a(3,this.Ob,this.Ui,this.offset,null,null,null,this.jK),sb=new Zb(this.Bhh,this.D$g,this.$4e,this.E$g);return new Jb(this.metadata.packetId,this.metadata.clientId,1,4,Ja,null,void 0,void 0,void 0,void 0,sb,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ja){const sb=Ja.d_,ub=Ja.Lmc;return new Yb(sb.D7a,sb.Uub,sb.MY,sb.jK,ub.lLg,ub.C$g,ub.mLg,ub.F$g,Ok.create(Ja))}static dNl(Ja,sb,ub){if(1!==Ja.type)return null;
const Cc=ub.F7a(Ja.sQ.characterData,Ja.sQ.ja);return new Yb(Ja.sQ.Ob,Ja.sQ.Ui,ub.kWc(Cc,Ja.wEj),Ja.jK,Ja.e2b.Ob,Ja.e2b.Ui,Ja.jid.Ob,Ja.jid.Ui,sb)}}Object(f.a)(Yb,"RttSplitParagraphOp",jh,[132,154]);class Ua{constructor(Ja,sb,ub,Cc){this.kva=Ja;this.H8c=sb;this.Mva=ub;this.P0b=Cc;null!=m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.WordEditorRttStatusReplicatorIsEnabled",!1)&&(this.m_b=new wj,tn.GraphTransactionManager.instance.qCf(Object(c.a)(this,
this.rCm,"onAllViewsUpdatedEvent")))}rCm(){this.m_b.J_j()}XDk(Ja,sb,ub,Cc=null){if(sb.isDirty)return Cc&&Cc.properties.$(Ua.rdj,"1"),!1;const ic=new xg(Ja,sb.Bf);try{if(1===Ja.opType||6===Ja.opType){const He=Object(k.a)(gh,Ja),lf=this.PXk(He,sb);var Ud=lf.node.characterData;const Of=10<=lf.cpBegin?lf.cpBegin-10:0;let hf=lf.cpEnd+10<=Ud.length?lf.cpEnd+10:Ud.length;const rh=Ud.substr(Of,lf.cpBegin-Of),Li=Ud.substr(lf.cpEnd,hf-lf.cpEnd);hf=hf+He.MOb.length-(lf.cpEnd-lf.cpBegin);var ae=new el(lf.node.id,
Of,hf,rh+He.MOb+Li);const Jj=6===He.opType;Ud="";Jj&&(Ud=He.font);if(!this.U9m(lf,He.MOb,Jj,Ud,Cc))return!1;let Fg;Fg=1===Ja.opType?new kc(He,sb.id):new Th(He,sb.id);sb.Raa=Ja.S8;He.dwb=ae;Ja.Xea=Fg;ub.mIg(Fg);null!=this.m_b&&this.m_b.C5e(Fg)}else return 4===Ja.opType?this.WDk(Ja,sb,ub):!1}finally{ic&&ic.dispose()}return!0}WDk(Ja,sb,ub){const Cc=Object(k.a)(Yb,Ja);var ic=this.P0b.F7a(sb.characterData,sb.ja);ic=this.P0b.G5b(ic,Cc.offset);if(!this.kUi(tb.a.createTextRange(sb,0,dc.ParagraphReader.textLength(sb))))return!1;
var Ud=vj.GraphIterator.ua(sb);Ud.La(10);if(this.HKc(Ud))return!1;let ae;Ud=this.Mva.Wb(3);try{Ud.Sa(sb);const He=sb.oT();try{const lf=vj.GraphIterator.ua(sb);lf.La(10);lf.tc(11);let Of=lf.currentNode;Cc.VBc()&&(lf.zFe?Of=null:(lf.lx(),Of=lf.currentNode));lf.hb();const hf=this.H8c.V5b();lf.zE(hf,Of,89);lf.rg(hf);ae=sb.clone();const rh=ae.oT();try{ae.setValue(Hh.a.Ob,Cc.SSn);ae.setValue(Hh.a.Ui,Cc.vIj);ae.isDirty=!1;lf.Re(ae,2);lf.rg(ae);this.cZk(sb,ae);const Li=Cc.VBc()?ae:sb,Jj=Cc.VBc()?sb:ae;Li.OG=
!0;Jj.OG=!0;this.kva.SUe(this.tDb(Li,ic,dc.ParagraphReader.textLength(Li)),"",!1,"");this.kva.SUe(this.tDb(Jj,0,ic),"",!1,"");sb.Raa=Cc.jDn;ae.Raa=Cc.vIj}finally{rh&&rh.dispose()}}finally{He&&He.dispose()}Ud.TXa()}finally{Ud&&Ud.dispose()}sb=new ei(Cc,sb.id,ae.id);Ja.Xea=sb;ub.mIg(sb);null!=this.m_b&&this.m_b.C5e(sb);return!0}HKc(Ja){const sb=new vj.GraphIterator;sb.Cb(Ja);sb.tc(11);return kh.ListReader.Bh(sb)?(r.ULS.sendTraceTag(16868566,355,50,"Blocked RTT para operation: in a list"),!0):!1}Qkl(Ja,
sb,ub){var Cc=sb.UFb(Ja.Ob);if(Cc.equals(oc.a.nil))return null;Cc=ub.Ta(Cc);if(!Cc||!dc.ParagraphReader.nb(Cc)||!Cc.isConnected)return null;const ic=vj.GraphIterator.ua(Cc);if(!ic.La(23))return null;if(Ja.Ahh){Ja=sb.UFb(Ja.Ahh);if(Ja.equals(oc.a.nil))return null;ub=ub.Ta(Ja);if(!ub||!dc.ParagraphReader.nb(ub)||!ub.isConnected)return null;ub=vj.GraphIterator.ua(ub);if(!ub.La(23))return null;ub.tc(11);ub.lx();ub.Rc();if(ub.currentNode!==Cc)return null}return this.HKc(ic)?null:ic}WGn(Ja,sb,ub,Cc){const ic=
sb.currentNode,Ud=this.Mva.Wb(3);try{Ud.Sa(ic);sb.tc(11);const ae=sb.currentNode;sb.hb();const He=this.H8c.V5b();sb.zE(He,ae,89);sb.rg(He);const lf=Qe.a.instance.createInstance(393230),Of=lf.oT();try{lf.setValue(Nn.a.wk,""),lf.oY=!0,Cc.gjc(lf),Cc=[0],lf.setValue(Hh.a.Qo,Cc),lf.setValue(Hh.a.ir,Cc),lf.oY=!1,lf.setValue(Hh.a.Ob,Ja.jEg),lf.setValue(Hh.a.Ui,Ja.iEg),lf.isDirty=!1,sb.Re(lf,2),lf.OG=!0,lf.Raa=Ja.iEg}finally{Of&&Of.dispose()}Ud.TXa();Ja.Xea=new uk(Ja,lf.id);ub.mIg(Ja.Xea);null!=this.m_b&&
this.m_b.C5e(Ja.Xea)}finally{Ud&&Ud.dispose()}return!0}tDb(Ja,sb,ub){return sb===ub?tb.a.Kb(Ja,sb):tb.a.createTextRange(Ja,sb,ub)}U9m(Ja,sb,ub,Cc,ic=null){const Ud=Ja.node;if(Ja.cpBegin!==Ja.cpEnd&&!this.kUi(Ja))return ic&&ic.properties.$(Ua.ZMj,"1"),!1;ic=this.Mva.Wb(3);try{ic.Sa(Ud);const ae=Ud.oT();try{Ud.OG=!0,this.kva.SUe(Ja,sb,ub,Cc)}finally{ae&&ae.dispose()}ic.TXa()}finally{ic&&ic.dispose()}return!0}cZk(Ja,sb){sb.oY=!0;sb.qM(Ja.characterData);sb.Raa=Ja.Raa;sb.ja.clear();for(var ub=0;ub<Ja.ja.length;ub++){const Cc=
Ja.ja.J(ub).rya(sb);sb.ja.add(Cc)}sb.$j();if(sb.wordRunProperties.length)for(Ja=0;Ja<sb.ja.length;Ja++){if((ub=sb.ja.J(Ja).formatting)&&-1!==ub.Qc)for(;sb.wordRunProperties.length<=ub.Qc;)sb.wordRunProperties.aQ(sb.wordRunProperties.length-1,256)}else r.ULS.sendTraceTag(9204881,355,15,"Cannot update WordRunProperties after splitting paragraph");sb.oY=!1}vtg(Ja){Ja=vj.GraphIterator.ua(Ja);Ja.La(23);Ja.hb();return{returnValue:89===Ja.role,iterator:Ja}}KUg(Ja){const sb=new vj.GraphIterator;sb.Cb(Ja);
sb.hb();const ub=this.Mva.Wb(3);try{ub.Sa(sb.currentNode),Ja.wg()}finally{ub&&ub.dispose()}}H5m(Ja){if(Ja.anchor)if(({iterator:sb}=this.vtg(Ja)).returnValue)this.KUg(sb);else{var sb=Ja.Ib.Mn;var ub=this.Mva.Wb(3);try{ub.Sa(Ja),Ja.load(sb.Ta(Ja.id)),Ja.anchor.sH(4)}finally{ub&&ub.dispose()}}}MXg(Ja,sb,ub){for(let Ud=sb.count-1;0<=Ud;Ud--){var Cc=sb.J(Ud);switch(Cc.opType){case 4:Cc=Object(k.a)(ei,Cc);if(!Ja.id.equals(Cc.n_e)){r.ULS.shipAssertTag(9204885,355,Ja.id.equals(Cc.Dnd));continue}Cc=ub.Ta(Cc.Dnd);
if(!Cc)break;if(!Cc||!dc.ParagraphReader.nb(Cc)){r.ULS.shipAssertTag(9204886,355,!1);break}if(!Cc.isConnected)continue;var ic=({iterator:Cc}=this.vtg(Cc)).returnValue;r.ULS.shipAssertTag(9204887,355,ic);ic&&this.KUg(Cc);break;case 2:(Cc=Object(k.a)(uk,Cc),Ja.id.equals(Cc.paragraphId))?Ja.isConnected&&(ic=({iterator:Cc}=this.vtg(Ja)).returnValue,r.ULS.shipAssertTag(16820002,355,ic),ic&&this.KUg(Cc)):r.ULS.shipAssertTag(16820001,355,!1)}}}PXk(Ja,sb){const ub=this.P0b.F7a(sb.characterData,sb.ja),Cc=
this.P0b.G5b(ub,Ja.MY);Ja=this.P0b.G5b(ub,Ja.uca);return Cc===Ja?tb.a.Kb(sb,Cc):tb.a.createTextRange(sb,Cc,Ja)}kUi(Ja){const sb=Ja.node.ja,ub=Ja.cpBegin;Ja=Ja.cpEnd;for(let Cc=0;Cc<sb.length;Cc++){const ic=sb.J(Cc);if(ic.cp>=Ja)break;if(ic.cp>=ub){if(ic.fd)return r.ULS.sendTraceTag(8242647,355,15,"Rejected unsafe wet change: range contains comment"),!1;if(ic.blob)return r.ULS.sendTraceTag(8242648,355,15,"Rejected unsafe wet change: range contains blob"),!1;if(ic.Hc||ic.Esa||ic.Bob)return r.ULS.sendTraceTag(8242649,
355,15,"Rejected unsafe wet change: range contains field"),!1}}return!0}}Ua.rdj="ParagraphAlreadyDirty";Ua.ZMj="UnsafeWetChange";Object(f.a)(Ua,"RttEditor",null,[131]);var Hb=b(1254),$b=b(233);class sc{constructor(){this.W2d=new M.a}add(Ja){this.W2d.add(Ja);return!0}Aye(Ja){const sb=new M.a;for(let ub of this.W2d)Ja(ub)&&sb.add(ub);return sb}aUg(Ja){Ja.activity.rGg("dried");this.W2d.remove(Ja)}eUg(Ja){Ja.activity.rGg("expired");this.W2d.remove(Ja)}}Object(f.a)(sc,"RttAddParagraphDataStore",null,[]);
class Wc extends jh{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He){super(2,He);this.Ob=Ja;this.Ui=sb;this.S8=ub;this.Ahh=Cc;this.jEg=ic;this.iEg=Ud;this.jK=ae}serialize(){const Ja=new kd.a(2,this.Ob,this.Ui,null,this.Ahh,null,null,this.jK),sb=new Tb(this.S8,this.jEg,this.iEg);return new Jb(this.metadata.packetId,this.metadata.clientId,1,3,Ja,null,void 0,void 0,sb,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ja){const sb=Ja.d_,ub=Ja.qyc;let Cc=null;null!=Ja.d_.UWa&&(Cc=Ja.d_.UWa);
return new Wc(sb.D7a,sb.Uub,ub.G$g,Cc,ub.oLg,ub.S8,sb.jK,Ok.create(Ja))}static $Ml(Ja,sb){return 3!==Ja.type?null:new Wc(Ja.UBa.Ob,Ja.UBa.Ui,Ja.Uym.Ui,Ja.d7a?Ja.d7a.Ob:null,Ja.kna.Ob,Ja.kna.Ui,Ja.jK,sb)}}Object(f.a)(Wc,"RttAddParagraphOp",jh,[]);class dd{constructor(Ja){this.FM=Ja}Gkj(){this.FM&&this.FM.properties.$(dd.Rmi,"1")}M_m(Ja){this.FM&&(this.FM.properties.Na(dd.pBg)||this.FM.properties.$(dd.pBg,(Ja-this.FM.startTime).toString()))}rGg(Ja){this.FM&&(this.FM.properties.$(dd.Soj,Ja),this.FM.end())}C0m(Ja){this.FM&&
this.FM.properties.$(dd.Hcj,Ja.toString())}B0m(Ja){this.FM&&this.FM.properties.$(dd.$bj,Ja)}static ejg(Ja){Ja.Xca(fj.a.gkc,dd.Rmi,Hb.a.LGj);Ja.Xca(fj.a.gkc,dd.Fil,Hb.a.LGj);Ja.Xca(fj.a.gkc,dd.pBg,Hb.a.gGk);Ja.Xca(fj.a.gkc,dd.Soj,Hb.a.$Ga);Ja.Xca(fj.a.gkc,dd.Hcj,Hb.a.$Ga);Ja.Xca(fj.a.gkc,dd.$bj,Hb.a.$Ga)}static create(Ja){if(!Ja)return null;Ja=Ja.mm(fj.a.gkc,dd.pSn);return new dd(Ja)}}dd.Rmi="FailedToFindInitialParaID";dd.Fil="FailedToFindInitialTextID";dd.pBg="MsecUntilApplied";dd.Soj="RemovedBecause";
dd.Hcj="PacketVersions";dd.$bj="OperationType";dd.pSn=48E4;Object(f.a)(dd,"RttOpActivity",null,[]);var td;(function(Ja){Ja[Ja.unknown=0]="unknown";Ja[Ja.I7n=1]="replaceTextRangeOp";Ja[Ja.QZn=2]="addParagraphOp";Ja[Ja.Q0n=3]="deleteParagraphOp";Ja[Ja.I9n=4]="splitParagraphOp";Ja[Ja.r5n=5]="mergeParagraphOp";Ja[Ja.H7n=6]="replaceSymbolRangeOp"})(td||(td={}));Object(f.b)("RttOpType",td);var oe=b(115);class Ld extends gh{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf){super(Cc,ic,Ud,ae,He,lf,Of,hf,6);this.font=
Ja;this.legacy=sb}Pcg(){return"OffsetStart: "+this.MY+"OffsetEnd: "+this.uca}serialize(){const Ja=this.udi();return new Jb(this.metadata.packetId,this.metadata.clientId,1,7,Ja,null,this.S8,this.MOb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ja){let sb,ub,Cc,ic;if(!({MY:sb,uca:ub,Ob:Cc,Ui:ic}=gh.qLj(Ja,sb,ub,Cc,ic)).returnValue)return null;let Ud,ae;if(1===Ja.text.length)Ud=!1,ae=oe.AParagraphNode.ix;else if(2===Ja.text.length)if(ya.a.Zog(Ja.text,0)&&ya.a.Yr(Ja.text,
1))Ud=!0,ae=Ja.text;else return r.ULS.sendTraceTag(8914772,355,15,"RTT symbol packet has text length 2 but is not a valid surrogate pair",Ja.qD),null;else return r.ULS.sendTraceTag(8914773,355,15,"RTT symbol packet text is of unsupported length (length must be 1 or 2)",Ja.qD),null;const He=Ja.zXd,lf=Ok.create(Ja);return new Ld(He.j9g,He.k9g,Ud,Cc,ic,sb,ub,Ja.Enc,ae,Ja.d_.jK,lf)}}Object(f.a)(Ld,"RttReplaceSymbolRangeOp",gh,[132,154]);class Mf extends gh{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He){super(Ja,
sb,ub,Cc,ic,Ud,ae,He,1)}Pcg(){return"OffsetStart: "+this.MY+"OffsetEnd: "+this.uca+"TextAddedLength: "+this.MOb.length}serialize(){const Ja=this.udi();return new Jb(this.metadata.packetId,this.metadata.clientId,1,2,Ja,null,this.S8,this.MOb,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ja){let sb,ub,Cc,ic;if(!({MY:sb,uca:ub,Ob:Cc,Ui:ic}=gh.qLj(Ja,sb,ub,Cc,ic)).returnValue)return null;let Ud="";Ja.text&&(Ud=Ja.text);const ae=Ok.create(Ja);return new Mf(Cc,ic,sb,
ub,Ja.Enc,Ud,Ja.d_.jK,ae)}static hMl(Ja,sb,ub){if(Ja.type)return null;const Cc=ub.F7a(Ja.sQ.characterData,Ja.sQ.ja);return new Mf(Ja.sQ.Ob,Ja.sQ.Ui,ub.kWc(Cc,Ja.cpBegin),ub.kWc(Cc,Ja.cpEnd),Ja.kna.Ui,Ja.pV,Ja.jK,sb)}}Object(f.a)(Mf,"RttReplaceTextRangeOp",gh,[132,154]);class Rf{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He,lf,Of,hf,rh,Li,Jj,Fg,Ni,di,Il,Jc){this.Ss=null;this.kkf=this.iSh=!1;this.O5d=!0;this.aNh=this.Ytf=this.cNh=this.$Mh=this.bNh=!1;this.l_b=Ja;this.eSb=sb;this.W6c=ub;this.zuc=Cc;this.Ja=ic;
this.eN=Ud;this.Ppa=ae;this.aj=He;this.fb=lf;this.PD=Of;this.P0b=hf;this.Bc=rh;this.jrf=Jj;this.Nb=Fg;this.XPh=Ni;this.jwc=di;this.kwc=!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1);this.DQb=Il;this.Fzf=Jc;this.W9c=new ag.a(Fa.a.Xi());this.yXc=new sc;Li.execute(Rf.ejg)}F2l(){const Ja=new va.a(3,2,Rf.t7m,Object(c.a)(this,this.Nhl,"expireWetChangesAndRender"));this.fb.rb(Ja);this.iSh=!0}init(){return this.Ppa?this.Ppa.continueWith(Object(c.a)(this,
this.bJg,"onRtcConnected")):G.Task.KL(!1)}zrg(){return this.Ja.isFeatureEnabled(194)&&this.Ja.isFeatureEnabled(151)}XTi(){return this.zrg()&&this.Ja.isFeatureEnabled(141)}bJg(){r.ULS.sendTraceTag(7685328,355,50,"All prerequisite ready for RttManager");this.Ss=this.Ppa.result;r.ULS.sendTraceTag(7685330,355,50,"Subscribing to presence updates");this.Ss.Wea(Object(c.a)(this,this.Ana,"onUpdateNotificationReceived"))}w9k(Ja){Ja=mc(Ja);if(!Ja)return null;switch(Ja.qD){case 2:return Mf.create(Ja);case 7:return Ld.create(Ja);
case 4:return this.XTi()?Yb.create(Ja):null;case 3:return this.XTi()?Wc.create(Ja):null;default:return r.ULS.sendTraceTag(8459668,355,50,"RTT packet is of unexpected operationType {0}",Ja.qD),null}}Ana(Ja,sb){if(3===sb.type&&this.zrg())if(this.zuc.value&&!this.zuc.value.pCe)r.ULS.sendTraceTag(8454939,355,15,"RTT channel did not get disconnected on lock release");else if(sb.kia){if(this.H0m(),(Ja=this.w9k(sb.kia))&&1!==Ja.metadata.clientType)switch(this.G0m(),this.kwc&&this.O5d&&(this.jwc.Qkj(),this.O5d=
!1),this.iSh||this.F2l(),Ja.opType){case 1:case 6:case 4:if(!({zf:Ja}=this.Rtk(Ja)).returnValue)break;this.XPh?this.Ttj(Ja):this.hMj(Ja);break;case 2:this.yXc.add(Ja),this.EMi(Ja),this.XPh?this.Ttj(oc.a.nil):this.gMj(Ja)}}else r.ULS.sendTraceTag(7685331,355,15,"RTT packet was empty")}Rtk(Ja){let sb=oc.a.nil;if(!this.eSb.Qtk(Ja))return{returnValue:!1,zf:sb};this.EMi(Ja);if(!this.eN)return{returnValue:!1,zf:sb};const ub=this.eN.UFb(Ja.Ob);if(ub.equals(oc.a.nil)||!this.aj.value.Ta(ub))return Ja.activity.Gkj(),
{returnValue:!1,zf:sb};this.Tkj();return{returnValue:!0,zf:ub}}Ttj(Ja){Ja.equals(oc.a.nil)||this.W9c.add(Ja.toString());this.kkf||(Ja=new va.a(0,1,200,()=>{this.oIn();this.kkf=!1},71),this.fb.rb(Ja),this.kkf=!0)}bfn(Ja){Ja=new va.a(0,1,0,Ja,71);this.fb.rb(Ja)}EMi(Ja){Ja.activity=dd.create(this.Bc);Ja.activity.C0m(Ja.metadata.packetVersion);Ja.activity.B0m(td[Ja.opType])}oIn(){var Ja=this.yXc.Aye(ub=>!ub.Xea);for(let ub of Ja)this.gMj(ub);if(this.W9c.count){Ja=null;for(var sb of this.W9c){sb=oc.a.qe(sb);
Ja=this.aj.value.Ta(sb);break}sb=this.Nb.Wb(3);try{sb.Sa(Ja);for(let ub of this.W9c)this.hMj(oc.a.qe(ub))}finally{sb&&sb.dispose()}this.W9c.clear()}}hMj(Ja){Ja=this.aj.value.Ta(Ja);let sb;const ub=this.Nb.Wb(3);try{ub.Sa(Ja);sb=this.Bc.mm(fj.a.hZh);const Cc=this.lZh(Ja,sb);sb.end();Cc&&this.$vk(Cc)}finally{ub&&ub.dispose(),this.kwc&&(this.jwc.ZRg(1),this.O5d=!0)}}gMj(Ja){var sb=this.l_b.Qkl(Ja,this.eN,this.aj.value);sb&&(this.Tkj(),this.l_b.WGn(Ja,sb,this.DQb,da.a.instance.resolve("Box4.IParagraphEditor"))&&
(sb=this.aj.value.Ta(Ja.Xea.paragraphId),this.BZh(sb,Ja),this.kwc&&(this.jwc.ZRg(1),this.O5d=!0)))}$vk(Ja){this.jrf.continueWith(()=>{if(1===Ja.opType){var sb=this.HKl(Ja);sb&&(this.jrf.result.sBf(sb),this.jrf.result.HUe(!0))}})}HKl(Ja){const sb=Ja.serialize();if(2!==sb.qD||sb.d_.UWa&&sb.d_.D7a!==sb.d_.UWa)return null;const ub=Ja.MY.clone();0<Ja.MOb.length&&(ub.u7h(),ub.cp+=Ja.MOb.length);sb.qD=0;sb.text=null;sb.d_.DTe=0;sb.d_.MY=ub;sb.d_.Uub=sb.Enc;sb.d_.UWa=null;sb.d_.mUc=null;sb.d_.uca=null;sb.Enc=
null;return Bc.kRf(sb,this.eN,this.P0b,()=>this.aj.value,this.Fzf.instance)}Nhl(){const Ja=this.aj.value;if(Ja){var sb=this.PD()-Rf.R5m,ub=this.eSb.Aye(ic=>ic.metadata.T$g<sb);0<ub.count&&this.N_m();var Cc=new $b.a;for(let ic of ub)if(this.eSb.eUg(ic),ic.Xea)switch(ic.Xea.opType){case 1:Cc.add(ic.Xea.paragraphId.toString());break;case 6:Cc.add(ic.Xea.paragraphId.toString());break;case 4:Cc.add(ic.Xea.n_e.toString()),Cc.add(ic.Xea.Dnd.toString())}ub=this.yXc.Aye(ic=>ic.metadata.T$g<sb);for(let ic of ub)this.yXc.eUg(ic),
ic.Xea&&Cc.add(ic.Xea.paragraphId.toString());for(let ic of Cc)(Cc=Ja.Ta(oc.a.qe(ic)))?Cc.OG?(this.l_b.H5m(Cc),Cc.OG||this.W6c.value.foj(Cc)):r.ULS.sendTraceTag(8765829,355,15,"Expiring wet change from paragraph with no applied changes"):r.ULS.sendTraceTag(8765828,355,15,"Expiring wet change with invalid object ID")}else this.aj.zgg&&r.ULS.sendTraceTag(7685332,355,10,"Failed to find the IObjectSpace! Wet changes will never expire")}BZh(Ja,sb){return this.W6c.value?this.W6c.value.Ssk(Ja,sb.metadata.clientId).returnValue?
!0:(r.ULS.sendTraceTag(7866379,355,15,"Unable to apply a wet change lock"),!1):(r.ULS.shipAssertTag(7866378,355,!!this.W6c.value,"Unable to apply wet changes as LockManager unavailable"),!1)}kZh(Ja,sb){this.lZh(Ja,sb)}lZh(Ja,sb){if(!Ja)return null;if(!Ja.anchor)return sb&&sb.properties.$(Rf.F6i,"1"),null;if(!Ja.hasProperty(Hh.a.Ob))return r.ULS.sendTraceTag(7619922,355,15,"Paragraph is missing the WordId property"),null;if(!Ja.hasProperty(Hh.a.Ui))return r.ULS.sendTraceTag(8197722,355,15,"Paragraph is missing the TextId property"),
null;if(Ja.hasProperty(Hh.a.XWf)&&Ja.getValue(Hh.a.XWf))return r.ULS.sendTraceTag(16815506,355,50,"RTT edit disabled in paragraph"),null;const ub=Ja.getValue(Hh.a.Ob);var Cc=Ja.Raa;sb&&(sb.properties.$(Rf.Nzm,Cc.toString()),sb.properties.$(Rf.Pzm,ub.toString()));Cc=this.eSb.r$f(ub,Cc);if(!Cc)return sb&&sb.properties.$(Rf.y6i,"1"),null;if(!this.BZh(Ja,Cc))return sb&&sb.properties.$(Rf.Yai,"1"),null;let ic=0,Ud=null;for(;Cc;){if(!this.l_b.XDk(Cc,Ja,this.DQb,sb)){sb&&sb.properties.$(Rf.DSj,"1");break}ic++;
Cc.activity.M_m(this.PD());Ud=Cc;Cc=Ja.Raa;Cc=this.eSb.r$f(ub,Cc)}0<ic&&this.hkj();sb&&sb.properties.add(Rf.ESj,ic.toString());return Ud}uQc(Ja){if(this.zrg()&&Ja.hasProperty(Hh.a.Ob)&&Ja.hasProperty(Hh.a.Ui)){var sb=Ja.getValue(Hh.a.Ob),ub=Ja.fa(Hh.a.Ui,0),Cc=this.Bc.mm(fj.a.smj),ic=this.DQb.NFm(Ja.id);0<ic.count&&(this.l_b.MXg(Ja,ic,this.aj.value),this.l6m(Ja,ic,ub));var Ud=this.DQb.Uql(sb);if(Ud&&!Ja.id.equals(Ud.paragraphId)){const ae=this.aj.value;this.bfn(()=>{const He=this.DQb.ZJb(Ud.paragraphId),
lf=ae.Ta(Ud.paragraphId);r.ULS.shipAssertTag(16820032,355,!!lf,"Could not find added graph node");lf&&(this.l_b.MXg(lf,He,ae),this.yXc.aUg(Ud.uBf))})}this.eSb.r$f(sb,ub)||this.W6c.value.foj(Ja);this.kZh(Ja,Cc);Cc.end()}}l6m(Ja,sb,ub){let Cc=!1;for(let Ud=sb.count-1;0<=Ud;Ud--){var ic=sb.J(Ud);switch(ic.opType){case 1:case 6:case 4:ic=Object(k.a)(132,ic.operation);break;default:continue}ic.S8===ub&&(Cc=!0,ic.dwb&&!ic.dwb.PQn(Ja)&&r.ULS.sendTraceTag(8765831,355,15,"Validating wet change location failed. Type {0} OffsetInfo {1} NodeId {2} ValidatorNodeId {3} ValidatorNodeCpBegin {4} ValidatorNodeCpEnd {5}",
ic.opType,ic.Pcg(),Ja.id,ic.dwb.id,ic.dwb.cpBegin,ic.dwb.cpEnd));Cc&&this.eSb.aUg(ic)}Cc&&this.hkj()}p7a(Ja){const sb=this.DQb.ZJb(Ja.id);0<sb.count&&(2===sb.J(0).opType&&sb.removeAt(0),this.l_b.MXg(Ja,sb,this.aj.value))}NSc(Ja){var sb=this.DQb.ZHl(Ja.id);for(let ub of sb)if(4===ub.opType&&(sb=Object(k.a)(ei,ub),Ja.id.equals(sb.Csk)))return!0;return!1}H0m(){this.bNh||(r.ULS.sendTraceTag(8704354,355,50,"Received a wet change"),this.bNh=!0)}G0m(){this.$Mh||(r.ULS.sendTraceTag(8185606,355,50,"Received a wet change that we could deserialize"),
this.$Mh=!0)}Tkj(){this.cNh||(r.ULS.sendTraceTag(17147533,355,50,"Received a usable wet change"),this.cNh=!0)}hkj(){this.Ytf||(r.ULS.sendTraceTag(8185607,355,50,"Successfully applied a wet change"),this.Ytf=!0)}N_m(){this.Ytf||this.aNh||(r.ULS.sendTraceTag(8185608,355,15,"Failed to apply any wet changes so far"),this.aNh=!0)}static ejg(Ja){const sb=[fj.a.hZh,fj.a.smj];for(let ub of sb)Ja.Xca(ub,Rf.ESj,Hb.a.$Ga),Ja.Xca(ub,Rf.y6i,Hb.a.$Ga),Ja.Xca(ub,Rf.F6i,Hb.a.$Ga),Ja.Xca(ub,Rf.Yai,Hb.a.$Ga),Ja.Xca(ub,
Rf.DSj,Hb.a.$Ga),Ja.Xca(ub,Ua.rdj,Hb.a.$Ga),Ja.Xca(ub,Ua.ZMj,Hb.a.$Ga);dd.ejg(Ja)}}Rf.t7m=6E4;Rf.R5m=18E4;Rf.ESj="WetChangeCount";Rf.y6i="NoChangesToApply";Rf.F6i="NodeNotConnected";Rf.Yai="CouldNotGetLock";Rf.DSj="WetChangeBlocked";Rf.Pzm="NodeWordId";Rf.Nzm="NodeTextId";Object(f.a)(Rf,"RttManager",null,[133]);class yi{constructor(Ja,sb){this.Fsj=0;this.hGb=Ja;this.Ddn=sb}Qkj(){this.Fsj=this.hGb()}ZRg(Ja){const sb=this.hGb()-this.Fsj;0<=sb&&this.Ddn.track(Math.round(sb),0===Ja?"CTB":"RTP")}}Object(f.a)(yi,
"RttPerfCounter",null,[130]);var $i=b(1729);class he{constructor(){this.gbd=new $i.a}zwk(Ja,sb){this.gbd.back()&&sb&&this.gbd.back().tya(Ja)||this.gbd.enqueue(Ja)}ZGl(){return this.gbd.isEmpty?null:this.gbd.dequeue()}}Object(f.a)(he,"RttSendDataStore",null,[129]);class fi extends jh{constructor(Ja,sb,ub,Cc){super(3,Cc);this.Ob=Ja;this.Ui=sb;this.jK=ub}get S8(){return 0}serialize(){const Ja=new kd.a(4,this.Ob,this.Ui,null,null,null,null,this.jK);return new Jb(this.metadata.packetId,this.metadata.clientId,
1,5,Ja,null,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ja){const sb=Ja.d_;return new fi(sb.D7a,sb.Uub,sb.jK,Ok.create(Ja))}static aNl(Ja,sb){return 4!==Ja.type?null:new fi(Ja.LCc.Ob,Ja.LCc.Ui,Ja.jK,sb)}}Object(f.a)(fi,"RttDeleteParagraphOp",jh,[132,154]);class Xg extends jh{constructor(Ja,sb,ub,Cc,ic,Ud,ae,He){super(5,He);this.zhh=Ja;this.uIj=sb;this.RSn=ub;this.kDn=Cc;this.jK=ic;this.oTj=Ud;this.nUc=ae}get Ob(){return this.zhh}get Ui(){return this.uIj}get S8(){return this.zhh===
this.oTj?this.nUc:0}serialize(){const Ja=new kd.a(5,this.zhh,this.uIj,null,this.RSn,this.kDn,null,this.jK),sb=new qb(this.oTj,this.nUc);return new Jb(this.metadata.packetId,this.metadata.clientId,1,6,Ja,null,void 0,void 0,void 0,sb,void 0,void 0,void 0,this.metadata.strictlySequentialId)}static create(Ja){const sb=Ja.d_,ub=Ja.bId;return new Xg(sb.D7a,sb.Uub,sb.UWa,sb.mUc,sb.jK,ub.nLg,ub.nUc,Ok.create(Ja))}static bNl(Ja,sb){return 2!==Ja.type?null:new Xg(Ja.UBa.Ob,Ja.UBa.Ui,Ja.d7a.Ob,Ja.d7a.Ui,Ja.jK,
Ja.xLe.Ob,Ja.xLe.Ui,sb)}}Object(f.a)(Xg,"RttMergeParagraphOp",jh,[132,154]);class Lm{constructor(Ja,sb,ub,Cc,ic,Ud,ae){this.Ybd=this.Jj=null;this.l$=!1;this.Fxf=this.rQh=0;this.ofe=this.rRh=!1;this.ntf=0;this.Ppa=Ja;this.vMh=sb;this.ypa=ub;this.xs=Cc;this.lGa=ic;this.Ja=Ud;this.jwc=ae;this.kwc=!!m.AFrameworkApplication.K&&m.AFrameworkApplication.K.getBooleanFeatureGate("Microsoft.Office.WordOnline.RttPerfMetricsIsEnabled",!1)}get Xp(){return this.ypa.value}init(){return this.Ppa?this.Ppa.continueWith(Object(c.a)(this,
this.bJg,"onRtcConnected")):G.Task.KL(!1)}bJg(){r.ULS.sendTraceTag(8245954,355,50,"All prerequisites ready for RttSendManager");this.Jj=this.Ppa.result;this.Jj.ZTe(this)}start(){this.l$||(this.$rg()&&this.xs.jc.uE.mzk(Object(c.a)(this,this.R$i,"onPersistenceTransactionCompleted")),this.l$=!0)}stop(){this.l$=!1;this.$rg()&&this.xs.jc.uE.k8m(Object(c.a)(this,this.R$i,"onPersistenceTransactionCompleted"))}$rg(){return this.Ja.isFeatureEnabled(194)&&this.Ja.isFeatureEnabled(161)}ofm(){return this.$rg()?
this.Ja.isFeatureEnabled(142):!1}R$i(Ja,sb){if(this.Jj&&2===this.Jj.connectionState&&(Ja=sb.uE,Ja.length))if(sb.cfa)100>this.Fxf&&(this.Fxf++,r.ULS.sendTraceTag(8270467,355,50,"Blocking send. Reason: {0} OverallSends: {1} OverallBlocked: {2}",sb.oHk,this.rQh,this.Fxf));else{for(sb=0;sb<Ja.length;sb++)if(!this.ohm(Ja[sb]))return;for(sb=0;sb<Ja.length;sb++){let ub=Ja[sb];this.vMh.zwk(ub,!ub.type&&!sb)}this.Ybd||this.E$i(this.Ybd,this.Jj)}}ohm(Ja){return Ja&&-1!==Ja.jK?!Ja.type||this.ofm()&&(3===Ja.type||
1===Ja.type)?!0:!1:!1}Pqm(){this.ofe||(this.rRh||(r.ULS.sendTraceTag(8270468,355,50,"Preparing to send RTT change"),this.rRh=!0),!this.ofe&&5>=this.ntf&&this.ntf++)}brm(){!this.ofe&&5>=this.ntf&&(r.ULS.sendTraceTag(8270469,355,50,"Sent Rtt Message"),this.ofe=!0)}E$i(Ja,sb){this.Pqm();Ja&&(Ja.Vh||Ja.Jm)&&r.ULS.sendTraceTag(8245956,355,15,"Task is faulted or cancelled with exception {0}",Ja.exception);this.kwc&&this.jwc.Qkj();(Ja=this.cNl(this.vMh.ZGl()))?(this.rQh++,this.Ybd=sb.GV(3,Ab(Ja.serialize())),
this.brm(),this.kwc&&this.jwc.ZRg(0),this.Ybd.continueWith(ub=>{this.E$i(ub,sb)})):this.Ybd=null}cNl(Ja){if(!Ja)return null;if(!this.Xp)return r.ULS.sendTraceTag(8245957,355,15,"GetParagraphAnchoredOpFromGraphTransactionOperation: CoAuth manager is null"),null;const sb=new Ok(Oj.instance.EAi(),this.Xp.Kg,1,0,0,Ec.instance.jHl());let ub=null;switch(Ja.type){case 0:ub=Mf.hMl(Ja,sb,this.lGa);break;case 4:ub=fi.aNl(Ja,sb);break;case 3:ub=Wc.$Ml(Ja,sb);break;case 2:ub=Xg.bNl(Ja,sb);break;case 1:ub=Yb.dNl(Ja,
sb,this.lGa)}return ub}}Object(f.a)(Lm,"RttSendManager",null,[127]);class Fi{constructor(){this.Z=null}get name(){return"WordEditor.RealTimeTyping"}nFl(){return la.App.lc&&la.App.lc.Mp?la.App.lc.Mp:(r.ULS.sendTraceTag(7866377,304,15,"Unable to get the lock manager"),null)}Hb(Ja){const sb=ia.a.ot(Ja.Ca("Box4.IOutlineElementEditor")),ub=ia.a.ot(Ja.Ca("Box4.IFeatureHelper")),Cc=ia.a.ot(Ja.Ca("Common.IActivityAggregationInfo")),ic=ia.a.ot(Ja.Ca("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"));
this.Z=Ja;const Ud=new bk.a;G.Task.WAA.call(null,sb,ub,Cc,ic).continueWith(()=>{Ja.ha("WordEditor.RealTimeTyping.IRttEditor",()=>new Ua(Ja.resolve("Box4.ICharacterPropertiesEditor"),Ja.resolve("Box4.IOutlineElementEditor"),Ud,Ja.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"))).singleInstance();Ja.register(yi,"WordEditor.RttPerfCounter").as("WordEditor.IRttPerfCounter").singleInstance().zd(()=>new yi(th.a.me,sf.a.QB(17,1,new lm.a(new Sc.a(.25)))));Ja.ha("WordEditor.RealTimeTyping.RttManager",
()=>new Rf(Ja.resolve("WordEditor.RealTimeTyping.IRttEditor"),new Ef(De.a.instance),new F.a(Object(c.a)(this,this.nFl,"getLockManager")),new F.a(()=>la.App.y5),Ja.resolve("Box4.IFeatureHelper"),Ja.resolve("WordEditor.ParagraphWordIdMapping"),Ja.resolve("Box4.Presence.IRtcProxyProvider").LN(),new F.a(()=>la.App.oa.za.jc.kd),fb.a.instance,()=>Date.now(),Ja.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),De.a.instance,Ja.Ca("Common.IActivityAggregationInfo"),Pe.LN(),Ud,m.AFrameworkApplication.K.ea("WordEditorThrottleAndBatchRTTRendering"),
Ja.resolve("WordEditor.IRttPerfCounter"),new jg,Ja.Ca("WordEditor.Presence.IWordPresenceCpFactory"))).as("WordEditor.RealTimeTyping.IRttManager").singleInstance();Ja.ha("WordEditor.RealTimeTyping.RttSendManager",()=>new Lm(Ja.resolve("Box4.Presence.IRtcProxyProvider").LN(),new he,new F.a(()=>la.App.lc),la.App.oa.za,Ja.resolve("WordEditor.WordTextOffsetTranslator.IWordTextOffsetTranslator"),Ja.resolve("Box4.IFeatureHelper"),Ja.resolve("WordEditor.IRttPerfCounter"))).singleInstance();this.fjg()})}fjg(){this.Z.resolve("WordEditor.RealTimeTyping.RttManager").init();
this.Z.resolve("WordEditor.RealTimeTyping.RttSendManager").init()}init(){}dispose(){}static main(){ha.a.instance.Sb(new Fi)}}Object(f.a)(Fi,"WordEditorRealTimeTypingPackage",null,[1,2]);Type.registerNamespace("BPr");Type.registerNamespace("Box4.Presence");Type.registerNamespace("RealtimePresenceUI");Type.registerNamespace("WERTT");Type.registerNamespace("WordEditor.PeoplesWellControl");Type.registerNamespace("WordEditor.Presence");Type.registerNamespace("AppRealtimeChannel");Type.registerNamespace("Common.App.CoauthTelemetry");
ma.main();Type.registerNamespace("Common.App.CollabControls");Ba.prototype.toString=ra.prototype.toString;ta.prototype.toString=ra.prototype.toString;ha.a.instance.Sb(new Ue);Fi.main();Type.registerNamespace("RealtimePresenceUI");ha.a.instance.Sb(new Vc);Type.registerNamespace("Common.App.RtcHostNotificationSubscription");W.main()}}]);

//# sourceMappingURL=https://wordwebclientbuilds.blob.core.windows.net/ooui/c5f763da10f22c3478db857ec7ab2f59faeda6ad/WordEditorDS.collab.js.map